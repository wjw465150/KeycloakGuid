
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>保护应用程序和服务指南 · KeycloakGuid中文版</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="WS">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-ace/ace.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-emphasize/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="03_Securing Applications and Services Guide.html" />
    
    
    <link rel="prev" href="02_Server Installation and Configuration Guide.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    序言
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html">
            
                    
                    Keycloak入门指南
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#1___1__概述">
            
                    
                    1. 概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#2___2__安装和启动">
            
                    
                    2. 安装和启动
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.2.1" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#3____2_1__安装分发文件">
            
                    
                    2.1. 安装分发文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.2" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#4____2_2__启动服务器">
            
                    
                    2.2. 启动服务器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.3" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#5____2_3__创建管理员帐户">
            
                    
                    2.3. 创建管理员帐户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.4" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#6____2_4__登录管理控制台">
            
                    
                    2.4. 登录管理控制台
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#7___3__创建领域和用户">
            
                    
                    3. 创建领域和用户
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.3.1" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#8____3_1__在你开始之前">
            
                    
                    3.1. 在你开始之前
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3.2" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#9____3_2__创建一个新领域">
            
                    
                    3.2. 创建一个新领域
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3.3" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#10____3_3__创建新用户">
            
                    
                    3.3. 创建新用户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3.4" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#11____3_4__用户帐户服务">
            
                    
                    3.4. 用户帐户服务
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#12___4__保护JBoss_Servlet应用程序">
            
                    
                    4. 保护JBoss Servlet应用程序
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.4.1" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#13____4_1__在你开始之前">
            
                    
                    4.1. 在你开始之前
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4.2" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#14____4_2__安装客户端适配器">
            
                    
                    4.2. 安装客户端适配器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4.3" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#15____4_3__下载，构建和部署应用程序代码">
            
                    
                    4.3. 下载，构建和部署应用程序代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4.4" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#16____4_4__创建和注册客户端">
            
                    
                    4.4. 创建和注册客户端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4.5" data-path="01_Getting Started Guide.html">
            
                <a href="01_Getting Started Guide.html#17____4_5__配置子系统">
            
                    
                    4.5. 配置子系统
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html">
            
                    
                    KeyCloak服务器安装和配置指南
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#1___1__指南概述">
            
                    
                    1. 指南概述
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#2____1_1__建议额外的外部文档">
            
                    
                    1.1. 建议额外的外部文档
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#3___2__安装">
            
                    
                    2. 安装
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.2.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#4____2_1__系统需求">
            
                    
                    2.1. 系统需求
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#5____2_2__安装分布式文件">
            
                    
                    2.2. 安装分布式文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#6____2_3__分布式目录结构">
            
                    
                    2.3. 分布式目录结构
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#7___3__选择工作模式">
            
                    
                    3. 选择工作模式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#8____3_1__独立模式">
            
                    
                    3.1. 独立模式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.1.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#9_____3_1_1__独立的启动脚本">
            
                    
                    3.1.1. 独立的启动脚本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.1.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#10_____3_1_2__独立的配置">
            
                    
                    3.1.2. 独立的配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.3.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#11____3_2__独立的集群模式">
            
                    
                    3.2. 独立的集群模式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.2.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#12_____3_2_1__独立的集群配置">
            
                    
                    3.2.1. 独立的集群配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.2.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#13_____3_2_2__独立集群启动脚本">
            
                    
                    3.2.2. 独立集群启动脚本
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.3.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#14____3_3__域集群模式">
            
                    
                    3.3. 域集群模式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.3.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#15_____3_3_1__域配置">
            
                    
                    3.3.1. 域配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.3.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#16_____3_3_2__主机控制器配置">
            
                    
                    3.3.2. 主机控制器配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.3.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#17_____3_3_3__服务器实例工作目录">
            
                    
                    3.3.3. 服务器实例工作目录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.3.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#18_____3_3_4__域启动脚本">
            
                    
                    3.3.4. 域启动脚本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.3.5" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#19_____3_3_5__集群域示例">
            
                    
                    3.3.5. 集群域示例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.3.5.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#20______设置从属控制器到域控制器的连接">
            
                    
                    设置从属控制器到域控制器的连接
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.3.5.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#21______运行启动脚本">
            
                    
                    运行启动脚本
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.3.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#22____3_4__跨数据中心复制模式">
            
                    
                    3.4. 跨数据中心复制模式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.4.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#23_____3_4_1__先决条件">
            
                    
                    3.4.1. 先决条件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#24_____3_4_2__技术细节">
            
                    
                    3.4.2. 技术细节
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#25_____3_4_3__请求处理">
            
                    
                    3.4.3. 请求处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#26_____3_4_4__模式">
            
                    
                    3.4.4. 模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.5" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#27_____3_4_5__数据库">
            
                    
                    3.4.5. 数据库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.6" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#28_____3_4_6__Infinispan缓存">
            
                    
                    3.4.6. Infinispan缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.7" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#29_____3_4_7__通信细节">
            
                    
                    3.4.7. 通信细节
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.8" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#30_____3_4_8__基本设置">
            
                    
                    3.4.8. 基本设置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.3.4.8.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#31______Infinispan服务器设置">
            
                    
                    Infinispan服务器设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.8.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#32______Keycloak服务器设置">
            
                    
                    Keycloak服务器设置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.9" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#33_____3_4_9__跨DC部署的管理">
            
                    
                    3.4.9. 跨DC部署的管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.10" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#34_____3_4_10__使网站脱机和在线">
            
                    
                    3.4.10. 使网站脱机和在线
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.11" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#35_____3_4_11__状态转移">
            
                    
                    3.4.11. 状态转移
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.12" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#36_____3_4_12__清除缓存">
            
                    
                    3.4.12. 清除缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.13" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#37_____3_4_13__调整JDG缓存配置">
            
                    
                    3.4.13. 调整JDG缓存配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.14" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#38_____3_4_14__同步或异步备份">
            
                    
                    3.4.14. 同步或异步备份
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3.4.15" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#39_____3_4_15__故障排除">
            
                    
                    3.4.15. 故障排除
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#40___4__管理子系统配置">
            
                    
                    4. 管理子系统配置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.4.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#41____4_1__配置SPI提供程序">
            
                    
                    4.1. 配置SPI提供程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#42____4_2__启动WildFly_CLI">
            
                    
                    4.2. 启动WildFly CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#43____4_3__CLI嵌入式模式">
            
                    
                    4.3. CLI嵌入式模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#44____4_4__CLI_GUI模式">
            
                    
                    4.4. CLI GUI模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.5" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#45____4_5__CLI脚本">
            
                    
                    4.5. CLI脚本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.6" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#46____4_6__CLI食谱">
            
                    
                    4.6. CLI食谱
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.4.6.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#47_____4_6_1__更改服务器的Web上下文">
            
                    
                    4.6.1. 更改服务器的Web上下文
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.6.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#48_____4_6_2__设置全局默认主题">
            
                    
                    4.6.2. 设置全局默认主题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.6.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#49_____4_6_3__添加新的SPI和提供程序">
            
                    
                    4.6.3. 添加新的SPI和提供程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.6.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#50_____4_6_4__禁用提供商">
            
                    
                    4.6.4. 禁用提供商
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.6.5" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#51_____4_6_5__更改SPI的默认提供程序">
            
                    
                    4.6.5. 更改SPI的默认提供程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.6.6" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#52_____4_6_6__配置dblock_SPI">
            
                    
                    4.6.6. 配置dblock SPI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.6.7" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#53_____4_6_7__为提供者添加或更改单个属性值">
            
                    
                    4.6.7. 为提供者添加或更改单个属性值
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.6.8" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#54_____4_6_8__从提供程序中删除单个属性">
            
                    
                    4.6.8. 从提供程序中删除单个属性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4.6.9" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#55_____4_6_9__在类型为`List`的提供程序属性上设置值">
            
                    
                    4.6.9. 在类型为List的提供程序属性上设置值
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#56___5__特征文件">
            
                    
                    5. 特征文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#57___6__关系数据库设置">
            
                    
                    6. 关系数据库设置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.6.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#58____6_1__RDBMS设置清单">
            
                    
                    6.1. RDBMS设置清单
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#59____6_2__打包JDBC驱动程序">
            
                    
                    6.2. 打包JDBC驱动程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#60____6_3__声明并加载JDBC驱动程序">
            
                    
                    6.3. 声明并加载JDBC驱动程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#61____6_4__修改Keycloak数据源">
            
                    
                    6.4. 修改Keycloak数据源
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6.5" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#62____6_5__数据库配置">
            
                    
                    6.5. 数据库配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6.6" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#63____6_6__数据库的Unicode注意事项">
            
                    
                    6.6. 数据库的Unicode注意事项
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.6.6.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#64_____6_6_1__Oracle_数据库">
            
                    
                    6.6.1. Oracle 数据库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6.6.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#65_____6_6_2__Microsoft_SQL_Server_数据库">
            
                    
                    6.6.2. Microsoft SQL Server 数据库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6.6.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#66_____6_6_3__MySQL_数据库">
            
                    
                    6.6.3. MySQL 数据库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6.6.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#67_____6_6_4__PostgreSQL_数据库">
            
                    
                    6.6.4. PostgreSQL 数据库
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#68___7__网络设置">
            
                    
                    7. 网络设置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.7.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#69____7_1__绑定地址">
            
                    
                    7.1. 绑定地址
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#70____7_2__套接字端口绑定">
            
                    
                    7.2. 套接字端口绑定
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#71____7_3__设置_HTTPS_SSL">
            
                    
                    7.3. 设置 HTTPS/SSL
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.7.3.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#72_____7_3_1__为Keycloak_Server启用SSL_HTTPS">
            
                    
                    7.3.1. 为Keycloak Server启用SSL/HTTPS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.7.3.1.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#73______创建证书和Java密钥库">
            
                    
                    创建证书和Java密钥库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.7.3.1.1.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#74_______自签名证书">
            
                    
                    自签名证书
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.7.3.1.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#75______配置Keycloak以使用密钥库">
            
                    
                    配置Keycloak以使用密钥库
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.7.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#76____7_4__传出HTTP请求">
            
                    
                    7.4. 传出HTTP请求
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.7.4.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#77_____7_4_1__传出HTTP请求的代理映射">
            
                    
                    7.4.1. 传出HTTP请求的代理映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7.4.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#78_____7_4_2__传出HTTPS请求信任库">
            
                    
                    7.4.2. 传出HTTPS请求信任库
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.8" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#79___8__集群">
            
                    
                    8. 集群
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.8.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#80____8_1__推荐的网络架构">
            
                    
                    8.1. 推荐的网络架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#81____8_2__集群示例">
            
                    
                    8.2. 集群示例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#82____8_3__设置负载均衡器或代理">
            
                    
                    8.3. 设置负载均衡器或代理
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.8.3.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#83_____8_3_1__识别客户端IP地址">
            
                    
                    8.3.1. 识别客户端IP地址
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8.3.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#84_____8_3_2__使反向代理启用HTTPS_SSL">
            
                    
                    8.3.2. 使反向代理启用HTTPS/SSL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8.3.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#85_____8_3_3__验证配置">
            
                    
                    8.3.3. 验证配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8.3.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#86_____8_3_4__使用内置负载均衡器">
            
                    
                    8.3.4. 使用内置负载均衡器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.8.3.4.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#87______使用Load_Balancer注册新主机">
            
                    
                    使用Load Balancer注册新主机
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8.3.4.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#88______Master_Bind_Addresses__主绑定地址_">
            
                    
                    Master Bind Addresses (主绑定地址)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8.3.4.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#89______Host_Slave_Bind_Addresses__主机从属绑定地址_">
            
                    
                    Host Slave Bind Addresses (主机从属绑定地址)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.8.3.5" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#90_____8_3_5__配置其他负载均衡器">
            
                    
                    8.3.5. 配置其他负载均衡器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.8.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#91____8_4__粘性会话">
            
                    
                    8.4. 粘性会话
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.8.4.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#92_____8_4_1__禁用添加路由">
            
                    
                    8.4.1. 禁用添加路由
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.8.5" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#93____8_5__多播网络设置">
            
                    
                    8.5. 多播网络设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8.6" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#94____8_6__确保集群通信安全">
            
                    
                    8.6. 确保集群通信安全
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8.7" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#95____8_7__串行化集群启动">
            
                    
                    8.7. 串行化集群启动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8.8" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#96____8_8__启动群集">
            
                    
                    8.8. 启动群集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8.9" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#97____8_9__故障排除">
            
                    
                    8.9. 故障排除
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.9" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#98___9__服务器缓存配置">
            
                    
                    9. 服务器缓存配置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.9.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#99____9_1__驱逐和到期">
            
                    
                    9.1. 驱逐和到期
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.9.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#100____9_2__复制和故障转移">
            
                    
                    9.2. 复制和故障转移
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.9.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#101____9_3__禁用缓存">
            
                    
                    9.3. 禁用缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.9.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#102____9_4__在运行时清除缓存">
            
                    
                    9.4. 在运行时清除缓存
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.10" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#103___10__Keycloak安全代理">
            
                    
                    10. Keycloak安全代理
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.10.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#104____10_1__代理安装和运行">
            
                    
                    10.1. 代理安装和运行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.10.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#105____10_2__代理配置">
            
                    
                    10.2. 代理配置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.10.2.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#106_____10_2_1__基本配置">
            
                    
                    10.2.1. 基本配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.10.3" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#107____10_3__应用程序配置">
            
                    
                    10.3. 应用程序配置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.10.3.1" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#108_____10_3_1__约束配置">
            
                    
                    10.3.1. 约束配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.10.3.2" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#109_____10_3_2__头名配置">
            
                    
                    10.3.2. 头名配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.10.4" data-path="02_Server Installation and Configuration Guide.html">
            
                <a href="02_Server Installation and Configuration Guide.html#110____10_4__Keycloak标识头">
            
                    
                    10.4. Keycloak标识头
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter active" data-level="4.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html">
            
                    
                    保护应用程序和服务指南
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#1___1__概述">
            
                    
                    1. 概述
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#2____1_1__什么是客户端适配器_">
            
                    
                    1.1. 什么是客户端适配器?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#3____1_2__支持的平台">
            
                    
                    1.2. 支持的平台
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1.2.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#4_____1_2_1__OpenID_Connect">
            
                    
                    1.2.1. OpenID Connect
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1.2.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#5______Java">
            
                    
                    Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.2.1.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#6______JavaScript__client_side_">
            
                    
                    JavaScript (client-side)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.2.1.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#7______Node_js__server_side_">
            
                    
                    Node.js (server-side)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.2.1.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#8_____1_2_2__C_">
            
                    
                    1.2.2. C
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.1.2.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#9_____1_2_3__Python">
            
                    
                    1.2.3. Python
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.2.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#10_____1_2_4__Android">
            
                    
                    1.2.4. Android
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.2.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#11_____1_2_5__iOS">
            
                    
                    1.2.5. iOS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1.2.4.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#12______Apache_HTTP_Server">
            
                    
                    Apache HTTP Server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.1.2.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#13_____1_2_6__SAML">
            
                    
                    1.2.6. SAML
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1.2.5.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#14______Java">
            
                    
                    Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.2.5.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#15______Apache_HTTP_Server">
            
                    
                    Apache HTTP Server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.1.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#16____1_3__支持的协议">
            
                    
                    1.3. 支持的协议
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1.3.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#17_____1_3_1__OpenID_Connect">
            
                    
                    1.3.1. OpenID Connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.3.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#18_____1_3_2__SAML_2_0">
            
                    
                    1.3.2. SAML 2.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.1.3.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#19_____1_3_3__OpenID_Connect_与_SAML">
            
                    
                    1.3.3. OpenID Connect 与 SAML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#20___2__OpenID_连接器">
            
                    
                    2. OpenID 连接器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#21____2_1__Java_适配器">
            
                    
                    2.1. Java 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#22_____2_1_1__Java适配器配置">
            
                    
                    2.1.1. Java适配器配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#23_____2_1_2__JBoss_EAP_WildFly_适配器">
            
                    
                    2.1.2. JBoss EAP/WildFly 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.2.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#24______安装适配器">
            
                    
                    安装适配器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.2.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#25______JBoss_SSO">
            
                    
                    JBoss SSO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.2.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#26______每个WAR配置必需">
            
                    
                    每个WAR配置必需
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.2.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#27______通过适配器子系统保护WAR">
            
                    
                    通过适配器子系统保护WAR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.2.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#28______安全域">
            
                    
                    安全域
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#29_____2_1_3__从RPM安装JBoss_EAP适配器">
            
                    
                    2.1.3. 从RPM安装JBoss EAP适配器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#30_____2_1_4__JBoss_Fuse_6_适配器">
            
                    
                    2.1.4. JBoss Fuse 6 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.4.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#31______在Fuse_6中保护Web应用程序">
            
                    
                    在Fuse 6中保护Web应用程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#32______安装Keycloak功能">
            
                    
                    安装Keycloak功能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.4.2.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#33_______从Maven存储库安装">
            
                    
                    从Maven存储库安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4.2.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#34_______从ZIP捆绑包安装">
            
                    
                    从ZIP捆绑包安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#35______保护经典WAR应用程序">
            
                    
                    保护经典WAR应用程序
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.4.3.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#36_______配置外部适配器">
            
                    
                    配置外部适配器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#37______保护部署为OSGI服务的Servlet">
            
                    
                    保护部署为OSGI服务的Servlet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#38______保护Apache_Camel应用程序">
            
                    
                    保护Apache Camel应用程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#39______Camel_RestDSL">
            
                    
                    Camel RestDSL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#40______在单独的Jetty引擎上保护Apache_CXF端点">
            
                    
                    在单独的Jetty引擎上保护Apache CXF端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4.8" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#41______在默认Jetty引擎上保护Apache_CXF端点">
            
                    
                    在默认Jetty引擎上保护Apache CXF端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4.9" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#42______安全Fuse管理服务">
            
                    
                    安全Fuse管理服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.4.9.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#43_______使用SSH身份验证来融合终端">
            
                    
                    使用SSH身份验证来融合终端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4.9.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#44_______使用JMX身份验证">
            
                    
                    使用JMX身份验证
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.4.10" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#45______保护Hawtio管理控制台">
            
                    
                    保护Hawtio管理控制台
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.4.10.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#46_______保护JBoss_EAP_6_4上的Hawtio">
            
                    
                    保护JBoss EAP 6.4上的Hawtio
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#47_____2_1_5__JBoss_Fuse_7_适配器">
            
                    
                    2.1.5. JBoss Fuse 7 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.5.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#48______在Fuse_7中保护Web应用程序">
            
                    
                    在Fuse 7中保护Web应用程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#49______安装Keycloak功能">
            
                    
                    安装Keycloak功能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.5.2.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#50_______从Maven存储库安装">
            
                    
                    从Maven存储库安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5.2.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#51_______从ZIP捆绑包安装">
            
                    
                    从ZIP捆绑包安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#52______保护经典WAR应用程序">
            
                    
                    保护经典WAR应用程序
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.5.3.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#53_______配置解析器">
            
                    
                    配置解析器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#54______保护部署为OSGI服务的Servlet">
            
                    
                    保护部署为OSGI服务的Servlet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#55______保护Apache_Camel应用程序">
            
                    
                    保护Apache Camel应用程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#56______Camel_RestDSL">
            
                    
                    Camel RestDSL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#57______在单独的Undertow引擎上保护Apache_CXF端点">
            
                    
                    在单独的Undertow引擎上保护Apache CXF端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5.8" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#58______在默认的Undertow引擎上保护Apache_CXF端点">
            
                    
                    在默认的Undertow引擎上保护Apache CXF端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5.9" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#59______保护Fuse管理服务">
            
                    
                    保护Fuse管理服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.5.9.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#60_______使用SSH身份验证来Fuse终端">
            
                    
                    使用SSH身份验证来Fuse终端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5.9.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#61_______使用JMX身份验证">
            
                    
                    使用JMX身份验证
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.5.10" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#62______保护Hawtio管理控制台">
            
                    
                    保护Hawtio管理控制台
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#63_____2_1_6__Spring_Boot_适配器">
            
                    
                    2.1.6. Spring Boot 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.6.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#64______适配器安装">
            
                    
                    适配器安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.6.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#65______必需的Spring_Boot_Adapter配置">
            
                    
                    必需的Spring Boot Adapter配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#66_____2_1_7__Tomcat_6__7_and_8_适配器">
            
                    
                    2.1.7. Tomcat 6, 7 and 8 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.7.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#67______适配器安装">
            
                    
                    适配器安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.7.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#68______每个WAR配置所需">
            
                    
                    每个WAR配置所需
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.8" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#69_____2_1_8__Jetty_9_x_适配器">
            
                    
                    2.1.8. Jetty 9.x 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.8.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#70______适配器安装">
            
                    
                    适配器安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.8.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#71______每个WAR配置必需">
            
                    
                    每个WAR配置必需
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.9" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#72_____2_1_9__Spring_Security_适配器">
            
                    
                    2.1.9. Spring Security 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.9.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#73______适配器安装">
            
                    
                    适配器安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.9.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#74______Spring安全配置">
            
                    
                    Spring安全配置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.9.2.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#75_______Java配置">
            
                    
                    Java配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.9.2.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#76_______XML配置">
            
                    
                    XML配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.9.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#77______多租户">
            
                    
                    多租户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.9.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#78______命名安全角色">
            
                    
                    命名安全角色
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.9.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#79______客户端到客户端的支持">
            
                    
                    客户端到客户端的支持
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.9.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#80______Spring_Boot集成">
            
                    
                    Spring Boot集成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.9.6.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#81_______使用Spring_Boot配置">
            
                    
                    使用Spring Boot配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.9.6.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#82_______避免Bean注册两次">
            
                    
                    避免Bean注册两次
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.10" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#83_____2_1_10__Java_Servlet_Filter_适配器">
            
                    
                    2.1.10. Java Servlet Filter 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.10.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#84______在OSGi上使用">
            
                    
                    在OSGi上使用
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.10.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#85_______安装">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.10.1.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#86_______配置">
            
                    
                    配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.11" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#87_____2_1_11__JAAS_插件">
            
                    
                    2.1.11. JAAS 插件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.12" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#88_____2_1_12__CLI___Desktop_应用">
            
                    
                    2.1.12. CLI / Desktop 应用
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.12.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#89______它是如何工作的">
            
                    
                    它是如何工作的
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.12.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#90______适配器安装">
            
                    
                    适配器安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.12.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#91______客户端配置">
            
                    
                    客户端配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.12.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#92______用法">
            
                    
                    用法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.12.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#93______例子">
            
                    
                    例子
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.13" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#94_____2_1_13__安全上下文">
            
                    
                    2.1.13. 安全上下文
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.14" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#95_____2_1_14__错误处理">
            
                    
                    2.1.14. 错误处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.15" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#96_____2_1_15__注销">
            
                    
                    2.1.15. 注销
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.16" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#97_____2_1_16__参数转发">
            
                    
                    2.1.16. 参数转发
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.17" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#98_____2_1_17__客户端身份验证">
            
                    
                    2.1.17. 客户端身份验证
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.17.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#99______客户端ID和客户端Secret">
            
                    
                    客户端ID和客户端Secret
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.17.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#100______使用签名JWT的客户端身份验证">
            
                    
                    使用签名JWT的客户端身份验证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.17.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#101______使用客户端密钥使用签名JWT进行客户端身份验证">
            
                    
                    使用客户端密钥使用签名JWT进行客户端身份验证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.17.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#102______添加自己的客户端身份验证方法">
            
                    
                    添加自己的客户端身份验证方法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.18" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#103_____2_1_18__多租户">
            
                    
                    2.1.18. 多租户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.19" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#104_____2_1_19__应用程序集群">
            
                    
                    2.1.19. 应用程序集群
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1.19.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#105______无状态令牌存储">
            
                    
                    无状态令牌存储
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.19.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#106______相对URI优化">
            
                    
                    相对URI优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.19.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#107______管理员URL配置">
            
                    
                    管理员URL配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.19.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#108______注册应用程序节点">
            
                    
                    注册应用程序节点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.1.19.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#109______刷新每个请求中的令牌">
            
                    
                    刷新每个请求中的令牌
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#110____2_2__JavaScript_适配器">
            
                    
                    2.2. JavaScript 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.2.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#111_____2_2_1__会话状态iframe">
            
                    
                    2.2.1. 会话状态iframe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#112_____2_2_2__隐式和混合流">
            
                    
                    2.2.2. 隐式和混合流
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#113_____2_2_3__与Cordova的混合应用程序">
            
                    
                    2.2.3. 与Cordova的混合应用程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#114_____2_2_4__早期的浏览器">
            
                    
                    2.2.4. 早期的浏览器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#115_____2_2_5__JavaScript适配器参考">
            
                    
                    2.2.5. JavaScript适配器参考
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.2.5.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#116______构造函数">
            
                    
                    构造函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#117______属性">
            
                    
                    属性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#118______方法">
            
                    
                    方法
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.2.5.3.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#119_______init（选项）">
            
                    
                    init（选项）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#120_______login_选项_">
            
                    
                    login(选项)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#121_______createLoginUrl_选项_">
            
                    
                    createLoginUrl(选项)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#122_______logout_选项_">
            
                    
                    logout(选项)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#123_______createLogoutUrl_选项_">
            
                    
                    createLogoutUrl(选项)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#124_______register_选项_">
            
                    
                    register(选项)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#125_______createRegisterUrl_选项_">
            
                    
                    createRegisterUrl(选项)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.8" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#126_______accountManagement__">
            
                    
                    accountManagement()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.9" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#127_______createAccountUrl__">
            
                    
                    createAccountUrl()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.10" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#128_______hasRealmRole_role_">
            
                    
                    hasRealmRole(role)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.11" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#129_______hasResourceRole_role__resource_">
            
                    
                    hasResourceRole(role, resource)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.12" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#130_______loadUserProfile__">
            
                    
                    loadUserProfile()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.13" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#131_______isTokenExpired_minValidity_">
            
                    
                    isTokenExpired(minValidity)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.14" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#132_______updateToken_minValidity_">
            
                    
                    updateToken(minValidity)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.3.15" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#133_______clearToken__">
            
                    
                    clearToken()
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.2.5.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#134______Callback_Events">
            
                    
                    Callback Events
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#135____2_3__Node_js_适配器">
            
                    
                    2.3. Node.js 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.3.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#136_____2_3_1__安装">
            
                    
                    2.3.1. 安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.3.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#137_____2_3_2__用法">
            
                    
                    2.3.2. 用法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.3.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#138_____2_3_3__安装中间件">
            
                    
                    2.3.3. 安装中间件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.3.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#139_____2_3_4__检查身份验证">
            
                    
                    2.3.4. 检查身份验证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.3.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#140_____2_3_5__保护资源">
            
                    
                    2.3.5. 保护资源
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.3.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#141_____2_3_6__其他URLs">
            
                    
                    2.3.6. 其他URLs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#142____2_4__Keycloak_看门人">
            
                    
                    2.4. Keycloak 看门人
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.4.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#143_____2_4_1__构建">
            
                    
                    2.4.1. 构建
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#144_____2_4_2__配置选项">
            
                    
                    2.4.2. 配置选项
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#145_____2_4_3__示例用法和配置">
            
                    
                    2.4.3. 示例用法和配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#146_____2_4_4__OpenID提供商通信">
            
                    
                    2.4.4. OpenID提供商通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#147_____2_4_5__HTTP路由">
            
                    
                    2.4.5. HTTP路由
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#148_____2_4_6__仅限会话的cookie">
            
                    
                    2.4.6. 仅限会话的cookie
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#149_____2_4_7__转发签名代理">
            
                    
                    2.4.7. 转发签名代理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.8" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#150_____2_4_8__转发已签名的HTTPS连接">
            
                    
                    2.4.8. 转发已签名的HTTPS连接
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.9" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#151_____2_4_9__HTTPS重定向">
            
                    
                    2.4.9. HTTPS重定向
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.10" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#152_____2_4_10__我们加密配置">
            
                    
                    2.4.10. 我们加密配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.11" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#153_____2_4_11__访问令牌加密">
            
                    
                    2.4.11. 访问令牌加密
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.12" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#154_____2_4_12__上游标题">
            
                    
                    2.4.12. 上游标题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.13" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#155_____2_4_13__自定义声明标头">
            
                    
                    2.4.13. 自定义声明标头
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.14" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#156_____2_4_14__自定义标题">
            
                    
                    2.4.14. 自定义标题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.15" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#157_____2_4_15__加密密钥">
            
                    
                    2.4.15. 加密密钥
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.16" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#158_____2_4_16__要求匹配">
            
                    
                    2.4.16. 要求匹配
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.17" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#159_____2_4_17__组要求">
            
                    
                    2.4.17. 组要求
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.18" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#160_____2_4_18__自定义页面">
            
                    
                    2.4.18. 自定义页面
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.19" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#161_____2_4_19__白名单_URL_s">
            
                    
                    2.4.19. 白名单 URL's
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.20" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#162_____2_4_20__交互_TLS">
            
                    
                    2.4.20. 交互 TLS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.21" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#163_____2_4_21__证书轮换">
            
                    
                    2.4.21. 证书轮换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.22" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#164_____2_4_22__刷新_tokens">
            
                    
                    2.4.22. 刷新 tokens
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.23" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#165_____2_4_23__注销端点">
            
                    
                    2.4.23. 注销端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.24" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#166_____2_4_24__跨域资源共享__CORS_">
            
                    
                    2.4.24. 跨域资源共享 (CORS)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.25" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#167_____2_4_25__上游URL">
            
                    
                    2.4.25. 上游URL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.26" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#168_____2_4_26__端点">
            
                    
                    2.4.26. 端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.27" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#169_____2_4_27__度量">
            
                    
                    2.4.27. 度量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.28" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#170_____2_4_28__限制">
            
                    
                    2.4.28. 限制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.4.29" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#171_____2_4_29__已知的问题">
            
                    
                    2.4.29. 已知的问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#172____2_5__其他OpenID连接库">
            
                    
                    2.5. 其他OpenID连接库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.5.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#173_____2_5_1__端点">
            
                    
                    2.5.1. 端点
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.5.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#174______授权端点">
            
                    
                    授权端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.1.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#175______令牌端点">
            
                    
                    令牌端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.1.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#176______Userinfo端点">
            
                    
                    Userinfo端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.1.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#177______注销端点">
            
                    
                    注销端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.1.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#178______证书端点">
            
                    
                    证书端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.1.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#179______内省端点">
            
                    
                    内省端点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.1.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#180______动态客户端注册端点">
            
                    
                    动态客户端注册端点
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#181_____2_5_2__验证访问令牌">
            
                    
                    2.5.2. 验证访问令牌
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#182_____2_5_3__流">
            
                    
                    2.5.3. 流
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.5.3.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#183______授权码">
            
                    
                    授权码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.3.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#184______隐式">
            
                    
                    隐式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.3.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#185______资源所有者密码凭据">
            
                    
                    资源所有者密码凭据
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.5.3.3.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#186_______使用CURL的示例">
            
                    
                    使用CURL的示例
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.3.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#187______客户端凭据">
            
                    
                    客户端凭据
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2.5.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#188_____2_5_4__重定向URI">
            
                    
                    2.5.4. 重定向URI
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#189___3__SAML">
            
                    
                    3. SAML
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#190____3_1__Java_适配器">
            
                    
                    3.1. Java 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#191_____3_1_1__通用适配器配置">
            
                    
                    3.1.1. 通用适配器配置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#192______SP元素">
            
                    
                    SP元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.1.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#193______服务提供商密钥和关键元素">
            
                    
                    服务提供商密钥和关键元素
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1.1.2.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#194_______KeyStore元素">
            
                    
                    KeyStore元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.1.2.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#195_______Key_PEMS">
            
                    
                    Key PEMS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.1.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#196______SP_PrincipalNameMapping_元素">
            
                    
                    SP PrincipalNameMapping 元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.1.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#197______RoleIdentifiers_元素">
            
                    
                    RoleIdentifiers 元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.1.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#198______IDP_元素">
            
                    
                    IDP 元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.1.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#199______IDP_SingleSignOnService_子元素">
            
                    
                    IDP SingleSignOnService 子元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.1.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#200______IDP_SingleLogoutService_子元素">
            
                    
                    IDP SingleLogoutService 子元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.1.8" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#201______IDP_Keys_子元素">
            
                    
                    IDP Keys 子元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.1.9" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#202______IDP_HttpClient_子元素">
            
                    
                    IDP HttpClient 子元素
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#203_____3_1_2__JBoss_EAP_WildFly_适配器">
            
                    
                    3.1.2. JBoss EAP/WildFly 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1.2.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#204______适配器安装">
            
                    
                    适配器安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.2.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#205______JBoss_SSO">
            
                    
                    JBoss SSO
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#206_____3_1_3__从RPM安装JBoss_EAP适配器">
            
                    
                    3.1.3. 从RPM安装JBoss EAP适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1.3.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#207______每个WAR配置">
            
                    
                    每个WAR配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.3.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#208______通过Keycloak_SAML子系统保护WAR">
            
                    
                    通过Keycloak SAML子系统保护WAR
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#209_____3_1_4__Tomcat_SAML_适配器">
            
                    
                    3.1.4. Tomcat SAML 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1.4.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#210______适配器安装">
            
                    
                    适配器安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.4.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#211______每个_WAR_配置">
            
                    
                    每个 WAR 配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#212_____3_1_5__Jetty_SAML_适配器">
            
                    
                    3.1.5. Jetty SAML 适配器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1.5.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#213______Jetty_9_适配器安装">
            
                    
                    Jetty 9 适配器安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.5.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#214______Jetty_9_每个_WAR_配置">
            
                    
                    Jetty 9 每个 WAR 配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#215_____3_1_6__Java_Servlet_过滤器适配器">
            
                    
                    3.1.6. Java Servlet 过滤器适配器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#216_____3_1_7__注册身份提供商">
            
                    
                    3.1.7. 注册身份提供商
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.8" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#217_____3_1_8__注销">
            
                    
                    3.1.8. 注销
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1.8.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#218______在群集环境中注销">
            
                    
                    在群集环境中注销
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.8.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#219______在Cross_DC场景中注销">
            
                    
                    在Cross DC场景中注销
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.9" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#220_____3_1_9__获取断言属性">
            
                    
                    3.1.9. 获取断言属性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.10" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#221_____3_1_10__错误处理">
            
                    
                    3.1.10. 错误处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.11" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#222_____3_1_11__故障排除">
            
                    
                    3.1.11. 故障排除
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.12" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#223_____3_1_12__多租户">
            
                    
                    3.1.12. 多租户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.1.13" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#224_____3_1_13__从旧版本迁移">
            
                    
                    3.1.13. 从旧版本迁移
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1.13.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#225______迁移到1_9_0">
            
                    
                    迁移到1.9.0
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1.13.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#226_______SAML_SP_客户端_适配器更改">
            
                    
                    SAML SP 客户端 适配器更改
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.3.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#227____3_2__mod_auth_mellon_Apache_HTTPD_模块">
            
                    
                    3.2. mod_auth_mellon Apache HTTPD 模块
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.2.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#228_____3_2_1__使用Keycloak配置mod_auth_mellon">
            
                    
                    3.2.1. 使用Keycloak配置mod_auth_mellon
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.2.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#229______安装包">
            
                    
                    安装包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.2.1.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#230______为Apache_SAML创建配置目录">
            
                    
                    为Apache SAML创建配置目录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.2.1.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#231______配置Mellon服务提供商">
            
                    
                    配置Mellon服务提供商
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.2.1.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#232______创建服务提供者元数据">
            
                    
                    创建服务提供者元数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.2.1.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#233______将Mellon服务提供商添加到Keycloak身份提供商">
            
                    
                    将Mellon服务提供商添加到Keycloak身份提供商
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.2.1.5.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#234_______将Mellon服务提供程序添加为领域的客户端">
            
                    
                    将Mellon服务提供程序添加为领域的客户端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.2.1.5.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#235_______添加Mellon_SP客户端">
            
                    
                    添加Mellon SP客户端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.2.1.5.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#236_______编辑Mellon_SP客户端">
            
                    
                    编辑Mellon SP客户端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3.2.1.5.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#237_______检索身份提供程序元数据">
            
                    
                    检索身份提供程序元数据
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#238___4__Docker注册表配置">
            
                    
                    4. Docker注册表配置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.4.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#239____4_1__Docker注册表配置文件安装">
            
                    
                    4.1. Docker注册表配置文件安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#240____4_2__Docker注册表环境变量覆盖安装">
            
                    
                    4.2. Docker注册表环境变量覆盖安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#241____4_3__Docker撰写YAML文件">
            
                    
                    4.3. Docker撰写YAML文件
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#242___5__客户端注册">
            
                    
                    5. 客户端注册
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.5.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#243____5_1__认证">
            
                    
                    5.1. 认证
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.5.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#244_____5_1_1__承载令牌">
            
                    
                    5.1.1. 承载令牌
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5.1.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#245_____5_1_2__初始访问令牌">
            
                    
                    5.1.2. 初始访问令牌
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5.1.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#246_____5_1_3__注册访问令牌">
            
                    
                    5.1.3. 注册访问令牌
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.5.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#247____5_2__Keycloak表示">
            
                    
                    5.2. Keycloak表示
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#248____5_3__Keycloak适配器配置">
            
                    
                    5.3. Keycloak适配器配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#249____5_4__OpenID连接动态客户端注册">
            
                    
                    5.4. OpenID连接动态客户端注册
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#250____5_5__SAML实体描述符">
            
                    
                    5.5. SAML实体描述符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#251____5_6__使用CURL的示例">
            
                    
                    5.6. 使用CURL的示例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#252____5_7__使用Java客户端注册API的示例">
            
                    
                    5.7. 使用Java客户端注册API的示例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5.8" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#253____5_8__客户端注册政策">
            
                    
                    5.8. 客户端注册政策
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#254___6__客户端注册_CLI">
            
                    
                    6. 客户端注册 CLI
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.6.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#255____6_1__配置新常规用户以使用客户端注册CLI">
            
                    
                    6.1. 配置新常规用户以使用客户端注册CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#256____6_2__配置客户端以与客户端注册CLI一起使用">
            
                    
                    6.2. 配置客户端以与客户端注册CLI一起使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#257____6_3__安装客户端注册CLI">
            
                    
                    6.3. 安装客户端注册CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#258____6_4__使用客户端注册CLI">
            
                    
                    6.4. 使用客户端注册CLI
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.6.4.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#259_____6_4_1__登录">
            
                    
                    6.4.1. 登录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6.4.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#260_____6_4_2__使用其他配置">
            
                    
                    6.4.2. 使用其他配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6.4.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#261_____6_4_3__初始访问和注册访问令牌">
            
                    
                    6.4.3. 初始访问和注册访问令牌
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6.4.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#262_____6_4_4__创建客户端配置">
            
                    
                    6.4.4. 创建客户端配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6.4.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#263_____6_4_5__检索客户端配置">
            
                    
                    6.4.5. 检索客户端配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6.4.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#264_____6_4_6__修改客户端配置">
            
                    
                    6.4.6. 修改客户端配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6.4.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#265_____6_4_7__删除客户端配置">
            
                    
                    6.4.7. 删除客户端配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6.4.8" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#266_____6_4_8__刷新无效的注册访问令牌">
            
                    
                    6.4.8. 刷新无效的注册访问令牌
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.6.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#267____6_5__故障排除">
            
                    
                    6.5. 故障排除
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#268___7__令牌交换">
            
                    
                    7. 令牌交换
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.7.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#269____7_1__内部令牌到内部令牌交换">
            
                    
                    7.1. 内部令牌到内部令牌交换
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.7.1.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#270_____7_1_1__授予Exchange权限">
            
                    
                    7.1.1. 授予Exchange权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7.1.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#271_____7_1_2__提出请求">
            
                    
                    7.1.2. 提出请求
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.7.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#272____7_2__外部令牌交换的内部令牌">
            
                    
                    7.2. 外部令牌交换的内部令牌
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.7.2.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#273_____7_2_1__授予Exchange权限">
            
                    
                    7.2.1. 授予Exchange权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7.2.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#274_____7_2_2__提出请求">
            
                    
                    7.2.2. 提出请求
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.7.3" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#275____7_3__外部令牌到内部令牌交换">
            
                    
                    7.3. 外部令牌到内部令牌交换
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.7.3.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#276_____7_3_1__授予Exchange权限">
            
                    
                    7.3.1. 授予Exchange权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7.3.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#277_____7_3_2__提出请求">
            
                    
                    7.3.2. 提出请求
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.7.4" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#278____7_4__模拟">
            
                    
                    7.4. 模拟
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.7.4.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#279_____7_4_1__授予Exchange权限">
            
                    
                    7.4.1. 授予Exchange权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7.4.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#280_____7_4_2__提出请求">
            
                    
                    7.4.2. 提出请求
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.7.5" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#281____7_5__直接赤裸裸的模拟">
            
                    
                    7.5. 直接赤裸裸的模拟
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.7.5.1" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#282_____7_5_1__授予Exchange权限">
            
                    
                    7.5.1. 授予Exchange权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7.5.2" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#283_____7_5_2__提出请求">
            
                    
                    7.5.2. 提出请求
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.7.6" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#284____7_6__使用服务帐户展开权限模型">
            
                    
                    7.6. 使用服务帐户展开权限模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7.7" data-path="03_Securing Applications and Services Guide.html">
            
                <a href="03_Securing Applications and Services Guide.html#285____7_7__交换漏洞">
            
                    
                    7.7. 交换漏洞
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html">
            
                    
                    服务器管理指南
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#1___1__概述">
            
                    
                    1. 概述
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#2____1_1__特征">
            
                    
                    1.1. 特征
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.1.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#3____1_2__安全是如何工作的_">
            
                    
                    1.2. 安全是如何工作的?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.1.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#4____1_3__核心概念和术语">
            
                    
                    1.3. 核心概念和术语
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#5___2__服务器初始化">
            
                    
                    2. 服务器初始化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#6___3__管理控制台">
            
                    
                    3. 管理控制台
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.3.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#7____3_1__Master_领域">
            
                    
                    3.1. Master 领域
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#8____3_2__创造一个新领域">
            
                    
                    3.2. 创造一个新领域
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#9____3_3__SSL模式">
            
                    
                    3.3. SSL模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#10____3_4__清除服务器缓存">
            
                    
                    3.4. 清除服务器缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#11____3_5__电子邮件设置">
            
                    
                    3.5. 电子邮件设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#12____3_6__主题与国际化">
            
                    
                    3.6. 主题与国际化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.3.6.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#13_____3_6_1__国际化">
            
                    
                    3.6.1. 国际化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#14___4__用户管理">
            
                    
                    4. 用户管理
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.4.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#15____4_1__搜索用户">
            
                    
                    4.1. 搜索用户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#16____4_2__创建新用户">
            
                    
                    4.2. 创建新用户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#17____4_3__删除用户">
            
                    
                    4.3. 删除用户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#18____4_4__用户属性">
            
                    
                    4.4. 用户属性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#19____4_5__用户凭据">
            
                    
                    4.5. 用户凭据
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.4.5.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#20_____4_5_1__更改密码">
            
                    
                    4.5.1. 更改密码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4.5.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#21_____4_5_2__修改_OTPs">
            
                    
                    4.5.2. 修改 OTPs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.4.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#22____4_6__必需操作">
            
                    
                    4.6. 必需操作
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.4.6.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#23_____4_6_1__默认必需操作">
            
                    
                    4.6.1. 默认必需操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4.6.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#24_____4_6_2__条款和条件">
            
                    
                    4.6.2. 条款和条件
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.4.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#25____4_7__模拟">
            
                    
                    4.7. 模拟
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#26____4_8__用户注册">
            
                    
                    4.8. 用户注册
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.4.8.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#27_____4_8_1__reCAPTCHA_支持">
            
                    
                    4.8.1. reCAPTCHA 支持
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#28___5__登录页面设置">
            
                    
                    5. 登录页面设置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.5.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#29____5_1__忘记密码">
            
                    
                    5.1. 忘记密码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.5.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#30____5_2__记住账号">
            
                    
                    5.2. 记住账号
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#31___6__认证">
            
                    
                    6. 认证
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.6.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#32____6_1__密码策略">
            
                    
                    6.1. 密码策略
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.6.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#33_____6_1_1__密码策略类型">
            
                    
                    6.1.1. 密码策略类型
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.6.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#34____6_2__OTP_策略">
            
                    
                    6.2. OTP 策略
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.6.2.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#35_____6_2_1__TOTP_vs__HOTP">
            
                    
                    6.2.1. TOTP vs. HOTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.2.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#36_____6_2_2__TOTP配置选项">
            
                    
                    6.2.2. TOTP配置选项
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.2.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#37_____6_2_3__HOTP配置选项">
            
                    
                    6.2.3. HOTP配置选项
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.6.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#38____6_3__身份验证流程">
            
                    
                    6.3. 身份验证流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#39____6_4__执行">
            
                    
                    6.4. 执行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#40____6_5__Kerberos">
            
                    
                    6.5. Kerberos
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.6.5.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#41_____6_5_1__Kerberos服务器的设置">
            
                    
                    6.5.1. Kerberos服务器的设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.5.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#42_____6_5_2__Keycloak服务器的设置和配置">
            
                    
                    6.5.2. Keycloak服务器的设置和配置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.6.5.2.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#43______启用SPNEGO处理">
            
                    
                    启用SPNEGO处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.5.2.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#44______配置Kerberos用户存储联合提供程序">
            
                    
                    配置Kerberos用户存储联合提供程序
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.6.5.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#45_____6_5_3__客户端计算机的设置和配置">
            
                    
                    6.5.3. 客户端计算机的设置和配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.5.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#46_____6_5_4__示例设置">
            
                    
                    6.5.4. 示例设置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.6.5.4.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#47______Keycloak_and_FreeIPA_docker_镜像">
            
                    
                    Keycloak and FreeIPA docker 镜像
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.5.4.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#48______ApacheDS测试Kerberos服务器">
            
                    
                    ApacheDS测试Kerberos服务器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.6.5.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#49_____6_5_5__凭证授权">
            
                    
                    6.5.5. 凭证授权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.5.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#50_____6_5_6__跨领域的信任">
            
                    
                    6.5.6. 跨领域的信任
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.5.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#51_____6_5_7__故障排除">
            
                    
                    6.5.7. 故障排除
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.6.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#52____6_6__X_509客户端证书用户身份验证">
            
                    
                    6.6. X.509客户端证书用户身份验证
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.6.6.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#53_____6_6_1__特征">
            
                    
                    6.6.1. 特征
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.6.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#54_____6_6_2__启用X_509客户端证书用户身份验证">
            
                    
                    6.6.2. 启用X.509客户端证书用户身份验证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.6.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#55_____6_6_3__将X_509客户端证书身份验证添加到浏览器流">
            
                    
                    6.6.3. 将X.509客户端证书身份验证添加到浏览器流
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.6.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#56_____6_6_4__将X_509客户端证书身份验证添加到直接授权流程">
            
                    
                    6.6.4. 将X.509客户端证书身份验证添加到直接授权流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.6.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#57_____6_6_5__客户端证书查找">
            
                    
                    6.6.5. 客户端证书查找
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.6.6.5.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#58______HAProxy证书查找提供程序">
            
                    
                    HAProxy证书查找提供程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.6.5.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#59______Apache证书查找提供程序">
            
                    
                    Apache证书查找提供程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.6.5.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#60______Nginx证书查找提供程序">
            
                    
                    Nginx证书查找提供程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6.6.5.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#61______其他反向代理实现">
            
                    
                    其他反向代理实现
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.6.6.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#62_____6_6_6__Troubleshooting">
            
                    
                    6.6.6. Troubleshooting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#63___7__SSO协议">
            
                    
                    7. SSO协议
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.7.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#64____7_1__OpenID_连接">
            
                    
                    7.1. OpenID 连接
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.7.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#65_____7_1_1__OIDC_Auth_Flows">
            
                    
                    7.1.1. OIDC Auth Flows
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.7.1.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#66______授权代码流程">
            
                    
                    授权代码流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.7.1.1.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#67______隐式流">
            
                    
                    隐式流
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.7.1.1.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#68______资源所有者密码凭据授予__直接访问授予_">
            
                    
                    资源所有者密码凭据授予 (直接访问授予)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.7.1.1.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#69______客户凭证授权">
            
                    
                    客户凭证授权
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.7.1.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#70_____7_1_2__Keycloak_Server_OIDC_URI端点">
            
                    
                    7.1.2. Keycloak Server OIDC URI端点
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.7.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#71____7_2__SAML">
            
                    
                    7.2. SAML
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.7.2.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#72_____7_2_1_SAML绑定">
            
                    
                    7.2.1.SAML绑定
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.7.2.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#73______重定向绑定">
            
                    
                    重定向绑定
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.7.2.1.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#74______POST_绑定">
            
                    
                    POST 绑定
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.7.2.1.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#75______ECP">
            
                    
                    ECP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.7.2.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#76_____7_2_2__Keycloak_Server_SAML_URI端点">
            
                    
                    7.2.2. Keycloak Server SAML URI端点
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.7.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#77____7_3__OpenID_Connect_与_SAML">
            
                    
                    7.3. OpenID Connect 与 SAML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.7.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#78____7_4__Docker_Registry_v2身份验证">
            
                    
                    7.4. Docker Registry v2身份验证
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.7.4.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#79_____7_4_1__Docker_验证_流程">
            
                    
                    7.4.1. Docker 验证 流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.7.4.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#80_____7_4_2__Keycloak_Docker_Registry_v2身份验证服务器URI端点">
            
                    
                    7.4.2. Keycloak Docker Registry v2身份验证服务器URI端点
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#81___8__管理客户端">
            
                    
                    8. 管理客户端
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.8.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#82____8_1__OIDC_客户端">
            
                    
                    8.1. OIDC 客户端
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.8.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#83_____8_1_1__高级设置">
            
                    
                    8.1.1. 高级设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.1.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#84_____8_1_2__机密客户端凭据">
            
                    
                    8.1.2. 机密客户端凭据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.1.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#85_____8_1_3__服务帐户">
            
                    
                    8.1.3. 服务帐户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.1.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#86_____8_1_4__受众支持">
            
                    
                    8.1.4. 受众支持
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.8.1.4.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#87______设置">
            
                    
                    设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.1.4.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#88______自动添加受众群体">
            
                    
                    自动添加受众群体
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.1.4.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#89______硬编码的受众">
            
                    
                    硬编码的受众
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.8.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#90____8_2__SAML_客户端">
            
                    
                    8.2. SAML 客户端
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.8.2.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#91_____8_2_1__IDP发起登录">
            
                    
                    8.2.1. IDP发起登录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.2.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#92_____8_2_2__SAML实体描述符">
            
                    
                    8.2.2. SAML实体描述符
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.8.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#93____8_3__客户端链接">
            
                    
                    8.3. 客户端链接
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#94____8_4__OIDC令牌和SAML断言映射">
            
                    
                    8.4. OIDC令牌和SAML断言映射
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.8.4.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#95_____8_4_1__优先顺序">
            
                    
                    8.4.1. 优先顺序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.4.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#96_____8_4_2__OIDC用户会话记录映射器">
            
                    
                    8.4.2. OIDC用户会话记录映射器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.8.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#97____8_5__生成客户端适配器配置">
            
                    
                    8.5. 生成客户端适配器配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#98____8_6__客户端作用域">
            
                    
                    8.6. 客户端作用域
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.8.6.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#99_____8_6_1__协议">
            
                    
                    8.6.1. 协议
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.6.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#100_____8_6_2__同意相关设置">
            
                    
                    8.6.2. 同意相关设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.6.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#101_____8_6_3__将客户端作用域与客户端链接">
            
                    
                    8.6.3. 将客户端作用域与客户端链接
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.8.6.3.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#102______例子">
            
                    
                    例子
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.8.6.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#103_____8_6_4__评估客户端作用域">
            
                    
                    8.6.4. 评估客户端作用域
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.8.6.4.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#104______生成示例令牌">
            
                    
                    生成示例令牌
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.8.6.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#105_____8_6_5__客户端作用域权限">
            
                    
                    8.6.5. 客户端作用域权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.6.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#106_____8_6_6__领域默认客户端作用域">
            
                    
                    8.6.6. 领域默认客户端作用域
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.6.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#107_____8_6_7__作用域解释">
            
                    
                    8.6.7. 作用域解释
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#108___9__角色">
            
                    
                    9. 角色
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.9.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#109____9_1__领域角色">
            
                    
                    9.1. 领域角色
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.9.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#110____9_2__客户端_角色">
            
                    
                    9.2. 客户端 角色
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.9.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#111____9_3__复合_角色">
            
                    
                    9.3. 复合 角色
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.9.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#112____9_4__用户角色映射">
            
                    
                    9.4. 用户角色映射
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.9.4.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#113_____9_4_1__默认角色">
            
                    
                    9.4.1. 默认角色
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.9.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#114____9_5__角色范围映射">
            
                    
                    9.5. 角色范围映射
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.10" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#115___10__组">
            
                    
                    10. 组
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.10.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#116____10_1__群组与角色">
            
                    
                    10.1. 群组与角色
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.10.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#117____10_2__默认组">
            
                    
                    10.2. 默认组
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.11" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#118___11__管理控制台访问控制和权限">
            
                    
                    11. 管理控制台访问控制和权限
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.11.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#119____11_1__Master_Realm访问控制">
            
                    
                    11.1. Master Realm访问控制
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.11.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#120_____11_1_1__Global_Roles">
            
                    
                    11.1.1. Global Roles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.1.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#121_____11_1_2__领域特定角色">
            
                    
                    11.1.2. 领域特定角色
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.11.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#122____11_2__专用领域管理控制台">
            
                    
                    11.2. 专用领域管理控制台
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#123____11_3__细粒度管理员权限">
            
                    
                    11.3. 细粒度管理员权限
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.11.3.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#124_____11_3_1__管理一个特定的客户">
            
                    
                    11.3.1. 管理一个特定的客户
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.11.3.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#125______权限设置">
            
                    
                    权限设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.3.1.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#126______测试它">
            
                    
                    测试它
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.11.3.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#127_____11_3_2__限制用户角色映射">
            
                    
                    11.3.2. 限制用户角色映射
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.11.3.2.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#128______测试它_">
            
                    
                    测试它.
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.3.2.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#129______每个客户端_映射_角色_快捷方式">
            
                    
                    每个客户端 映射-角色 快捷方式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.11.3.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#130_____11_3_3__完整的权限列表">
            
                    
                    11.3.3. 完整的权限列表
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.11.3.3.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#131______Role">
            
                    
                    Role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.3.3.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#132______客户端">
            
                    
                    客户端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.3.3.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#133______用户">
            
                    
                    用户
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.11.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#134____11_4__领域密钥">
            
                    
                    11.4. 领域密钥
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.11.4.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#135_____11_4_1__轮流密钥">
            
                    
                    11.4.1. 轮流密钥
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.4.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#136_____11_4_2__添加生成的密钥对">
            
                    
                    11.4.2. 添加生成的密钥对
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.4.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#137_____11_4_3__添加现有密钥对和证书">
            
                    
                    11.4.3. 添加现有密钥对和证书
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.4.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#138_____11_4_4__从Java密钥库加载密钥">
            
                    
                    11.4.4. 从Java密钥库加载密钥
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.4.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#139_____11_4_5__使密钥消极">
            
                    
                    11.4.5. 使密钥消极
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.4.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#140_____11_4_6__禁用密钥">
            
                    
                    11.4.6. 禁用密钥
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11.4.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#141_____11_4_7__泄露的密钥">
            
                    
                    11.4.7. 泄露的密钥
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.12" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#142___12__身份代理">
            
                    
                    12. 身份代理
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.12.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#143____12_1__经纪概述">
            
                    
                    12.1. 经纪概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#144____12_2__默认身份提供者">
            
                    
                    12.2. 默认身份提供者
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#145____12_3__一般配置">
            
                    
                    12.3. 一般配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#146____12_4__社交身份提供者">
            
                    
                    12.4. 社交身份提供者
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.12.4.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#147_____12_4_1__Bitbucket">
            
                    
                    12.4.1. Bitbucket
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.4.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#148_____12_4_2__Facebook">
            
                    
                    12.4.2. Facebook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.4.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#149_____12_4_3__GitHub">
            
                    
                    12.4.3. GitHub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.4.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#150_____12_4_4__GitLab">
            
                    
                    12.4.4. GitLab
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.4.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#151_____12_4_5__Google">
            
                    
                    12.4.5. Google
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.4.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#152_____12_4_6__LinkedIn">
            
                    
                    12.4.6. LinkedIn
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.4.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#153_____12_4_7__Microsoft">
            
                    
                    12.4.7. Microsoft
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.4.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#154_____12_4_8__OpenShift">
            
                    
                    12.4.8. OpenShift
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.4.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#155_____12_4_9__PayPal">
            
                    
                    12.4.9. PayPal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.4.10" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#156_____12_4_10__Stack_Overflow">
            
                    
                    12.4.10. Stack Overflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.4.11" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#157_____12_4_11__Twitter">
            
                    
                    12.4.11. Twitter
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.12.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#158____12_5__OpenID_Connect_v1_0_身份提供商">
            
                    
                    12.5. OpenID Connect v1.0 身份提供商
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#159____12_6__SAML_v2_0_身份提供商">
            
                    
                    12.6. SAML v2.0 身份提供商
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.12.6.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#160_____12_6_1__SP描述符">
            
                    
                    12.6.1. SP描述符
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.12.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#161____12_7__客户建议身份提供商">
            
                    
                    12.7. 客户建议身份提供商
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#162____12_8__映射声明和断言">
            
                    
                    12.8. 映射声明和断言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#163____12_9__可用的用户会话数据">
            
                    
                    12.9. 可用的用户会话数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.10" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#164____12_10__首次登录流程">
            
                    
                    12.10. 首次登录流程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.12.10.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#165_____12_10_1__默认首次登录流程">
            
                    
                    12.10.1. 默认首次登录流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.10.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#166_____12_10_2__自动链接现有的第一个登录流程">
            
                    
                    12.10.2. 自动链接现有的第一个登录流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.12.11" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#167____12_11__检索外部IDP令牌">
            
                    
                    12.11. 检索外部IDP令牌
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12.12" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#168____12_12__身份代理注销">
            
                    
                    12.12. 身份代理注销
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.13" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#169___13__用户会话管理">
            
                    
                    13. 用户会话管理
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.13.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#170____13_1__管理会话">
            
                    
                    13.1. 管理会话
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.13.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#171_____13_1_1__退出所有限制">
            
                    
                    13.1.1. 退出所有限制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.13.1.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#172_____13_1_2__应用追溯">
            
                    
                    13.1.2. 应用追溯
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.13.1.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#173_____13_1_3__用户追溯">
            
                    
                    13.1.3. 用户追溯
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.13.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#174____13_2__撤销策略">
            
                    
                    13.2. 撤销策略
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.13.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#175____13_3__会话和令牌超时">
            
                    
                    13.3. 会话和令牌超时
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.13.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#176____13_4__离线访问">
            
                    
                    13.4. 离线访问
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.14" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#177___14__用户存储联合">
            
                    
                    14. 用户存储联合
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.14.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#178____14_1__添加提供商">
            
                    
                    14.1. 添加提供商
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#179____14_2__处理提供商失败">
            
                    
                    14.2. 处理提供商失败
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#180____14_3__LDAP和Active_Directory">
            
                    
                    14.3. LDAP和Active Directory
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.14.3.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#181_____14_3_1__存储模式">
            
                    
                    14.3.1. 存储模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14.3.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#182_____14_3_2__编辑模式">
            
                    
                    14.3.2. 编辑模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14.3.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#183_____14_3_3__其他配置选项">
            
                    
                    14.3.3. 其他配置选项
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14.3.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#184_____14_3_4__通过SSL连接到LDAP">
            
                    
                    14.3.4. 通过SSL连接到LDAP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14.3.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#185_____14_3_5__LDAP用户与Keycloak的同步">
            
                    
                    14.3.5. LDAP用户与Keycloak的同步
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14.3.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#186_____14_3_6__LDAP映射器">
            
                    
                    14.3.6. LDAP映射器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14.3.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#187_____14_3_7__密码哈希">
            
                    
                    14.3.7. 密码哈希
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.14.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#188____14_4__SSSD和FreeIPA身份管理集成">
            
                    
                    14.4. SSSD和FreeIPA身份管理集成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.14.4.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#189_____14_4_1__FreeIPA_IdM服务器">
            
                    
                    14.4.1. FreeIPA/IdM服务器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14.4.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#190_____14_4_2__SSSD_and_D_Bus">
            
                    
                    14.4.2. SSSD and D-Bus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14.4.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#191_____14_4_3__启用SSSD联合提供程序">
            
                    
                    14.4.3. 启用SSSD联合提供程序
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.14.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#192____14_5__配置联合SSSD存储">
            
                    
                    14.5. 配置联合SSSD存储
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#193____14_6__定制供应商">
            
                    
                    14.6. 定制供应商
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.15" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#194___15__审计和事件">
            
                    
                    15. 审计和事件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.15.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#195____15_1__登录活动">
            
                    
                    15.1. 登录活动
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.15.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#196_____15_1_1__事件类型">
            
                    
                    15.1.1. 事件类型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.15.1.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#197_____15_1_2__事件监听器">
            
                    
                    15.1.2. 事件监听器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.15.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#198____15_2__管理事件">
            
                    
                    15.2. 管理事件
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.16" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#199___16__导出和导入">
            
                    
                    16. 导出和导入
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.16.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#200____16_1__管理控制台导出_导入">
            
                    
                    16.1. 管理控制台导出/导入
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.17" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#201___17__用户帐户服务">
            
                    
                    17. 用户帐户服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.17.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#202____17_1__主题化">
            
                    
                    17.1. 主题化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.18" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#203___18__威胁模型缓解">
            
                    
                    18. 威胁模型缓解
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.18.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#204____18_1__主机名">
            
                    
                    18.1. 主机名
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.18.1.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#205_____18_1_1__请求提供者">
            
                    
                    18.1.1. 请求提供者
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.1.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#206_____18_1_2__固定提供商">
            
                    
                    18.1.2. 固定提供商
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.1.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#207_____18_1_3__定制提供商">
            
                    
                    18.1.3. 定制提供商
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.18.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#208____18_2__管理员端点和控制台">
            
                    
                    18.2. 管理员端点和控制台
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.18.2.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#209_____18_2_1__IP限制">
            
                    
                    18.2.1. IP限制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.2.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#210_____18_2_2__端口限制">
            
                    
                    18.2.2. 端口限制
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.18.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#211____18_3__密码猜测：暴力攻击">
            
                    
                    18.3. 密码猜测：暴力攻击
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.18.3.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#212_____18_3_1__密码策略">
            
                    
                    18.3.1. 密码策略
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.18.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#213____18_4__点击劫持">
            
                    
                    18.4. 点击劫持
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#214____18_5__SSL_HTTPS要求">
            
                    
                    18.5. SSL/HTTPS要求
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#215____18_6__CSRF_攻击">
            
                    
                    18.6. CSRF 攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#216____18_7__非特定的重定向URI">
            
                    
                    18.7. 非特定的重定向URI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#217____18_8__受损的访问和刷新令牌">
            
                    
                    18.8. 受损的访问和刷新令牌
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#218____18_9__受损的授权码">
            
                    
                    18.9. 受损的授权码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.10" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#219____18_10__打开重定向器">
            
                    
                    18.10. 打开重定向器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.11" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#220____18_11__密码数据库受损">
            
                    
                    18.11. 密码数据库受损
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.12" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#221____18_12__限制范围">
            
                    
                    18.12. 限制范围
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.13" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#222____18_13__限制令牌受众">
            
                    
                    18.13. 限制令牌受众
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18.14" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#223____18_14__SQL注入攻击">
            
                    
                    18.14. SQL注入攻击
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.19" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#224___19__管理员_命令行">
            
                    
                    19. 管理员 命令行
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.19.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#225____19_1__安装Admin_CLI">
            
                    
                    19.1. 安装Admin CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#226____19_2__使用Admin_CLI">
            
                    
                    19.2. 使用Admin CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#227____19_3__认证">
            
                    
                    19.3. 认证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#228____19_4__使用其他配置">
            
                    
                    19.4. 使用其他配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#229____19_5__Basic_operations_and_resource_URIs">
            
                    
                    19.5. Basic operations and resource URIs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#230____19_6__Realm_operations">
            
                    
                    19.6. Realm operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.19.6.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#231_____Creating_a_new_realm">
            
                    
                    Creating a new realm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#232_____Listing_existing_realms">
            
                    
                    Listing existing realms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#233_____Getting_a_specific_realm">
            
                    
                    Getting a specific realm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#234_____Updating_a_realm">
            
                    
                    Updating a realm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#235_____Deleting_a_realm">
            
                    
                    Deleting a realm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#236_____Turning_on_all_login_page_options_for_the_realm">
            
                    
                    Turning on all login page options for the realm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#237_____Listing_the_realm_keys">
            
                    
                    Listing the realm keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#238_____Generating_new_realm_keys">
            
                    
                    Generating new realm keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#239_____Adding_new_realm_keys_from_a_Java_Key_Store_file">
            
                    
                    Adding new realm keys from a Java Key Store file
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.10" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#240_____Making_the_key_passive_or_disabling_the_key">
            
                    
                    Making the key passive or disabling the key
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.11" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#241_____Deleting_an_old_key">
            
                    
                    Deleting an old key
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.12" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#242_____Configuring_event_logging_for_a_realm">
            
                    
                    Configuring event logging for a realm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.13" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#243_____Flushing_the_caches">
            
                    
                    Flushing the caches
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.6.14" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#244_____Importing_a_realm_from_exported__json_file">
            
                    
                    Importing a realm from exported .json file
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.19.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#245____19_7__Role_operations">
            
                    
                    19.7. Role operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.19.7.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#246_____Creating_a_realm_role">
            
                    
                    Creating a realm role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#247_____Creating_a_client_role">
            
                    
                    Creating a client role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#248_____Listing_realm_roles">
            
                    
                    Listing realm roles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#249_____Listing_client_roles">
            
                    
                    Listing client roles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#250_____Getting_a_specific_realm_role">
            
                    
                    Getting a specific realm role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#251_____Getting_a_specific_client_role">
            
                    
                    Getting a specific client role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#252_____Updating_a_realm_role">
            
                    
                    Updating a realm role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#253_____Updating_a_client_role">
            
                    
                    Updating a client role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#254_____Deleting_a_realm_role">
            
                    
                    Deleting a realm role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.10" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#255_____Deleting_a_client_role">
            
                    
                    Deleting a client role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.11" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#256_____Listing_assigned__available__and_effective_realm_roles_for_a_composite_role">
            
                    
                    Listing assigned, available, and effective realm roles for a composite role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.12" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#257_____Listing_assigned__available__and_effective_client_roles_for_a_composite_role">
            
                    
                    Listing assigned, available, and effective client roles for a composite role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.13" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#258_____Adding_realm_roles_to_a_composite_role">
            
                    
                    Adding realm roles to a composite role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.14" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#259_____Removing_realm_roles_from_a_composite_role">
            
                    
                    Removing realm roles from a composite role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.15" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#260_____Adding_client_roles_to_a_realm_role">
            
                    
                    Adding client roles to a realm role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.16" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#261_____Adding_client_roles_to_a_client_role">
            
                    
                    Adding client roles to a client role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.17" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#262_____Removing_client_roles_from_a_composite_role">
            
                    
                    Removing client roles from a composite role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.18" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#263_____Adding_client_roles_to_a_group">
            
                    
                    Adding client roles to a group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.7.19" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#264_____Removing_client_roles_from_a_group">
            
                    
                    Removing client roles from a group
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.19.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#265____19_8__Client_operations">
            
                    
                    19.8. Client operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.19.8.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#266_____Creating_a_client">
            
                    
                    Creating a client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.8.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#267_____Listing_clients">
            
                    
                    Listing clients
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.8.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#268_____Getting_a_specific_client">
            
                    
                    Getting a specific client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.8.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#269_____Getting_the_current_secret_for_a_specific_client">
            
                    
                    Getting the current secret for a specific client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.8.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#270_____Getting_an_adapter_configuration_file__keycloak_json__for_a_specific_client">
            
                    
                    Getting an adapter configuration file (keycloak.json) for a specific client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.8.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#271_____Getting_a_WildFly_subsystem_adapter_configuration_for_a_specific_client">
            
                    
                    Getting a WildFly subsystem adapter configuration for a specific client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.8.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#272_____Getting_a_Docker_v2_example_configuration_for_a_specific_client">
            
                    
                    Getting a Docker-v2 example configuration for a specific client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.8.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#273_____Updating_a_client">
            
                    
                    Updating a client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.8.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#274_____Deleting_a_client">
            
                    
                    Deleting a client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.8.10" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#275_____Adding_or_removing_roles_for_client_s_service_account">
            
                    
                    Adding or removing roles for client’s service account
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.19.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#276____19_9__User_operations">
            
                    
                    19.9. User operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.19.9.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#277_____Creating_a_user">
            
                    
                    Creating a user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#278_____Listing_users">
            
                    
                    Listing users
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#279_____Getting_a_specific_user">
            
                    
                    Getting a specific user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#280_____Updating_a_user">
            
                    
                    Updating a user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#281_____Deleting_a_user">
            
                    
                    Deleting a user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#282_____Resetting_a_user_s_password">
            
                    
                    Resetting a user’s password
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#283_____Listing_assigned__available__and_effective_realm_roles_for_a_user">
            
                    
                    Listing assigned, available, and effective realm roles for a user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#284_____Listing_assigned__available__and_effective_client_roles_for_a_user">
            
                    
                    Listing assigned, available, and effective client roles for a user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#285_____Adding_realm_roles_to_a_user">
            
                    
                    Adding realm roles to a user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.10" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#286_____Removing_realm_roles_from_a_user">
            
                    
                    Removing realm roles from a user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.11" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#287_____Adding_client_roles_to_a_user">
            
                    
                    Adding client roles to a user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.12" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#288_____Removing_client_roles_from_a_user">
            
                    
                    Removing client roles from a user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.13" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#289_____Listing_a_user_s_sessions">
            
                    
                    Listing a user’s sessions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.14" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#290_____Logging_out_a_user_from_a_specific_session">
            
                    
                    Logging out a user from a specific session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.9.15" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#291_____Logging_out_a_user_from_all_sessions">
            
                    
                    Logging out a user from all sessions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.19.10" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#292____19_10__Group_operations">
            
                    
                    19.10. Group operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.19.10.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#293_____Creating_a_group">
            
                    
                    Creating a group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.10.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#294_____Listing_groups">
            
                    
                    Listing groups
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.10.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#295_____Getting_a_specific_group">
            
                    
                    Getting a specific group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.10.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#296_____Updating_a_group">
            
                    
                    Updating a group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.10.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#297_____Deleting_a_group">
            
                    
                    Deleting a group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.10.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#298_____Creating_a_subgroup">
            
                    
                    Creating a subgroup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.10.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#299_____Moving_a_group_under_another_group">
            
                    
                    Moving a group under another group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.10.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#300_____Get_groups_for_a_specific_user">
            
                    
                    Get groups for a specific user
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.10.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#301_____Adding_a_user_to_a_group">
            
                    
                    Adding a user to a group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.10.10" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#302_____Removing_a_user_from_a_group">
            
                    
                    Removing a user from a group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.10.11" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#303_____Listing_assigned__available__and_effective_realm_roles_for_a_group">
            
                    
                    Listing assigned, available, and effective realm roles for a group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.10.12" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#304_____Listing_assigned__available__and_effective_client_roles_for_a_group">
            
                    
                    Listing assigned, available, and effective client roles for a group
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.19.11" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#305____19_11__Identity_provider_operations">
            
                    
                    19.11. Identity provider operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.19.11.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#306_____Listing_available_identity_providers">
            
                    
                    Listing available identity providers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#307_____Listing_configured_identity_providers">
            
                    
                    Listing configured identity providers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#308_____Getting_a_specific_configured_identity_provider">
            
                    
                    Getting a specific configured identity provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#309_____Removing_a_specific_configured_identity_provider">
            
                    
                    Removing a specific configured identity provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#310_____Configuring_a_Keycloak_OpenID_Connect_identity_provider">
            
                    
                    Configuring a Keycloak OpenID Connect identity provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#311_____Configuring_an_OpenID_Connect_identity_provider">
            
                    
                    Configuring an OpenID Connect identity provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#312_____Configuring_a_SAML_2_identity_provider">
            
                    
                    Configuring a SAML 2 identity provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#313_____Configuring_a_Facebook_identity_provider">
            
                    
                    Configuring a Facebook identity provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#314_____Configuring_a_Google_identity_provider">
            
                    
                    Configuring a Google identity provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.10" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#315_____Configuring_a_Twitter_identity_provider">
            
                    
                    Configuring a Twitter identity provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.11" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#316_____Configuring_a_GitHub_identity_provider">
            
                    
                    Configuring a GitHub identity provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.12" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#317_____Configuring_a_LinkedIn_identity_provider">
            
                    
                    Configuring a LinkedIn identity provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.13" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#318_____Configuring_a_Microsoft_Live_identity_provider">
            
                    
                    Configuring a Microsoft Live identity provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.11.14" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#319_____Configuring_a_Stack_Overflow_identity_provider">
            
                    
                    Configuring a Stack Overflow identity provider
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.19.12" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#320____19_12__Storage_provider_operations">
            
                    
                    19.12. Storage provider operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.19.12.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#321_____Configuring_a_Kerberos_storage_provider">
            
                    
                    Configuring a Kerberos storage provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.12.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#322_____Configuring_an_LDAP_user_storage_provider">
            
                    
                    Configuring an LDAP user storage provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.12.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#323_____Removing_a_user_storage_provider_instance">
            
                    
                    Removing a user storage provider instance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.12.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#324_____Triggering_synchronization_of_all_users_for_a_specific_user_storage_provider">
            
                    
                    Triggering synchronization of all users for a specific user storage provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.12.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#325_____Triggering_synchronization_of_changed_users_for_a_specific_user_storage_provider">
            
                    
                    Triggering synchronization of changed users for a specific user storage provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.12.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#326_____Test_LDAP_user_storage_connectivity">
            
                    
                    Test LDAP user storage connectivity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.12.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#327_____Test_LDAP_user_storage_authentication">
            
                    
                    Test LDAP user storage authentication
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.19.13" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#328____19_13__Adding_mappers">
            
                    
                    19.13. Adding mappers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.19.13.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#329_____Adding_a_hardcoded_role_LDAP_mapper">
            
                    
                    Adding a hardcoded role LDAP mapper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.13.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#330_____Adding_an_MS_Active_Directory_mapper">
            
                    
                    Adding an MS Active Directory mapper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.13.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#331_____Adding_a_user_attribute_LDAP_mapper">
            
                    
                    Adding a user attribute LDAP mapper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.13.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#332_____Adding_a_group_LDAP_mapper">
            
                    
                    Adding a group LDAP mapper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.13.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#333_____Adding_a_full_name_LDAP_mapper">
            
                    
                    Adding a full name LDAP mapper
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.19.14" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#334____19_14__Authentication_operations">
            
                    
                    19.14. Authentication operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.19.14.1" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#335_____Setting_a_password_policy">
            
                    
                    Setting a password policy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.14.2" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#336_____Getting_the_current_password_policy">
            
                    
                    Getting the current password policy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.14.3" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#337_____Listing_authentication_flows">
            
                    
                    Listing authentication flows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.14.4" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#338_____Getting_a_specific_authentication_flow">
            
                    
                    Getting a specific authentication flow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.14.5" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#339_____Listing_executions_for_a_flow">
            
                    
                    Listing executions for a flow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.14.6" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#340_____Adding_configuration_to_an_execution">
            
                    
                    Adding configuration to an execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.14.7" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#341_____Getting_configuration_for_an_execution">
            
                    
                    Getting configuration for an execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.14.8" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#342_____Updating_configuration_for_an_execution">
            
                    
                    Updating configuration for an execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19.14.9" data-path="04_Server Administration Guide.html">
            
                <a href="04_Server Administration Guide.html#343_____Deleting_configuration_for_an_execution">
            
                    
                    Deleting configuration for an execution
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >保护应用程序和服务指南</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-anchor"></i><ul><li><a href="#&#x4FDD;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#x6307;&#x5357;">&#x4FDD;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#x6307;&#x5357;</a></li><ul><li><a href="#1-&#x6982;&#x8FF0;">1. &#x6982;&#x8FF0;</a></li><ul><li><a href="#11-&#x4EC0;&#x4E48;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;">1.1. &#x4EC0;&#x4E48;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;?</a></li><li><a href="#12-&#x652F;&#x6301;&#x7684;&#x5E73;&#x53F0;">1.2. &#x652F;&#x6301;&#x7684;&#x5E73;&#x53F0;</a></li><li><a href="#13-&#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;">1.3. &#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;</a></li></ul><li><a href="#2-openid-&#x8FDE;&#x63A5;&#x5668;">2. OpenID &#x8FDE;&#x63A5;&#x5668;</a></li><ul><li><a href="#21-java-&#x9002;&#x914D;&#x5668;">2.1. Java &#x9002;&#x914D;&#x5668;</a></li><li><a href="#22-javascript-&#x9002;&#x914D;&#x5668;">2.2. JavaScript &#x9002;&#x914D;&#x5668;</a></li><li><a href="#23-nodejs-&#x9002;&#x914D;&#x5668;">2.3. Node.js &#x9002;&#x914D;&#x5668;</a></li><li><a href="#24-keycloak-&#x770B;&#x95E8;&#x4EBA;">2.4. Keycloak &#x770B;&#x95E8;&#x4EBA;</a></li><li><a href="#25-&#x5176;&#x4ED6;openid&#x8FDE;&#x63A5;&#x5E93;">2.5. &#x5176;&#x4ED6;OpenID&#x8FDE;&#x63A5;&#x5E93;</a></li></ul><li><a href="#3-saml">3. SAML</a></li><ul><li><a href="#31-java-&#x9002;&#x914D;&#x5668;">3.1. Java &#x9002;&#x914D;&#x5668;</a></li><li><a href="#32-modauthmellon-apache-httpd-&#x6A21;&#x5757;">3.2. mod_auth_mellon Apache HTTPD &#x6A21;&#x5757;</a></li></ul><li><a href="#4-docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;">4. Docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;</a></li><ul><li><a href="#41-docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5B89;&#x88C5;">4.1. Docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5B89;&#x88C5;</a></li><li><a href="#42-docker&#x6CE8;&#x518C;&#x8868;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8986;&#x76D6;&#x5B89;&#x88C5;">4.2. Docker&#x6CE8;&#x518C;&#x8868;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8986;&#x76D6;&#x5B89;&#x88C5;</a></li><li><a href="#43-docker&#x64B0;&#x5199;yaml&#x6587;&#x4EF6;">4.3. Docker&#x64B0;&#x5199;YAML&#x6587;&#x4EF6;</a></li></ul><li><a href="#5-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;">5. &#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;</a></li><ul><li><a href="#51-&#x8BA4;&#x8BC1;">5.1. &#x8BA4;&#x8BC1;</a></li><li><a href="#52-keycloak&#x8868;&#x793A;">5.2. Keycloak&#x8868;&#x793A;</a></li><li><a href="#53-keycloak&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;">5.3. Keycloak&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;</a></li><li><a href="#54-openid&#x8FDE;&#x63A5;&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;">5.4. OpenID&#x8FDE;&#x63A5;&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;</a></li><li><a href="#55-saml&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;">5.5. SAML&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;</a></li><li><a href="#56-&#x4F7F;&#x7528;curl&#x7684;&#x793A;&#x4F8B;">5.6. &#x4F7F;&#x7528;CURL&#x7684;&#x793A;&#x4F8B;</a></li><li><a href="#57-&#x4F7F;&#x7528;java&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;api&#x7684;&#x793A;&#x4F8B;">5.7. &#x4F7F;&#x7528;Java&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;API&#x7684;&#x793A;&#x4F8B;</a></li><li><a href="#58-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x653F;&#x7B56;">5.8. &#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x653F;&#x7B56;</a></li></ul><li><a href="#6-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;-cli">6. &#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C; CLI</a></li><ul><li><a href="#61-&#x914D;&#x7F6E;&#x65B0;&#x5E38;&#x89C4;&#x7528;&#x6237;&#x4EE5;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli">6.1. &#x914D;&#x7F6E;&#x65B0;&#x5E38;&#x89C4;&#x7528;&#x6237;&#x4EE5;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI</a></li><li><a href="#62-&#x914D;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli&#x4E00;&#x8D77;&#x4F7F;&#x7528;">6.2. &#x914D;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x4E00;&#x8D77;&#x4F7F;&#x7528;</a></li><li><a href="#63-&#x5B89;&#x88C5;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli">6.3. &#x5B89;&#x88C5;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI</a></li><li><a href="#64-&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli">6.4. &#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI</a></li><li><a href="#65-&#x6545;&#x969C;&#x6392;&#x9664;">6.5. &#x6545;&#x969C;&#x6392;&#x9664;</a></li></ul><li><a href="#7-&#x4EE4;&#x724C;&#x4EA4;&#x6362;">7. &#x4EE4;&#x724C;&#x4EA4;&#x6362;</a></li><ul><li><a href="#71-&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;">7.1. &#x5185;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;</a></li><li><a href="#72-&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x5185;&#x90E8;&#x4EE4;&#x724C;">7.2. &#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x5185;&#x90E8;&#x4EE4;&#x724C;</a></li><li><a href="#73-&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;">7.3. &#x5916;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;</a></li><li><a href="#74-&#x6A21;&#x62DF;">7.4. &#x6A21;&#x62DF;</a></li><li><a href="#75-&#x76F4;&#x63A5;&#x8D64;&#x88F8;&#x88F8;&#x7684;&#x6A21;&#x62DF;">7.5. &#x76F4;&#x63A5;&#x8D64;&#x88F8;&#x88F8;&#x7684;&#x6A21;&#x62DF;</a></li><li><a href="#76-&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x5C55;&#x5F00;&#x6743;&#x9650;&#x6A21;&#x578B;">7.6. &#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x5C55;&#x5F00;&#x6743;&#x9650;&#x6A21;&#x578B;</a></li><li><a href="#77-&#x4EA4;&#x6362;&#x6F0F;&#x6D1E;">7.7. &#x4EA4;&#x6362;&#x6F0F;&#x6D1E;</a></li></ul></ul></ul></div><a href="#&#x4FDD;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#x6307;&#x5357;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="&#x4FDD;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#x6307;&#x5357;"><a name="&#x4FDD;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#x6307;&#x5357;" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#x6307;&#x5357;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FDD;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#x6307;&#x5357;</h1>
<p><a name="1___1__&#x6982;&#x8FF0;"></a></p>
<h2 id="1-&#x6982;&#x8FF0;"><a name="1-&#x6982;&#x8FF0;" class="anchor-navigation-ex-anchor" href="#1-&#x6982;&#x8FF0;"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x6982;&#x8FF0;</h2>
<p>Keycloak&#x652F;&#x6301;OpenID Connect&#xFF08;OAuth 2.0&#x7684;&#x6269;&#x5C55;&#xFF09;&#x548C;SAML 2.0&#x3002; &#x5728;&#x4FDD;&#x62A4;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x9996;&#x5148;&#x9700;&#x8981;&#x786E;&#x5B9A;&#x7684;&#x662F;&#x60A8;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x4E24;&#x4E2A;&#x4E2D;&#x7684;&#x54EA;&#x4E00;&#x4E2A;&#x3002; &#x5982;&#x679C;&#x60A8;&#x613F;&#x610F;&#xFF0C;&#x60A8;&#x4E5F;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x4F7F;&#x7528;OpenID Connect&#x548C;&#x5176;&#x4ED6;SAML&#x5B89;&#x5168;&#x4FDD;&#x62A4;&#x3002;</p>
<p>To secure clients and services you are also going to need an adapter or library for the protocol you&#x2019;ve selected. Keycloak comes with its own adapters for selected platforms, but it is also possible to use generic OpenID Connect Resource Provider and SAML Service Provider libraries.</p>
<p><a name="2____1_1__&#x4EC0;&#x4E48;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;_"></a></p>
<h3 id="11-&#x4EC0;&#x4E48;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;"><a name="11-&#x4EC0;&#x4E48;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#11-&#x4EC0;&#x4E48;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x4EC0;&#x4E48;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;?</h3>
<p>Keycloak&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x662F;&#x4F7F;&#x7528;Keycloak&#x8F7B;&#x677E;&#x4FDD;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#x7684;&#x5E93;&#x3002; &#x6211;&#x4EEC;&#x5C06;&#x5B83;&#x4EEC;&#x79F0;&#x4E3A;&#x9002;&#x914D;&#x5668;&#x800C;&#x4E0D;&#x662F;&#x5E93;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x4E0E;&#x5E95;&#x5C42;&#x5E73;&#x53F0;&#x548C;&#x6846;&#x67B6;&#x7684;&#x7D27;&#x5BC6;&#x96C6;&#x6210;&#x3002; &#x8FD9;&#x4F7F;&#x5F97;&#x6211;&#x4EEC;&#x7684;&#x9002;&#x914D;&#x5668;&#x6613;&#x4E8E;&#x4F7F;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x5E93;&#x6837;&#x677F;&#x4EE3;&#x7801;&#x5C11;&#x4E8E;&#x5E93;&#x901A;&#x5E38;&#x6240;&#x9700;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
<p><a name="3____1_2__&#x652F;&#x6301;&#x7684;&#x5E73;&#x53F0;"></a></p>
<h3 id="12-&#x652F;&#x6301;&#x7684;&#x5E73;&#x53F0;"><a name="12-&#x652F;&#x6301;&#x7684;&#x5E73;&#x53F0;" class="anchor-navigation-ex-anchor" href="#12-&#x652F;&#x6301;&#x7684;&#x5E73;&#x53F0;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. &#x652F;&#x6301;&#x7684;&#x5E73;&#x53F0;</h3>
<p><a name="4_____1_2_1__OpenID_Connect"></a></p>
<h4 id="121-openid-connect"><a name="121-openid-connect" class="anchor-navigation-ex-anchor" href="#121-openid-connect"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.1. OpenID Connect</h4>
<p><a name="5______Java"></a></p>
<h5 id="java"><a name="java" class="anchor-navigation-ex-anchor" href="#java"><i class="fa fa-link" aria-hidden="true"></i></a>Java</h5>
<ul>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_jboss_adapter" target="_blank">JBoss EAP</a></li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_jboss_adapter" target="_blank">WildFly</a></li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse_adapter" target="_blank">Fuse</a></li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_tomcat_adapter" target="_blank">Tomcat</a></li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_jetty9_adapter" target="_blank">Jetty 9</a></li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_servlet_filter_adapter" target="_blank">Servlet Filter</a></li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_spring_boot_adapter" target="_blank">Spring Boot</a></li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_spring_security_adapter" target="_blank">Spring Security</a></li>
</ul>
<p><a name="6______JavaScript__client_side_"></a></p>
<h5 id="javascript-client-side"><a name="javascript-client-side" class="anchor-navigation-ex-anchor" href="#javascript-client-side"><i class="fa fa-link" aria-hidden="true"></i></a>JavaScript (client-side)</h5>
<ul>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_javascript_adapter" target="_blank">JavaScript</a></li>
</ul>
<p><a name="7______Node_js__server_side_"></a></p>
<h5 id="nodejs-server-side"><a name="nodejs-server-side" class="anchor-navigation-ex-anchor" href="#nodejs-server-side"><i class="fa fa-link" aria-hidden="true"></i></a>Node.js (server-side)</h5>
<ul>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_nodejs_adapter" target="_blank">Node.js</a></li>
</ul>
<p><a name="8_____1_2_2__C_"></a></p>
<h4 id="122-c"><a name="122-c" class="anchor-navigation-ex-anchor" href="#122-c"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.2. C</h4>
<ul>
<li><a href="https://github.com/dylanplecki/KeycloakOwinAuthentication" target="_blank">OWIN</a> (community)</li>
</ul>
<p><a name="9_____1_2_3__Python"></a></p>
<h4 id="123-python"><a name="123-python" class="anchor-navigation-ex-anchor" href="#123-python"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.3. Python</h4>
<ul>
<li><a href="https://pypi.org/project/oic/" target="_blank">oidc</a> (generic)</li>
</ul>
<p><a name="10_____1_2_4__Android"></a></p>
<h4 id="124-android"><a name="124-android" class="anchor-navigation-ex-anchor" href="#124-android"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.4. Android</h4>
<ul>
<li><a href="https://github.com/openid/AppAuth-Android" target="_blank">AppAuth</a> (generic)</li>
<li><a href="https://github.com/aerogear/aerogear-android-authz" target="_blank">AeroGear</a> (generic)</li>
</ul>
<p><a name="11_____1_2_5__iOS"></a></p>
<h4 id="125-ios"><a name="125-ios" class="anchor-navigation-ex-anchor" href="#125-ios"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.5. iOS</h4>
<ul>
<li><a href="https://github.com/openid/AppAuth-iOS" target="_blank">AppAuth</a> (generic)</li>
<li><a href="https://github.com/aerogear/aerogear-ios-oauth2" target="_blank">AeroGear</a> (generic)</li>
</ul>
<p><a name="12______Apache_HTTP_Server"></a></p>
<h5 id="apache-http-server"><a name="apache-http-server" class="anchor-navigation-ex-anchor" href="#apache-http-server"><i class="fa fa-link" aria-hidden="true"></i></a>Apache HTTP Server</h5>
<ul>
<li><a href="https://github.com/zmartzone/mod_auth_openidc" target="_blank">mod_auth_openidc</a></li>
</ul>
<p><a name="13_____1_2_6__SAML"></a></p>
<h4 id="126-saml"><a name="126-saml" class="anchor-navigation-ex-anchor" href="#126-saml"><i class="fa fa-link" aria-hidden="true"></i></a>1.2.6. SAML</h4>
<p><a name="14______Java"></a></p>
<h5 id="java"><a name="java" class="anchor-navigation-ex-anchor" href="#java"><i class="fa fa-link" aria-hidden="true"></i></a>Java</h5>
<ul>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_saml_jboss_adapter" target="_blank">JBoss EAP</a></li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_saml_jboss_adapter" target="_blank">WildFly</a></li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_tomcat_adapter" target="_blank">Tomcat</a></li>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_jetty_saml_adapter" target="_blank">Jetty</a></li>
</ul>
<p><a name="15______Apache_HTTP_Server"></a></p>
<h5 id="apache-http-server"><a name="apache-http-server" class="anchor-navigation-ex-anchor" href="#apache-http-server"><i class="fa fa-link" aria-hidden="true"></i></a>Apache HTTP Server</h5>
<ul>
<li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_mod_auth_mellon" target="_blank">mod_auth_mellon</a></li>
</ul>
<p><a name="16____1_3__&#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;"></a></p>
<h3 id="13-&#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;"><a name="13-&#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;" class="anchor-navigation-ex-anchor" href="#13-&#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. &#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;</h3>
<p><a name="17_____1_3_1__OpenID_Connect"></a></p>
<h4 id="131-openid-connect"><a name="131-openid-connect" class="anchor-navigation-ex-anchor" href="#131-openid-connect"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.1. OpenID Connect</h4>
<p><a href="https://openid.net/connect/" target="_blank">OpenID &#x8FDE;&#x63A5;</a> (OIDC)&#x662F;&#x4E00;&#x4E2A;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x534F;&#x8BAE;&#xFF0C;&#x5B83;&#x662F;<a href="https://tools.ietf.org/html/rfc6749" target="_blank">OAuth 2.0</a>&#x7684;&#x6269;&#x5C55;&#x3002;&#x867D;&#x7136;OAuth 2.0&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x6784;&#x5EFA;&#x6388;&#x6743;&#x534F;&#x8BAE;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x800C;&#x4E14;&#x4E3B;&#x8981;&#x662F;&#x4E0D;&#x5B8C;&#x6574;&#x7684;&#xFF0C;&#x4F46;OIDC&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x548C;&#x6388;&#x6743;&#x534F;&#x8BAE;&#x3002; OIDC&#x8FD8;&#x5927;&#x91CF;&#x4F7F;&#x7528;&#x4E86;<a href="https://jwt.io/" target="_blank">Json Web Token</a> (JWT)&#x6807;&#x51C6;&#x96C6;&#x3002;&#x8FD9;&#x4E9B;&#x6807;&#x51C6;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x79CD;&#x8EAB;&#x4EFD;&#x4EE4;&#x724C;JSON&#x683C;&#x5F0F;&#xFF0C;&#x4EE5;&#x53CA;&#x4EE5;&#x4E00;&#x79CD;&#x7D27;&#x51D1;&#x4E14;web&#x53CB;&#x597D;&#x7684;&#x65B9;&#x5F0F;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x6570;&#x5B57;&#x7B7E;&#x540D;&#x548C;&#x52A0;&#x5BC6;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x4F7F;&#x7528;OIDC&#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E24;&#x79CD;&#x7528;&#x4F8B;&#x3002; &#x7B2C;&#x4E00;&#x4E2A;&#x662F;&#x8981;&#x6C42;Keycloak&#x670D;&#x52A1;&#x5668;&#x4E3A;&#x7528;&#x6237;&#x9A8C;&#x8BC1;&#x7528;&#x6237;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x6210;&#x529F;&#x767B;&#x5F55;&#x540E;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5C06;&#x6536;&#x5230;<em>identity token(&#x8EAB;&#x4EFD;&#x4EE4;&#x724C;)</em>&#x548C;<em>access token(&#x8BBF;&#x95EE;&#x4EE4;&#x724C;)</em>&#x3002; <em>&#x8EAB;&#x4EFD;&#x4EE4;&#x724C;</em>&#x5305;&#x542B;&#x6709;&#x5173;&#x7528;&#x6237;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x7535;&#x5B50;&#x90AE;&#x4EF6;&#x548C;&#x5176;&#x4ED6;&#x4E2A;&#x4EBA;&#x8D44;&#x6599;&#x4FE1;&#x606F;&#x3002; <em>&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</em>&#x7531;&#x9886;&#x57DF;&#x8FDB;&#x884C;&#x6570;&#x5B57;&#x7B7E;&#x540D;&#xFF0C;&#x5E76;&#x5305;&#x542B;&#x8BBF;&#x95EE;&#x4FE1;&#x606F;&#xFF08;&#x5982;&#x7528;&#x6237;&#x89D2;&#x8272;&#x6620;&#x5C04;&#xFF09;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BE5;&#x4FE1;&#x606F;&#x6765;&#x786E;&#x5B9A;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E0A;&#x8BBF;&#x95EE;&#x54EA;&#x4E9B;&#x8D44;&#x6E90;&#x3002;</p>
<p>&#x7B2C;&#x4E8C;&#x79CD;&#x7528;&#x4F8B;&#x662F;&#x5E0C;&#x671B;&#x83B7;&#x5F97;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x8981;&#x6C42;Keycloak&#x83B7;&#x53D6;<em>&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</em>&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x4EE3;&#x8868;&#x7528;&#x6237;&#x5728;&#x5176;&#x4ED6;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x4E0A;&#x8C03;&#x7528;&#x3002; Keycloak&#x5BF9;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x7136;&#x540E;&#x8981;&#x6C42;&#x7528;&#x6237;&#x540C;&#x610F;&#x6388;&#x4E88;&#x8BBF;&#x95EE;&#x8BF7;&#x6C42;&#x5B83;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6743;&#x9650;&#x3002; &#x7136;&#x540E;&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;<em>&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</em>&#x3002; &#x6B64;<em>&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</em>&#x7531;&#x9886;&#x57DF;&#x8FDB;&#x884C;&#x6570;&#x5B57;&#x7B7E;&#x540D;&#x3002; &#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6B64;<em>&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</em>&#x5728;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x4E0A;&#x8FDB;&#x884C;REST&#x8C03;&#x7528;&#x3002; REST&#x670D;&#x52A1;&#x63D0;&#x53D6;<em>&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</em>&#xFF0C;&#x9A8C;&#x8BC1;&#x4EE4;&#x724C;&#x7684;&#x7B7E;&#x540D;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x4EE4;&#x724C;&#x5185;&#x7684;&#x8BBF;&#x95EE;&#x4FE1;&#x606F;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x3002;</p>
<p><a name="18_____1_3_2__SAML_2_0"></a></p>
<h4 id="132-saml-20"><a name="132-saml-20" class="anchor-navigation-ex-anchor" href="#132-saml-20"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.2. SAML 2.0</h4>
<p><a href="http://saml.xml.org/saml-specifications" target="_blank">SAML 2.0</a> &#x662F;&#x4E0E;OIDC&#x7C7B;&#x4F3C;&#x7684;&#x89C4;&#x8303;&#xFF0C;&#x4F46;&#x662F;&#x66F4;&#x8001;&#xFF0C;&#x66F4;&#x6210;&#x719F;&#x3002; &#x5B83;&#x7684;&#x6839;&#x6E90;&#x5728;&#x4E8E;SOAP&#x548C;&#x8FC7;&#x591A;&#x7684;WS-*&#x89C4;&#x8303;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x5F80;&#x5F80;&#x6BD4;OIDC&#x66F4;&#x5197;&#x957F;&#x3002; SAML 2.0&#x4E3B;&#x8981;&#x662F;&#x4E00;&#x79CD;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x534F;&#x8BAE;&#xFF0C;&#x901A;&#x8FC7;&#x5728;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x670D;&#x52A1;&#x5668;&#x548C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E4B;&#x95F4;&#x4EA4;&#x6362;XML&#x6587;&#x6863;&#x6765;&#x5DE5;&#x4F5C;&#x3002; XML&#x7B7E;&#x540D;&#x548C;&#x52A0;&#x5BC6;&#x7528;&#x4E8E;&#x9A8C;&#x8BC1;&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x3002;</p>
<p>&#x5728;Keycloak&#x4E2D;&#xFF0C;SAML&#x63D0;&#x4F9B;&#x4E24;&#x79CD;&#x7528;&#x4F8B;&#xFF1A;&#x6D4F;&#x89C8;&#x5668;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;REST&#x8C03;&#x7528;&#x3002;</p>
<p>&#x4F7F;&#x7528;SAML&#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E24;&#x79CD;&#x7528;&#x4F8B;&#x3002; &#x7B2C;&#x4E00;&#x4E2A;&#x662F;&#x8981;&#x6C42;Keycloak&#x670D;&#x52A1;&#x5668;&#x4E3A;&#x7528;&#x6237;&#x9A8C;&#x8BC1;&#x7528;&#x6237;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x6210;&#x529F;&#x767B;&#x5F55;&#x540E;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5C06;&#x6536;&#x5230;&#x4E00;&#x4E2A;XML&#x6587;&#x6863;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x79F0;&#x4E3A;SAML&#x65AD;&#x8A00;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x8BE5;&#x65AD;&#x8A00;&#x6307;&#x5B9A;&#x4E86;&#x6709;&#x5173;&#x7528;&#x6237;&#x7684;&#x5404;&#x79CD;&#x5C5E;&#x6027;&#x3002; &#x6B64;XML&#x6587;&#x6863;&#x7531;&#x9886;&#x57DF;&#x8FDB;&#x884C;&#x6570;&#x5B57;&#x7B7E;&#x540D;&#xFF0C;&#x5E76;&#x5305;&#x542B;&#x8BBF;&#x95EE;&#x4FE1;&#x606F;&#xFF08;&#x5982;&#x7528;&#x6237;&#x89D2;&#x8272;&#x6620;&#x5C04;&#xFF09;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BE5;&#x4FE1;&#x606F;&#x6765;&#x786E;&#x5B9A;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E0A;&#x8BBF;&#x95EE;&#x54EA;&#x4E9B;&#x8D44;&#x6E90;&#x3002;</p>
<p>&#x7B2C;&#x4E8C;&#x79CD;&#x7528;&#x4F8B;&#x662F;&#x5E0C;&#x671B;&#x83B7;&#x5F97;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x8981;&#x6C42;Keycloak&#x83B7;&#x53D6;&#x53EF;&#x7528;&#x4E8E;&#x4EE3;&#x8868;&#x7528;&#x6237;&#x5728;&#x5176;&#x4ED6;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x4E0A;&#x8C03;&#x7528;&#x7684;SAML&#x65AD;&#x8A00;&#x3002;</p>
<p><a name="19_____1_3_3__OpenID_Connect_&#x4E0E;_SAML"></a></p>
<h4 id="133-openid-connect-&#x4E0E;-saml"><a name="133-openid-connect-&#x4E0E;-saml" class="anchor-navigation-ex-anchor" href="#133-openid-connect-&#x4E0E;-saml"><i class="fa fa-link" aria-hidden="true"></i></a>1.3.3. OpenID Connect &#x4E0E; SAML</h4>
<p>&#x5728;OpenID Connect&#x548C;SAML&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x9009;&#x62E9;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x4F7F;&#x7528;&#x66F4;&#x65B0;&#x7684;&#x534F;&#x8BAE;&#xFF08;OIDC&#xFF09;&#x800C;&#x4E0D;&#x662F;&#x65E7;&#x7684;&#x66F4;&#x6210;&#x719F;&#x7684;&#x534F;&#x8BAE;&#xFF08;SAML&#xFF09;&#x3002;</p>
<p>&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Keycloak&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;OIDC&#x3002;</p>
<p>SAML&#x5F80;&#x5F80;&#x6BD4;OIDC&#x66F4;&#x5197;&#x957F;&#x3002;</p>
<p>&#x9664;&#x4E86;&#x4EA4;&#x6362;&#x6570;&#x636E;&#x7684;&#x8BE6;&#x7EC6;&#x7A0B;&#x5EA6;&#x4E4B;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x6BD4;&#x8F83;&#x89C4;&#x8303;&#xFF0C;&#x60A8;&#x4F1A;&#x53D1;&#x73B0;OIDC&#x65E8;&#x5728;&#x4E0E;Web&#x4E00;&#x8D77;&#x5DE5;&#x4F5C;&#xFF0C;&#x540C;&#x65F6;SAML&#x88AB;&#x6539;&#x88C5;&#x4E3A;&#x5728;Web&#x4E0A;&#x8FD0;&#x884C;&#x3002; &#x4F8B;&#x5982;&#xFF0C;OIDC&#x4E5F;&#x66F4;&#x9002;&#x5408;HTML5/JavaScript&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x6BD4;SAML&#x66F4;&#x5BB9;&#x6613;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x5B9E;&#x73B0;&#x3002; &#x7531;&#x4E8E;&#x4EE4;&#x724C;&#x91C7;&#x7528;JSON&#x683C;&#x5F0F;&#xFF0C;&#x56E0;&#x6B64;JavaScript&#x66F4;&#x6613;&#x4E8E;&#x4F7F;&#x7528;&#x3002; &#x60A8;&#x8FD8;&#x5C06;&#x627E;&#x5230;&#x4E00;&#x4E9B;&#x5F88;&#x597D;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x66F4;&#x8F7B;&#x677E;&#x5730;&#x5728;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x5B9E;&#x73B0;&#x5B89;&#x5168;&#x6027;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x67E5;&#x770B;&#x89C4;&#x8303;&#x7528;&#x4E8E;&#x8F7B;&#x677E;&#x786E;&#x5B9A;&#x7528;&#x6237;&#x662F;&#x5426;&#x4ECD;&#x5728;&#x767B;&#x5F55;&#x7684;<a href="https://openid.net/specs/openid-connect-session-1_0.html#ChangeNotification" target="_blank">iframe&#x6280;&#x5DE7;</a>&#x3002;</p>
<p>SAML&#x867D;&#x7136;&#x6709;&#x5B83;&#x7684;&#x7528;&#x9014;&#x3002; &#x6B63;&#x5982;&#x60A8;&#x6240;&#x770B;&#x5230;&#x7684;&#xFF0C;OIDC&#x89C4;&#x8303;&#x7684;&#x53D1;&#x5C55;&#xFF0C;&#x60A8;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;SAML&#x591A;&#x5E74;&#x6765;&#x6240;&#x62E5;&#x6709;&#x7684;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x529F;&#x80FD;&#x3002; &#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x770B;&#x5230;&#x4EBA;&#x4EEC;&#x9009;&#x62E9;SAML&#x800C;&#x4E0D;&#x662F;OIDC&#xFF0C;&#x56E0;&#x4E3A;&#x4EBA;&#x4EEC;&#x8BA4;&#x4E3A;&#x5B83;&#x66F4;&#x6210;&#x719F;&#xFF0C;&#x4E5F;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x73B0;&#x6709;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p><a name="20___2__OpenID_&#x8FDE;&#x63A5;&#x5668;"></a></p>
<h2 id="2-openid-&#x8FDE;&#x63A5;&#x5668;"><a name="2-openid-&#x8FDE;&#x63A5;&#x5668;" class="anchor-navigation-ex-anchor" href="#2-openid-&#x8FDE;&#x63A5;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2. OpenID &#x8FDE;&#x63A5;&#x5668;</h2>
<p>&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x4F7F;&#x7528;Keycloak&#x9002;&#x914D;&#x5668;&#x6216;&#x901A;&#x7528;OpenID Connect&#x8D44;&#x6E90;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x5E93;&#x901A;&#x8FC7;OpenID Connect&#x4FDD;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#x3002;</p>
<p><a name="21____2_1__Java_&#x9002;&#x914D;&#x5668;"></a></p>
<h3 id="21-java-&#x9002;&#x914D;&#x5668;"><a name="21-java-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#21-java-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. Java &#x9002;&#x914D;&#x5668;</h3>
<p>Keycloak&#x4E3A;Java&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x4E0D;&#x540C;&#x7684;&#x9002;&#x914D;&#x5668;&#x3002; &#x9009;&#x62E9;&#x6B63;&#x786E;&#x7684;&#x9002;&#x914D;&#x5668;&#x53D6;&#x51B3;&#x4E8E;&#x76EE;&#x6807;&#x5E73;&#x53F0;&#x3002;</p>
<p>&#x6240;&#x6709;Java&#x9002;&#x914D;&#x5668;&#x5171;&#x4EAB;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_java_adapter_config" target="_blank">Java Adapters Config</a> &#x7AE0;&#x8282;&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x4E00;&#x7EC4;&#x5E38;&#x7528;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x3002;</p>
<p><a name="22_____2_1_1__Java&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;"></a></p>
<h4 id="211-java&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;"><a name="211-java&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#211-java&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.1. Java&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;</h4>
<p>Keycloak&#x652F;&#x6301;&#x7684;&#x6BCF;&#x4E2A;Java&#x9002;&#x914D;&#x5668;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;JSON&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002; &#x8FD9;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;realm&quot;</span> : <span class="hljs-string">&quot;demo&quot;</span>,
  <span class="hljs-string">&quot;resource&quot;</span> : <span class="hljs-string">&quot;customer-portal&quot;</span>,
  <span class="hljs-string">&quot;realm-public-key&quot;</span> : <span class="hljs-string">&quot;MIGfMA0GCSqGSIb3D...31LwIDAQAB&quot;</span>,
  <span class="hljs-string">&quot;auth-server-url&quot;</span> : <span class="hljs-string">&quot;https://localhost:8443/auth&quot;</span>,
  <span class="hljs-string">&quot;ssl-required&quot;</span> : <span class="hljs-string">&quot;external&quot;</span>,
  <span class="hljs-string">&quot;use-resource-role-mappings&quot;</span> : <span class="hljs-literal">false</span>,
  <span class="hljs-string">&quot;enable-cors&quot;</span> : <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;cors-max-age&quot;</span> : <span class="hljs-number">1000</span>,
  <span class="hljs-string">&quot;cors-allowed-methods&quot;</span> : <span class="hljs-string">&quot;POST, PUT, DELETE, GET&quot;</span>,
  <span class="hljs-string">&quot;cors-exposed-headers&quot;</span> : <span class="hljs-string">&quot;WWW-Authenticate, My-custom-exposed-Header&quot;</span>,
  <span class="hljs-string">&quot;bearer-only&quot;</span> : <span class="hljs-literal">false</span>,
  <span class="hljs-string">&quot;enable-basic-auth&quot;</span> : <span class="hljs-literal">false</span>,
  <span class="hljs-string">&quot;expose-token&quot;</span> : <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;verify-token-audience&quot;</span> : <span class="hljs-literal">true</span>,
   <span class="hljs-string">&quot;credentials&quot;</span> : {
      <span class="hljs-string">&quot;secret&quot;</span> : <span class="hljs-string">&quot;234234-234234-234234&quot;</span>
   },

   <span class="hljs-string">&quot;connection-pool-size&quot;</span> : <span class="hljs-number">20</span>,
   <span class="hljs-string">&quot;disable-trust-manager&quot;</span>: <span class="hljs-literal">false</span>,
   <span class="hljs-string">&quot;allow-any-hostname&quot;</span> : <span class="hljs-literal">false</span>,
   <span class="hljs-string">&quot;truststore&quot;</span> : <span class="hljs-string">&quot;path/to/truststore.jks&quot;</span>,
   <span class="hljs-string">&quot;truststore-password&quot;</span> : <span class="hljs-string">&quot;geheim&quot;</span>,
   <span class="hljs-string">&quot;client-keystore&quot;</span> : <span class="hljs-string">&quot;path/to/client-keystore.jks&quot;</span>,
   <span class="hljs-string">&quot;client-keystore-password&quot;</span> : <span class="hljs-string">&quot;geheim&quot;</span>,
   <span class="hljs-string">&quot;client-key-password&quot;</span> : <span class="hljs-string">&quot;geheim&quot;</span>,
   <span class="hljs-string">&quot;token-minimum-time-to-live&quot;</span> : <span class="hljs-number">10</span>,
   <span class="hljs-string">&quot;min-time-between-jwks-requests&quot;</span> : <span class="hljs-number">10</span>,
   <span class="hljs-string">&quot;public-key-cache-ttl&quot;</span>: <span class="hljs-number">86400</span>,
   <span class="hljs-string">&quot;redirect-rewrite-rules&quot;</span> : {
   <span class="hljs-string">&quot;^/wsmaster/api/(.*)$&quot;</span> : <span class="hljs-string">&quot;/api/$1&quot;</span>
   }
}
</code></pre>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>${&#x2026;}</code>&#x6765;&#x66FF;&#x6362;&#x7CFB;&#x7EDF;&#x5C5E;&#x6027;&#x3002;&#x4F8B;&#x5982;<code>${jboss.server.config.dir}</code>&#x5C06;&#x66FF;&#x6362;&#x4E3A;<code>/path/to/Keycloak</code>&#x3002;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7684;&#x66FF;&#x6362;&#x4E5F;&#x901A;&#x8FC7;<code>env</code>&#x524D;&#x7F00;&#x5F97;&#x5230;&#x652F;&#x6301;&#xFF0C;&#x4F8B;&#x5982;&#x3002; <code>${env.MY_ENVIRONMENT_VARIABLE}</code>&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x4ECE;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x83B7;&#x53D6;&#x521D;&#x59CB;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002; &#x8FD9;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6253;&#x5F00;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#xFF0C;&#x4ECE;&#x83DC;&#x5355;&#x4E2D;&#x9009;&#x62E9;<code>Clients</code>&#x5E76;&#x5355;&#x51FB;&#x76F8;&#x5E94;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x5B8C;&#x6210;&#x3002; &#x6253;&#x5F00;&#x5BA2;&#x6237;&#x7AEF;&#x9875;&#x9762;&#x540E;&#xFF0C;&#x5355;&#x51FB;<code>Installation</code>&#x9009;&#x9879;&#x5361;&#xFF0C;&#x7136;&#x540E;&#x9009;&#x62E9;<code>Keycloak OIDC JSON</code>&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x662F;&#x6BCF;&#x4E2A;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x7684;&#x8BF4;&#x660E;&#xFF1A;</p>
<ul>
<li><p>realm</p>
<p>&#x9886;&#x57DF;&#x7684;&#x540D;&#x79F0;&#x3002; &#x8FD9;&#x662F;<em>&#x5FC5;&#x9700;&#x7684;</em></p>
</li>
<li><p>resource</p>
<p>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5BA2;&#x6237;&#x7AEF;ID&#x3002; &#x6BCF;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90FD;&#x6709;&#x4E00;&#x4E2A;client-id&#xFF0C;&#x7528;&#x4E8E;&#x6807;&#x8BC6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x8FD9;&#x662F;<em>&#x5FC5;&#x9700;&#x7684;</em></p>
</li>
<li><p>realm-public-key</p>
<p>&#x9886;&#x57DF;&#x516C;&#x94A5;&#x7684;PEM&#x683C;&#x5F0F;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4ECE;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x83B7;&#x53D6;&#x6B64;&#x4FE1;&#x606F;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#xFF0C;&#x4E0D;&#x5EFA;&#x8BAE;&#x8BBE;&#x7F6E;&#x5B83;&#x3002; &#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#xFF0C;&#x9002;&#x914D;&#x5668;&#x5C06;&#x4ECE;Keycloak&#x4E0B;&#x8F7D;&#x5B83;&#xFF0C;&#x5B83;&#x5C06;&#x5728;&#x9700;&#x8981;&#x65F6;&#x603B;&#x662F;&#x91CD;&#x65B0;&#x4E0B;&#x8F7D;&#xFF08;&#x4F8B;&#x5982;Keycloak&#x65CB;&#x8F6C;&#x5B83;&#x7684;&#x952E;&#xFF09;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;realm-public-key&#xFF0C;&#x90A3;&#x4E48;&#x9002;&#x914D;&#x5668;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x4ECE;Keycloak&#x4E0B;&#x8F7D;&#x65B0;&#x5BC6;&#x94A5;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;Keycloak&#x65CB;&#x8F6C;&#x5B83;&#x7684;&#x5BC6;&#x94A5;&#x65F6;&#xFF0C;&#x9002;&#x914D;&#x5668;&#x5C06;&#x4F1A;&#x4E2D;&#x65AD;&#x3002;</p>
</li>
<li><p>auth-server-url</p>
<p>Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;&#x57FA;&#x672C;URL&#x3002; &#x6240;&#x6709;&#x5176;&#x4ED6;Keycloak&#x9875;&#x9762;&#x548C;REST&#x670D;&#x52A1;&#x7AEF;&#x70B9;&#x90FD;&#x6E90;&#x4E8E;&#x6B64;&#x3002; &#x5B83;&#x7684;&#x5F62;&#x5F0F;&#x901A;&#x5E38;&#x4E3A;<code>https://host:port/auth</code>&#x3002; &#x8FD9;&#x662F;<em>&#x5FC5;&#x9700;&#x7684;</em></p>
</li>
<li><p>ssl-required</p>
<p>&#x786E;&#x4FDD;&#x4E0E;Keycloak&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x6240;&#x6709;&#x901A;&#x4FE1;&#x5747;&#x901A;&#x8FC7;HTTPS&#x8FDB;&#x884C;&#x3002; &#x5728;&#x751F;&#x4EA7;&#x4E2D;&#xFF0C;&#x8FD9;&#x5E94;&#x8BE5;&#x8BBE;&#x7F6E;&#x4E3A;&#x201C;all&#x201D;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<em>external</em>&#x8868;&#x793A;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;HTTPS&#x662F;&#x5916;&#x90E8;&#x8BF7;&#x6C42;&#x6240;&#x5FC5;&#x9700;&#x7684;&#x3002; &#x6709;&#x6548;&#x503C;&#x4E3A;&#x201C;all&#x201D;&#xFF0C;&#x201C;external&#x201D;&#x548C;&#x201C;none&#x201D;&#x3002;</p>
</li>
<li><p>confidential-port</p>
<p>Keycloak&#x670D;&#x52A1;&#x5668;&#x7528;&#x4E8E;&#x901A;&#x8FC7;SSL/TLS&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x8FDE;&#x63A5;&#x7684;&#x673A;&#x5BC6;&#x7AEF;&#x53E3;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<em>8443</em>&#x3002;</p>
</li>
<li><p>use-resource-role-mappings</p>
<p>&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A;true&#xFF0C;&#x90A3;&#x4E48;&#x9002;&#x914D;&#x5668;&#x5C06;&#x5728;&#x4EE4;&#x724C;&#x5185;&#x67E5;&#x627E;&#x7528;&#x6237;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7EA7;&#x522B;&#x89D2;&#x8272;&#x6620;&#x5C04;&#x3002; &#x5982;&#x679C;&#x4E3A;false&#xFF0C;&#x5B83;&#x5C06;&#x67E5;&#x770B;&#x7528;&#x6237;&#x89D2;&#x8272;&#x6620;&#x5C04;&#x7684;&#x9886;&#x57DF;&#x7EA7;&#x522B;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<em> false</em>&#x3002;</p>
</li>
<li><p>public-client</p>
<p>&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A;true&#xFF0C;&#x5219;&#x9002;&#x914D;&#x5668;&#x5C06;&#x4E0D;&#x4F1A;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x51ED;&#x636E;&#x53D1;&#x9001;&#x5230;Keycloak&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<em>false</em>&#x3002;</p>
</li>
<li><p>enable-cors</p>
<p>&#x8FD9;&#x4F7F;CORS&#x652F;&#x6301;&#x6210;&#x4E3A;&#x53EF;&#x80FD;&#x3002; &#x5B83;&#x5C06;&#x5904;&#x7406;CORS&#x9884;&#x68C0;&#x8BF7;&#x6C42;&#x3002; &#x5B83;&#x8FD8;&#x5C06;&#x67E5;&#x770B;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x4EE5;&#x786E;&#x5B9A;&#x6709;&#x6548;&#x7684;&#x6765;&#x6E90;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<em>false</em>&#x3002;</p>
</li>
<li><p>cors-max-age</p>
<p>&#x5982;&#x679C;&#x542F;&#x7528;&#x4E86;CORS&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;<code>Access-Control-Max-Age</code>&#x6807;&#x5934;&#x7684;&#x503C;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x5982;&#x679C;&#x672A;&#x8BBE;&#x7F6E;&#xFF0C;&#x5219;&#x5728;CORS&#x54CD;&#x5E94;&#x4E2D;&#x4E0D;&#x8FD4;&#x56DE;&#x6B64;&#x6807;&#x5934;&#x3002;</p>
</li>
<li><p>cors-allowed-methods</p>
<p>&#x5982;&#x679C;&#x542F;&#x7528;&#x4E86;CORS&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;<code>Access-Control-Allow-Methods</code>&#x6807;&#x5934;&#x7684;&#x503C;&#x3002; &#x8FD9;&#x5E94;&#x8BE5;&#x662F;&#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x5982;&#x679C;&#x672A;&#x8BBE;&#x7F6E;&#xFF0C;&#x5219;&#x5728;CORS&#x54CD;&#x5E94;&#x4E2D;&#x4E0D;&#x8FD4;&#x56DE;&#x6B64;&#x6807;&#x5934;&#x3002;</p>
</li>
<li><p>cors-allowed-headers</p>
<p>&#x5982;&#x679C;&#x542F;&#x7528;&#x4E86;CORS&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;<code>Access-Control-Allow-Headers</code>&#x6807;&#x5934;&#x7684;&#x503C;&#x3002; &#x8FD9;&#x5E94;&#x8BE5;&#x662F;&#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x5982;&#x679C;&#x672A;&#x8BBE;&#x7F6E;&#xFF0C;&#x5219;&#x5728;CORS&#x54CD;&#x5E94;&#x4E2D;&#x4E0D;&#x8FD4;&#x56DE;&#x6B64;&#x6807;&#x5934;&#x3002;</p>
</li>
<li><p>cors-exposed-headers</p>
<p>&#x5982;&#x679C;&#x542F;&#x7528;&#x4E86;CORS&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;<code>Access-Control-Expose-Headers</code>&#x6807;&#x5934;&#x7684;&#x503C;&#x3002; &#x8FD9;&#x5E94;&#x8BE5;&#x662F;&#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x5982;&#x679C;&#x672A;&#x8BBE;&#x7F6E;&#xFF0C;&#x5219;&#x5728;CORS&#x54CD;&#x5E94;&#x4E2D;&#x4E0D;&#x8FD4;&#x56DE;&#x6B64;&#x6807;&#x5934;&#x3002;</p>
</li>
<li><p>bearer-only</p>
<p>&#x5BF9;&#x4E8E;&#x670D;&#x52A1;&#xFF0C;&#x5E94;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;<em>true</em>&#x3002; &#x5982;&#x679C;&#x542F;&#x7528;&#xFF0C;&#x9002;&#x914D;&#x5668;&#x5C06;&#x4E0D;&#x4F1A;&#x5C1D;&#x8BD5;&#x5BF9;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x800C;&#x53EA;&#x4F1A;&#x9A8C;&#x8BC1;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<em>false</em>&#x3002;</p>
</li>
<li><p>autodetect-bearer-only</p>
<p>&#x5982;&#x679C;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x540C;&#x65F6;&#x63D0;&#x4F9B;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;Web&#x670D;&#x52A1;&#xFF08;&#x4F8B;&#x5982;SOAP&#x6216;REST&#xFF09;&#xFF0C;&#x5219;&#x5E94;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;<em>true</em>&#x3002; &#x5B83;&#x5141;&#x8BB8;&#x60A8;&#x5C06;&#x672A;&#x7ECF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7528;&#x6237;&#x91CD;&#x5B9A;&#x5411;&#x5230;Keycloak&#x767B;&#x5F55;&#x9875;&#x9762;&#xFF0C;&#x4F46;&#x662F;&#x5C06;HTTP<code>401</code>&#x72B6;&#x6001;&#x4EE3;&#x7801;&#x53D1;&#x9001;&#x7ED9;&#x672A;&#x7ECF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;SOAP&#x6216;REST&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x65E0;&#x6CD5;&#x7406;&#x89E3;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x767B;&#x5F55;&#x9875;&#x9762;&#x3002; Keycloak&#x57FA;&#x4E8E;&#x5178;&#x578B;&#x7684;&#x6807;&#x9898;&#x81EA;&#x52A8;&#x68C0;&#x6D4B;SOAP&#x6216;REST&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5982;<code>X-Requested-With</code>&#xFF0C;<code>SOAPAction</code> &#x6216; <code>Accept</code>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<em>false</em>&#x3002;</p>
</li>
<li><p>enable-basic-auth</p>
<p>&#x8FD9;&#x544A;&#x8BC9;&#x9002;&#x914D;&#x5668;&#x4E5F;&#x652F;&#x6301;&#x57FA;&#x672C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x5982;&#x679C;&#x542F;&#x7528;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x5219;&#x8FD8;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;<em>secret</em>&#x3002; &#x8FD9;&#x662F;<em>&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<em>false</em>&#x3002;</p>
</li>
<li><p>expose-token</p>
<p>&#x5982;&#x679C;&#x662F;<code>true</code>&#xFF0C;&#x5219;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x901A;&#x8FC7;JavaScript HTTP&#x8C03;&#x7528;&#xFF09;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;URL <code>root/k_query_bearer_token</code>&#x83B7;&#x53D6;&#x7B7E;&#x540D;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<em>false</em>&#x3002;</p>
</li>
<li><p>credentials</p>
<p>&#x6307;&#x5B9A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x51ED;&#x636E;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x8868;&#x793A;&#x6CD5;&#xFF0C;&#x5176;&#x4E2D;&#x952E;&#x662F;&#x51ED;&#x8BC1;&#x7C7B;&#x578B;&#xFF0C;&#x503C;&#x662F;&#x51ED;&#x8BC1;&#x7C7B;&#x578B;&#x7684;&#x503C;&#x3002; &#x76EE;&#x524D;&#x652F;&#x6301;&#x5BC6;&#x7801;&#x548C;jwt&#x3002; &#x8FD9;&#x662F;<em>&#x5FC5;&#x987B;&#x7684;</em>&#x4EC5;&#x9002;&#x7528;&#x4E8E;&#x5177;&#x6709;&apos;Confidential(&#x673A;&#x5BC6;)&apos;&#x8BBF;&#x95EE;&#x7C7B;&#x578B;&#x7684;&#x5BA2;&#x6237;&#x3002;</p>
</li>
<li><p>connection-pool-size</p>
<p>&#x9002;&#x914D;&#x5668;&#x5C06;&#x5BF9;Keycloak&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x5355;&#x72EC;&#x7684;HTTP&#x8C03;&#x7528;&#xFF0C;&#x4EE5;&#x5C06;&#x8BBF;&#x95EE;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x4E3A;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x6B64;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x5B9A;&#x4E49;&#x5E94;&#x8BE5;&#x5408;&#x5E76;&#x5230;Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>20</code>&#x3002;</p>
</li>
<li><p>disable-trust-manager</p>
<p>&#x5982;&#x679C;Keycloak&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;HTTPS&#x5E76;&#x4E14;&#x6B64;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x4E3A;true&#xFF0C;&#x5219;&#x4E0D;&#x5FC5;&#x6307;&#x5B9A;&#x4FE1;&#x4EFB;&#x5E93;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4EC5;&#x5E94;&#x5728;&#x5F00;&#x53D1;&#x671F;&#x95F4;&#x4F7F;&#x7528;&#xFF0C;<strong>&#x6C38;&#x8FDC;</strong>&#x4E0D;&#x8981;&#x5728;&#x751F;&#x4EA7;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5C06;&#x7981;&#x7528;SSL&#x8BC1;&#x4E66;&#x7684;&#x9A8C;&#x8BC1;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>false</code>&#x3002;</p>
</li>
<li><p>allow-any-hostname</p>
<p>&#x5982;&#x679C;Keycloak&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;HTTPS&#x5E76;&#x4E14;&#x6B64;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x4E3A;<code>true</code>&#xFF0C;&#x5219;&#x901A;&#x8FC7;&#x4FE1;&#x4EFB;&#x5E93;&#x9A8C;&#x8BC1;Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;&#x8BC1;&#x4E66;&#xFF0C;&#x4F46;&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;&#x4E3B;&#x673A;&#x540D;&#x9A8C;&#x8BC1;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4EC5;&#x5E94;&#x5728;&#x5F00;&#x53D1;&#x671F;&#x95F4;&#x4F7F;&#x7528;&#xFF0C;<strong>&#x6C38;&#x8FDC;</strong>&#x4E0D;&#x8981;&#x5728;&#x751F;&#x4EA7;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5C06;&#x7981;&#x7528;SSL&#x8BC1;&#x4E66;&#x7684;&#x9A8C;&#x8BC1;&#x3002; &#x6B64;&#x6D4B;&#x8BD5;&#x5728;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#x4E2D;&#x53EF;&#x80FD;&#x5F88;&#x6709;&#x7528;&#x3002;&#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>false</code>&#x3002;</p>
</li>
<li><p>proxy-url</p>
<p>HTTP&#x4EE3;&#x7406;&#x7684;URL&#xFF08;&#x5982;&#x679C;&#x4F7F;&#x7528;&#xFF09;&#x3002;</p>
</li>
<li><p>truststore</p>
<p>&#x8BE5;&#x503C;&#x662F;&#x4FE1;&#x4EFB;&#x5E93;&#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x3002; &#x5982;&#x679C;&#x5728;&#x8DEF;&#x5F84;&#x524D;&#x52A0;&#x4E0A;<code>classpath:</code>&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x4ECE;&#x90E8;&#x7F72;&#x7684;&#x7C7B;&#x8DEF;&#x5F84;&#x4E2D;&#x83B7;&#x53D6;&#x4FE1;&#x4EFB;&#x5E93;&#x3002; &#x7528;&#x4E8E;&#x4E0E;Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;&#x4F20;&#x51FA;HTTPS&#x901A;&#x4FE1;&#x3002; &#x53D1;&#x51FA;HTTPS&#x8BF7;&#x6C42;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x9A8C;&#x8BC1;&#x4ED6;&#x4EEC;&#x6B63;&#x5728;&#x4E0E;&#x4E4B;&#x901A;&#x4FE1;&#x7684;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4E3B;&#x673A;&#x3002; &#x8FD9;&#x5C31;&#x662F;&#x59D4;&#x6258;&#x4EBA;&#x6240;&#x505A;&#x7684;&#x3002; &#x5BC6;&#x94A5;&#x5E93;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x53EF;&#x4FE1;&#x4E3B;&#x673A;&#x8BC1;&#x4E66;&#x6216;&#x8BC1;&#x4E66;&#x9881;&#x53D1;&#x673A;&#x6784;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x63D0;&#x53D6;Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;SSL&#x5BC6;&#x94A5;&#x5E93;&#x7684;&#x516C;&#x5171;&#x8BC1;&#x4E66;&#x6765;&#x521B;&#x5EFA;&#x6B64;&#x4FE1;&#x4EFB;&#x5E93;&#x3002; &#x8FD9;&#x662F;<em> &#x5FC5;&#x987B;&#x7684;</em>&#xFF0C;&#x9664;&#x975E;<code>ssl-required</code>&#x662F;<code>none</code>&#x6216;<code>disable-trust-manager</code> &#x662F; <code>true</code>&#x3002;</p>
</li>
<li><p>truststore-password</p>
<p>&#x4FE1;&#x4EFB;&#x5E93;&#x7684;&#x5BC6;&#x7801;&#x3002; &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;<code>truststore</code>&#x5E76;&#x4E14;&#x4FE1;&#x4EFB;&#x5E93;&#x9700;&#x8981;&#x5BC6;&#x7801;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x662F;<em>&#x5FC5;&#x987B;&#x7684;</em>&#x3002;</p>
</li>
<li><p>client-keystore</p>
<p>&#x8FD9;&#x662F;&#x5BC6;&#x94A5;&#x5E93;&#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x3002; &#x5F53;&#x9002;&#x914D;&#x5668;&#x5411;Keycloak&#x670D;&#x52A1;&#x5668;&#x53D1;&#x51FA;HTTPS&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x6B64;&#x5BC6;&#x94A5;&#x5E93;&#x5305;&#x542B;&#x53CC;&#x5411;SSL&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8BC1;&#x4E66;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002;</p>
</li>
<li><p>client-keystore-password</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x5E93;&#x7684;&#x5BC6;&#x7801;&#x3002; &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;<code>client-keystore</code>&#xFF0C;&#x8FD9;&#x662F;<em>&#x5FC5;&#x987B;&#x7684;</em>&#x3002;</p>
</li>
<li><p>client-key-password</p>
<p>&#x5BA2;&#x6237;&#x5BC6;&#x94A5;&#x7684;&#x5BC6;&#x7801;&#x3002; &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;<code>client-keystore</code>&#xFF0C;&#x8FD9;&#x662F;<em>&#x5FC5;&#x987B;&#x7684;</em>&#x3002;</p>
</li>
<li><p>always-refresh-token</p>
<p>&#x5982;&#x679C;<em>true</em>&#xFF0C;&#x5219;&#x9002;&#x914D;&#x5668;&#x5C06;&#x5728;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x4E2D;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x3002;</p>
</li>
<li><p>register-node-at-startup</p>
<p>&#x5982;&#x679C;<em>true</em>&#xFF0C;&#x5219;&#x9002;&#x914D;&#x5668;&#x5C06;&#x5411;Keycloak&#x53D1;&#x9001;&#x6CE8;&#x518C;&#x8BF7;&#x6C42;&#x3002; &#x5B83;&#x9ED8;&#x8BA4;&#x4E3A;<em>false</em>&#xFF0C;&#x4EC5;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x96C6;&#x7FA4;&#x65F6;&#x624D;&#x6709;&#x7528;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_applicationclustering" target="_blank">&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7FA4;&#x96C6;</a></p>
</li>
<li><p>register-node-period</p>
<p>&#x91CD;&#x65B0;&#x6CE8;&#x518C;&#x9002;&#x914D;&#x5668;&#x5230;Keycloak&#x7684;&#x671F;&#x9650;&#x3002; &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x96C6;&#x7FA4;&#x65F6;&#x5F88;&#x6709;&#x7528;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_applicationclustering" target="_blank">&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7FA4;&#x96C6;</a></p>
</li>
<li><p>token-store</p>
<p>&#x53EF;&#x80FD;&#x7684;&#x503C;&#x662F;<em>session</em>&#x548C;<em>cookie</em>&#x3002; &#x9ED8;&#x8BA4;&#x4E3A;<em>session</em>&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x9002;&#x914D;&#x5668;&#x5728;HTTP&#x4F1A;&#x8BDD;&#x4E2D;&#x5B58;&#x50A8;&#x5E10;&#x6237;&#x4FE1;&#x606F;&#x3002; &#x5982;&#x679C;&#x662F;<em>cookie</em>&#x8868;&#x793A;&#x5728;cookie&#x4E2D;&#x5B58;&#x50A8;&#x4FE1;&#x606F;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_applicationclustering" target="_blank">&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7FA4;&#x96C6;</a></p>
</li>
<li><p>token-cookie-path</p>
<p>&#x4F7F;&#x7528;cookie&#x5B58;&#x50A8;&#x65F6;&#xFF0C;&#x6B64;&#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x5E10;&#x6237;&#x4FE1;&#x606F;&#x7684;cookie&#x7684;&#x8DEF;&#x5F84;&#x3002; &#x5982;&#x679C;&#x5B83;&#x662F;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x5219;&#x5047;&#x5B9A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x4E0A;&#x4E0B;&#x6587;&#x6839;&#x4E2D;&#x8FD0;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x76F8;&#x5BF9;&#x4E8E;&#x8BE5;&#x4E0A;&#x4E0B;&#x6587;&#x6839;&#x8FDB;&#x884C;&#x89E3;&#x91CA;&#x3002; &#x5982;&#x679C;&#x5B83;&#x662F;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x5219;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;cookie&#x8DEF;&#x5F84;&#x3002; &#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x76F8;&#x5BF9;&#x4E8E;&#x4E0A;&#x4E0B;&#x6587;&#x6839;&#x7684;&#x8DEF;&#x5F84;&#x3002;</p>
</li>
<li><p>principal-attribute</p>
<p>&#x4F7F;&#x7528;OpenID Connect ID Token&#x5C5E;&#x6027;&#x586B;&#x5145;UserPrincipal&#x540D;&#x79F0;&#x3002; &#x5982;&#x679C;token&#x5C5E;&#x6027;&#x4E3A;null&#xFF0C;&#x5219;&#x9ED8;&#x8BA4;&#x4E3A;<code>sub</code>&#x3002; &#x53EF;&#x80FD;&#x7684;&#x503C;&#x662F;<code>sub</code>&#xFF0C;<code>preferred_username</code>&#xFF0C;<code>email</code>&#xFF0C;<code>name</code>&#xFF0C;<code>nickname</code>&#xFF0C;<code>given_name</code>&#xFF0C;<code>family_name</code>&#x3002;</p>
</li>
<li><p>turn-off-change-session-id-on-login</p>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x5E73;&#x53F0;&#x4E0A;&#x6210;&#x529F;&#x767B;&#x5F55;&#x65F6;&#x4F1A;&#x66F4;&#x6539;&#x4F1A;&#x8BDD;ID&#x4EE5;&#x63D2;&#x5165;&#x5B89;&#x5168;&#x653B;&#x51FB;&#x5411;&#x91CF;&#x3002; &#x5982;&#x679C;&#x8981;&#x5C06;&#x5176;&#x5173;&#x95ED;&#xFF0C;&#x8BF7;&#x5C06;&#x6B64;&#x66F4;&#x6539;&#x4E3A;true&#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<em>false</em>&#x3002;</p>
</li>
<li><p>token-minimum-time-to-live</p>
<p>&#x5728;Keycloak&#x670D;&#x52A1;&#x5668;&#x5230;&#x671F;&#x4E4B;&#x524D;&#x4F7F;&#x7528;Keycloak&#x670D;&#x52A1;&#x5668;&#x62A2;&#x5148;&#x5237;&#x65B0;&#x6D3B;&#x52A8;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x7684;&#x65F6;&#x95F4;&#xFF08;&#x4EE5;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#xFF09;&#x3002; &#x5F53;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x88AB;&#x53D1;&#x9001;&#x5230;&#x53E6;&#x4E00;&#x4E2A;REST&#x5BA2;&#x6237;&#x7AEF;&#x65F6;&#xFF0C;&#x8FD9;&#x5728;&#x5B83;&#x53EF;&#x80FD;&#x5728;&#x8BC4;&#x4F30;&#x4E4B;&#x524D;&#x5230;&#x671F;&#x65F6;&#x7279;&#x522B;&#x6709;&#x7528;&#x3002; &#x8BE5;&#x503C;&#x4E0D;&#x5E94;&#x8D85;&#x8FC7;&#x9886;&#x57DF;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x5BFF;&#x547D;&#x3002; &#x8FD9;&#x662F;<em>&#x53EF;&#x9009;&#x7684;</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>0</code>&#x79D2;&#xFF0C;&#x56E0;&#x6B64;&#x9002;&#x914D;&#x5668;&#x5C06;&#x5237;&#x65B0;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x5DF2;&#x8FC7;&#x671F;&#x3002;</p>
</li>
<li><p>min-time-between-jwks-requests</p>
<p>&#x6307;&#x5B9A;Keycloak&#x68C0;&#x7D22;&#x65B0;&#x516C;&#x94A5;&#x7684;&#x4E24;&#x4E2A;&#x8BF7;&#x6C42;&#x4E4B;&#x95F4;&#x7684;&#x6700;&#x5C0F;&#x95F4;&#x9694;&#x7684;&#x65F6;&#x95F4;&#x91CF;&#xFF08;&#x4EE5;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#xFF09;&#x3002; &#x9ED8;&#x8BA4;&#x4E3A;10&#x79D2;&#x3002; &#x5F53;&#x9002;&#x914D;&#x5668;&#x8BC6;&#x522B;&#x5E26;&#x6709;&#x672A;&#x77E5;<code>kid</code>&#x7684;&#x4EE4;&#x724C;&#x65F6;&#xFF0C;&#x5B83;&#x603B;&#x662F;&#x4F1A;&#x5C1D;&#x8BD5;&#x4E0B;&#x8F7D;&#x65B0;&#x7684;&#x516C;&#x94A5;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x5B83;&#x4E0D;&#x4F1A;&#x6BCF;10&#x79D2;&#x5C1D;&#x8BD5;&#x4E00;&#x6B21;&#xFF08;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF09;&#x3002; &#x8FD9;&#x662F;&#x4E3A;&#x4E86;&#x907F;&#x514D;DoS&#xFF0C;&#x5F53;&#x653B;&#x51FB;&#x8005;&#x53D1;&#x9001;&#x5927;&#x91CF;&#x5E26;&#x6709;&#x9519;&#x8BEF;<code>kid</code>&#x5F3A;&#x5236;&#x9002;&#x914D;&#x5668;&#x7684;&#x4EE4;&#x724C;&#x5411;Keycloak&#x53D1;&#x9001;&#x5927;&#x91CF;&#x8BF7;&#x6C42;&#x65F6;&#x3002;</p>
</li>
<li><p>public-key-cache-ttl</p>
<p>&#x6307;&#x5B9A;Keycloak&#x68C0;&#x7D22;&#x65B0;&#x516C;&#x94A5;&#x7684;&#x4E24;&#x4E2A;&#x8BF7;&#x6C42;&#x4E4B;&#x95F4;&#x7684;&#x6700;&#x5927;&#x95F4;&#x9694;&#x7684;&#x65F6;&#x95F4;&#x91CF;&#xFF08;&#x4EE5;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#xFF09;&#x3002; &#x9ED8;&#x8BA4;&#x4E3A;86400&#x79D2;&#xFF08;1&#x5929;&#xFF09;&#x3002; &#x5F53;&#x9002;&#x914D;&#x5668;&#x8BC6;&#x522B;&#x5E26;&#x6709;&#x672A;&#x77E5;<code>kid</code>&#x7684;&#x4EE4;&#x724C;&#x65F6;&#xFF0C;&#x5B83;&#x603B;&#x662F;&#x4F1A;&#x5C1D;&#x8BD5;&#x4E0B;&#x8F7D;&#x65B0;&#x7684;&#x516C;&#x94A5;&#x3002; &#x5982;&#x679C;&#x5B83;&#x8BC6;&#x522B;&#x5DF2;&#x77E5;<code>kid</code>&#x7684;&#x4EE4;&#x724C;&#xFF0C;&#x5B83;&#x5C06;&#x53EA;&#x4F7F;&#x7528;&#x5148;&#x524D;&#x4E0B;&#x8F7D;&#x7684;&#x516C;&#x94A5;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x6BCF;&#x4E2A;&#x6B64;&#x914D;&#x7F6E;&#x7684;&#x95F4;&#x9694;&#xFF08;&#x9ED8;&#x8BA4;&#x4E3A;1&#x5929;&#xFF09;&#x81F3;&#x5C11;&#x4E00;&#x6B21;&#x5C06;&#x662F;&#x65B0;&#x7684;&#x516C;&#x94A5;&#xFF0C;&#x5373;&#x4F7F;&#x4EE4;&#x724C;&#x7684;<code>kid</code>&#x5DF2;&#x77E5;&#xFF0C;&#x4E5F;&#x4F1A;&#x4E00;&#x76F4;&#x4E0B;&#x8F7D;&#x3002;</p>
</li>
<li><p>ignore-oauth-query-parameter</p>
<p>&#x9ED8;&#x8BA4;&#x4E3A;<code>false</code>&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A;<code>true</code>&#x5C06;&#x5173;&#x95ED;&#x5904;&#x7406;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x5904;&#x7406;&#x7684;<code>access_token</code>&#x67E5;&#x8BE2;&#x53C2;&#x6570;&#x3002; &#x5982;&#x679C;&#x7528;&#x6237;&#x53EA;&#x4F20;&#x5165;<code>access_token</code>&#xFF0C;&#x4ED6;&#x4EEC;&#x5C06;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;</p>
</li>
<li><p>redirect-rewrite-rules</p>
<p>&#x5982;&#x679C;&#x9700;&#x8981;&#xFF0C;&#x8BF7;&#x6307;&#x5B9A;&#x91CD;&#x5B9A;&#x5411;URI&#x91CD;&#x5199;&#x89C4;&#x5219;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x8868;&#x793A;&#x6CD5;&#xFF0C;&#x5176;&#x4E2D;&#x952E;&#x662F;&#x8981;&#x4E0E;Redirect URI&#x5339;&#x914D;&#x7684;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x503C;&#x662F;&#x66FF;&#x6362;String&#x3002; <code>$</code>&#x5B57;&#x7B26;&#x53EF;&#x7528;&#x4E8E;&#x66FF;&#x6362;String&#x4E2D;&#x7684;&#x53CD;&#x5411;&#x5F15;&#x7528;&#x3002;</p>
</li>
<li><p>verify-token-audience</p>
<p>&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A;&#x201C;true&#x201D;&#xFF0C;&#x5219;&#x5728;&#x4F7F;&#x7528;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x671F;&#x95F4;&#xFF0C;&#x9002;&#x914D;&#x5668;&#x5C06;&#x9A8C;&#x8BC1;&#x4EE4;&#x724C;&#x662F;&#x5426;&#x5305;&#x542B;&#x6B64;&#x5BA2;&#x6237;&#x7AEF;&#x540D;&#x79F0;&#xFF08;&#x8D44;&#x6E90;&#xFF09;&#x4F5C;&#x4E3A;&#x53D7;&#x4F17;&#x3002; &#x8BE5;&#x9009;&#x9879;&#x5BF9;&#x4E8E;&#x4E3B;&#x8981;&#x670D;&#x52A1;&#x4E8E;&#x7531;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x9A8C;&#x8BC1;&#x7684;&#x8BF7;&#x6C42;&#x7684;&#x670D;&#x52A1;&#x7279;&#x522B;&#x6709;&#x7528;&#x3002; &#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x4E3A;<code>false</code>&#xFF0C;&#x4F46;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x5EFA;&#x8BAE;&#x542F;&#x7528;&#x6B64;&#x529F;&#x80FD;&#x3002; &#x6709;&#x5173;&#x53D7;&#x4F17;&#x7FA4;&#x4F53;&#x652F;&#x6301;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_admin/#_audience" target="_blank">&#x53D7;&#x4F17;&#x7FA4;&#x4F53;&#x652F;&#x6301;</a>&#x3002;</p>
</li>
</ul>
<p><a name="23_____2_1_2__JBoss_EAP_WildFly_&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="212-jboss-eapwildfly-&#x9002;&#x914D;&#x5668;"><a name="212-jboss-eapwildfly-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#212-jboss-eapwildfly-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.2. JBoss EAP/WildFly &#x9002;&#x914D;&#x5668;</h4>
<p>&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x5728;JBoss EAP&#xFF0C;WildFly&#x6216;JBoss AS&#x4E0A;&#x7684;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;Keycloak&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x3002; &#x7136;&#x540E;&#xFF0C;&#x60A8;&#x6709;&#x4E24;&#x4E2A;&#x9009;&#x9879;&#x6765;&#x4FDD;&#x62A4;&#x60A8;&#x7684;WAR&#x3002;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x5728;WAR&#x4E2D;&#x63D0;&#x4F9B;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5728;web.xml&#x4E2D;&#x5C06;auth-method&#x66F4;&#x6539;&#x4E3A;KEYCLOAK&#x3002;</p>
<p>&#x6216;&#x8005;&#xFF0C;&#x60A8;&#x6839;&#x672C;&#x4E0D;&#x5FC5;&#x4FEE;&#x6539;WAR&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684;Keycloak&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x914D;&#x7F6E;&#xFF08;&#x4F8B;&#x5982;<code>standalone.xml</code>&#xFF09;&#x6765;&#x4FDD;&#x62A4;&#x5B83;&#x3002; &#x672C;&#x8282;&#x5C06;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x3002;</p>
<p><a name="24______&#x5B89;&#x88C5;&#x9002;&#x914D;&#x5668;"></a></p>
<h5 id="&#x5B89;&#x88C5;&#x9002;&#x914D;&#x5668;"><a name="&#x5B89;&#x88C5;&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#&#x5B89;&#x88C5;&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B89;&#x88C5;&#x9002;&#x914D;&#x5668;</h5>
<p>&#x6839;&#x636E;&#x60A8;&#x4F7F;&#x7528;&#x7684;&#x670D;&#x52A1;&#x5668;&#x7248;&#x672C;&#xFF0C;&#x9002;&#x914D;&#x5668;&#x53EF;&#x4F5C;&#x4E3A;&#x5355;&#x72EC;&#x7684;&#x5B58;&#x6863;&#x63D0;&#x4F9B;&#x3002;</p>
<blockquote>
<p>&#x6211;&#x4EEC;&#x53EA;&#x6D4B;&#x8BD5;&#x548C;&#x7EF4;&#x62A4;&#x9002;&#x914D;&#x5668;&#xFF0C;&#x5E76;&#x5728;&#x53D1;&#x5E03;&#x65F6;&#x63D0;&#x4F9B;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684;WildFly&#x3002; &#x4E00;&#x65E6;&#x53D1;&#x5E03;&#x4E86;&#x65B0;&#x7248;&#x672C;&#x7684;WildFly&#xFF0C;&#x5F53;&#x524D;&#x7684;&#x9002;&#x914D;&#x5668;&#x5C06;&#x88AB;&#x5F03;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;WildFly&#x7248;&#x672C;&#x53D1;&#x5E03;&#x540E;&#x5C06;&#x5220;&#x9664;&#x5BF9;&#x5B83;&#x4EEC;&#x7684;&#x652F;&#x6301;&#x3002; &#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x5C06;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4ECE;WildFly&#x5207;&#x6362;&#x5230;JBoss EAP&#xFF0C;&#x56E0;&#x4E3A;JBoss EAP&#x9002;&#x914D;&#x5668;&#x7684;&#x652F;&#x6301;&#x65F6;&#x95F4;&#x66F4;&#x957F;&#x3002;</p>
</blockquote>
<p>&#x5B89;&#x88C5;WildFly 9&#x6216;&#x66F4;&#x65B0;&#x7248;&#x672C;:</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$WILDFLY_HOME</span>
$ unzip keycloak-wildfly-adapter-dist-6.0.1.zip
</code></pre>
<p>&#x5B89;&#x88C5;WildFly 8:</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$WILDFLY_HOME</span>
$ unzip keycloak-wf8-adapter-dist-6.0.1.zip
</code></pre>
<p>&#x5B89;&#x88C5;JBoss EAP 7:</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$EAP_HOME</span>
$ unzip keycloak-eap7-adapter-dist-6.0.1.zip
</code></pre>
<p>&#x5B89;&#x88C5;JBoss EAP 6:</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$EAP_HOME</span>
$ unzip keycloak-eap6-adapter-dist-6.0.1.zip
</code></pre>
<p>&#x5B89;&#x88C5;JBoss AS 7.1:</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$JBOSS_HOME</span>
$ unzip keycloak-as7-adapter-dist-6.0.1.zip
</code></pre>
<p>&#x6B64;ZIP&#x5B58;&#x6863;&#x5305;&#x542B;&#x7279;&#x5B9A;&#x4E8E;Keycloak&#x9002;&#x914D;&#x5668;&#x7684;JBoss&#x6A21;&#x5757;&#x3002; &#x5B83;&#x8FD8;&#x5305;&#x542B;JBoss CLI&#x811A;&#x672C;&#x4EE5;&#x914D;&#x7F6E;&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x3002;</p>
<p>&#x8981;&#x5728;&#x670D;&#x52A1;&#x5668;&#x672A;&#x8FD0;&#x884C;&#x65F6;&#x914D;&#x7F6E;&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#xFF0C;&#x8BF7;&#x6267;&#x884C;&#xFF1A;</p>
<blockquote>
<p>&#x6216;&#x8005;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#x5B89;&#x88C5;&#x9002;&#x914D;&#x5668;&#x65F6;&#x6307;&#x5B9A;<code>server.config</code>&#x5C5E;&#x6027;&#xFF0C;&#x4EE5;&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x914D;&#x7F6E;&#x5B89;&#x88C5;&#x9002;&#x914D;&#x5668;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;<code>-Dserver.config=standalone-ha.xml</code>&#x3002;</p>
</blockquote>
<p>WildFly 11 &#x6216;&#x8005; &#x66F4;&#x65B0;&#x7248;&#x672C;</p>
<pre><code class="lang-bash">$ ./bin/jboss-cli.sh --file=bin/adapter-elytron-install-offline.cli
</code></pre>
<p>WildFly 10 &#x6216;&#x8005; &#x66F4;&#x65E7;&#x7248;&#x672C;</p>
<pre><code class="lang-bash">$ ./bin/jboss-cli.sh --file=bin/adapter-install-offline.cli
</code></pre>
<blockquote>
<p>&#x53EF;&#x4EE5;&#x5728;WildFly 11&#x6216;&#x66F4;&#x65B0;&#x7248;&#x672C;&#x4E0A;&#x4F7F;&#x7528;&#x4F20;&#x7EDF;&#x7684;&#x975E;Elytron&#x9002;&#x914D;&#x5668;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5373;&#x4F7F;&#x5728;&#x8FD9;&#x4E9B;&#x7248;&#x672C;&#x4E0A;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>adapter-install-offline.cli</code>&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x8F83;&#x65B0;&#x7684;Elytron&#x9002;&#x914D;&#x5668;&#x3002;</p>
</blockquote>
<p>&#x6216;&#x8005;&#xFF0C;&#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x5219;&#x6267;&#x884C;&#xFF1A;</p>
<p>WildFly 11 &#x6216;&#x8005; &#x66F4;&#x65B0;&#x7248;&#x672C;</p>
<pre><code class="lang-bash">$ ./bin/jboss-cli.sh -c --file=bin/adapter-elytron-install.cli
</code></pre>
<p>WildFly 10 &#x6216;&#x8005; &#x66F4;&#x65E7;&#x7248;&#x672C;</p>
<pre><code class="lang-bash">$ ./bin/jboss-cli.sh -c --file=bin/adapter-install.cli
</code></pre>
<p><a name="25______JBoss_SSO"></a></p>
<h5 id="jboss-sso"><a name="jboss-sso" class="anchor-navigation-ex-anchor" href="#jboss-sso"><i class="fa fa-link" aria-hidden="true"></i></a>JBoss SSO</h5>
<p>WildFly&#x5185;&#x7F6E;&#x652F;&#x6301;&#x90E8;&#x7F72;&#x5230;&#x540C;&#x4E00;WildFly&#x5B9E;&#x4F8B;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5355;&#x70B9;&#x767B;&#x5F55;&#x3002; &#x4F7F;&#x7528;Keycloak&#x65F6;&#x4E0D;&#x5E94;&#x542F;&#x7528;&#x6B64;&#x529F;&#x80FD;&#x3002;</p>
<p><a name="26______&#x6BCF;&#x4E2A;WAR&#x914D;&#x7F6E;&#x5FC5;&#x9700;"></a></p>
<h5 id="&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;&#x5FC5;&#x9700;"><a name="&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;&#x5FC5;&#x9700;" class="anchor-navigation-ex-anchor" href="#&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;&#x5FC5;&#x9700;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6BCF;&#x4E2A;WAR&#x914D;&#x7F6E;&#x5FC5;&#x9700;</h5>
<p>&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x5728;WAR&#x5305;&#x4E2D;&#x6DFB;&#x52A0;&#x914D;&#x7F6E;&#x548C;&#x7F16;&#x8F91;&#x6587;&#x4EF6;&#x6765;&#x76F4;&#x63A5;&#x4FDD;&#x62A4;WAR&#x3002;</p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x505A;&#x7684;&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x662F;&#x5728;WAR&#x7684;<code>WEB-INF</code>&#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>keycloak.json</code>&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x6B64;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#java_adapter_config" target="_blank">Java&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;</a> &#x90E8;&#x5206;&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x63CF;&#x8FF0;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;<code>web.xml</code>&#x4E2D;&#x5C06;<code>auth-method</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>KEYCLOAK</code>&#x3002; &#x60A8;&#x8FD8;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x6807;&#x51C6;servlet&#x5B89;&#x5168;&#x6027;&#x6765;&#x6307;&#x5B9A;URL&#x4E0A;&#x7684;&#x89D2;&#x8272;&#x57FA;&#x7840;&#x7EA6;&#x675F;&#x3002;</p>
<p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
      <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
      <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">module-name</span>&gt;</span>application<span class="hljs-tag">&lt;/<span class="hljs-name">module-name</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-collection</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-name</span>&gt;</span>Admins<span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/admin/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-collection</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">auth-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">user-data-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transport-guarantee</span>&gt;</span>CONFIDENTIAL<span class="hljs-tag">&lt;/<span class="hljs-name">transport-guarantee</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">user-data-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">security-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-collection</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-name</span>&gt;</span>Customers<span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/customers/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-collection</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">auth-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">user-data-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transport-guarantee</span>&gt;</span>CONFIDENTIAL<span class="hljs-tag">&lt;/<span class="hljs-name">transport-guarantee</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">user-data-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-constraint</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">login-config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-method</span>&gt;</span>KEYCLOAK<span class="hljs-tag">&lt;/<span class="hljs-name">auth-method</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">realm-name</span>&gt;</span>this is ignored currently<span class="hljs-tag">&lt;/<span class="hljs-name">realm-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">login-config</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
<p><a name="27______&#x901A;&#x8FC7;&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x4FDD;&#x62A4;WAR"></a></p>
<h5 id="&#x901A;&#x8FC7;&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x4FDD;&#x62A4;war"><a name="&#x901A;&#x8FC7;&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x4FDD;&#x62A4;war" class="anchor-navigation-ex-anchor" href="#&#x901A;&#x8FC7;&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x4FDD;&#x62A4;war"><i class="fa fa-link" aria-hidden="true"></i></a>&#x901A;&#x8FC7;&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x4FDD;&#x62A4;WAR</h5>
<p>&#x60A8;&#x4E0D;&#x5FC5;&#x4FEE;&#x6539;WAR&#x4EE5;&#x4F7F;&#x7528;Keycloak&#x4FDD;&#x62A4;&#x5B83;&#x3002; &#x76F8;&#x53CD;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Keycloak&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x4ECE;&#x5916;&#x90E8;&#x4FDD;&#x62A4;&#x5B83;&#x3002; &#x867D;&#x7136;&#x60A8;&#x4E0D;&#x5FC5;&#x5C06;KEYCLOAK&#x6307;&#x5B9A;&#x4E3A;<code>auth-method</code>&#xFF0C;&#x4F46;&#x4ECD;&#x9700;&#x8981;&#x5728;<code>web.xml</code>&#x4E2D;&#x5B9A;&#x4E49;<code>security-constraints</code>&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x60A8;&#x4E0D;&#x5FC5;&#x521B;&#x5EFA;<code>WEB-INF/keycloak.json</code>&#x6587;&#x4EF6;&#x3002; &#x800C;&#x662F;&#x5728;Keycloak&#x5B50;&#x7CFB;&#x7EDF;&#x5B9A;&#x4E49;&#x4E2D;&#x7684;&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#xFF08;&#x5373;<code>standalone.xml</code>&#xFF09;&#x4E2D;&#x5B9A;&#x4E49;&#x6B64;&#x5143;&#x6570;&#x636E;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">extensions</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">extension</span> <span class="hljs-attr">module</span>=<span class="hljs-string">&quot;org.keycloak.keycloak-adapter-subsystem&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">extensions</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">subsystem</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:domain:keycloak:1.1&quot;</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">secure-deployment</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;WAR MODULE NAME.war&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">realm</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-name">realm</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-server-url</span>&gt;</span>http://localhost:8081/auth<span class="hljs-tag">&lt;/<span class="hljs-name">auth-server-url</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ssl-required</span>&gt;</span>external<span class="hljs-tag">&lt;/<span class="hljs-name">ssl-required</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>customer-portal<span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">credential</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;secret&quot;</span>&gt;</span>password<span class="hljs-tag">&lt;/<span class="hljs-name">credential</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">secure-deployment</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">subsystem</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
</code></pre>
<p><code>secure-deployment``name</code>&#x5C5E;&#x6027;&#x6807;&#x8BC6;&#x8981;&#x4FDD;&#x62A4;&#x7684;WAR&#x3002; &#x5B83;&#x7684;&#x503C;&#x662F;<code>web.xml</code>&#x4E2D;&#x5B9A;&#x4E49;&#x7684;<code>module-name</code>&#xFF0C;&#x9644;&#x52A0;&#x4E86;<code>.war</code>&#x3002; &#x5176;&#x4F59;&#x7684;&#x914D;&#x7F6E;&#x51E0;&#x4E4E;&#x4E0E;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_java_adapter_config" target="_blank">Java adapter configuration</a>&#x4E2D;&#x5B9A;&#x4E49;&#x7684;<code>keycloak.json</code>&#x914D;&#x7F6E;&#x9009;&#x9879;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#x3002;</p>
<p>&#x4F8B;&#x5916;&#x662F;<code>credential</code>&#x5143;&#x7D20;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x60A8;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x8F6C;&#x5230;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x5E76;&#x8F6C;&#x5230;&#x6B64;WAR&#x6240;&#x5BF9;&#x5E94;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5BA2;&#x6237;&#x7AEF;/&#x5B89;&#x88C5;&#x9009;&#x9879;&#x5361;&#x3002; &#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x526A;&#x5207;&#x548C;&#x7C98;&#x8D34;&#x7684;&#x793A;&#x4F8B;XML&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x5982;&#x679C;&#x60A8;&#x6709;&#x591A;&#x4E2A;&#x7531;&#x540C;&#x4E00;&#x9886;&#x57DF;&#x4FDD;&#x62A4;&#x7684;&#x90E8;&#x7F72;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5728;&#x5355;&#x72EC;&#x7684;&#x5143;&#x7D20;&#x4E2D;&#x5171;&#x4EAB;&#x9886;&#x57DF;&#x914D;&#x7F6E;&#x3002; &#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">subsystem</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:domain:keycloak:1.1&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">realm</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;demo&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-server-url</span>&gt;</span>http://localhost:8080/auth<span class="hljs-tag">&lt;/<span class="hljs-name">auth-server-url</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ssl-required</span>&gt;</span>external<span class="hljs-tag">&lt;/<span class="hljs-name">ssl-required</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">realm</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">secure-deployment</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;customer-portal.war&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">realm</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-name">realm</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>customer-portal<span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">credential</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;secret&quot;</span>&gt;</span>password<span class="hljs-tag">&lt;/<span class="hljs-name">credential</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">secure-deployment</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">secure-deployment</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;product-portal.war&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">realm</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-name">realm</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>product-portal<span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">credential</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;secret&quot;</span>&gt;</span>password<span class="hljs-tag">&lt;/<span class="hljs-name">credential</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">secure-deployment</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">secure-deployment</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;database.war&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">realm</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-name">realm</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>database-service<span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bearer-only</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">bearer-only</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">secure-deployment</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">subsystem</span>&gt;</span>
</code></pre>
<p><a name="28______&#x5B89;&#x5168;&#x57DF;"></a></p>
<h5 id="&#x5B89;&#x5168;&#x57DF;"><a name="&#x5B89;&#x5168;&#x57DF;" class="anchor-navigation-ex-anchor" href="#&#x5B89;&#x5168;&#x57DF;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B89;&#x5168;&#x57DF;</h5>
<p>&#x8981;&#x5C06;&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;&#x4F20;&#x64AD;&#x5230;EJB&#x5C42;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x5C06;&#x5176;&#x914D;&#x7F6E;&#x4E3A;&#x4F7F;&#x7528;&#x201C;keycloak&#x201D;&#x5B89;&#x5168;&#x57DF;&#x3002; &#x8FD9;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;@SecurityDomain&#x6CE8;&#x91CA;&#x6765;&#x5B9E;&#x73B0;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">import</span> org.jboss.ejb3.annotation.SecurityDomain;
...

<span class="hljs-meta">@Stateless</span>
<span class="hljs-meta">@SecurityDomain</span>(<span class="hljs-string">&quot;keycloak&quot;</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerService</span> </span>{

    <span class="hljs-meta">@RolesAllowed</span>(<span class="hljs-string">&quot;user&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getCustomers</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> db.getCustomers();
    }
}
</code></pre>
<p><a name="29_____2_1_3__&#x4ECE;RPM&#x5B89;&#x88C5;JBoss_EAP&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="213-&#x4ECE;rpm&#x5B89;&#x88C5;jboss-eap&#x9002;&#x914D;&#x5668;"><a name="213-&#x4ECE;rpm&#x5B89;&#x88C5;jboss-eap&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#213-&#x4ECE;rpm&#x5B89;&#x88C5;jboss-eap&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.3. &#x4ECE;RPM&#x5B89;&#x88C5;JBoss EAP&#x9002;&#x914D;&#x5668;</h4>
<p>&#x4ECE;RPM&#x5B89;&#x88C5;EAP 7&#x9002;&#x914D;&#x5668;&#xFF1A;</p>
<blockquote>
<p>&#x5728;Red Hat Enterprise Linux 7&#x4E2D;&#xFF0C;<code>term channel</code>&#x88AB;&#x66FF;&#x6362;&#x4E3A;<code>term repository</code>&#x3002; &#x5728;&#x8FD9;&#x4E9B;&#x8BF4;&#x660E;&#x4E2D;&#xFF0C;&#x4EC5;&#x4F7F;&#x7528;<code>term repository</code>&#x3002;</p>
</blockquote>
<p>&#x60A8;&#x5FC5;&#x987B;&#x5148;&#x8BA2;&#x9605;JBoss EAP 7.2&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x80FD;&#x4ECE;RPM&#x5B89;&#x88C5;EAP 7&#x9002;&#x914D;&#x5668;&#x3002;</p>
<p>&#x5148;&#x51B3;&#x6761;&#x4EF6;</p>
<ol>
<li>&#x786E;&#x4FDD;&#x60A8;&#x7684;Red Hat Enterprise Linux&#x7CFB;&#x7EDF;&#x5DF2;&#x4F7F;&#x7528;Red Hat Subscription Manager&#x6CE8;&#x518C;&#x5230;&#x60A8;&#x7684;&#x5E10;&#x6237;&#x3002; &#x6709;&#x5173;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://access.redhat.com/documentation/en-us/red_hat_subscription_management/1/html-single/quick_registration_for_rhel/index" target="_blank">Red Hat&#x8BA2;&#x9605;&#x7BA1;&#x7406;&#x6587;&#x6863;</a>&#x3002;</li>
<li>&#x5982;&#x679C;&#x60A8;&#x5DF2;&#x7ECF;&#x8BA2;&#x9605;&#x4E86;&#x53E6;&#x4E00;&#x4E2A;JBoss EAP&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x5148;&#x53D6;&#x6D88;&#x8BA2;&#x9605;&#x8BE5;&#x5B58;&#x50A8;&#x5E93;&#x3002;</li>
</ol>
<p>&#x4F7F;&#x7528;Red Hat&#x8BA2;&#x9605;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x8BA2;&#x9605;JBoss EAP 7.2&#x5B58;&#x50A8;&#x5E93;&#x3002;&#x6839;&#x636E;&#x60A8;&#x7684;Red Hat Enterprise Linux&#x7248;&#x672C;&#xFF0C;&#x5C06;<rhel_version>&#x66FF;&#x6362;&#x4E3A;6&#x6216;7&#x3002;</rhel_version></p>
<pre><code class="lang-bash">$ sudo subscription-manager repos --enable=jb-eap-7-for-rhel-&lt;RHEL_VERSION&gt;-server-rpms
</code></pre>
<p>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x5B89;&#x88C5;OIDC&#x7684;EAP 7&#x9002;&#x914D;&#x5668;:</p>
<pre><code class="lang-bash">$ sudo yum install eap7-keycloak-adapter-sso7_3
</code></pre>
<blockquote>
<p>RPM&#x5B89;&#x88C5;&#x7684;&#x9ED8;&#x8BA4;EAP_HOME&#x8DEF;&#x5F84;&#x662F;:/opt/rh/eap7/root/usr/share/wildfly&#x3002;</p>
</blockquote>
<p>&#x8FD0;&#x884C;&#x9002;&#x5F53;&#x7684;&#x6A21;&#x5757;&#x5B89;&#x88C5;&#x811A;&#x672C;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;OIDC&#x6A21;&#x5757;&#xFF0C;&#x8F93;&#x5165;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;:</p>
<pre><code class="lang-bash">$ <span class="hljs-variable">$EAP_HOME</span>/bin/jboss-cli.sh -c --file=<span class="hljs-variable">$EAP_HOME</span>/bin/adapter-install.cli
</code></pre>
<p>&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x3002;</p>
<p>&#x4ECE;RPM&#x5B89;&#x88C5;EAP 6&#x9002;&#x914D;&#x5668;:</p>
<blockquote>
<p>&#x5728;Red Hat Enterprise Linux 7&#x4E2D;&#xFF0C;<code>term channel</code>&#x88AB;<code>term repository</code>&#x66FF;&#x6362;&#x3002;&#x5728;&#x8FD9;&#x4E9B;&#x6307;&#x4EE4;&#x4E2D;&#xFF0C;&#x53EA;&#x4F7F;&#x7528;<code>term repository</code>&#x3002;</p>
</blockquote>
<p>&#x5728;&#x4ECE;RPM&#x5B89;&#x88C5;EAP 6&#x9002;&#x914D;&#x5668;&#x4E4B;&#x524D;&#xFF0C;&#x5FC5;&#x987B;&#x8BA2;&#x9605;JBoss EAP 6.0&#x5B58;&#x50A8;&#x5E93;&#x3002;</p>
<p>&#x5148;&#x51B3;&#x6761;&#x4EF6;</p>
<ol>
<li>&#x786E;&#x4FDD;&#x60A8;&#x7684;Red Hat Enterprise Linux&#x7CFB;&#x7EDF;&#x4F7F;&#x7528;Red Hat Subscription Manager&#x6CE8;&#x518C;&#x5230;&#x60A8;&#x7684;&#x5E10;&#x6237;&#x3002;&#x6709;&#x5173;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1;<a href="https://access.redhat.com/documentation/en-us/red_hat_subscription_management/1/html-single/quick_registration_for_rhel/index" target="_blank">Red Hat&#x8BA2;&#x9605;&#x7BA1;&#x7406;&#x6587;&#x6863;</a>&#x3002;</li>
<li>&#x5982;&#x679C;&#x60A8;&#x5DF2;&#x7ECF;&#x8BA2;&#x9605;&#x4E86;&#x53E6;&#x4E00;&#x4E2A;JBoss EAP&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x9996;&#x5148;&#x4ECE;&#x8BE5;&#x5B58;&#x50A8;&#x5E93;&#x53D6;&#x6D88;&#x8BA2;&#x9605;&#x3002;</li>
</ol>
<p>&#x4F7F;&#x7528;Red Hat&#x8BA2;&#x9605;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x8BA2;&#x9605;JBoss EAP 6.0&#x5B58;&#x50A8;&#x5E93;&#x3002;&#x6839;&#x636E;&#x60A8;&#x7684;Red Hat Enterprise Linux&#x7248;&#x672C;&#xFF0C;&#x5C06;<rhel_version>&#x66FF;&#x6362;&#x4E3A;6&#x6216;7&#x3002;</rhel_version></p>
<pre><code class="lang-bash">$ sudo subscription-manager repos --enable=jb-eap-6-for-rhel-&lt;RHEL_VERSION&gt;-server-rpms
</code></pre>
<p>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x5B89;&#x88C5;OIDC&#x7684;EAP 6&#x9002;&#x914D;&#x5668;:</p>
<pre><code class="lang-bash">$ sudo yum install keycloak-adapter-sso7_3-eap6
</code></pre>
<blockquote>
<p>RPM&#x5B89;&#x88C5;&#x7684;&#x9ED8;&#x8BA4;EAP_HOME&#x8DEF;&#x5F84;&#x662F;/opt/rh/eap6/root/usr/share/wildfly&#x3002; </p>
</blockquote>
<p>&#x8FD0;&#x884C;&#x9002;&#x5F53;&#x7684;&#x6A21;&#x5757;&#x5B89;&#x88C5;&#x811A;&#x672C;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;OIDC&#x6A21;&#x5757;&#xFF0C;&#x8F93;&#x5165;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;:</p>
<pre><code class="lang-bash">$ <span class="hljs-variable">$EAP_HOME</span>/bin/jboss-cli.sh -c --file=<span class="hljs-variable">$EAP_HOME</span>/bin/adapter-install.cli
</code></pre>
<p>&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x3002;</p>
<p><a name="30_____2_1_4__JBoss_Fuse_6_&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="214-jboss-fuse-6-&#x9002;&#x914D;&#x5668;"><a name="214-jboss-fuse-6-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#214-jboss-fuse-6-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.4. JBoss Fuse 6 &#x9002;&#x914D;&#x5668;</h4>
<p>Keycloak&#x652F;&#x6301;&#x4FDD;&#x62A4;&#x5728;<a href="https://developers.redhat.com/products/fuse/overview/" target="_blank">JBoss Fuse 6</a>&#x4E2D;&#x8FD0;&#x884C;&#x7684;web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>JBoss Fuse 6&#x5229;&#x7528;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_jetty9_adapter" target="_blank">Jetty 9&#x9002;&#x914D;&#x5668;</a>&#x4F5C;&#x4E3A;JBoss Fuse 6.3.0 Rollup 5&#x4E0E;<a href="http://www.eclipse.org/jetty/" target="_blank">Jetty 9.2&#x670D;&#x52A1;&#x5668;</a>&#x6346;&#x7ED1;&#x5728;&#x4E00;&#x8D77;&#x548C;Jetty&#x7528;&#x4E8E;&#x8FD0;&#x884C;&#x5404;&#x79CD;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<blockquote>
<p>Fuse 6&#x552F;&#x4E00;&#x53D7;&#x652F;&#x6301;&#x7684;&#x7248;&#x672C;&#x662F;&#x6700;&#x65B0;&#x7248;&#x672C;&#x3002; &#x5982;&#x679C;&#x4F7F;&#x7528;&#x65E9;&#x671F;&#x7248;&#x672C;&#x7684;Fuse 6&#xFF0C;&#x5219;&#x67D0;&#x4E9B;&#x529F;&#x80FD;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002; &#x7279;&#x522B;&#x662F;&#xFF0C;<a href="https://hawt.io/" target="_blank">Hawtio</a>&#x96C6;&#x6210;&#x4E0D;&#x9002;&#x7528;&#x4E8E;&#x65E9;&#x671F;&#x7248;&#x672C;&#x7684;Fuse 6&#x3002;</p>
</blockquote>
<p>Fuse&#x652F;&#x6301;&#x4EE5;&#x4E0B;&#x9879;&#x76EE;&#x7684;&#x5B89;&#x5168;&#x6027;:</p>
<ul>
<li>&#x4F7F;&#x7528;Pax Web WAR Extender&#x5728;Fuse&#x4E0A;&#x90E8;&#x7F72;&#x7ECF;&#x5178;&#x7684;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</li>
<li>&#x4F7F;&#x7528;Pax Web&#x767D;&#x677F;&#x6269;&#x5C55;&#x5668;&#x5C06;servlet&#x4F5C;&#x4E3A;OSGI&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x5728;Fuse&#x4E0A;</li>
<li><a href="http://camel.apache.org/" target="_blank">Apache Camel</a>&#x4F7F;&#x7528;<a href="http://camel.apache.org/jetty.html" target="_blank">Camel Jetty</a>&#x7EC4;&#x4EF6;&#x8FD0;&#x884C;&#x7684;Jetty&#x7AEF;&#x70B9;</li>
<li><a href="http://cxf.apache.org/" target="_blank">Apache CXF</a>&#x7AEF;&#x70B9;&#x5728;&#x81EA;&#x5DF1;&#x72EC;&#x7ACB;&#x7684;<a href="http://cxf.apache.org/docs/jetty-configuration.html" target="_blank">Jetty&#x5F15;&#x64CE;</a>&#x4E0A;&#x8FD0;&#x884C;</li>
<li><a href="http://cxf.apache.org/" target="_blank">Apache CXF</a>&#x5728;CXF servlet&#x63D0;&#x4F9B;&#x7684;&#x9ED8;&#x8BA4;&#x5F15;&#x64CE;&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x7AEF;&#x70B9;</li>
<li>SSH&#x548C;JMX&#x7BA1;&#x7406;&#x5458;&#x8BBF;&#x95EE;&#x6743;&#x9650;</li>
<li><a href="https://hawt.io/" target="_blank">Hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;</a></li>
</ul>
<p><a name="31______&#x5728;Fuse_6&#x4E2D;&#x4FDD;&#x62A4;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"></a></p>
<h5 id="&#x5728;fuse-6&#x4E2D;&#x4FDD;&#x62A4;web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><a name="&#x5728;fuse-6&#x4E2D;&#x4FDD;&#x62A4;web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#&#x5728;fuse-6&#x4E2D;&#x4FDD;&#x62A4;web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5728;Fuse 6&#x4E2D;&#x4FDD;&#x62A4;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</h5>
<p>&#x60A8;&#x5FC5;&#x987B;&#x5148;&#x5B89;&#x88C5;Keycloak Karaf&#x529F;&#x80FD;&#x3002; &#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x6839;&#x636E;&#x8981;&#x4FDD;&#x62A4;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7C7B;&#x578B;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x3002; &#x6240;&#x6709;&#x5F15;&#x7528;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90FD;&#x9700;&#x8981;&#x5C06;Keycloak Jetty&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5668;&#x6CE8;&#x5165;&#x5E95;&#x5C42;Jetty&#x670D;&#x52A1;&#x5668;&#x3002; &#x5B9E;&#x73B0;&#x6B64;&#x76EE;&#x6807;&#x7684;&#x6B65;&#x9AA4;&#x53D6;&#x51B3;&#x4E8E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7C7B;&#x578B;&#x3002; &#x7EC6;&#x8282;&#x63CF;&#x8FF0;&#x5982;&#x4E0B;&#x3002;</p>
<p>&#x6700;&#x597D;&#x7684;&#x8D77;&#x70B9;&#x662F;&#x770B;&#x770B;&#x4F5C;&#x4E3A;<code>fuse</code>&#x76EE;&#x5F55;&#x4E2D;Keycloak&#x793A;&#x4F8B;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x6346;&#x7ED1;&#x7684;Fuse&#x6F14;&#x793A;&#x3002; &#x901A;&#x8FC7;&#x6D4B;&#x8BD5;&#x548C;&#x7406;&#x89E3;&#x6F14;&#x793A;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x6B65;&#x9AA4;&#x90FD;&#x5E94;&#x8BE5;&#x662F;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x7684;&#x3002;</p>
<p><a name="32______&#x5B89;&#x88C5;Keycloak&#x529F;&#x80FD;"></a></p>
<h5 id="&#x5B89;&#x88C5;keycloak&#x529F;&#x80FD;"><a name="&#x5B89;&#x88C5;keycloak&#x529F;&#x80FD;" class="anchor-navigation-ex-anchor" href="#&#x5B89;&#x88C5;keycloak&#x529F;&#x80FD;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B89;&#x88C5;Keycloak&#x529F;&#x80FD;</h5>
<p>&#x60A8;&#x5FC5;&#x987B;&#x9996;&#x5148;&#x5728;JBoss Fuse&#x73AF;&#x5883;&#x4E2D;&#x5B89;&#x88C5;<code>keycloak</code>&#x529F;&#x80FD;&#x3002; keycloak&#x529F;&#x80FD;&#x5305;&#x62EC;Fuse&#x9002;&#x914D;&#x5668;&#x548C;&#x6240;&#x6709;&#x7B2C;&#x4E09;&#x65B9;&#x4F9D;&#x8D56;&#x9879;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4ECE;Maven&#x5B58;&#x50A8;&#x5E93;&#x6216;&#x5B58;&#x6863;&#x4E2D;&#x5B89;&#x88C5;&#x5B83;&#x3002;</p>
<p><a name="33_______&#x4ECE;Maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;"></a></p>
<h6 id="&#x4ECE;maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;"><a name="&#x4ECE;maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x4ECE;maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4ECE;Maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;</h6>
<p>&#x4F5C;&#x4E3A;&#x5148;&#x51B3;&#x6761;&#x4EF6;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;&#x7EBF;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;Maven&#x5B58;&#x50A8;&#x5E93;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x793E;&#x533A;&#x6765;&#x8BF4;&#xFF0C;&#x53EA;&#x8981;&#x5728;maven&#x4E2D;&#x592E;&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x63D0;&#x4F9B;&#x6240;&#x6709;&#x5DE5;&#x4EF6;&#x548C;&#x7B2C;&#x4E09;&#x65B9;&#x4F9D;&#x8D56;&#x9879;&#x5C31;&#x8DB3;&#x591F;&#x4E86;&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;Maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;keycloak&#x529F;&#x80FD;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x542F;&#x52A8;JBoss Fuse 6.3.0 Rollup 5; &#x7136;&#x540E;&#x5728;Karaf&#x7EC8;&#x7AEF;&#x7C7B;&#x578B;&#xFF1A;</p>
<pre><code>features:addurl mvn:org.keycloak/keycloak-osgi-features/6.0.1/xml/features
features:install keycloak
</code></pre></li>
<li><p>&#x60A8;&#x53EF;&#x80FD;&#x8FD8;&#x9700;&#x8981;&#x5B89;&#x88C5;Jetty 9&#x529F;&#x80FD;&#xFF1A;</p>
<pre><code>features:install keycloak-jetty9-adapter
</code></pre></li>
<li><p>&#x786E;&#x4FDD;&#x5DF2;&#x5B89;&#x88C5;&#x529F;&#x80FD;&#xFF1A;</p>
<pre><code>features:list | grep keycloak
</code></pre></li>
</ol>
<p><a name="34_______&#x4ECE;ZIP&#x6346;&#x7ED1;&#x5305;&#x5B89;&#x88C5;"></a></p>
<h6 id="&#x4ECE;zip&#x6346;&#x7ED1;&#x5305;&#x5B89;&#x88C5;"><a name="&#x4ECE;zip&#x6346;&#x7ED1;&#x5305;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x4ECE;zip&#x6346;&#x7ED1;&#x5305;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4ECE;ZIP&#x6346;&#x7ED1;&#x5305;&#x5B89;&#x88C5;</h6>
<p>&#x5982;&#x679C;&#x60A8;&#x5904;&#x4E8E;&#x8131;&#x673A;&#x72B6;&#x6001;&#x6216;&#x4E0D;&#x60F3;&#x4F7F;&#x7528;Maven&#x83B7;&#x53D6;JAR&#x6587;&#x4EF6;&#x548C;&#x5176;&#x4ED6;&#x5DE5;&#x4EF6;&#xFF0C;&#x8FD9;&#x5C06;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p>
<p>&#x8981;&#x4ECE;ZIP&#x5B58;&#x6863;&#x5B89;&#x88C5;Fuse&#x9002;&#x914D;&#x5668;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x4E0B;&#x8F7D;Keycloak Fuse&#x9002;&#x914D;&#x5668;ZIP&#x5B58;&#x6863;&#x6587;&#x4EF6;&#x3002;</p>
</li>
<li><p>&#x5C06;&#x5176;&#x89E3;&#x538B;&#x7F29;&#x5230;JBoss Fuse&#x7684;&#x6839;&#x76EE;&#x5F55;&#x4E2D;&#x3002; &#x7136;&#x540E;&#x5C06;&#x4F9D;&#x8D56;&#x9879;&#x5B89;&#x88C5;&#x5728;<code>system</code>&#x76EE;&#x5F55;&#x4E0B;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x6240;&#x6709;&#x73B0;&#x6709;&#x7684;jar&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x5C06;&#x6B64;&#x7528;&#x4E8E;JBoss Fuse 6.3.0&#x6C47;&#x603B;5&#xFF1A;</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> /path-to-fuse/jboss-fuse-6.3.0.redhat-254
unzip -q /path-to-adapter-zip/keycloak-fuse-adapter-6.0.1.zip
</code></pre>
</li>
<li><p>&#x542F;&#x52A8;Fuse&#x5E76;&#x5728;Fuse/karaf&#x7EC8;&#x7AEF;&#x4E2D;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;:</p>
<pre><code class="lang-bash">features:addurl mvn:org.keycloak/keycloak-osgi-features/6.0.1/xml/features
features:install keycloak
</code></pre>
</li>
<li><p>&#x5B89;&#x88C5;&#x76F8;&#x5E94;&#x7684;Jetty&#x9002;&#x914D;&#x5668;&#x3002; &#x7531;&#x4E8E;artifacts&#x53EF;&#x76F4;&#x63A5;&#x5728;JBoss Fuse<code>system</code>&#x76EE;&#x5F55;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x65E0;&#x9700;&#x4F7F;&#x7528;Maven&#x5B58;&#x50A8;&#x5E93;&#x3002;</p>
</li>
</ol>
<p><a name="35______&#x4FDD;&#x62A4;&#x7ECF;&#x5178;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"></a></p>
<h5 id="&#x4FDD;&#x62A4;&#x7ECF;&#x5178;war&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><a name="&#x4FDD;&#x62A4;&#x7ECF;&#x5178;war&#x5E94;&#x7528;&#x7A0B;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x62A4;&#x7ECF;&#x5178;war&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FDD;&#x62A4;&#x7ECF;&#x5178;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</h5>
<p>&#x4FDD;&#x62A4;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6240;&#x9700;&#x7684;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li><p>&#x5728;<code>/WEB-INF/web.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x58F0;&#x660E;&#x5FC5;&#x8981;&#x7684;&#xFF1A;</p>
<ul>
<li><p><security-constraint>&#x5143;&#x7D20;&#x4E2D;&#x7684;&#x5B89;&#x5168;&#x6027;&#x7EA6;&#x675F;</security-constraint></p>
</li>
<li><p><login-config>&#x5143;&#x7D20;&#x4E2D;&#x7684;&#x767B;&#x5F55;&#x914D;&#x7F6E;</login-config></p>
</li>
<li><p><security-role>&#x5143;&#x7D20;&#x4E2D;&#x7684;&#x5B89;&#x5168;&#x89D2;&#x8272;&#x3002;</security-role></p>
<p>&#x4F8B;&#x5982;&#xFF1A;</p>
</li>
</ul>
<pre><code class="lang-xml">  <span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
  <span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
           <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
           <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
           <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">module-name</span>&gt;</span>customer-portal<span class="hljs-tag">&lt;/<span class="hljs-name">module-name</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file-list</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.html<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file-list</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">security-constraint</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-collection</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-name</span>&gt;</span>Customers<span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-name</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/customers/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-collection</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">auth-constraint</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">auth-constraint</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">security-constraint</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">login-config</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">auth-method</span>&gt;</span>BASIC<span class="hljs-tag">&lt;/<span class="hljs-name">auth-method</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">realm-name</span>&gt;</span>does-not-matter<span class="hljs-tag">&lt;/<span class="hljs-name">realm-name</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">login-config</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
</li>
<li><p>&#x5C06;&#x5E26;&#x6709;&#x9A8C;&#x8BC1;&#x5668;&#x7684;<code>jetty-web.xml</code>&#x6587;&#x4EF6;&#x6DFB;&#x52A0;&#x5230;<code>/WEB-INF/jetty-web.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE Configure PUBLIC &quot;-//Mort Bay Consulting//DTD Configure//EN&quot;
 &quot;http://www.eclipse.org/jetty/configure_9_0.dtd&quot;&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Configure</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.webapp.WebAppContext&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Get</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;securityHandler&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Set</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticator&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">New</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.jetty.KeycloakJettyAuthenticator&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">New</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Set</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Get</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Configure</span>&gt;</span>
</code></pre>
</li>
<li><p>&#x5728;WAR&#x7684;<code>/WEB-INF/</code>&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x6587;&#x4EF6;keycloak.json&#x3002; &#x8BE5;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_java_adapter_config" target="_blank">Java Adapters Config</a> &#x90E8;&#x5206;&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x63CF;&#x8FF0;&#x3002; &#x4E5F;&#x53EF;&#x4EE5;&#x6309;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#config_external_adapter" target="_blank">&#x914D;&#x7F6E;&#x5916;&#x90E8;&#x9002;&#x914D;&#x5668;</a>&#x4E2D;&#x7684;&#x8BF4;&#x660E;&#x5728;&#x5916;&#x90E8;&#x4F7F;&#x7528;&#x6B64;&#x6587;&#x4EF6;&#x3002;</p>
</li>
<li><p>&#x786E;&#x4FDD;&#x60A8;&#x7684;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;<code>Import-Package</code>&#x6807;&#x9898;&#x4E0B;&#x7684;<code>META-INF/MANIFEST.MF</code>&#x6587;&#x4EF6;&#x4E2D;&#x5BFC;&#x5165;<code>org.keycloak.adapters.jetty</code>&#x548C;&#x66F4;&#x591A;&#x8F6F;&#x4EF6;&#x5305;&#x3002; &#x5728;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;<code>maven-bundle-plugin</code>&#x53EF;&#x4EE5;&#x5728;&#x6E05;&#x5355;&#x4E2D;&#x6B63;&#x786E;&#x751F;&#x6210;OSGI&#x5934;&#x6587;&#x4EF6;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5305;&#x7684;&#x201C;*&#x201D;&#x89E3;&#x6790;&#x4E0D;&#x4F1A;&#x5BFC;&#x5165;<code>org.keycloak.adapters.jetty</code>&#x5305;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4E0D;&#x662F;&#x7531;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6216;Blueprint&#x6216;Spring&#x63CF;&#x8FF0;&#x7B26;&#x4F7F;&#x7528;&#xFF0C;&#x800C;&#x662F;&#x5728;<code>jetty-web.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x8981;&#x5BFC;&#x5165;&#x7684;&#x5305;&#x7684;&#x5217;&#x8868;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>
<pre><code>org.keycloak.adapters.jetty;version=&quot;6.0.1&quot;,
org.keycloak.adapters;version=&quot;6.0.1&quot;,
org.keycloak.constants;version=&quot;6.0.1&quot;,
org.keycloak.util;version=&quot;6.0.1&quot;,
org.keycloak.*;version=&quot;6.0.1&quot;,
*;resolution:=optional
</code></pre></li>
</ol>
<p><a name="36_______&#x914D;&#x7F6E;&#x5916;&#x90E8;&#x9002;&#x914D;&#x5668;"></a></p>
<h6 id="&#x914D;&#x7F6E;&#x5916;&#x90E8;&#x9002;&#x914D;&#x5668;"><a name="&#x914D;&#x7F6E;&#x5916;&#x90E8;&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;&#x5916;&#x90E8;&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x914D;&#x7F6E;&#x5916;&#x90E8;&#x9002;&#x914D;&#x5668;</h6>
<p>&#x5982;&#x679C;&#x60A8;&#x4E0D;&#x5E0C;&#x671B;&#x5C06;<code>keycloak.json</code>&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6346;&#x7ED1;&#x5728;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x800C;&#x662F;&#x6839;&#x636E;&#x547D;&#x540D;&#x7EA6;&#x5B9A;&#x5728;&#x5916;&#x90E8;&#x63D0;&#x4F9B;&#x5E76;&#x52A0;&#x8F7D;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;&#x6B64;&#x914D;&#x7F6E;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x8981;&#x542F;&#x7528;&#x8BE5;&#x529F;&#x80FD;&#xFF0C;&#x8BF7;&#x5C06;&#x6B64;&#x90E8;&#x5206;&#x6DFB;&#x52A0;&#x5230;<code>/WEB_INF/web.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>keycloak.config.resolver<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>org.keycloak.adapters.osgi.PathBasedKeycloakConfigResolver<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span>
</code></pre>
<p>&#x8BE5;&#x7EC4;&#x4EF6;&#x4F7F;&#x7528;<code>keycloak.config</code>&#x6216;<code>karaf.etc</code> java&#x5C5E;&#x6027;&#x6765;&#x641C;&#x7D22;&#x57FA;&#x672C;&#x6587;&#x4EF6;&#x5939;&#x4EE5;&#x627E;&#x5230;&#x914D;&#x7F6E;&#x3002; &#x7136;&#x540E;&#x5728;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x641C;&#x7D22;&#x540D;&#x4E3A;<code>&lt;your_web_context&gt; -keycloak.json</code>&#x7684;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5177;&#x6709;&#x4E0A;&#x4E0B;&#x6587;<code>my-portal</code>&#xFF0C;&#x90A3;&#x4E48;&#x60A8;&#x7684;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x5C06;&#x4ECE;<code>$FUSE_HOME/etc/my-portal-keycloak.json</code>&#x6587;&#x4EF6;&#x52A0;&#x8F7D;&#x3002;</p>
<p><a name="37______&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x4E3A;OSGI&#x670D;&#x52A1;&#x7684;Servlet"></a></p>
<h5 id="&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x4E3A;osgi&#x670D;&#x52A1;&#x7684;servlet"><a name="&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x4E3A;osgi&#x670D;&#x52A1;&#x7684;servlet" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x4E3A;osgi&#x670D;&#x52A1;&#x7684;servlet"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x4E3A;OSGI&#x670D;&#x52A1;&#x7684;Servlet</h5>
<p>&#x5982;&#x679C;&#x5728;OSGI&#x6346;&#x7ED1;&#x9879;&#x76EE;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x672A;&#x90E8;&#x7F72;&#x4E3A;&#x7ECF;&#x5178;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;servlet&#x7C7B;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x3002; Fuse&#x4F7F;&#x7528;Pax Web Whiteboard Extender&#x5C06;&#x8FD9;&#x4E9B;servlet&#x90E8;&#x7F72;&#x4E3A;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;Keycloak&#x4FDD;&#x62A4;&#x60A8;&#x7684;servlet&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>Keycloak&#x63D0;&#x4F9B;&#x4E86;PaxWebIntegrationService&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x6CE8;&#x5165;jetty-web.xml&#x5E76;&#x4E3A;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x914D;&#x7F6E;&#x5B89;&#x5168;&#x6027;&#x7EA6;&#x675F;&#x3002; &#x60A8;&#x9700;&#x8981;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5185;&#x7684;<code>OSGI-INF/blueprint/blueprint.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x58F0;&#x660E;&#x6B64;&#x7C7B;&#x670D;&#x52A1;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x60A8;&#x7684;servlet&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x5B83;&#x3002; &#x914D;&#x7F6E;&#x793A;&#x4F8B;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">blueprint</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</span>
           <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
           <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0
           http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd&quot;</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Using jetty bean just for the compatibility with other fuse services --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;servletConstraintMapping&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.security.ConstraintMapping&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;constraint&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.util.security.Constraint&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;cst1&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;roles&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticate&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataConstraint&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pathSpec&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/product-portal/*&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakPaxWebIntegration&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.osgi.PaxWebIntegrationService&quot;</span>
          <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;start&quot;</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">&quot;stop&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jettyWebXmlLocation&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/WEB-INF/jetty-web.xml&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bundleContext&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;blueprintBundleContext&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;constraintMappings&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">component-id</span>=<span class="hljs-string">&quot;servletConstraintMapping&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;productServlet&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.example.ProductPortalServlet&quot;</span> <span class="hljs-attr">depends-on</span>=<span class="hljs-string">&quot;keycloakPaxWebIntegration&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;productServlet&quot;</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">&quot;javax.servlet.Servlet&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service-properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;alias&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/product-portal&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;servlet-name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ProductServlet&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;keycloak.config.file&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/keycloak.json&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service-properties</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">blueprint</span>&gt;</span>
</code></pre>
<ul>
<li>&#x60A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x5305;&#x542B;<code>WEB-INF</code>&#x76EE;&#x5F55;&#xFF08;&#x5373;&#x4F7F;&#x60A8;&#x7684;&#x9879;&#x76EE;&#x4E0D;&#x662F;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF09;&#x5E76;&#x521B;&#x5EFA;<code>/WEB-INF/jetty-web.xml</code>&#x548C;<code>/WEB-INF/keycloak.json</code>&#x6587;&#x4EF6;&#xFF0C;&#x5982;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse_adapter_classic_war" target="_blank">&#x7ECF;&#x5178;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</a>&#x90E8;&#x5206;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x60A8;&#x4E0D;&#x9700;&#x8981;<code>web.xml</code>&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x84DD;&#x56FE;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x58F0;&#x660E;&#x4E86;&#x5B89;&#x5168;&#x6027;&#x7EA6;&#x675F;&#x3002;</li>
</ul>
</li>
<li><p><code>META-INF/MANIFEST.MF</code>&#x4E2D;&#x7684;<code>Import-Package</code>&#x5FC5;&#x987B;&#x81F3;&#x5C11;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5BFC;&#x5165;&#xFF1A;</p>
<pre><code class="lang-properties">org.keycloak.adapters.jetty;version=&quot;6.0.1&quot;,
org.keycloak.adapters;version=&quot;6.0.1&quot;,
org.keycloak.constants;version=&quot;6.0.1&quot;,
org.keycloak.util;version=&quot;6.0.1&quot;,
org.keycloak.*;version=&quot;6.0.1&quot;,
*;resolution:=optional
</code></pre>
</li>
</ol>
<p><a name="38______&#x4FDD;&#x62A4;Apache_Camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"></a></p>
<h5 id="&#x4FDD;&#x62A4;apache-camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><a name="&#x4FDD;&#x62A4;apache-camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x62A4;apache-camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FDD;&#x62A4;Apache Camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</h5>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6DFB;&#x52A0;&#x5E26;&#x6709;<code>KeycloakJettyAuthenticator</code>&#x7684;securityHandler&#x5E76;&#x6CE8;&#x5165;&#x9002;&#x5F53;&#x7684;&#x5B89;&#x5168;&#x7EA6;&#x675F;&#x6765;&#x4FDD;&#x62A4;&#x4F7F;&#x7528;<a href="http://camel.apache.org/jetty.html" target="_blank">camel-jetty</a>&#x7EC4;&#x4EF6;&#x5B9E;&#x73B0;&#x7684;Apache Camel&#x7AEF;&#x70B9;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7C7B;&#x4F3C;&#x4EE5;&#x4E0B;&#x914D;&#x7F6E;&#x5C06;<code>OSGI-INF/blueprint/blueprint.xml</code>&#x6587;&#x4EF6;&#x6DFB;&#x52A0;&#x5230;Camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x3002; &#x89D2;&#x8272;&#xFF0C;&#x5B89;&#x5168;&#x7EA6;&#x675F;&#x6620;&#x5C04;&#x548C;Keycloak&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x53EF;&#x80FD;&#x7565;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x5177;&#x4F53;&#x53D6;&#x51B3;&#x4E8E;&#x60A8;&#x7684;&#x73AF;&#x5883;&#x548C;&#x9700;&#x6C42;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>

<span class="hljs-tag">&lt;<span class="hljs-name">blueprint</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</span>
           <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
           <span class="hljs-attr">xmlns:camel</span>=<span class="hljs-string">&quot;http://camel.apache.org/schema/blueprint&quot;</span>
           <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;
       http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
       http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;kcAdapterConfig&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.representations.adapters.config.AdapterConfig&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;realm&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;demo&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;resource&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;admin-camel-endpoint&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bearerOnly&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authServerUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;http://localhost:8080/auth&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sslRequired&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;EXTERNAL&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakAuthenticator&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.jetty.KeycloakJettyAuthenticator&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;adapterConfig&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;kcAdapterConfig&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;constraint&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.util.security.Constraint&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Customers&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;roles&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticate&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataConstraint&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;constraintMapping&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.security.ConstraintMapping&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;constraint&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;constraint&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pathSpec&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/*&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;securityHandler&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.security.ConstraintSecurityHandler&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticator&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;keycloakAuthenticator&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;constraintMappings&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">component-id</span>=<span class="hljs-string">&quot;constraintMapping&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authMethod&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;BASIC&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;realmName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;does-not-matter&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sessionHandler&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.jetty.spi.WrappingSessionHandler&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;handler&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;securityHandler&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;helloProcessor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.example.CamelHelloProcessor&quot;</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">camelContext</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;blueprintContext&quot;</span>
                  <span class="hljs-attr">trace</span>=<span class="hljs-string">&quot;false&quot;</span>
                  <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://camel.apache.org/schema/blueprint&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;httpBridge&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">from</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;jetty:http://0.0.0.0:8383/admin-camel-endpoint?handlers=sessionHandler&amp;amp;matchOnUriPrefix=true&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;helloProcessor&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;The message from camel endpoint contains ${body}&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">camelContext</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">blueprint</span>&gt;</span>
</code></pre>
<ul>
<li><code>META-INF/MANIFEST.MF</code>&#x4E2D;&#x7684;<code>Import-Package</code>&#x9700;&#x8981;&#x5305;&#x542B;&#x8FD9;&#x4E9B;&#x5BFC;&#x5165;&#xFF1A;</li>
</ul>
<pre><code class="lang-properties">javax.servlet;version=&quot;[3,4)&quot;,
javax.servlet.http;version=&quot;[3,4)&quot;,
org.apache.camel.*,
org.apache.camel;version=&quot;[2.13,3)&quot;,
org.eclipse.jetty.security;version=&quot;[9,10)&quot;,
org.eclipse.jetty.server.nio;version=&quot;[9,10)&quot;,
org.eclipse.jetty.util.security;version=&quot;[9,10)&quot;,
org.keycloak.*;version=&quot;6.0.1&quot;,
org.osgi.service.blueprint,
org.osgi.service.blueprint.container,
org.osgi.service.event,
</code></pre>
<p><a name="39______Camel_RestDSL"></a></p>
<h5 id="camel-restdsl"><a name="camel-restdsl" class="anchor-navigation-ex-anchor" href="#camel-restdsl"><i class="fa fa-link" aria-hidden="true"></i></a>Camel RestDSL</h5>
<p>Camel Rest DSL&#x662F;&#x4E00;&#x79CD;Camel&#x529F;&#x80FD;&#xFF0C;&#x7528;&#x4E8E;&#x4EE5;&#x6D41;&#x7545;&#x7684;&#x65B9;&#x5F0F;&#x5B9A;&#x4E49;REST&#x7AEF;&#x70B9;&#x3002; &#x4F46;&#x60A8;&#x4ECD;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x7279;&#x5B9A;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x6709;&#x5173;&#x5982;&#x4F55;&#x4E0E;Keycloak&#x96C6;&#x6210;&#x7684;&#x8BF4;&#x660E;&#x3002;</p>
<p>&#x914D;&#x7F6E;&#x96C6;&#x6210;&#x673A;&#x5236;&#x7684;&#x65B9;&#x6CD5;&#x53D6;&#x51B3;&#x4E8E;&#x60A8;&#x4E3A;&#x5176;&#x914D;&#x7F6E;RestDSL&#x5B9A;&#x4E49;&#x7684;&#x8DEF;&#x7531;&#x7684;Camel&#x7EC4;&#x4EF6;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#x663E;&#x793A;&#x5982;&#x4F55;&#x4F7F;&#x7528;Jetty&#x7EC4;&#x4EF6;&#x914D;&#x7F6E;&#x96C6;&#x6210;&#xFF0C;&#x4EE5;&#x53CA;&#x5BF9;&#x5148;&#x524D;Blueprint&#x793A;&#x4F8B;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x67D0;&#x4E9B;bean&#x7684;&#x5F15;&#x7528;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;securityHandlerRest&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.security.ConstraintSecurityHandler&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticator&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;keycloakAuthenticator&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;constraintMappings&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">component-id</span>=<span class="hljs-string">&quot;constraintMapping&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authMethod&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;BASIC&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;realmName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;does-not-matter&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sessionHandlerRest&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.jetty.spi.WrappingSessionHandler&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;handler&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;securityHandlerRest&quot;</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>


<span class="hljs-tag">&lt;<span class="hljs-name">camelContext</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;blueprintContext&quot;</span>
              <span class="hljs-attr">trace</span>=<span class="hljs-string">&quot;false&quot;</span>
              <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://camel.apache.org/schema/blueprint&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">restConfiguration</span> <span class="hljs-attr">component</span>=<span class="hljs-string">&quot;jetty&quot;</span> <span class="hljs-attr">contextPath</span>=<span class="hljs-string">&quot;/restdsl&quot;</span>
                       <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8484&quot;</span>&gt;</span>
        <span class="hljs-comment">&lt;!--the link with Keycloak security handlers happens here--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">endpointProperty</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;handlers&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;sessionHandlerRest&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">endpointProperty</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">endpointProperty</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;matchOnUriPrefix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">endpointProperty</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">restConfiguration</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">rest</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/hello&quot;</span> &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Hello rest service<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">get</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;/{id}&quot;</span> <span class="hljs-attr">outType</span>=<span class="hljs-string">&quot;java.lang.String&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Just an helllo<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;direct:justDirect&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">get</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">rest</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;justDirect&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">from</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;direct:justDirect&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;helloProcessor&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;RestDSL correctly invoked ${body}&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">setBody</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">constant</span>&gt;</span>(__This second sentence is returned from a Camel RestDSL endpoint__)<span class="hljs-tag">&lt;/<span class="hljs-name">constant</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">setBody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">camelContext</span>&gt;</span>
</code></pre>
<p><a name="40______&#x5728;&#x5355;&#x72EC;&#x7684;Jetty&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;Apache_CXF&#x7AEF;&#x70B9;"></a></p>
<h5 id="&#x5728;&#x5355;&#x72EC;&#x7684;jetty&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;"><a name="&#x5728;&#x5355;&#x72EC;&#x7684;jetty&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x5728;&#x5355;&#x72EC;&#x7684;jetty&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5728;&#x5355;&#x72EC;&#x7684;Jetty&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;Apache CXF&#x7AEF;&#x70B9;</h5>
<p>&#x8981;&#x5728;&#x5355;&#x72EC;&#x7684;Jetty&#x5F15;&#x64CE;&#x4E0A;&#x8FD0;&#x884C;Keycloak&#x4FDD;&#x62A4;&#x7684;CXF&#x7AEF;&#x70B9;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x5C06;<code>META-INF/spring/beans.xml</code>&#x6DFB;&#x52A0;&#x5230;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x5E76;&#x5728;&#x5176;&#x4E2D;&#x4F7F;&#x7528;Jetty SecurityHandler&#x58F0;&#x660E;<code>httpj&#xFF1A;ngine-factory</code>&#xFF0C;&#x5E76;&#x6CE8;&#x5165;<code>KeycloakJettyAuthenticator</code>&#x3002; CFX JAX-WS&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x914D;&#x7F6E;&#x53EF;&#x80FD;&#x7C7B;&#x4F3C;&#x4E8E;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>

<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="hljs-attr">xmlns:jaxws</span>=<span class="hljs-string">&quot;http://cxf.apache.org/jaxws&quot;</span>
       <span class="hljs-attr">xmlns:httpj</span>=<span class="hljs-string">&quot;http://cxf.apache.org/transports/http-jetty/configuration&quot;</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
        http://www.springframework.org/schema/osgi http://www.springframework.org/schema/osgi/spring-osgi.xsd
        http://cxf.apache.org/transports/http-jetty/configuration http://cxf.apache.org/schemas/configuration/http-jetty.xsd&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;classpath:META-INF/cxf/cxf.xml&quot;</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;kcAdapterConfig&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.representations.adapters.config.AdapterConfig&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;realm&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;demo&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;resource&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;custom-cxf-endpoint&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bearerOnly&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authServerUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;http://localhost:8080/auth&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sslRequired&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;EXTERNAL&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakAuthenticator&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.jetty.KeycloakJettyAuthenticator&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;adapterConfig&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">local</span>=<span class="hljs-string">&quot;kcAdapterConfig&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;constraint&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.util.security.Constraint&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Customers&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;roles&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticate&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataConstraint&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;constraintMapping&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.security.ConstraintMapping&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;constraint&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;constraint&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pathSpec&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/*&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;securityHandler&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.security.ConstraintSecurityHandler&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticator&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;keycloakAuthenticator&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;constraintMappings&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">local</span>=<span class="hljs-string">&quot;constraintMapping&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authMethod&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;BASIC&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;realmName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;does-not-matter&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">httpj:engine-factory</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&quot;cxf&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;kc-cxf-endpoint&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">httpj:engine</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8282&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">httpj:handlers</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">local</span>=<span class="hljs-string">&quot;securityHandler&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">httpj:handlers</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">httpj:sessionSupport</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">httpj:sessionSupport</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">httpj:engine</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">httpj:engine-factory</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">jaxws:endpoint</span>
                    <span class="hljs-attr">implementor</span>=<span class="hljs-string">&quot;org.keycloak.example.ws.ProductImpl&quot;</span>
                    <span class="hljs-attr">address</span>=<span class="hljs-string">&quot;http://localhost:8282/ProductServiceCF&quot;</span> <span class="hljs-attr">depends-on</span>=<span class="hljs-string">&quot;kc-cxf-endpoint&quot;</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span>
</code></pre>
<p>&#x5BF9;&#x4E8E;CXF JAX-RS&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x552F;&#x4E00;&#x7684;&#x533A;&#x522B;&#x53EF;&#x80FD;&#x5728;&#x4E8E;&#x4F9D;&#x8D56;&#x4E8E;engine-factory&#x7684;&#x7AEF;&#x70B9;&#x914D;&#x7F6E;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">jaxrs:server</span> <span class="hljs-attr">serviceClass</span>=<span class="hljs-string">&quot;org.keycloak.example.rs.CustomerService&quot;</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&quot;http://localhost:8282/rest&quot;</span>
    <span class="hljs-attr">depends-on</span>=<span class="hljs-string">&quot;kc-cxf-endpoint&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">jaxrs:providers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">jaxrs:providers</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">jaxrs:server</span>&gt;</span>
</code></pre>
</li>
<li><p><code>META-INF/MANIFEST.MF</code>&#x4E2D;&#x7684;<code>Import-Package</code>&#x5FC5;&#x987B;&#x5305;&#x542B;&#x90A3;&#x4E9B;&#x5BFC;&#x5165;&#xFF1A;</p>
</li>
</ol>
<pre><code class="lang-properties">META-INF.cxf;version=&quot;[2.7,3.2)&quot;,
META-INF.cxf.osgi;version=&quot;[2.7,3.2)&quot;;resolution:=optional,
org.apache.cxf.bus;version=&quot;[2.7,3.2)&quot;,
org.apache.cxf.bus.spring;version=&quot;[2.7,3.2)&quot;,
org.apache.cxf.bus.resource;version=&quot;[2.7,3.2)&quot;,
org.apache.cxf.transport.http;version=&quot;[2.7,3.2)&quot;,
org.apache.cxf.*;version=&quot;[2.7,3.2)&quot;,
org.springframework.beans.factory.config,
org.eclipse.jetty.security;version=&quot;[9,10)&quot;,
org.eclipse.jetty.util.security;version=&quot;[9,10)&quot;,
org.keycloak.*;version=&quot;6.0.1&quot;
</code></pre>
<p><a name="41______&#x5728;&#x9ED8;&#x8BA4;Jetty&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;Apache_CXF&#x7AEF;&#x70B9;"></a></p>
<h5 id="&#x5728;&#x9ED8;&#x8BA4;jetty&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;"><a name="&#x5728;&#x9ED8;&#x8BA4;jetty&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x5728;&#x9ED8;&#x8BA4;jetty&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5728;&#x9ED8;&#x8BA4;Jetty&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;Apache CXF&#x7AEF;&#x70B9;</h5>
<p>&#x67D0;&#x4E9B;&#x670D;&#x52A1;&#x4F1A;&#x5728;&#x542F;&#x52A8;&#x65F6;&#x81EA;&#x52A8;&#x9644;&#x5E26;&#x5DF2;&#x90E8;&#x7F72;&#x7684;servlet&#x3002; &#x4E00;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x670D;&#x52A1;&#x662F;&#x5728;<code>http://localhost:8181/cxf</code>&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x8FD0;&#x884C;&#x7684;CXF servlet&#x3002; &#x4FDD;&#x62A4;&#x8FD9;&#x4E9B;&#x7AEF;&#x70B9;&#x53EF;&#x80FD;&#x5F88;&#x590D;&#x6742;&#x3002; Keycloak&#x76EE;&#x524D;&#x4F7F;&#x7528;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;ServletReregistrationService&#xFF0C;&#x5B83;&#x5728;&#x542F;&#x52A8;&#x65F6;&#x53D6;&#x6D88;&#x90E8;&#x7F72;&#x5185;&#x7F6E;servlet&#xFF0C;&#x4F7F;&#x60A8;&#x80FD;&#x591F;&#x5728;Keycloak&#x4FDD;&#x62A4;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x91CD;&#x65B0;&#x90E8;&#x7F72;&#x5B83;&#x3002;</p>
<p>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<code>OSGI-INF/blueprint/blueprint.xml</code>&#x53EF;&#x80FD;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E0B;&#x9762;&#x7684;&#x90A3;&#x4E2A;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5B83;&#x6DFB;&#x52A0;&#x4E86;JAX-RS<code>customerservice</code>&#x7AEF;&#x70B9;&#xFF0C;&#x5B83;&#x662F;&#x7279;&#x5B9A;&#x4E8E;&#x7AEF;&#x70B9;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F46;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x5B83;&#x4FDD;&#x62A4;&#x6574;&#x4E2A;<code>/cxf</code>&#x4E0A;&#x4E0B;&#x6587;&#x3002;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">blueprint</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</span>
           <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
           <span class="hljs-attr">xmlns:jaxrs</span>=<span class="hljs-string">&quot;http://cxf.apache.org/blueprint/jaxrs&quot;</span>
           <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;
                http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
                http://cxf.apache.org/blueprint/jaxrs http://cxf.apache.org/schemas/blueprint/jaxrs.xsd&quot;</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- JAXRS Application --&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;customerBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.example.rs.CxfCustomerService&quot;</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">jaxrs:server</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cxfJaxrsServer&quot;</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&quot;/customerservice&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">jaxrs:providers</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">jaxrs:providers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">jaxrs:serviceBeans</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">component-id</span>=<span class="hljs-string">&quot;customerBean&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">jaxrs:serviceBeans</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">jaxrs:server</span>&gt;</span>


    <span class="hljs-comment">&lt;!-- Securing of whole /cxf context by unregister default cxf servlet from paxweb and re-register with applied security constraints --&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cxfConstraintMapping&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.security.ConstraintMapping&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;constraint&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.util.security.Constraint&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;cst1&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;roles&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticate&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataConstraint&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pathSpec&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/cxf/*&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cxfKeycloakPaxWebIntegration&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.osgi.PaxWebIntegrationService&quot;</span>
          <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;start&quot;</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">&quot;stop&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bundleContext&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;blueprintBundleContext&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jettyWebXmlLocation&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/WEB-INF/jetty-web.xml&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;constraintMappings&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">component-id</span>=<span class="hljs-string">&quot;cxfConstraintMapping&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;defaultCxfReregistration&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.osgi.ServletReregistrationService&quot;</span> <span class="hljs-attr">depends-on</span>=<span class="hljs-string">&quot;cxfKeycloakPaxWebIntegration&quot;</span>
          <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;start&quot;</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">&quot;stop&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bundleContext&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;blueprintBundleContext&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;managedServiceReference&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">&quot;org.osgi.service.cm.ManagedService&quot;</span> <span class="hljs-attr">filter</span>=<span class="hljs-string">&quot;(service.pid=org.apache.cxf.osgi)&quot;</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;5000&quot;</span>  /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">blueprint</span>&gt;</span>
</code></pre>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x9ED8;&#x8BA4;CXF HTTP&#x76EE;&#x6807;&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x6240;&#x6709;&#x5176;&#x4ED6;CXF&#x670D;&#x52A1;&#x4E5F;&#x662F;&#x5B89;&#x5168;&#x7684;&#x3002; &#x7C7B;&#x4F3C;&#x5730;&#xFF0C;&#x5F53;&#x53D6;&#x6D88;&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x6574;&#x4E2A;<code>/cxf</code>&#x4E0A;&#x4E0B;&#x6587;&#x4E5F;&#x53D8;&#x5F97;&#x4E0D;&#x5B89;&#x5168;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x5982;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse_adapter_cxf_separate" target="_blank">&#x5728;&#x5355;&#x72EC;&#x7684;Jetty&#x5F15;&#x64CE;&#x4E0A;&#x5B89;&#x5168;CXF&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</a>&#x4E2D;&#x6240;&#x8FF0;&#xFF0C;&#x4E3A;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;Jetty&#x5F15;&#x64CE;&#xFF0C;&#x7136;&#x540E;&#x4E3A;&#x60A8;&#x63D0;&#x4F9B; &#x66F4;&#x597D;&#x5730;&#x63A7;&#x5236;&#x6BCF;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5B89;&#x5168;&#x6027;&#x3002;</p>
<ul>
<li><code>WEB-INF</code>&#x76EE;&#x5F55;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5728;&#x60A8;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#xFF08;&#x5373;&#x4F7F;&#x60A8;&#x7684;&#x9879;&#x76EE;&#x4E0D;&#x662F;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF09;&#x3002; &#x60A8;&#x53EF;&#x80FD;&#x8FD8;&#x9700;&#x8981;&#x4EE5;&#x4E0E;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse_adapter_classic_war" target="_blank">&#x7ECF;&#x5178;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</a>&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x5F0F;&#x7F16;&#x8F91;<code>/WEB-INF/jetty-web.xml</code>&#x548C;<code>/WEB-INF/keycloak.json</code>&#x6587;&#x4EF6;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x60A8;&#x4E0D;&#x9700;&#x8981;<code>web.xml</code>&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x4E3A;&#x84DD;&#x56FE;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x58F0;&#x660E;&#x4E86;&#x5B89;&#x5168;&#x6027;&#x7EA6;&#x675F;&#x3002;</li>
<li><code>META-INF/MANIFEST.MF</code>&#x4E2D;&#x7684;<code>Import-Package</code>&#x5FC5;&#x987B;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5BFC;&#x5165;&#xFF1A;</li>
</ul>
<pre><code class="lang-properties">META-INF.cxf;version=&quot;[2.7,3.2)&quot;,
META-INF.cxf.osgi;version=&quot;[2.7,3.2)&quot;;resolution:=optional,
org.apache.cxf.transport.http;version=&quot;[2.7,3.2)&quot;,
org.apache.cxf.*;version=&quot;[2.7,3.2)&quot;,
com.fasterxml.jackson.jaxrs.json;version=&quot;[2.5,3)&quot;,
org.eclipse.jetty.security;version=&quot;[9,10)&quot;,
org.eclipse.jetty.util.security;version=&quot;[9,10)&quot;,
org.keycloak.*;version=&quot;6.0.1&quot;,
org.keycloak.adapters.jetty;version=&quot;6.0.1&quot;,
*;resolution:=optional
</code></pre>
<p><a name="42______&#x5B89;&#x5168;Fuse&#x7BA1;&#x7406;&#x670D;&#x52A1;"></a></p>
<h5 id="&#x5B89;&#x5168;fuse&#x7BA1;&#x7406;&#x670D;&#x52A1;"><a name="&#x5B89;&#x5168;fuse&#x7BA1;&#x7406;&#x670D;&#x52A1;" class="anchor-navigation-ex-anchor" href="#&#x5B89;&#x5168;fuse&#x7BA1;&#x7406;&#x670D;&#x52A1;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B89;&#x5168;Fuse&#x7BA1;&#x7406;&#x670D;&#x52A1;</h5>
<p><a name="43_______&#x4F7F;&#x7528;SSH&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;&#x878D;&#x5408;&#x7EC8;&#x7AEF;"></a></p>
<h6 id="&#x4F7F;&#x7528;ssh&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;&#x878D;&#x5408;&#x7EC8;&#x7AEF;"><a name="&#x4F7F;&#x7528;ssh&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;&#x878D;&#x5408;&#x7EC8;&#x7AEF;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;ssh&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;&#x878D;&#x5408;&#x7EC8;&#x7AEF;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;SSH&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;&#x878D;&#x5408;&#x7EC8;&#x7AEF;</h6>
<p>Keycloak&#x4E3B;&#x8981;&#x5904;&#x7406;&#x7528;&#x4E8E;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x7528;&#x4F8B;; &#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x7684;&#x5176;&#x4ED6;Web&#x670D;&#x52A1;&#x548C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53D7;Keycloak&#x4FDD;&#x62A4;&#xFF0C;&#x5219;&#x4F7F;&#x7528;Keycloak&#x51ED;&#x636E;&#x4FDD;&#x62A4;&#x975E;Web&#x7BA1;&#x7406;&#x670D;&#x52A1;&#xFF08;&#x5982;SSH&#xFF09;&#x662F;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;JAAS&#x767B;&#x5F55;&#x6A21;&#x5757;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C;&#xFF0C;&#x8BE5;&#x6A21;&#x5757;&#x5141;&#x8BB8;&#x8FDC;&#x7A0B;&#x8FDE;&#x63A5;&#x5230;Keycloak&#x5E76;&#x6839;&#x636E;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_resource_owner_password_credentials_flow" target="_blank">&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x636E;</a>&#x9A8C;&#x8BC1;&#x51ED;&#x636E;&#x3002;</p>
<p>&#x8981;&#x542F;&#x7528;SSH&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x5728;Keycloak&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;<code>ssh-jmx-admin-client</code>&#xFF09;&#xFF0C;&#x5B83;&#x5C06;&#x7528;&#x4E8E;SSH&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x6B64;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x5C06;<code>Direct Access Grants Enabled</code>&#x9009;&#x4E3A;<code>On</code>&#x3002;</p>
</li>
<li><p>&#x5728;<code>$FUSE_HOME/etc/org.apache.karaf.shell.cfg</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x66F4;&#x65B0;&#x6216;&#x6307;&#x5B9A;&#x6B64;&#x5C5E;&#x6027;&#xFF1A;</p>
<pre><code class="lang-properties">sshRealm=keycloak
</code></pre>
</li>
<li><p>&#x6DFB;&#x52A0;<code>$FUSE_HOME/etc/keycloak-direct-access.json</code>&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x5185;&#x5BB9;&#x7C7B;&#x4F3C;&#x4E8E;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF08;&#x57FA;&#x4E8E;&#x60A8;&#x7684;&#x73AF;&#x5883;&#x548C;Keycloak&#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;&#xFF09;&#xFF1A;</p>
<pre><code class="lang-json">{
    <span class="hljs-string">&quot;realm&quot;</span>: <span class="hljs-string">&quot;demo&quot;</span>,
    <span class="hljs-string">&quot;resource&quot;</span>: <span class="hljs-string">&quot;ssh-jmx-admin-client&quot;</span>,
    <span class="hljs-string">&quot;ssl-required&quot;</span> : <span class="hljs-string">&quot;external&quot;</span>,
    <span class="hljs-string">&quot;auth-server-url&quot;</span> : <span class="hljs-string">&quot;http://localhost:8080/auth&quot;</span>,
    <span class="hljs-string">&quot;credentials&quot;</span>: {
        <span class="hljs-string">&quot;secret&quot;</span>: <span class="hljs-string">&quot;password&quot;</span>
    }
}
</code></pre>
<p>&#x6B64;&#x6587;&#x4EF6;&#x6307;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x914D;&#x7F6E;&#xFF0C;&#x8BE5;&#x547D;&#x4EE4;&#x7531;&#x6765;&#x81EA;<code>keycloak</code> JAAS&#x9886;&#x57DF;&#x7684;JAAS DirectAccessGrantsLoginModule&#x7528;&#x4E8E;SSH&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;</p>
</li>
<li><p>&#x542F;&#x52A8;Fuse&#x5E76;&#x5B89;&#x88C5;<code>keycloak</code> JAAS&#x9886;&#x57DF;&#x3002; &#x6700;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5B89;&#x88C5;<code>keycloak-jaas</code>&#x529F;&#x80FD;&#xFF0C;&#x5B83;&#x5177;&#x6709;&#x9884;&#x5B9A;&#x4E49;&#x7684;JAAS&#x9886;&#x57DF;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;<code>keycloak</code> JAAS&#x9886;&#x57DF;&#x8986;&#x76D6;&#x8BE5;&#x529F;&#x80FD;&#x7684;&#x9884;&#x5B9A;&#x4E49;&#x9886;&#x57DF;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_fuse/6.3/html-single/security_guide/#ESBSecureContainer" target="_blank">JBoss Fuse&#x6587;&#x6863;</a>&#x3002;</p>
<p>&#x5728;Fuse&#x7EC8;&#x7AEF;&#x4E2D;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code>features:addurl mvn:org.keycloak/keycloak-osgi-features/6.0.1/xml/features
features:install keycloak-jaas
</code></pre></li>
<li><p>&#x901A;&#x8FC7;&#x5728;&#x7EC8;&#x7AEF;&#x4E2D;&#x952E;&#x5165;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF0C;&#x4F7F;&#x7528;SSH&#x4F5C;&#x4E3A;<code>admin</code>&#x7528;&#x6237;&#x767B;&#x5F55;&#xFF1A;</p>
<pre><code class="lang-bash">ssh -o PubkeyAuthentication=no -p 8101 admin@localhost
</code></pre>
</li>
<li><p>&#x4F7F;&#x7528;&#x5BC6;&#x7801;<code>password</code>&#x767B;&#x5F55;&#x3002;</p>
</li>
</ol>
<blockquote>
<p>&#x5728;&#x67D0;&#x4E9B;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x8FD8;&#x9700;&#x8981;&#x4F7F;&#x7528;SSH&#x547D;&#x4EE4;&#x7684;-o&#x9009;&#x9879;<code>-o HostKeyAlgorithms=+ssh-dss</code>&#xFF0C;&#x56E0;&#x4E3A;&#x4EE5;&#x540E;&#x7684;SSH&#x5BA2;&#x6237;&#x7AEF;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x4E0D;&#x5141;&#x8BB8;&#x4F7F;&#x7528;<code>ssh-dss</code>&#x7B97;&#x6CD5;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x76EE;&#x524D;&#x7528;&#x4E8E;JBoss Fuse 6.3.0 Rollup 5&#x3002;</p>
</blockquote>
<p>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x7528;&#x6237;&#x9700;&#x8981;&#x5177;&#x6709;&#x9886;&#x57DF;&#x89D2;&#x8272;<code>admin</code>&#x6765;&#x6267;&#x884C;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x6216;&#x5176;&#x4ED6;&#x89D2;&#x8272;&#x6765;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#x5B50;&#x96C6;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;<strong>viewer</strong>&#x89D2;&#x8272;&#x9650;&#x5236;&#x7528;&#x6237;&#x4EC5;&#x8FD0;&#x884C;&#x53EA;&#x8BFB;&#x7684;Karaf&#x547D;&#x4EE4;&#xFF09;&#x3002; &#x53EF;&#x7528;&#x89D2;&#x8272;&#x5728;<code>$FUSE_HOME/etc/org.apache.karaf.shell.cfg</code>&#x6216;<code>$FUSE_HOME/etc/system.properties</code>&#x4E2D;&#x914D;&#x7F6E;&#x3002;</p>
<p><a name="44_______&#x4F7F;&#x7528;JMX&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"></a></p>
<h6 id="&#x4F7F;&#x7528;jmx&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><a name="&#x4F7F;&#x7528;jmx&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;jmx&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;JMX&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;</h6>
<p>&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;jconsole&#x6216;&#x5176;&#x4ED6;&#x5916;&#x90E8;&#x5DE5;&#x5177;&#x901A;&#x8FC7;RMI&#x8FDC;&#x7A0B;&#x8FDE;&#x63A5;&#x5230;JMX&#xFF0C;&#x5219;&#x53EF;&#x80FD;&#x9700;&#x8981;JMX&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x5426;&#x5219;&#x6700;&#x597D;&#x4F7F;&#x7528;hawt.io/jolokia&#xFF0C;&#x56E0;&#x4E3A;jolokia&#x4EE3;&#x7406;&#x9ED8;&#x8BA4;&#x5B89;&#x88C5;&#x5728;hawt.io&#x4E2D;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_hawtio" target="_blank">Hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;</a>&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;JMX&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x5728;<code>$FUSE_HOME/etc/org.apache.karaf.management.cfg</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x5C06;jmxRealm&#x5C5E;&#x6027;&#x66F4;&#x6539;&#x4E3A;&#xFF1A;</p>
<pre><code class="lang-properties">jmxRealm=keycloak
</code></pre>
</li>
<li><p>&#x5B89;&#x88C5;<code>keycloak-jaas</code>&#x529F;&#x80FD;&#x5E76;&#x914D;&#x7F6E;<code>$FUSE_HOME/etc/keycloak-direct-access.json</code>&#x6587;&#x4EF6;&#xFF0C;&#x5982;&#x4E0A;&#x9762;&#x7684;SSH&#x90E8;&#x5206;&#x6240;&#x8FF0;&#x3002;</p>
</li>
<li><p>&#x5728;jconsole&#x4E2D;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;URL&#xFF1A;</p>
</li>
</ol>
<pre><code>service:jmx:rmi://localhost:44444/jndi/rmi://localhost:1099/karaf-root
</code></pre><p>&#x548C;&#x51ED;&#x636E;&#xFF1A;admin/password&#xFF08;&#x6839;&#x636E;&#x60A8;&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x5177;&#x6709;&#x7BA1;&#x7406;&#x5458;&#x6743;&#x9650;&#x7684;&#x7528;&#x6237;&#xFF09;&#x3002;</p>
<p><a name="45______&#x4FDD;&#x62A4;Hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;"></a></p>
<h5 id="&#x4FDD;&#x62A4;hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;"><a name="&#x4FDD;&#x62A4;hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x62A4;hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FDD;&#x62A4;Hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;</h5>
<p>&#x8981;&#x4F7F;&#x7528;Keycloak&#x4FDD;&#x62A4;Hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;:</p>
<ol>
<li><p>&#x5C06;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x6DFB;&#x52A0;&#x5230;<code>$FUSE_HOME/etc/system.properties</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF1A;</p>
<pre><code class="lang-properties">hawtio.keycloakEnabled=true
hawtio.realm=keycloak
hawtio.keycloakClientConfig=file://${karaf.base}/etc/keycloak-hawtio-client.json
hawtio.rolePrincipalClasses=org.keycloak.adapters.jaas.RolePrincipal,org.apache.karaf.jaas.boot.principal.RolePrincipal
</code></pre>
</li>
<li><p>&#x5728;&#x60A8;&#x7684;&#x9886;&#x57DF;&#x7684;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5728;Keycloak<code>demo</code>&#x9886;&#x57DF;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;<code>hawtio-client</code>&#xFF0C;&#x6307;&#x5B9A;<code>public</code>&#x4F5C;&#x4E3A;Access Type&#xFF0C;&#x5E76;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x6307;&#x5411;Hawtio&#x7684;&#x91CD;&#x5B9A;&#x5411;URI&#xFF1A;<code>http://localhost:8181/hawtio/*</code>&#x3002; &#x60A8;&#x8FD8;&#x5FC5;&#x987B;&#x914D;&#x7F6E;&#x76F8;&#x5E94;&#x7684;Web Origin&#xFF08;&#x5728;&#x672C;&#x4F8B;&#x4E2D;&#x4E3A;<code>http://localhost:8181</code>&#xFF09;&#x3002;</p>
</li>
<li><p>&#x4F7F;&#x7528;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E0B;&#x9762;&#x793A;&#x4F8B;&#x4E2D;&#x6240;&#x793A;&#x7684;&#x5185;&#x5BB9;&#x5728;<code>$FUSE_HOME/etc</code>&#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;<code>keycloak-hawtio-client.json</code>&#x6587;&#x4EF6;&#x3002; &#x6839;&#x636E;&#x60A8;&#x7684;Keycloak&#x73AF;&#x5883;&#x66F4;&#x6539;<code>realm</code>&#xFF0C;<code>resource</code>&#x548C;<code>auth-server-url</code>&#x5C5E;&#x6027;&#x3002; <code>resource</code>&#x5C5E;&#x6027;&#x5FC5;&#x987B;&#x6307;&#x5411;&#x4E0A;&#x4E00;&#x6B65;&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x8BE5;&#x6587;&#x4EF6;&#x7531;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;Hawtio JavaScript&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF09;&#x4F7F;&#x7528;&#x3002;</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;realm&quot;</span> : <span class="hljs-string">&quot;demo&quot;</span>,
  <span class="hljs-string">&quot;resource&quot;</span> : <span class="hljs-string">&quot;hawtio-client&quot;</span>,
  <span class="hljs-string">&quot;auth-server-url&quot;</span> : <span class="hljs-string">&quot;http://localhost:8080/auth&quot;</span>,
  <span class="hljs-string">&quot;ssl-required&quot;</span> : <span class="hljs-string">&quot;external&quot;</span>,
  <span class="hljs-string">&quot;public-client&quot;</span> : <span class="hljs-literal">true</span>
}
</code></pre>
</li>
<li><p>&#x4F7F;&#x7528;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E0B;&#x9762;&#x793A;&#x4F8B;&#x4E2D;&#x6240;&#x793A;&#x7684;&#x5185;&#x5BB9;&#x5728;<code>$FUSE_HOME/etc</code> &#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;<code>keycloak-hawtio.json</code>&#x6587;&#x4EF6;&#x3002; &#x6839;&#x636E;&#x60A8;&#x7684;Keycloak&#x73AF;&#x5883;&#x66F4;&#x6539;<code>realm</code>&#x548C;<code>auth-server-url</code>&#x5C5E;&#x6027;&#x3002; &#x6B64;&#x6587;&#x4EF6;&#x7531;&#x670D;&#x52A1;&#x5668;&#xFF08;JAAS&#x767B;&#x5F55;&#x6A21;&#x5757;&#xFF09;&#x7AEF;&#x7684;&#x9002;&#x914D;&#x5668;&#x4F7F;&#x7528;&#x3002;</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;realm&quot;</span> : <span class="hljs-string">&quot;demo&quot;</span>,
  <span class="hljs-string">&quot;resource&quot;</span> : <span class="hljs-string">&quot;jaas&quot;</span>,
  <span class="hljs-string">&quot;bearer-only&quot;</span> : <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;auth-server-url&quot;</span> : <span class="hljs-string">&quot;http://localhost:8080/auth&quot;</span>,
  <span class="hljs-string">&quot;ssl-required&quot;</span> : <span class="hljs-string">&quot;external&quot;</span>,
  <span class="hljs-string">&quot;use-resource-role-mappings&quot;</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">&quot;principal-attribute&quot;</span>: <span class="hljs-string">&quot;preferred_username&quot;</span>
}
</code></pre>
</li>
<li><p>&#x542F;&#x52A8;JBoss Fuse 6.3.0 Rollup 5&#x5E76;&#x5B89;&#x88C5;keycloak&#x529F;&#x80FD;&#xFF08;&#x5982;&#x679C;&#x5C1A;&#x672A;&#x5B89;&#x88C5;&#xFF09;&#x3002; Karaf&#x7EC8;&#x7AEF;&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x4E0E;&#x6B64;&#x793A;&#x4F8B;&#x7C7B;&#x4F3C;&#xFF1A;</p>
<pre><code>features:addurl mvn:org.keycloak/keycloak-osgi-features/6.0.1/xml/features
features:install keycloak
</code></pre></li>
<li><p>&#x8F6C;&#x5230;<a href="http://localhost:8181/hawtio" target="_blank">http://localhost:8181/hawtio</a>&#x5E76;&#x4EE5;Keycloak&#x9886;&#x57DF;&#x7684;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#x767B;&#x5F55;&#x3002;</p>
<p>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x7528;&#x6237;&#x9700;&#x8981;&#x5177;&#x6709;&#x9002;&#x5F53;&#x7684;&#x9886;&#x57DF;&#x89D2;&#x8272;&#x624D;&#x80FD;&#x6210;&#x529F;&#x5411;Hawtio&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x53EF;&#x7528;&#x89D2;&#x8272;&#x5728;<code>hawtio.roles</code>&#x4E2D;&#x7684;<code>$FUSE_HOME/etc/system.properties</code>&#x6587;&#x4EF6;&#x4E2D;&#x914D;&#x7F6E;&#x3002;</p>
</li>
</ol>
<p><a name="46_______&#x4FDD;&#x62A4;JBoss_EAP_6_4&#x4E0A;&#x7684;Hawtio"></a></p>
<h6 id="&#x4FDD;&#x62A4;jboss-eap-64&#x4E0A;&#x7684;hawtio"><a name="&#x4FDD;&#x62A4;jboss-eap-64&#x4E0A;&#x7684;hawtio" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x62A4;jboss-eap-64&#x4E0A;&#x7684;hawtio"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FDD;&#x62A4;JBoss EAP 6.4&#x4E0A;&#x7684;Hawtio</h6>
<p>&#x8981;&#x5728;JBoss EAP 6.4&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8FD0;&#x884C;Hawtio&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;:</p>
<ol>
<li><p>&#x6309;&#x7167;&#x4E0A;&#x4E00;&#x8282;&#x201C;&#x4FDD;&#x62A4;Hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x201D;&#x4E2D;&#x7684;&#x8BF4;&#x660E;&#x8BBE;&#x7F6E;Keycloak&#x3002; &#x5047;&#x8BBE;&#xFF1A;</p>
<ul>
<li>&#x4F60;&#x6709;&#x4E00;&#x4E2A;Keycloak&#x9886;&#x57DF;<code>demo</code>&#x548C;&#x5BA2;&#x6237;<code>hawtio-client</code></li>
<li>&#x4F60;&#x7684;Keycloak&#x5728;<code>localhost:8080</code>&#x4E0A;&#x8FD0;&#x884C;</li>
<li>&#x90E8;&#x7F72;&#x4E86;Hawtio&#x7684;JBoss EAP 6.4&#x670D;&#x52A1;&#x5668;&#x5C06;&#x5728;<code>localhost:8181</code>&#x4E0A;&#x8FD0;&#x884C;&#x3002; &#x5177;&#x6709;&#x6B64;&#x670D;&#x52A1;&#x5668;&#x7684;&#x76EE;&#x5F55;&#x5728;&#x540E;&#x7EED;&#x6B65;&#x9AA4;&#x4E2D;&#x79F0;&#x4E3A;<code>$EAP_HOME</code>&#x3002;</li>
</ul>
</li>
<li><p>&#x5C06;<code>hawtio-wildfly-1.4.0.redhat-630254.war</code>&#x5B58;&#x6863;&#x590D;&#x5236;&#x5230;<code>$EAP_HOME/standalone/configuration</code>&#x76EE;&#x5F55;&#x3002; &#x6709;&#x5173;&#x90E8;&#x7F72;Hawtio&#x7684;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_fuse/6.3/html-single/deploying_into_a_web_server/" target="_blank">Fuse Hawtio&#x6587;&#x6863;</a>&#x3002;</p>
</li>
<li><p>&#x5C06;&#x5E26;&#x6709;&#x4E0A;&#x8FF0;&#x5185;&#x5BB9;&#x7684;<code>keycloak-hawtio.json</code>&#x548C;<code>keycloak-hawtio-client.json</code>&#x6587;&#x4EF6;&#x590D;&#x5236;&#x5230;<code>$EAP_HOME/standalone/configuration</code>&#x76EE;&#x5F55;&#x3002;</p>
</li>
<li><p>&#x6309;&#x7167;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_jboss_adapter" target="_blank">JBoss&#x9002;&#x914D;&#x5668;&#x6587;&#x6863;</a>&#x4E2D;&#x7684;&#x8BF4;&#x660E;&#xFF0C;&#x5C06;Keycloak&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x5B89;&#x88C5;&#x5230;JBoss EAP 6.4&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x3002;</p>
</li>
<li><p>&#x5728;<code>$EAP_HOME/standalone/configuration/standalone.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x914D;&#x7F6E;&#x7CFB;&#x7EDF;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x4E0B;&#x4F8B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">extensions</span>&gt;</span>
...
<span class="hljs-tag">&lt;/<span class="hljs-name">extensions</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">system-properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hawtio.authenticationEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hawtio.realm&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;hawtio&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hawtio.roles&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;admin,viewer&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hawtio.rolePrincipalClasses&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;org.keycloak.adapters.jaas.RolePrincipal&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hawtio.keycloakEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hawtio.keycloakClientConfig&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;${jboss.server.config.dir}/keycloak-hawtio-client.json&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hawtio.keycloakServerConfig&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;${jboss.server.config.dir}/keycloak-hawtio.json&quot;</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">system-properties</span>&gt;</span>
</code></pre>
</li>
<li><p>&#x5C06;Hawtio&#x57DF;&#x6DFB;&#x52A0;&#x5230;<code>security-domains</code>&#x90E8;&#x5206;&#x4E2D;&#x7684;&#x540C;&#x4E00;&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">security-domain</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hawtio&quot;</span> <span class="hljs-attr">cache-type</span>=<span class="hljs-string">&quot;default&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">authentication</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">login-module</span> <span class="hljs-attr">code</span>=<span class="hljs-string">&quot;org.keycloak.adapters.jaas.BearerTokenLoginModule&quot;</span> <span class="hljs-attr">flag</span>=<span class="hljs-string">&quot;required&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">module-option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;keycloak-config-file&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;${hawtio.keycloakServerConfig}&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">login-module</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">authentication</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">security-domain</span>&gt;</span>
</code></pre>
</li>
<li><p>&#x5C06;<code>secure-deployment</code>&#x90E8;&#x5206;<code>hawtio</code>&#x6DFB;&#x52A0;&#x5230;&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x3002; &#x8FD9;&#x53EF;&#x786E;&#x4FDD;Hawtio WAR&#x80FD;&#x591F;&#x627E;&#x5230;JAAS&#x767B;&#x5F55;&#x6A21;&#x5757;&#x7C7B;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">subsystem</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:domain:keycloak:1.1&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">secure-deployment</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hawtio-wildfly-1.4.0.redhat-630254.war&quot;</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">subsystem</span>&gt;</span>
</code></pre>
</li>
<li><p>&#x4F7F;&#x7528;Hawtio&#x91CD;&#x65B0;&#x542F;&#x52A8;JBoss EAP 6.4&#x670D;&#x52A1;&#x5668;&#xFF1A;</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$EAP_HOME</span>/bin
./standalone.sh -Djboss.socket.binding.port-offset=101
</code></pre>
</li>
<li><p>&#x5728;<a href="http://localhost:8181/hawtio" target="_blank">http://localhost:8181/hawtio</a>&#x8BBF;&#x95EE;Hawtio&#x3002; &#x5B83;&#x7531;Keycloak&#x4FDD;&#x62A4;&#x3002;</p>
</li>
</ol>
<p><a name="47_____2_1_5__JBoss_Fuse_7_&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="215-jboss-fuse-7-&#x9002;&#x914D;&#x5668;"><a name="215-jboss-fuse-7-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#215-jboss-fuse-7-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.5. JBoss Fuse 7 &#x9002;&#x914D;&#x5668;</h4>
<p>Keycloak&#x652F;&#x6301;&#x4FDD;&#x62A4;&#x5728;<a href="https://developers.redhat.com/products/fuse/overview/" target="_blank">JBoss Fuse 7</a>&#x4E2D;&#x8FD0;&#x884C;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>JBoss Fuse 7&#x5229;&#x7528;&#x4E86;Undertow&#x9002;&#x914D;&#x5668;&#xFF0C;&#x5B83;&#x4E0E;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_jboss_adapter" target="_blank">EAP 7 / WildFly&#x9002;&#x914D;&#x5668;</a>&#x57FA;&#x672C;&#x76F8;&#x540C;&#xFF0C;&#x56E0;&#x4E3A;&#x6346;&#x7ED1;&#x4E86;JBoss Fuse 7.2.0 &#x4F7F;&#x7528;<a href="http://undertow.io/" target="_blank">Undertow HTTP&#x5F15;&#x64CE;</a>&#xFF0C;Undertow&#x7528;&#x4E8E;&#x8FD0;&#x884C;&#x5404;&#x79CD;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<blockquote>
<p>&#x552F;&#x4E00;&#x53D7;&#x652F;&#x6301;&#x7684;Fuse 7&#x7248;&#x672C;&#x662F;&#x6700;&#x65B0;&#x7248;&#x672C;&#x3002; &#x5982;&#x679C;&#x4F7F;&#x7528;&#x65E9;&#x671F;&#x7248;&#x672C;&#x7684;Fuse 7&#xFF0C;&#x5219;&#x67D0;&#x4E9B;&#x529F;&#x80FD;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002; &#x7279;&#x522B;&#x662F;&#xFF0C;&#x5BF9;&#x4E8E;&#x4F4E;&#x4E8E;7.0.1&#x7684;Fuse 7&#x7248;&#x672C;&#xFF0C;&#x96C6;&#x6210;&#x5C06;&#x5B8C;&#x5168;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#x3002;</p>
</blockquote>
<p>Fuse&#x652F;&#x6301;&#x4EE5;&#x4E0B;&#x9879;&#x76EE;&#x7684;&#x5B89;&#x5168;&#x6027;:</p>
<ul>
<li>&#x4F7F;&#x7528;Pax Web War Extender&#x90E8;&#x7F72;&#x5728;Fuse&#x4E0A;&#x7684;&#x7ECF;&#x5178;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</li>
<li>&#x4F7F;&#x7528;Pax Web Whiteboard Extender&#x4F5C;&#x4E3A;OSGI&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x5728;Fuse&#x4E0A;&#x7684;Servlet&#x4EE5;&#x53CA;&#x901A;&#x8FC7;org.osgi.service.http.HttpService#registerServlet()&#x6CE8;&#x518C;&#x7684;servlet&#xFF0C;&#x8FD9;&#x662F;&#x6807;&#x51C6;&#x7684;OSGi Enterprise HTTP&#x670D;&#x52A1;</li>
<li><a href="http://camel.apache.org/" target="_blank">Apache Camel</a> &#x4F7F;&#x7528;<a href="http://camel.apache.org/undertow.html" target="_blank">Camel Undertow</a>&#x7EC4;&#x4EF6;&#x8FD0;&#x884C;&#x7684;&#x7AEF;&#x70B9;</li>
<li><a href="http://cxf.apache.org/" target="_blank">Apache CXF</a> &#x7AEF;&#x70B9;&#x5728;&#x4ED6;&#x4EEC;&#x81EA;&#x5DF1;&#x72EC;&#x7ACB;&#x7684;Undertow&#x5F15;&#x64CE;&#x4E0A;&#x8FD0;&#x884C;</li>
<li><a href="http://cxf.apache.org/" target="_blank">Apache CXF</a> &#x5728;CXF servlet&#x63D0;&#x4F9B;&#x7684;&#x9ED8;&#x8BA4;&#x5F15;&#x64CE;&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x7AEF;&#x70B9;</li>
<li>SSH&#x548C;JMX&#x7BA1;&#x7406;&#x5458;&#x8BBF;&#x95EE;&#x6743;&#x9650;</li>
<li><a href="https://hawt.io/" target="_blank">Hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;</a></li>
</ul>
<p><a name="48______&#x5728;Fuse_7&#x4E2D;&#x4FDD;&#x62A4;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"></a></p>
<h5 id="&#x5728;fuse-7&#x4E2D;&#x4FDD;&#x62A4;web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><a name="&#x5728;fuse-7&#x4E2D;&#x4FDD;&#x62A4;web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#&#x5728;fuse-7&#x4E2D;&#x4FDD;&#x62A4;web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5728;Fuse 7&#x4E2D;&#x4FDD;&#x62A4;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</h5>
<p>&#x60A8;&#x5FC5;&#x987B;&#x5148;&#x5B89;&#x88C5;Keycloak Karaf&#x529F;&#x80FD;&#x3002; &#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x6839;&#x636E;&#x8981;&#x4FDD;&#x62A4;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7C7B;&#x578B;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x3002; &#x6240;&#x6709;&#x5F15;&#x7528;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90FD;&#x9700;&#x8981;&#x5C06;Keycloak Undertow&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x673A;&#x5236;&#x6CE8;&#x5165;&#x5E95;&#x5C42;Web&#x670D;&#x52A1;&#x5668;&#x3002; &#x5B9E;&#x73B0;&#x6B64;&#x76EE;&#x6807;&#x7684;&#x6B65;&#x9AA4;&#x53D6;&#x51B3;&#x4E8E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7C7B;&#x578B;&#x3002; &#x7EC6;&#x8282;&#x63CF;&#x8FF0;&#x5982;&#x4E0B;&#x3002;</p>
<p>&#x6700;&#x597D;&#x7684;&#x8D77;&#x70B9;&#x662F;&#x770B;&#x770B;&#x4F5C;&#x4E3A;<code>fuse</code>&#x76EE;&#x5F55;&#x4E2D;Keycloak&#x793A;&#x4F8B;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x6346;&#x7ED1;&#x7684;Fuse&#x6F14;&#x793A;&#x3002; &#x901A;&#x8FC7;&#x6D4B;&#x8BD5;&#x548C;&#x7406;&#x89E3;&#x6F14;&#x793A;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x6B65;&#x9AA4;&#x90FD;&#x5E94;&#x8BE5;&#x662F;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x7684;&#x3002;</p>
<p><a name="49______&#x5B89;&#x88C5;Keycloak&#x529F;&#x80FD;"></a></p>
<h5 id="&#x5B89;&#x88C5;keycloak&#x529F;&#x80FD;"><a name="&#x5B89;&#x88C5;keycloak&#x529F;&#x80FD;" class="anchor-navigation-ex-anchor" href="#&#x5B89;&#x88C5;keycloak&#x529F;&#x80FD;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B89;&#x88C5;Keycloak&#x529F;&#x80FD;</h5>
<p>&#x60A8;&#x5FC5;&#x987B;&#x9996;&#x5148;&#x5728;JBoss Fuse&#x73AF;&#x5883;&#x4E2D;&#x5B89;&#x88C5;<code>keycloak-pax-http-afow</code>&#x548C;<code>keycloak-jaas</code>&#x529F;&#x80FD;&#x3002; <code>keycloak-pax-http-undertow</code>&#x529F;&#x80FD;&#x5305;&#x62EC;Fuse&#x9002;&#x914D;&#x5668;&#x548C;&#x6240;&#x6709;&#x7B2C;&#x4E09;&#x65B9;&#x4F9D;&#x8D56;&#x9879;&#x3002; <code>keycloak-jaas</code>&#x5305;&#x542B;&#x7528;&#x4E8E;SSH&#x548C;JMX&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x9886;&#x57DF;&#x4E2D;&#x7684;JAAS&#x6A21;&#x5757;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4ECE;Maven&#x5B58;&#x50A8;&#x5E93;&#x6216;&#x5B58;&#x6863;&#x4E2D;&#x5B89;&#x88C5;&#x5B83;&#x3002;</p>
<p><a name="50_______&#x4ECE;Maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;"></a></p>
<h6 id="&#x4ECE;maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;"><a name="&#x4ECE;maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x4ECE;maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4ECE;Maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;</h6>
<p>&#x4F5C;&#x4E3A;&#x5148;&#x51B3;&#x6761;&#x4EF6;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;&#x7EBF;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;Maven&#x5B58;&#x50A8;&#x5E93;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x793E;&#x533A;&#x6765;&#x8BF4;&#xFF0C;&#x53EA;&#x8981;&#x5728;maven&#x4E2D;&#x592E;&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x63D0;&#x4F9B;&#x6240;&#x6709;&#x5DE5;&#x4EF6;&#x548C;&#x7B2C;&#x4E09;&#x65B9;&#x4F9D;&#x8D56;&#x9879;&#x5C31;&#x8DB3;&#x591F;&#x4E86;&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;Maven&#x5B58;&#x50A8;&#x5E93;&#x5B89;&#x88C5;keycloak&#x529F;&#x80FD;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x542F;&#x52A8;JBoss Fuse 7.2.0; &#x7136;&#x540E;&#x5728;Karaf&#x7EC8;&#x7AEF;&#x7C7B;&#x578B;&#xFF1A;</p>
<pre><code>feature:repo-add mvn:org.keycloak/keycloak-osgi-features/6.0.1/xml/features
feature:install keycloak-pax-http-undertow keycloak-jaas
</code></pre></li>
<li><p>&#x60A8;&#x53EF;&#x80FD;&#x8FD8;&#x9700;&#x8981;&#x5B89;&#x88C5;Undertow&#x529F;&#x80FD;&#xFF1A;</p>
<pre><code>feature:install pax-http-undertow
</code></pre></li>
<li><p>&#x786E;&#x4FDD;&#x5DF2;&#x5B89;&#x88C5;&#x529F;&#x80FD;&#xFF1A;</p>
</li>
</ol>
<pre><code>feature:list | grep keycloak
</code></pre><p><a name="51_______&#x4ECE;ZIP&#x6346;&#x7ED1;&#x5305;&#x5B89;&#x88C5;"></a></p>
<h6 id="&#x4ECE;zip&#x6346;&#x7ED1;&#x5305;&#x5B89;&#x88C5;"><a name="&#x4ECE;zip&#x6346;&#x7ED1;&#x5305;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x4ECE;zip&#x6346;&#x7ED1;&#x5305;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4ECE;ZIP&#x6346;&#x7ED1;&#x5305;&#x5B89;&#x88C5;</h6>
<p>&#x5982;&#x679C;&#x60A8;&#x5904;&#x4E8E;&#x8131;&#x673A;&#x72B6;&#x6001;&#x6216;&#x4E0D;&#x60F3;&#x4F7F;&#x7528;Maven&#x83B7;&#x53D6;JAR&#x6587;&#x4EF6;&#x548C;&#x5176;&#x4ED6;&#x5DE5;&#x4EF6;&#xFF0C;&#x8FD9;&#x5C06;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p>
<p>&#x8981;&#x4ECE;ZIP&#x5B58;&#x6863;&#x5B89;&#x88C5;Fuse&#x9002;&#x914D;&#x5668;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x4E0B;&#x8F7D;Keycloak Fuse&#x9002;&#x914D;&#x5668;ZIP&#x5B58;&#x6863;&#x3002;</p>
</li>
<li><p>&#x5C06;&#x5176;&#x89E3;&#x538B;&#x7F29;&#x5230;JBoss Fuse&#x7684;&#x6839;&#x76EE;&#x5F55;&#x4E2D;&#x3002; &#x7136;&#x540E;&#x5C06;&#x4F9D;&#x8D56;&#x9879;&#x5B89;&#x88C5;&#x5728;<code>system</code>&#x76EE;&#x5F55;&#x4E0B;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x6240;&#x6709;&#x73B0;&#x6709;&#x7684;jar&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x7528;&#x4E8E;JBoss Fuse 7.2.0&#xFF1A;</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> /path-to-fuse/fuse-karaf-7.z
unzip -q /path-to-adapter-zip/keycloak-fuse-adapter-6.0.1.zip
</code></pre>
</li>
<li><p>&#x542F;&#x52A8;Fuse&#x5E76;&#x5728;Fuse /karaf&#x7EC8;&#x7AEF;&#x4E2D;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;:</p>
<pre><code>feature:repo-add mvn:org.keycloak/keycloak-osgi-features/6.0.1/xml/features
feature:install keycloak-pax-http-undertow keycloak-jaas
</code></pre></li>
<li><p>&#x5B89;&#x88C5;&#x76F8;&#x5E94;&#x7684;Undertow&#x9002;&#x914D;&#x5668;&#x3002; &#x7531;&#x4E8E;&#x5DE5;&#x4EF6;&#x53EF;&#x76F4;&#x63A5;&#x5728;JBoss Fuse<code>system</code>&#x76EE;&#x5F55;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x65E0;&#x9700;&#x4F7F;&#x7528;Maven&#x5B58;&#x50A8;&#x5E93;&#x3002;</p>
</li>
</ol>
<p><a name="52______&#x4FDD;&#x62A4;&#x7ECF;&#x5178;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"></a></p>
<h5 id="&#x4FDD;&#x62A4;&#x7ECF;&#x5178;war&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><a name="&#x4FDD;&#x62A4;&#x7ECF;&#x5178;war&#x5E94;&#x7528;&#x7A0B;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x62A4;&#x7ECF;&#x5178;war&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FDD;&#x62A4;&#x7ECF;&#x5178;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</h5>
<p>&#x4FDD;&#x62A4;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6240;&#x9700;&#x7684;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li><p>&#x5728;<code>/WEB-INF/web.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x58F0;&#x660E;&#x5FC5;&#x8981;&#x7684;&#xFF1A;</p>
<ul>
<li><p><security-constraint>&#x5143;&#x7D20;&#x4E2D;&#x7684;&#x5B89;&#x5168;&#x6027;&#x7EA6;&#x675F;</security-constraint></p>
</li>
<li><p><login-config>&#x5143;&#x7D20;&#x4E2D;&#x7684;&#x767B;&#x5F55;&#x914D;&#x7F6E;&#x3002; &#x786E;&#x4FDD;<code>&lt;auth-method&gt;</code>&#x662F;<code>KEYCLOAK</code>&#x3002;</login-config></p>
</li>
<li><p><security-role>&#x5143;&#x7D20;&#x4E2D;&#x7684;&#x5B89;&#x5168;&#x89D2;&#x8272;</security-role></p>
<p>&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">module-name</span>&gt;</span>customer-portal<span class="hljs-tag">&lt;/<span class="hljs-name">module-name</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file-list</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.html<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file-list</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-collection</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-name</span>&gt;</span>Customers<span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/customers/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-collection</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">auth-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-constraint</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">login-config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-method</span>&gt;</span>KEYCLOAK<span class="hljs-tag">&lt;/<span class="hljs-name">auth-method</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">realm-name</span>&gt;</span>does-not-matter<span class="hljs-tag">&lt;/<span class="hljs-name">realm-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">login-config</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
</li>
</ul>
</li>
<li><p>&#x5728;WAR&#x7684;<code>/WEB-INF/</code>&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x6587;&#x4EF6;keycloak.json&#x3002; &#x8BE5;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_java_adapter_config" target="_blank">Java Adapters Config</a>&#x90E8;&#x5206;&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x63CF;&#x8FF0;&#x3002; &#x4E5F;&#x53EF;&#x4EE5;&#x6309;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#config_external_adapter" target="_blank">&#x914D;&#x7F6E;&#x5916;&#x90E8;&#x9002;&#x914D;&#x5668;</a>&#x4E2D;&#x7684;&#x8BF4;&#x660E;&#x5728;&#x5916;&#x90E8;&#x4F7F;&#x7528;&#x6B64;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-json">{
    <span class="hljs-string">&quot;realm&quot;</span>: <span class="hljs-string">&quot;demo&quot;</span>,
    <span class="hljs-string">&quot;resource&quot;</span>: <span class="hljs-string">&quot;customer-portal&quot;</span>,
    <span class="hljs-string">&quot;auth-server-url&quot;</span>: <span class="hljs-string">&quot;http://localhost:8080/auth&quot;</span>,
    <span class="hljs-string">&quot;ssl-required&quot;</span> : <span class="hljs-string">&quot;external&quot;</span>,
    <span class="hljs-string">&quot;credentials&quot;</span>: {
        <span class="hljs-string">&quot;secret&quot;</span>: <span class="hljs-string">&quot;password&quot;</span>
    }
}
</code></pre>
</li>
<li><p>&#x4E0E;Fuse 6&#x9002;&#x914D;&#x5668;&#x76F8;&#x53CD;&#xFF0C;MANIFEST.MF&#x4E2D;&#x4E0D;&#x9700;&#x8981;&#x7279;&#x6B8A;&#x7684;OSGi&#x5BFC;&#x5165;&#x3002;</p>
</li>
</ol>
<p><a name="53_______&#x914D;&#x7F6E;&#x89E3;&#x6790;&#x5668;"></a></p>
<h6 id="&#x914D;&#x7F6E;&#x89E3;&#x6790;&#x5668;"><a name="&#x914D;&#x7F6E;&#x89E3;&#x6790;&#x5668;" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;&#x89E3;&#x6790;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x914D;&#x7F6E;&#x89E3;&#x6790;&#x5668;</h6>
<p><code>keycloak.json</code>&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x5728;&#x6346;&#x7ED1;&#x5305;&#x4E2D;&#xFF0C;&#x8FD9;&#x662F;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x5728;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x76EE;&#x5F55;&#x4E2D;&#x3002; &#x8981;&#x6307;&#x5B9A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x5B9E;&#x9645;&#x6E90;&#xFF0C;&#x8BF7;&#x5C06;<code>keycloak.config.resolver</code>&#x90E8;&#x7F72;&#x53C2;&#x6570;&#x8BBE;&#x7F6E;&#x4E3A;&#x6240;&#x9700;&#x7684;&#x914D;&#x7F6E;&#x89E3;&#x6790;&#x7A0B;&#x5E8F;&#x7C7B;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x7ECF;&#x5178;&#x7684;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x5728;<code>web.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x8BBE;&#x7F6E;<code>keycloak.config.resolver</code>&#x4E0A;&#x4E0B;&#x6587;&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>keycloak.config.resolver<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>org.keycloak.adapters.osgi.PathBasedKeycloakConfigResolver<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span>
</code></pre>
<p>&#x4EE5;&#x4E0B;&#x89E3;&#x6790;&#x5668;&#x53EF;&#x7528;&#x4E8E;<code>keycloak.config.resolver</code>&#xFF1A;</p>
<ul>
<li><p>org.keycloak.adapters.osgi.BundleBasedKeycloakConfigResolver</p>
<p>&#x8FD9;&#x662F;&#x9ED8;&#x8BA4;&#x7684;&#x89E3;&#x6790;&#x5668;&#x3002; &#x9884;&#x671F;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4F4D;&#x4E8E;&#x53D7;&#x4FDD;&#x62A4;&#x7684;OSGi&#x5305;&#x4E2D;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x52A0;&#x8F7D;&#x540D;&#x4E3A;<code>WEB-INF/keycloak.json</code>&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>configLocation</code>&#x5C5E;&#x6027;&#x914D;&#x7F6E;&#x6B64;&#x6587;&#x4EF6;&#x540D;&#x3002;</p>
</li>
<li><p>org.keycloak.adapters.osgi.PathBasedKeycloakConfigResolver</p>
<p>&#x6B64;&#x89E3;&#x6790;&#x7A0B;&#x5E8F;&#x5728;<code>keycloak.config</code>&#x7CFB;&#x7EDF;&#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x7684;&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x641C;&#x7D22;&#x540D;&#x4E3A;<code>&lt;your_web_context&gt;-keycloak.json</code>&#x7684;&#x6587;&#x4EF6;&#x3002; &#x5982;&#x679C;&#x672A;&#x8BBE;&#x7F6E;<code>keycloak.config</code>&#xFF0C;&#x5219;&#x4F7F;&#x7528;<code>karaf.etc</code>&#x7CFB;&#x7EDF;&#x5C5E;&#x6027;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90E8;&#x7F72;&#x5230;&#x4E0A;&#x4E0B;&#x6587;<code>my-portal</code>&#x4E2D;&#xFF0C;&#x90A3;&#x4E48;&#x60A8;&#x7684;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x5C06;&#x4ECE;<code>${keycloak.config}/my-portal-keycloak.json</code>&#x6587;&#x4EF6;&#x52A0;&#x8F7D;&#xFF0C;&#x6216;&#x6765;&#x81EA;<code>${karaf.etc}/my-portal-keycloak.json</code>&#x3002;</p>
</li>
<li><p>org.keycloak.adapters.osgi.HierarchicalPathBasedKeycloakConfigResolver</p>
<p>&#x8FD9;&#x4E2A;&#x89E3;&#x6790;&#x5668;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E0A;&#x9762;&#x7684;<code>PathBasedKeycloakConfigResolver</code>&#xFF0C;&#x5BF9;&#x4E8E;&#x7ED9;&#x5B9A;&#x7684;URI&#x8DEF;&#x5F84;&#xFF0C;&#x914D;&#x7F6E;&#x4F4D;&#x7F6E;&#x4F1A;&#x4ECE;&#x6700;&#x7279;&#x5B9A;&#x5230;&#x6700;&#x4E0D;&#x7279;&#x5B9A;&#x5730;&#x8FDB;&#x884C;&#x68C0;&#x67E5;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5BF9;&#x4E8E;<code>/my/web-app/context</code>URI&#xFF0C;&#x5C06;&#x641C;&#x7D22;&#x4EE5;&#x4E0B;&#x914D;&#x7F6E;&#x4F4D;&#x7F6E;&#xFF0C;&#x76F4;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x4F4D;&#x7F6E;&#x5B58;&#x5728;:<code>${karaf.etc}/my-web-app-context-keycloak.json``${karaf.etc}/my-web-app-keycloak.json``${karaf.etc}/my-keycloak.json``${karaf.etc}/keycloak.json</code></p>
</li>
</ul>
<p><a name="54______&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x4E3A;OSGI&#x670D;&#x52A1;&#x7684;Servlet"></a></p>
<h5 id="&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x4E3A;osgi&#x670D;&#x52A1;&#x7684;servlet"><a name="&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x4E3A;osgi&#x670D;&#x52A1;&#x7684;servlet" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x4E3A;osgi&#x670D;&#x52A1;&#x7684;servlet"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x4E3A;OSGI&#x670D;&#x52A1;&#x7684;Servlet</h5>
<p>&#x5982;&#x679C;&#x5728;OSGI&#x6346;&#x7ED1;&#x9879;&#x76EE;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x672A;&#x90E8;&#x7F72;&#x4E3A;&#x7ECF;&#x5178;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;servlet&#x7C7B;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x3002; Fuse&#x4F7F;&#x7528;Pax Web Whiteboard Extender&#x5C06;&#x8FD9;&#x4E9B;servlet&#x90E8;&#x7F72;&#x4E3A;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;Keycloak&#x4FDD;&#x62A4;&#x60A8;&#x7684;servlet&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>Keycloak&#x63D0;&#x4F9B;&#x4E86;<code>org.keycloak.adapters.osgi.undertow.PaxWebIntegrationService</code>&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x4E3A;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x914D;&#x7F6E;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65B9;&#x6CD5;&#x548C;&#x5B89;&#x5168;&#x6027;&#x7EA6;&#x675F;&#x3002; &#x60A8;&#x9700;&#x8981;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5185;&#x7684;<code>OSGI-INF/blueprint/blueprint.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x58F0;&#x660E;&#x6B64;&#x7C7B;&#x670D;&#x52A1;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x60A8;&#x7684;servlet&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x5B83;&#x3002; &#x914D;&#x7F6E;&#x793A;&#x4F8B;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">blueprint</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</span>
           <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
           <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;servletConstraintMapping&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.osgi.PaxWebSecurityConstraintMapping&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;roles&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authentication&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/product-portal/*&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- This handles the integration and setting the login-config and security-constraints parameters --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakPaxWebIntegration&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.osgi.undertow.PaxWebIntegrationService&quot;</span>
          <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;start&quot;</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">&quot;stop&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bundleContext&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;blueprintBundleContext&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;constraintMappings&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">component-id</span>=<span class="hljs-string">&quot;servletConstraintMapping&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;productServlet&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.example.ProductPortalServlet&quot;</span> <span class="hljs-attr">depends-on</span>=<span class="hljs-string">&quot;keycloakPaxWebIntegration&quot;</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;productServlet&quot;</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">&quot;javax.servlet.Servlet&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service-properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;alias&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/product-portal&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;servlet-name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ProductServlet&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;keycloak.config.file&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/keycloak.json&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service-properties</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">blueprint</span>&gt;</span>
</code></pre>
<ul>
<li>&#x60A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x5305;&#x542B;<code>WEB-INF</code>&#x76EE;&#x5F55;&#xFF08;&#x5373;&#x4F7F;&#x60A8;&#x7684;&#x9879;&#x76EE;&#x4E0D;&#x662F;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF09;&#x5E76;&#x521B;&#x5EFA;<code>/WEB-INF/keycloak.json</code>&#x6587;&#x4EF6;&#xFF0C;&#x5982;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse7_adapter_classic_war" target="_blank">Classic WAR application</a>&#x4E2D;&#x6240;&#x8FF0;&#x90E8;&#x5206;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x60A8;&#x4E0D;&#x9700;&#x8981;<code>web.xml</code>&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x84DD;&#x56FE;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x58F0;&#x660E;&#x4E86;&#x5B89;&#x5168;&#x6027;&#x7EA6;&#x675F;&#x3002;</li>
</ul>
</li>
<li><p>&#x4E0E;Fuse 6&#x9002;&#x914D;&#x5668;&#x76F8;&#x53CD;&#xFF0C;MANIFEST.MF&#x4E2D;&#x4E0D;&#x9700;&#x8981;&#x7279;&#x6B8A;&#x7684;OSGi&#x5BFC;&#x5165;&#x3002;</p>
</li>
</ol>
<p><a name="55______&#x4FDD;&#x62A4;Apache_Camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"></a></p>
<h5 id="&#x4FDD;&#x62A4;apache-camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><a name="&#x4FDD;&#x62A4;apache-camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x62A4;apache-camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FDD;&#x62A4;Apache Camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</h5>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x84DD;&#x56FE;&#x6CE8;&#x5165;&#x9002;&#x5F53;&#x7684;&#x5B89;&#x5168;&#x7EA6;&#x675F;&#x5E76;&#x5C06;&#x4F7F;&#x7528;&#x8FC7;&#x7684;&#x7EC4;&#x4EF6;&#x66F4;&#x65B0;&#x4E3A;<code>undertow-keycloak</code>&#x6765;&#x4FDD;&#x62A4;&#x4F7F;&#x7528;<a href="http://camel.apache.org/undertow.html" target="_blank">camel-undertow</a>&#x7EC4;&#x4EF6;&#x5B9E;&#x73B0;&#x7684;Apache Camel&#x7AEF;&#x70B9;&#x3002; &#x60A8;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x7C7B;&#x4F3C;&#x4EE5;&#x4E0B;&#x914D;&#x7F6E;&#x5C06;<code>OSGI-INF/blueprint/blueprint.xml</code>&#x6587;&#x4EF6;&#x6DFB;&#x52A0;&#x5230;Camel&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x3002; &#x89D2;&#x8272;&#x548C;&#x5B89;&#x5168;&#x6027;&#x7EA6;&#x675F;&#x6620;&#x5C04;&#x4EE5;&#x53CA;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x53EF;&#x80FD;&#x7565;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x5177;&#x4F53;&#x53D6;&#x51B3;&#x4E8E;&#x60A8;&#x7684;&#x73AF;&#x5883;&#x548C;&#x9700;&#x6C42;&#x3002;</p>
<p>&#x4E0E;&#x6807;&#x51C6;&#x7684;<code>undertow</code>&#x7EC4;&#x4EF6;&#x76F8;&#x6BD4;&#xFF0C;<code>undertow-keycloak</code>&#x7EC4;&#x4EF6;&#x589E;&#x52A0;&#x4E86;&#x4E24;&#x4E2A;&#x65B0;&#x5C5E;&#x6027;&#xFF1A;</p>
<ul>
<li><code>configResolver</code>&#x662F;&#x4E00;&#x4E2A;&#x89E3;&#x6790;&#x5668;bean&#xFF0C;&#x63D0;&#x4F9B;Keycloak&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x3002; &#x53EF;&#x7528;&#x7684;&#x89E3;&#x6790;&#x5668;&#x5217;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse7_config_external_adapter" target="_blank">&#x914D;&#x7F6E;&#x89E3;&#x6790;&#x5668;</a>&#x90E8;&#x5206;&#x4E2D;&#x3002;</li>
<li><code>allowedRoles</code>&#x662F;&#x4EE5;&#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x89D2;&#x8272;&#x5217;&#x8868;&#x3002; &#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x7684;&#x7528;&#x6237;&#x5FC5;&#x987B;&#x81F3;&#x5C11;&#x5177;&#x6709;&#x4E00;&#x4E2A;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x7684;&#x89D2;&#x8272;&#x3002;</li>
</ul>
<p>&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">blueprint</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</span>
           <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
           <span class="hljs-attr">xmlns:camel</span>=<span class="hljs-string">&quot;http://camel.apache.org/schema/blueprint&quot;</span>
           <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;
       http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
       http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint-2.17.1.xsd&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakConfigResolver&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.osgi.BundleBasedKeycloakConfigResolver&quot;</span> &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bundleContext&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;blueprintBundleContext&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;helloProcessor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.example.CamelHelloProcessor&quot;</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">camelContext</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;blueprintContext&quot;</span>
                  <span class="hljs-attr">trace</span>=<span class="hljs-string">&quot;false&quot;</span>
                  <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://camel.apache.org/schema/blueprint&quot;</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;httpBridge&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">from</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;undertow-keycloak:http://0.0.0.0:8383/admin-camel-endpoint?matchOnUriPrefix=true&amp;amp;configResolver=#keycloakConfigResolver&amp;amp;allowedRoles=admin&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;helloProcessor&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;The message from camel endpoint contains ${body}&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">camelContext</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">blueprint</span>&gt;</span>
</code></pre>
<ul>
<li><code>META-INF/MANIFEST.MF</code>&#x4E2D;&#x7684;<code>Import-Package</code>&#x9700;&#x8981;&#x5305;&#x542B;&#x8FD9;&#x4E9B;&#x5BFC;&#x5165;&#xFF1A;</li>
</ul>
<pre><code class="lang-properties">javax.servlet;version=&quot;[3,4)&quot;,
javax.servlet.http;version=&quot;[3,4)&quot;,
javax.net.ssl,
org.apache.camel.*,
org.apache.camel;version=&quot;[2.13,3)&quot;,
io.undertow.*,
org.keycloak.*;version=&quot;6.0.1&quot;,
org.osgi.service.blueprint,
org.osgi.service.blueprint.container
</code></pre>
<p><a name="56______Camel_RestDSL"></a></p>
<h5 id="camel-restdsl"><a name="camel-restdsl" class="anchor-navigation-ex-anchor" href="#camel-restdsl"><i class="fa fa-link" aria-hidden="true"></i></a>Camel RestDSL</h5>
<p>Camel Rest DSL&#x662F;&#x4E00;&#x79CD;Camel&#x529F;&#x80FD;&#xFF0C;&#x7528;&#x4E8E;&#x4EE5;&#x6D41;&#x7545;&#x7684;&#x65B9;&#x5F0F;&#x5B9A;&#x4E49;REST&#x7AEF;&#x70B9;&#x3002; &#x4F46;&#x60A8;&#x4ECD;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x7279;&#x5B9A;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x6709;&#x5173;&#x5982;&#x4F55;&#x4E0E;Keycloak&#x96C6;&#x6210;&#x7684;&#x8BF4;&#x660E;&#x3002;</p>
<p>&#x914D;&#x7F6E;&#x96C6;&#x6210;&#x673A;&#x5236;&#x7684;&#x65B9;&#x6CD5;&#x53D6;&#x51B3;&#x4E8E;&#x60A8;&#x4E3A;&#x5176;&#x914D;&#x7F6E;RestDSL&#x5B9A;&#x4E49;&#x7684;&#x8DEF;&#x7531;&#x7684;Camel&#x7EC4;&#x4EF6;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#x663E;&#x793A;&#x5982;&#x4F55;&#x4F7F;&#x7528;<code>undertow-keycloak</code>&#x7EC4;&#x4EF6;&#x914D;&#x7F6E;&#x96C6;&#x6210;&#xFF0C;&#x5E76;&#x5F15;&#x7528;&#x524D;&#x4E00;&#x4E2A;Blueprint&#x793A;&#x4F8B;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x4E9B;bean&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">camelContext</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;blueprintContext&quot;</span>
              <span class="hljs-attr">trace</span>=<span class="hljs-string">&quot;false&quot;</span>
              <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://camel.apache.org/schema/blueprint&quot;</span>&gt;</span>

    <span class="hljs-comment">&lt;!--the link with Keycloak security handlers happens by using undertow-keycloak component --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">restConfiguration</span> <span class="hljs-attr">apiComponent</span>=<span class="hljs-string">&quot;undertow-keycloak&quot;</span> <span class="hljs-attr">contextPath</span>=<span class="hljs-string">&quot;/restdsl&quot;</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8484&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">endpointProperty</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;configResolver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;#keycloakConfigResolver&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">endpointProperty</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;allowedRoles&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;admin,superadmin&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">restConfiguration</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">rest</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/hello&quot;</span> &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Hello rest service<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">get</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;/{id}&quot;</span> <span class="hljs-attr">outType</span>=<span class="hljs-string">&quot;java.lang.String&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Just a hello<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;direct:justDirect&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">get</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">rest</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;justDirect&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">from</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;direct:justDirect&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;helloProcessor&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;RestDSL correctly invoked ${body}&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">setBody</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">constant</span>&gt;</span>(__This second sentence is returned from a Camel RestDSL endpoint__)<span class="hljs-tag">&lt;/<span class="hljs-name">constant</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">setBody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">camelContext</span>&gt;</span>
</code></pre>
<p><a name="57______&#x5728;&#x5355;&#x72EC;&#x7684;Undertow&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;Apache_CXF&#x7AEF;&#x70B9;"></a></p>
<h5 id="&#x5728;&#x5355;&#x72EC;&#x7684;undertow&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;"><a name="&#x5728;&#x5355;&#x72EC;&#x7684;undertow&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x5728;&#x5355;&#x72EC;&#x7684;undertow&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5728;&#x5355;&#x72EC;&#x7684;Undertow&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;Apache CXF&#x7AEF;&#x70B9;</h5>
<p>&#x8981;&#x5728;&#x5355;&#x72EC;&#x7684;Undertow&#x5F15;&#x64CE;&#x4E0A;&#x8FD0;&#x884C;Keycloak&#x4FDD;&#x62A4;&#x7684;CXF&#x7AEF;&#x70B9;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x5C06;<code>OSGI-INF/blueprint/blueprint.xml</code>&#x6DFB;&#x52A0;&#x5230;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x5E76;&#x5728;&#x5176;&#x4E2D;&#x6DFB;&#x52A0;&#x4E0E;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse7_adapter_camel" target="_blank">Camel&#x914D;&#x7F6E;</a>&#x7C7B;&#x4F3C;&#x7684;&#x6B63;&#x786E;&#x914D;&#x7F6E;&#x89E3;&#x6790;&#x7A0B;&#x5E8F;bean&#x3002; &#x5728;<code>httpu:engine-factory</code>&#x4E2D;&#x4F7F;&#x7528;&#x8BE5;camel&#x914D;&#x7F6E;&#x58F0;&#x660E;<code>org.keycloak.adapters.osgi.undertow.CxfKeycloakAuthHandler</code>&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x3002; CFX JAX-WS&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x914D;&#x7F6E;&#x53EF;&#x80FD;&#x7C7B;&#x4F3C;&#x4E8E;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">blueprint</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</span>
           <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
           <span class="hljs-attr">xmlns:jaxws</span>=<span class="hljs-string">&quot;http://cxf.apache.org/blueprint/jaxws&quot;</span>
           <span class="hljs-attr">xmlns:cxf</span>=<span class="hljs-string">&quot;http://cxf.apache.org/blueprint/core&quot;</span>
           <span class="hljs-attr">xmlns:httpu</span>=<span class="hljs-string">&quot;http://cxf.apache.org/transports/http-undertow/configuration&quot;</span><span class="hljs-string">.</span>
           <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;
      http://cxf.apache.org/transports/http-undertow/configuration http://cxf.apache.org/schemas/configuration/http-undertow.xsd
      http://cxf.apache.org/blueprint/core http://cxf.apache.org/schemas/blueprint/core.xsd
      http://cxf.apache.org/blueprint/jaxws http://cxf.apache.org/schemas/blueprint/jaxws.xsd&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakConfigResolver&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.osgi.BundleBasedKeycloakConfigResolver&quot;</span> &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bundleContext&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;blueprintBundleContext&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">httpu:engine-factory</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&quot;cxf&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;kc-cxf-endpoint&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">httpu:engine</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8282&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">httpu:handlers</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.osgi.undertow.CxfKeycloakAuthHandler&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;configResolver&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;keycloakConfigResolver&quot;</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">httpu:handlers</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">httpu:engine</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">httpu:engine-factory</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">jaxws:endpoint</span> <span class="hljs-attr">implementor</span>=<span class="hljs-string">&quot;org.keycloak.example.ws.ProductImpl&quot;</span>
                    <span class="hljs-attr">address</span>=<span class="hljs-string">&quot;http://localhost:8282/ProductServiceCF&quot;</span> <span class="hljs-attr">depends-on</span>=<span class="hljs-string">&quot;kc-cxf-endpoint&quot;</span>/&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">blueprint</span>&gt;</span>
</code></pre>
<p>For the CXF JAX-RS application, the only difference might be in the configuration of the endpoint dependent on engine-factory:</p>
<pre><code>&lt;jaxrs:server serviceClass=&quot;org.keycloak.example.rs.CustomerService&quot; address=&quot;http://localhost:8282/rest&quot;
    depends-on=&quot;kc-cxf-endpoint&quot;&gt;
    &lt;jaxrs:providers&gt;
        &lt;bean class=&quot;com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider&quot; /&gt;
    &lt;/jaxrs:providers&gt;
&lt;/jaxrs:server&gt;
</code></pre></li>
<li><p><code>META-INF/MANIFEST.MF</code>&#x4E2D;&#x7684;<code>Import-Package</code>&#x5FC5;&#x987B;&#x5305;&#x542B;&#x90A3;&#x4E9B;&#x5BFC;&#x5165;&#xFF1A;</p>
</li>
</ol>
<pre><code class="lang-properties">META-INF.cxf;version=&quot;[2.7,3.3)&quot;,
META-INF.cxf.osgi;version=&quot;[2.7,3.3)&quot;;resolution:=optional,
org.apache.cxf.bus;version=&quot;[2.7,3.3)&quot;,
org.apache.cxf.bus.spring;version=&quot;[2.7,3.3)&quot;,
org.apache.cxf.bus.resource;version=&quot;[2.7,3.3)&quot;,
org.apache.cxf.transport.http;version=&quot;[2.7,3.3)&quot;,
org.apache.cxf.*;version=&quot;[2.7,3.3)&quot;,
org.springframework.beans.factory.config,
org.keycloak.*;version=&quot;6.0.1&quot;
</code></pre>
<p><a name="58______&#x5728;&#x9ED8;&#x8BA4;&#x7684;Undertow&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;Apache_CXF&#x7AEF;&#x70B9;"></a></p>
<h5 id="&#x5728;&#x9ED8;&#x8BA4;&#x7684;undertow&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;"><a name="&#x5728;&#x9ED8;&#x8BA4;&#x7684;undertow&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x5728;&#x9ED8;&#x8BA4;&#x7684;undertow&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;apache-cxf&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5728;&#x9ED8;&#x8BA4;&#x7684;Undertow&#x5F15;&#x64CE;&#x4E0A;&#x4FDD;&#x62A4;Apache CXF&#x7AEF;&#x70B9;</h5>
<p>&#x67D0;&#x4E9B;&#x670D;&#x52A1;&#x4F1A;&#x5728;&#x542F;&#x52A8;&#x65F6;&#x81EA;&#x52A8;&#x9644;&#x5E26;&#x5DF2;&#x90E8;&#x7F72;&#x7684;servlet&#x3002; &#x4E00;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x670D;&#x52A1;&#x662F;&#x5728;http:// localhost:8181/cxf&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x8FD0;&#x884C;&#x7684;CXF servlet&#x3002; Fuse&#x7684;Pax Web&#x652F;&#x6301;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x6539;&#x53D8;&#x73B0;&#x6709;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x3002; &#x8FD9;&#x53EF;&#x7528;&#x4E8E;&#x901A;&#x8FC7;Keycloak&#x4FDD;&#x62A4;&#x7AEF;&#x70B9;&#x3002;</p>
<p>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<code>OSGI-INF/blueprint/blueprint.xml</code>&#x53EF;&#x80FD;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E0B;&#x9762;&#x7684;&#x90A3;&#x4E2A;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5B83;&#x6DFB;&#x52A0;&#x4E86;JAX-RS <code>customerservice</code>&#x7AEF;&#x70B9;&#xFF0C;&#x8BE5;&#x7AEF;&#x70B9;&#x662F;&#x7279;&#x5B9A;&#x4E8E;&#x7AEF;&#x70B9;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">blueprint</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</span>
           <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
           <span class="hljs-attr">xmlns:jaxrs</span>=<span class="hljs-string">&quot;http://cxf.apache.org/blueprint/jaxrs&quot;</span>
           <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;
                http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
                http://cxf.apache.org/blueprint/jaxrs http://cxf.apache.org/schemas/blueprint/jaxrs.xsd&quot;</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- JAXRS Application --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;customerBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.example.rs.CxfCustomerService&quot;</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">jaxrs:server</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cxfJaxrsServer&quot;</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&quot;/customerservice&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">jaxrs:providers</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">jaxrs:providers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">jaxrs:serviceBeans</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">component-id</span>=<span class="hljs-string">&quot;customerBean&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">jaxrs:serviceBeans</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">jaxrs:server</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">blueprint</span>&gt;</span>
</code></pre>
<p>&#x6B64;&#x5916;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x521B;&#x5EFA;<code>${karaf.etc}/org.ops4j.pax.web.context-*anyName*.cfg file</code>&#x3002; &#x5B83;&#x5C06;&#x88AB;&#x89C6;&#x4E3A;&#x5DE5;&#x5382;PID&#x914D;&#x7F6E;&#xFF0C;&#x7531;<code>pax-web-runtime</code>&#x5305;&#x8DDF;&#x8E2A;&#x3002; &#x6B64;&#x7C7B;&#x914D;&#x7F6E;&#x53EF;&#x80FD;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5C5E;&#x6027;&#xFF0C;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x5BF9;&#x5E94;&#x4E8E;&#x6807;&#x51C6;<code>web.xml</code>&#x7684;&#x67D0;&#x4E9B;&#x5C5E;&#x6027;&#xFF1A;</p>
<pre><code class="lang-properties">bundle.symbolicName = org.apache.cxf.cxf-rt-transports-http
context.id = default

context.param.keycloak.config.resolver = org.keycloak.adapters.osgi.HierarchicalPathBasedKeycloakConfigResolver

login.config.authMethod = KEYCLOAK

security.cxf.url = /cxf/customerservice/*
security.cxf.roles = admin, user
</code></pre>
<p>&#x6709;&#x5173;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x6587;&#x4EF6;&#x4E2D;&#x53EF;&#x7528;&#x5C5E;&#x6027;&#x7684;&#x5B8C;&#x6574;&#x8BF4;&#x660E;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;Fuse&#x6587;&#x6863;&#x3002; &#x4E0A;&#x8FF0;&#x5C5E;&#x6027;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x542B;&#x4E49;&#xFF1A;</p>
<ul>
<li><p><code>bundle.symbolicName</code> &#x548C; <code>context.id</code></p>
<p>&#x5728;<code>org.ops4j.pax.web.service.WebContainer</code>&#x4E2D;&#x6807;&#x8BC6;bundle&#x53CA;&#x5176;&#x90E8;&#x7F72;&#x4E0A;&#x4E0B;&#x6587;&#x3002;</p>
</li>
<li><p><code>context.param.keycloak.config.resolver</code></p>
<p>&#x4E3A;bundle&#x63D0;&#x4F9B;<code>keycloak.config.resolver</code>&#x4E0A;&#x4E0B;&#x6587;&#x53C2;&#x6570;&#x7684;&#x503C;&#xFF0C;&#x4E0E;&#x7ECF;&#x5178;WAR&#x4E2D;&#x7684;<code>web.xml</code>&#x76F8;&#x540C;&#x3002; &#x53EF;&#x7528;&#x7684;&#x89E3;&#x6790;&#x5668;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse7_config_external_adapter" target="_blank">&#x914D;&#x7F6E;&#x89E3;&#x6790;&#x5668;</a>&#x90E8;&#x5206;&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x63CF;&#x8FF0;&#x3002;</p>
</li>
<li><p><code>login.config.authMethod</code></p>
<p>&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65B9;&#x6CD5;&#x3002; &#x5FC5;&#x987B;&#x662F;<code>KEYCLOAK</code>&#x3002;</p>
</li>
<li><p><code>security.*anyName*.url</code> &#x548C; <code>security.*anyName*.roles</code></p>
<p>&#x5404;&#x4E2A;&#x5B89;&#x5168;&#x7EA6;&#x675F;&#x7684;&#x5C5E;&#x6027;&#x503C;&#x5C31;&#x50CF;&#x5728;<code>web.xml</code>&#x4E2D;&#x7684;<code>security-constraint/web-resource-collection/url-pattern</code> &#x548C; <code>security-constraint/auth-constraint/role-name</code>&#x4E2D;&#x8BBE;&#x7F6E;&#x7684;&#x90A3;&#x6837;&#xFF0C; &#x5206;&#x522B;&#x3002; &#x89D2;&#x8272;&#x7531;&#x9017;&#x53F7;&#x548C;&#x5468;&#x56F4;&#x7684;&#x7A7A;&#x683C;&#x5206;&#x9694;&#x3002; <code>* anyName*</code>&#x6807;&#x8BC6;&#x7B26;&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x610F;&#x7684;&#xFF0C;&#x4F46;&#x5FC5;&#x987B;&#x5339;&#x914D;&#x76F8;&#x540C;&#x5B89;&#x5168;&#x7EA6;&#x675F;&#x7684;&#x5404;&#x4E2A;&#x5C5E;&#x6027;&#x3002;&#x4E00;&#x4E9B;Fuse&#x7248;&#x672C;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x9700;&#x8981;&#x5C06;&#x89D2;&#x8272;&#x5206;&#x9694;&#x4E3A;<code>&quot;, &quot;</code>&#xFF08;&#x9017;&#x53F7;&#x548C;&#x5355;&#x4E2A;&#x7A7A;&#x683C;&#xFF09;&#x3002; &#x786E;&#x4FDD;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x8868;&#x793A;&#x6CD5;&#x6765;&#x5206;&#x79BB;&#x89D2;&#x8272;&#x3002;</p>
</li>
</ul>
<p><code>META-INF/MANIFEST.MF</code>&#x4E2D;&#x7684;<code>Import-Package</code>&#x5FC5;&#x987B;&#x81F3;&#x5C11;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5BFC;&#x5165;&#xFF1A;</p>
<pre><code class="lang-properties">javax.ws.rs;version=&quot;[2,3)&quot;,
META-INF.cxf;version=&quot;[2.7,3.3)&quot;,
META-INF.cxf.osgi;version=&quot;[2.7,3.3)&quot;;resolution:=optional,
org.apache.cxf.transport.http;version=&quot;[2.7,3.3)&quot;,
org.apache.cxf.*;version=&quot;[2.7,3.3)&quot;,
com.fasterxml.jackson.jaxrs.json;version=&quot;${jackson.version}&quot;
</code></pre>
<p><a name="59______&#x4FDD;&#x62A4;Fuse&#x7BA1;&#x7406;&#x670D;&#x52A1;"></a></p>
<h5 id="&#x4FDD;&#x62A4;fuse&#x7BA1;&#x7406;&#x670D;&#x52A1;"><a name="&#x4FDD;&#x62A4;fuse&#x7BA1;&#x7406;&#x670D;&#x52A1;" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x62A4;fuse&#x7BA1;&#x7406;&#x670D;&#x52A1;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FDD;&#x62A4;Fuse&#x7BA1;&#x7406;&#x670D;&#x52A1;</h5>
<p><a name="60_______&#x4F7F;&#x7528;SSH&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;Fuse&#x7EC8;&#x7AEF;"></a></p>
<h6 id="&#x4F7F;&#x7528;ssh&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;fuse&#x7EC8;&#x7AEF;"><a name="&#x4F7F;&#x7528;ssh&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;fuse&#x7EC8;&#x7AEF;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;ssh&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;fuse&#x7EC8;&#x7AEF;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;SSH&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;Fuse&#x7EC8;&#x7AEF;</h6>
<p>Keycloak&#x4E3B;&#x8981;&#x5904;&#x7406;&#x7528;&#x4E8E;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x7528;&#x4F8B;; &#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x7684;&#x5176;&#x4ED6;Web&#x670D;&#x52A1;&#x548C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53D7;Keycloak&#x4FDD;&#x62A4;&#xFF0C;&#x5219;&#x4F7F;&#x7528;Keycloak&#x51ED;&#x636E;&#x4FDD;&#x62A4;&#x975E;Web&#x7BA1;&#x7406;&#x670D;&#x52A1;&#xFF08;&#x5982;SSH&#xFF09;&#x662F;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;JAAS&#x767B;&#x5F55;&#x6A21;&#x5757;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C;&#xFF0C;&#x8BE5;&#x6A21;&#x5757;&#x5141;&#x8BB8;&#x8FDC;&#x7A0B;&#x8FDE;&#x63A5;&#x5230;Keycloak&#x5E76;&#x6839;&#x636E;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_resource_owner_password_credentials_flow" target="_blank">&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x636E;</a>&#x9A8C;&#x8BC1;&#x51ED;&#x636E;&#x3002;</p>
<p>&#x8981;&#x542F;&#x7528;SSH&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x5728;Keycloak&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;<code>ssh-jmx-admin-client</code>&#xFF09;&#xFF0C;&#x5B83;&#x5C06;&#x7528;&#x4E8E;SSH&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x6B64;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x5C06;<code>Direct Access Grants Enabled</code>&#x9009;&#x4E3A;<code>On</code>&#x3002;</p>
</li>
<li><p>&#x5728;<code>$FUSE_HOME/etc/org.apache.karaf.shell.cfg</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x66F4;&#x65B0;&#x6216;&#x6307;&#x5B9A;&#x6B64;&#x5C5E;&#x6027;&#xFF1A;</p>
<pre><code class="lang-properties">sshRealm=keycloak
</code></pre>
</li>
<li><p>&#x6DFB;&#x52A0;<code>$FUSE_HOME/etc/ keycloak-direct-access.json</code>&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x5185;&#x5BB9;&#x7C7B;&#x4F3C;&#x4E8E;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF08;&#x57FA;&#x4E8E;&#x60A8;&#x7684;&#x73AF;&#x5883;&#x548C;Keycloak&#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;&#xFF09;&#xFF1A;</p>
<pre><code class="lang-json">{
    <span class="hljs-string">&quot;realm&quot;</span>: <span class="hljs-string">&quot;demo&quot;</span>,
    <span class="hljs-string">&quot;resource&quot;</span>: <span class="hljs-string">&quot;ssh-jmx-admin-client&quot;</span>,
    <span class="hljs-string">&quot;ssl-required&quot;</span> : <span class="hljs-string">&quot;external&quot;</span>,
    <span class="hljs-string">&quot;auth-server-url&quot;</span> : <span class="hljs-string">&quot;http://localhost:8080/auth&quot;</span>,
    <span class="hljs-string">&quot;credentials&quot;</span>: {
        <span class="hljs-string">&quot;secret&quot;</span>: <span class="hljs-string">&quot;password&quot;</span>
    }
}
</code></pre>
<p>&#x6B64;&#x6587;&#x4EF6;&#x6307;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x914D;&#x7F6E;&#xFF0C;&#x8BE5;&#x547D;&#x4EE4;&#x7531;&#x6765;&#x81EA;<code>keycloak</code> JAAS&#x9886;&#x57DF;&#x7684;JAAS DirectAccessGrantsLoginModule&#x7528;&#x4E8E;SSH&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;</p>
</li>
<li><p>&#x542F;&#x52A8;Fuse&#x5E76;&#x5B89;&#x88C5;<code>keycloak</code> JAAS&#x9886;&#x57DF;&#x3002; &#x6700;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5B89;&#x88C5;<code>keycloak-jaas</code>&#x529F;&#x80FD;&#xFF0C;&#x5B83;&#x5177;&#x6709;&#x9884;&#x5B9A;&#x4E49;&#x7684;JAAS&#x9886;&#x57DF;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;<code>keycloak</code> JAAS&#x9886;&#x57DF;&#x8986;&#x76D6;&#x8BE5;&#x529F;&#x80FD;&#x7684;&#x9884;&#x5B9A;&#x4E49;&#x9886;&#x57DF;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://access.redhat.com/documentation/en-us/red_hat_fuse/7.2/html-single/apache_karaf_security_guide/index#ESBSecureContainer" target="_blank">JBoss Fuse&#x6587;&#x6863;</a>&#x3002;</p>
<p>&#x5728;Fuse&#x7EC8;&#x7AEF;&#x4E2D;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code>features:addurl mvn:org.keycloak/keycloak-osgi-features/6.0.1/xml/features
features:install keycloak-jaas
</code></pre></li>
<li><p>&#x901A;&#x8FC7;&#x5728;&#x7EC8;&#x7AEF;&#x4E2D;&#x952E;&#x5165;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF0C;&#x4F7F;&#x7528;SSH&#x4F5C;&#x4E3A;<code>admin</code>&#x7528;&#x6237;&#x767B;&#x5F55;&#xFF1A;</p>
<pre><code class="lang-bash">ssh -o PubkeyAuthentication=no -p 8101 admin@localhost
</code></pre>
</li>
<li><p>&#x4F7F;&#x7528;&#x5BC6;&#x7801;<code>password</code>&#x767B;&#x5F55;&#x3002;</p>
</li>
</ol>
<blockquote>
<p>&#x5728;&#x67D0;&#x4E9B;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x8FD8;&#x9700;&#x8981;&#x4F7F;&#x7528;SSH&#x547D;&#x4EE4;&#x7684;-o&#x9009;&#x9879;<code>-o HostKeyAlgorithms=+ssh-dss</code>&#xFF0C;&#x56E0;&#x4E3A;&#x4EE5;&#x540E;&#x7684;SSH&#x5BA2;&#x6237;&#x7AEF;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x4E0D;&#x5141;&#x8BB8;&#x4F7F;&#x7528;<code>ssh-dss</code>&#x7B97;&#x6CD5;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x76EE;&#x524D;&#x5728;JBoss Fuse 7.2.0&#x4E2D;&#x4F7F;&#x7528;&#x3002;</p>
</blockquote>
<p>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x7528;&#x6237;&#x9700;&#x8981;&#x5177;&#x6709;&#x9886;&#x57DF;&#x89D2;&#x8272;<code>admin</code>&#x6765;&#x6267;&#x884C;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x6216;&#x5176;&#x4ED6;&#x89D2;&#x8272;&#x6765;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#x5B50;&#x96C6;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;<strong>viewer</strong>&#x89D2;&#x8272;&#x9650;&#x5236;&#x7528;&#x6237;&#x4EC5;&#x8FD0;&#x884C;&#x53EA;&#x8BFB;&#x7684;Karaf&#x547D;&#x4EE4;&#xFF09;&#x3002; &#x53EF;&#x7528;&#x89D2;&#x8272;&#x5728;<code>$FUSE_HOME/etc/ org.apache.karaf.shell.cfg</code>&#x6216;<code>$FUSE_HOME/etc/system.properties</code>&#x4E2D;&#x914D;&#x7F6E;&#x3002;</p>
<p><a name="61_______&#x4F7F;&#x7528;JMX&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"></a></p>
<h6 id="&#x4F7F;&#x7528;jmx&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><a name="&#x4F7F;&#x7528;jmx&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;jmx&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;JMX&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;</h6>
<p>&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;jconsole&#x6216;&#x5176;&#x4ED6;&#x5916;&#x90E8;&#x5DE5;&#x5177;&#x901A;&#x8FC7;RMI&#x8FDC;&#x7A0B;&#x8FDE;&#x63A5;&#x5230;JMX&#xFF0C;&#x5219;&#x53EF;&#x80FD;&#x9700;&#x8981;JMX&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x5426;&#x5219;&#x6700;&#x597D;&#x4F7F;&#x7528;hawt.io/jolokia&#xFF0C;&#x56E0;&#x4E3A;jolokia&#x4EE3;&#x7406;&#x9ED8;&#x8BA4;&#x5B89;&#x88C5;&#x5728;hawt.io&#x4E2D;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse7_hawtio" target="_blank">Hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;</a>&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;JMX&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x5728;<code>$FUSE_HOME/etc/org.apache.karaf.management.cfg</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x5C06;jmxRealm&#x5C5E;&#x6027;&#x66F4;&#x6539;&#x4E3A;&#xFF1A;</p>
<pre><code class="lang-properties">jmxRealm=keycloak
</code></pre>
</li>
<li><p>&#x5B89;&#x88C5;<code>keycloak-jaas</code>&#x529F;&#x80FD;&#x5E76;&#x914D;&#x7F6E;<code>$FUSE_HOME/etc/keycloak-direct-access.json</code>&#x6587;&#x4EF6;&#xFF0C;&#x5982;&#x4E0A;&#x9762;&#x7684;SSH&#x90E8;&#x5206;&#x6240;&#x8FF0;&#x3002;</p>
</li>
<li><p>&#x5728;jconsole&#x4E2D;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;URL&#xFF1A;</p>
</li>
</ol>
<pre><code>service:jmx:rmi://localhost:44444/jndi/rmi://localhost:1099/karaf-root
</code></pre><p>&#x548C;&#x51ED;&#x636E;&#xFF1A;admin/password&#xFF08;&#x6839;&#x636E;&#x60A8;&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x5177;&#x6709;&#x7BA1;&#x7406;&#x5458;&#x6743;&#x9650;&#x7684;&#x7528;&#x6237;&#xFF09;&#x3002;</p>
<p><a name="62______&#x4FDD;&#x62A4;Hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;"></a></p>
<h5 id="&#x4FDD;&#x62A4;hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;"><a name="&#x4FDD;&#x62A4;hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;" class="anchor-navigation-ex-anchor" href="#&#x4FDD;&#x62A4;hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FDD;&#x62A4;Hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;</h5>
<p>&#x8981;&#x4F7F;&#x7528;Keycloak&#x4FDD;&#x62A4;Hawtio&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x5728;&#x60A8;&#x7684;&#x9886;&#x57DF;&#x7684;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5728;Keycloak<code>demo</code>realm&#x4E2D;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;<code>hawtio-client</code>&#xFF0C;&#x6307;&#x5B9A;<code>public</code>&#x4F5C;&#x4E3A;Access Type&#xFF0C;&#x5E76;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x6307;&#x5411;Hawtio&#x7684;&#x91CD;&#x5B9A;&#x5411;URI&#xFF1A;<a href="http://localhost:8181/hawtio/*&#x3002;" target="_blank">http://localhost:8181/hawtio/*&#x3002;</a> &#x914D;&#x7F6E;&#x76F8;&#x5E94;&#x7684;Web Origin(&#x5728;&#x672C;&#x4F8B;&#x4E2D;&#x4E3A;<a href="http://localhost:8181)&#x3002;" target="_blank">http://localhost:8181)&#x3002;</a> &#x8BBE;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x8303;&#x56F4;&#x6620;&#x5C04;&#xFF0C;&#x5728;<code>hawtio-client</code>&#x5BA2;&#x6237;&#x7AEF;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x4E2D;&#x7684;<em>scope</em>&#x9009;&#x9879;&#x5361;&#x4E2D;&#x5305;&#x542B;<em>view-profile</em> client&#x89D2;&#x8272;<em>account</em> client&#x3002;</p>
</li>
<li><p>&#x4F7F;&#x7528;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E0B;&#x9762;&#x793A;&#x4F8B;&#x4E2D;&#x6240;&#x793A;&#x7684;&#x5185;&#x5BB9;&#x5728;<code>$FUSE_HOME/etc</code>&#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;<code>keycloak-hawtio-client.json</code>&#x6587;&#x4EF6;&#x3002; &#x6839;&#x636E;&#x60A8;&#x7684;Keycloak&#x73AF;&#x5883;&#x66F4;&#x6539;<code>realm</code>&#xFF0C;<code>resource</code>&#x548C;<code>auth-server-url</code>&#x5C5E;&#x6027;&#x3002; <code>resource</code>&#x5C5E;&#x6027;&#x5FC5;&#x987B;&#x6307;&#x5411;&#x4E0A;&#x4E00;&#x6B65;&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x8BE5;&#x6587;&#x4EF6;&#x7531;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;Hawtio JavaScript&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF09;&#x4F7F;&#x7528;&#x3002;</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;realm&quot;</span> : <span class="hljs-string">&quot;demo&quot;</span>,
  <span class="hljs-string">&quot;clientId&quot;</span> : <span class="hljs-string">&quot;hawtio-client&quot;</span>,
  <span class="hljs-string">&quot;url&quot;</span> : <span class="hljs-string">&quot;http://localhost:8080/auth&quot;</span>,
  <span class="hljs-string">&quot;ssl-required&quot;</span> : <span class="hljs-string">&quot;external&quot;</span>,
  <span class="hljs-string">&quot;public-client&quot;</span> : <span class="hljs-literal">true</span>
}
</code></pre>
</li>
<li><p>&#x4F7F;&#x7528;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E0B;&#x9762;&#x793A;&#x4F8B;&#x4E2D;&#x6240;&#x793A;&#x7684;&#x5185;&#x5BB9;&#x5728;<code>$ FUSE_HOME/etc</code>&#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;<code>keycloak-direct-access.json</code>&#x6587;&#x4EF6;&#x3002; &#x6839;&#x636E;&#x60A8;&#x7684;Keycloak&#x73AF;&#x5883;&#x66F4;&#x6539;<code>realm</code>&#x548C;<code>url</code>&#x5C5E;&#x6027;&#x3002; &#x8BE5;&#x6587;&#x4EF6;&#x7531;JavaScript&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x3002;</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;realm&quot;</span> : <span class="hljs-string">&quot;demo&quot;</span>,
  <span class="hljs-string">&quot;resource&quot;</span> : <span class="hljs-string">&quot;ssh-jmx-admin-client&quot;</span>,
  <span class="hljs-string">&quot;auth-server-url&quot;</span> : <span class="hljs-string">&quot;http://localhost:8080/auth&quot;</span>,
  <span class="hljs-string">&quot;ssl-required&quot;</span> : <span class="hljs-string">&quot;external&quot;</span>,
  <span class="hljs-string">&quot;credentials&quot;</span>: {
    <span class="hljs-string">&quot;secret&quot;</span>: <span class="hljs-string">&quot;password&quot;</span>
  }
}
</code></pre>
</li>
<li><p>&#x4F7F;&#x7528;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E0B;&#x9762;&#x793A;&#x4F8B;&#x4E2D;&#x6240;&#x793A;&#x7684;&#x5185;&#x5BB9;&#x5728;<code>$FUSE_HOME/etc</code> &#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;<code>keycloak-hawtio.json</code> &#x6587;&#x4EF6;&#x3002; &#x6839;&#x636E;&#x60A8;&#x7684;Keycloak&#x73AF;&#x5883;&#x66F4;&#x6539;<code>realm</code>&#x548C;<code>auth-server-url</code>&#x5C5E;&#x6027;&#x3002; &#x6B64;&#x6587;&#x4EF6;&#x7531;&#x670D;&#x52A1;&#x5668;&#xFF08;JAAS&#x767B;&#x5F55;&#x6A21;&#x5757;&#xFF09;&#x7AEF;&#x7684;&#x9002;&#x914D;&#x5668;&#x4F7F;&#x7528;&#x3002;</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;realm&quot;</span> : <span class="hljs-string">&quot;demo&quot;</span>,
  <span class="hljs-string">&quot;resource&quot;</span> : <span class="hljs-string">&quot;jaas&quot;</span>,
  <span class="hljs-string">&quot;bearer-only&quot;</span> : <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;auth-server-url&quot;</span> : <span class="hljs-string">&quot;http://localhost:8080/auth&quot;</span>,
  <span class="hljs-string">&quot;ssl-required&quot;</span> : <span class="hljs-string">&quot;external&quot;</span>,
  <span class="hljs-string">&quot;use-resource-role-mappings&quot;</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">&quot;principal-attribute&quot;</span>: <span class="hljs-string">&quot;preferred_username&quot;</span>
}
</code></pre>
</li>
<li><p>&#x542F;&#x52A8;JBoss Fuse 7.2.0&#xFF0C;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse7_install_feature" target="_blank">&#x5B89;&#x88C5;Keycloak&#x529F;&#x80FD;</a>&#x3002; &#x7136;&#x540E;&#x8F93;&#x5165;Karaf&#x7EC8;&#x7AEF;&#xFF1A;</p>
<pre><code class="lang-properties">system:property -p hawtio.keycloakEnabled true
system:property -p hawtio.realm keycloak
system:property -p hawtio.keycloakClientConfig file://\${karaf.base}/etc/keycloak-hawtio-client.json
system:property -p hawtio.rolePrincipalClasses org.keycloak.adapters.jaas.RolePrincipal,org.apache.karaf.jaas.boot.principal.RolePrincipal
restart io.hawt.hawtio-war
</code></pre>
</li>
<li><p>&#x8F6C;&#x5230;<a href="http://localhost:8181/hawtio" target="_blank">http://localhost:8181/hawtio</a>&#x5E76;&#x4EE5;Keycloak&#x9886;&#x57DF;&#x7684;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#x767B;&#x5F55;&#x3002;</p>
<p>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x7528;&#x6237;&#x9700;&#x8981;&#x5177;&#x6709;&#x9002;&#x5F53;&#x7684;&#x9886;&#x57DF;&#x89D2;&#x8272;&#x624D;&#x80FD;&#x6210;&#x529F;&#x5411;Hawtio&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x53EF;&#x7528;&#x89D2;&#x8272;&#x5728;<code>hawtio.roles</code>&#x4E2D;&#x7684;<code>$FUSE_HOME/etc/system.properties</code>&#x6587;&#x4EF6;&#x4E2D;&#x914D;&#x7F6E;&#x3002;</p>
</li>
</ol>
<p><a name="63_____2_1_6__Spring_Boot_&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="216-spring-boot-&#x9002;&#x914D;&#x5668;"><a name="216-spring-boot-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#216-spring-boot-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.6. Spring Boot &#x9002;&#x914D;&#x5668;</h4>
<p>&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x4FDD;&#x62A4;Spring Boot&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5C06;Keycloak Spring Boot&#x9002;&#x914D;&#x5668;JAR&#x6DFB;&#x52A0;&#x5230;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x7136;&#x540E;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x6B63;&#x5E38;&#x7684;Spring Boot&#x914D;&#x7F6E;&#xFF08;<code>application.properties</code>&#xFF09;&#x63D0;&#x4F9B;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x914D;&#x7F6E;&#x3002; &#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x3002;</p>
<p><a name="64______&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"></a></p>
<h5 id="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><a name="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;</h5>
<p>Keycloak Spring Boot&#x9002;&#x914D;&#x5668;&#x5229;&#x7528;Spring Boot&#x7684;&#x81EA;&#x52A8;&#x914D;&#x7F6E;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x53EA;&#x9700;&#x5C06;Keycloak Spring Boot&#x542F;&#x52A8;&#x5668;&#x6DFB;&#x52A0;&#x5230;&#x60A8;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x5373;&#x53EF;&#x3002; &#x4ED6;&#x4EEC;&#x7684;Keycloak Spring Boot Starter&#x4E5F;&#x53EF;&#x4EE5;&#x4ECE;<a href="https://start.spring.io/" target="_blank">Spring Start Page</a>&#x76F4;&#x63A5;&#x83B7;&#x5F97;&#x3002; &#x8981;&#x4F7F;&#x7528;Maven&#x624B;&#x52A8;&#x6DFB;&#x52A0;&#x5B83;&#xFF0C;&#x8BF7;&#x5C06;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x6DFB;&#x52A0;&#x5230;&#x4F9D;&#x8D56;&#x9879;&#x4E2D;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.keycloak<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>keycloak-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>&#x6DFB;&#x52A0;&#x9002;&#x914D;&#x5668;BOM&#x4F9D;&#x8D56;&#x9879;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.keycloak.bom<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>keycloak-adapter-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>
</code></pre>
<p>&#x76EE;&#x524D;&#x652F;&#x6301;&#x4EE5;&#x4E0B;&#x5D4C;&#x5165;&#x5F0F;&#x5BB9;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;Starter&#xFF0C;&#x5219;&#x4E0D;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x989D;&#x5916;&#x7684;&#x4F9D;&#x8D56;&#x9879;&#xFF1A;</p>
<ul>
<li>Tomcat</li>
<li>Undertow</li>
<li>Jetty</li>
</ul>
<p><a name="65______&#x5FC5;&#x9700;&#x7684;Spring_Boot_Adapter&#x914D;&#x7F6E;"></a></p>
<h5 id="&#x5FC5;&#x9700;&#x7684;spring-boot-adapter&#x914D;&#x7F6E;"><a name="&#x5FC5;&#x9700;&#x7684;spring-boot-adapter&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x5FC5;&#x9700;&#x7684;spring-boot-adapter&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5FC5;&#x9700;&#x7684;Spring Boot Adapter&#x914D;&#x7F6E;</h5>
<p>&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x914D;&#x7F6E;Spring Boot&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4EE5;&#x4F7F;&#x7528;Keycloak&#x3002;</p>
<p>&#x4E0D;&#x9700;&#x8981;&#x914D;&#x7F6E;<code>keycloak.json</code>&#x6587;&#x4EF6;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6B63;&#x5E38;&#x7684;Spring Boot&#x914D;&#x7F6E;&#x4E3A;Spring Boot Keycloak&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x57DF;&#x3002; &#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-properties">keycloak.realm = demorealm
keycloak.auth-server-url = http://127.0.0.1:8080/auth
keycloak.ssl-required = external
keycloak.resource = demoapp
keycloak.credentials.secret = 11111111-1111-1111-1111-111111111111
keycloak.use-resource-role-mappings = true
</code></pre>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;<code>keycloak.enabled=false</code>&#x6765;&#x7981;&#x7528;Keycloak Spring Boot Adapter&#xFF08;&#x4F8B;&#x5982;&#x5728;&#x6D4B;&#x8BD5;&#x4E2D;&#xFF09;&#x3002;</p>
<p>&#x8981;&#x914D;&#x7F6E;&#x7B56;&#x7565;&#x5F3A;&#x5236;&#x5B9E;&#x65BD;&#x5668;&#xFF0C;&#x4E0E;keycloak.json&#x4E0D;&#x540C;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528;<code>policy-enforcer-config</code>&#x800C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;<code>policy-enforcer</code>&#x3002;</p>
<p>&#x60A8;&#x8FD8;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x901A;&#x5E38;&#x4F4D;&#x4E8E;<code>web.xml</code>&#x4E2D;&#x7684;Java EE&#x5B89;&#x5168;&#x914D;&#x7F6E;&#x3002; Spring Boot Adapter&#x5C06;<code>login-method</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>KEYCLOAK</code>&#x5E76;&#x5728;&#x542F;&#x52A8;&#x65F6;&#x914D;&#x7F6E;<code>security-constraints</code>&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x914D;&#x7F6E;&#xFF1A;</p>
<pre><code class="lang-properties">keycloak.securityConstraints[0].authRoles[0] = admin
keycloak.securityConstraints[0].authRoles[1] = user
keycloak.securityConstraints[0].securityCollections[0].name = insecure stuff
keycloak.securityConstraints[0].securityCollections[0].patterns[0] = /insecure

keycloak.securityConstraints[1].authRoles[0] = admin
keycloak.securityConstraints[1].securityCollections[0].name = admin stuff
keycloak.securityConstraints[1].securityCollections[0].patterns[0] = /admin
</code></pre>
<blockquote>
<p>&#x5982;&#x679C;&#x60A8;&#x8BA1;&#x5212;&#x5C06;Spring&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90E8;&#x7F72;&#x4E3A;WAR&#xFF0C;&#x90A3;&#x4E48;&#x4E0D;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;Spring&#x5F15;&#x5BFC;&#x9002;&#x914D;&#x5668;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x4E3A;&#x60A8;&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x670D;&#x52A1;&#x5668;&#x6216;servlet&#x5BB9;&#x5668;&#x4F7F;&#x7528;&#x4E13;&#x7528;&#x9002;&#x914D;&#x5668;&#x3002;&#x60A8;&#x7684;Spring Boot&#x8FD8;&#x5E94;&#x8BE5;&#x5305;&#x542B;&#x4E00;&#x4E2A; <code>web.xml</code>&#x6587;&#x4EF6;&#x3002;</p>
</blockquote>
<p><a name="66_____2_1_7__Tomcat_6__7_and_8_&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="217-tomcat-6-7-and-8-&#x9002;&#x914D;&#x5668;"><a name="217-tomcat-6-7-and-8-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#217-tomcat-6-7-and-8-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.7. Tomcat 6, 7 and 8 &#x9002;&#x914D;&#x5668;</h4>
<p>&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x5728;Tomcat 6,7&#x548C;8&#x4E0A;&#x7684;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;Tomcat&#x5B89;&#x88C5;&#x4E2D;&#x5B89;&#x88C5;Keycloak Tomcat 6,7&#x6216;8&#x9002;&#x914D;&#x5668;&#x3002; &#x7136;&#x540E;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;&#x90E8;&#x7F72;&#x5230;Tomcat&#x7684;&#x6BCF;&#x4E2A;WAR&#x4E2D;&#x63D0;&#x4F9B;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x914D;&#x7F6E;&#x3002; &#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x3002;</p>
<p><a name="67______&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"></a></p>
<h5 id="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><a name="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;</h5>
<p>&#x9002;&#x914D;&#x5668;&#x4E0D;&#x518D;&#x5305;&#x542B;&#x5728;&#x8BBE;&#x5907;&#x6216;war&#x5206;&#x53D1;&#x7248;&#x4E2D;&#x3002;&#x6BCF;&#x4E2A;&#x9002;&#x914D;&#x5668;&#x5728;Keycloak&#x4E0B;&#x8F7D;&#x7AD9;&#x70B9;&#x4E0A;&#x90FD;&#x662F;&#x5355;&#x72EC;&#x7684;&#x4E0B;&#x8F7D;&#x3002;&#x5B83;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;maven&#x6784;&#x4EF6;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x5C06;&#x9002;&#x914D;&#x5668;&#x53D1;&#x884C;&#x7248;&#x89E3;&#x538B;&#x5230;Tomcat&#x7684;<code>lib/</code>&#x76EE;&#x5F55;&#x4E2D;&#x3002;&#x5728;WEB-INF/lib&#x76EE;&#x5F55;&#x4E2D;&#x5305;&#x542B;&#x9002;&#x914D;&#x5668;&#x7684;jar&#x5C06;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;!Keycloak&#x9002;&#x914D;&#x5668;&#x5B9E;&#x73B0;&#x4E3A;&#x4E00;&#x4E2A;Valve&#xFF0C;&#x800C;Valve&#x4EE3;&#x7801;&#x5FC5;&#x987B;&#x9A7B;&#x7559;&#x5728;Tomcat&#x7684;&#x4E3B;lib/&#x76EE;&#x5F55;&#x4E2D;&#x3002;</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$TOMCAT_HOME</span>/lib
$ unzip keycloak-tomcat6-adapter-dist.zip
    or
$ unzip keycloak-tomcat7-adapter-dist.zip
    or
$ unzip keycloak-tomcat8-adapter-dist.zip
</code></pre>
<p><a name="68______&#x6BCF;&#x4E2A;WAR&#x914D;&#x7F6E;&#x6240;&#x9700;"></a></p>
<h5 id="&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;&#x6240;&#x9700;"><a name="&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;&#x6240;&#x9700;" class="anchor-navigation-ex-anchor" href="#&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;&#x6240;&#x9700;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6BCF;&#x4E2A;WAR&#x914D;&#x7F6E;&#x6240;&#x9700;</h5>
<p>&#x672C;&#x8282;&#x63CF;&#x8FF0;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x5728;WAR&#x5305;&#x4E2D;&#x6DFB;&#x52A0;&#x914D;&#x7F6E;&#x548C;&#x7F16;&#x8F91;&#x6587;&#x4EF6;&#x6765;&#x76F4;&#x63A5;&#x4FDD;&#x62A4;WAR&#x3002;</p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x505A;&#x7684;&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x662F;&#x5728;WAR&#x5305;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>META-INF/context.xml</code>&#x6587;&#x4EF6;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x4E8E;Tomcat&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;Keycloak&#x7279;&#x5B9A;&#x7684;Valve&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Context</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/your-context-path&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Valve</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;org.keycloak.adapters.tomcat.KeycloakAuthenticatorValve&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Context</span>&gt;</span>
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;WAR&#x7684;<code>WEB-INF</code>&#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>keycloak.json</code>&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x8BE5;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_java_adapter_config" target="_blank">Java&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;</a>&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x63CF;&#x8FF0;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x540C;&#x65F6;&#x6307;&#x5B9A;<code>login-config</code>&#x5E76;&#x4F7F;&#x7528;&#x6807;&#x51C6;servlet&#x5B89;&#x5168;&#x6027;&#x6765;&#x6307;&#x5B9A;URL&#x4E0A;&#x7684;&#x89D2;&#x8272;&#x57FA;&#x7840;&#x7EA6;&#x675F;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
      <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
      <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">module-name</span>&gt;</span>customer-portal<span class="hljs-tag">&lt;/<span class="hljs-name">module-name</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-collection</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-name</span>&gt;</span>Customers<span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-collection</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">auth-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-constraint</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">login-config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-method</span>&gt;</span>BASIC<span class="hljs-tag">&lt;/<span class="hljs-name">auth-method</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">realm-name</span>&gt;</span>this is ignored currently<span class="hljs-tag">&lt;/<span class="hljs-name">realm-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">login-config</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
<p><a name="69_____2_1_8__Jetty_9_x_&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="218-jetty-9x-&#x9002;&#x914D;&#x5668;"><a name="218-jetty-9x-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#218-jetty-9x-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.8. Jetty 9.x &#x9002;&#x914D;&#x5668;</h4>
<p>Keycloak&#x6709;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x9002;&#x914D;&#x5668;&#xFF0C;&#x9002;&#x7528;&#x4E8E;Jetty 9.2.x&#xFF0C;Jetty 9.3.x&#x548C;Jetty 9.4.x&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5B89;&#x88C5;&#x5230;Jetty&#x5B89;&#x88C5;&#x4E2D;&#x3002; &#x7136;&#x540E;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;&#x90E8;&#x7F72;&#x5230;Jetty&#x7684;&#x6BCF;&#x4E2A;WAR&#x4E2D;&#x63D0;&#x4F9B;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x914D;&#x7F6E;&#x3002; &#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x3002;</p>
<p><a name="70______&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"></a></p>
<h5 id="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><a name="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;</h5>
<p>&#x9002;&#x914D;&#x5668;&#x4E0D;&#x518D;&#x5305;&#x542B;&#x5728;&#x8BBE;&#x5907;&#x6216;war&#x5206;&#x53D1;&#x7248;&#x4E2D;&#x3002;&#x6BCF;&#x4E2A;&#x9002;&#x914D;&#x5668;&#x5728;Keycloak&#x4E0B;&#x8F7D;&#x7AD9;&#x70B9;&#x4E0A;&#x90FD;&#x662F;&#x5355;&#x72EC;&#x7684;&#x4E0B;&#x8F7D;&#x3002;&#x5B83;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;maven&#x6784;&#x4EF6;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x5C06;Jetty 9.x&#x53D1;&#x884C;&#x7248;&#x89E3;&#x538B;&#x7F29;&#x5230;Jetty 9.x&#x7684;<a href="https://www.eclipse.org/jetty/documentation/current/startup-base-and-home.html" target="_blank">&#x57FA;&#x672C;&#x76EE;&#x5F55;</a>&#x3002; &#x5728;WEB-INF/lib&#x76EE;&#x5F55;&#x4E2D;&#x5305;&#x542B;&#x9002;&#x914D;&#x5668;&#x7684;jar&#x5C06;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF01; &#x5728;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;Jetty&#x57FA;&#x672C;&#x540D;&#x4E3A;<code>your-base</code>&#xFF1A;</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> your-base
$ unzip keycloak-jetty93-adapter-dist-2.5.0.Final.zip
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x4E3A;Jetty&#x57FA;&#x7840;&#x542F;&#x7528;<code>keycloak</code>&#x6A21;&#x5757;&#xFF1A;</p>
<pre><code class="lang-bash">$ java -jar <span class="hljs-variable">$JETTY_HOME</span>/start.jar --add-to-startd=keycloak
</code></pre>
<p><a name="71______&#x6BCF;&#x4E2A;WAR&#x914D;&#x7F6E;&#x5FC5;&#x9700;"></a></p>
<h5 id="&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;&#x5FC5;&#x9700;"><a name="&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;&#x5FC5;&#x9700;" class="anchor-navigation-ex-anchor" href="#&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;&#x5FC5;&#x9700;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6BCF;&#x4E2A;WAR&#x914D;&#x7F6E;&#x5FC5;&#x9700;</h5>
<p>&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x5728;WAR&#x5305;&#x4E2D;&#x6DFB;&#x52A0;&#x914D;&#x7F6E;&#x548C;&#x7F16;&#x8F91;&#x6587;&#x4EF6;&#x6765;&#x76F4;&#x63A5;&#x4FDD;&#x62A4;WAR&#x3002;</p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x505A;&#x7684;&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x662F;&#x5728;WAR&#x5305;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>WEB-INF/jetty-web.xml</code>&#x6587;&#x4EF6;&#x3002; &#x8FD9;&#x662F;Jetty&#x7279;&#x5B9A;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;&#x5176;&#x4E2D;&#x5B9A;&#x4E49;Keycloak&#x7279;&#x5B9A;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5668;&#x3002;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE Configure PUBLIC &quot;-//Mort Bay Consulting//DTD Configure//EN&quot; &quot;http://www.eclipse.org/jetty/configure_9_0.dtd&quot;&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Configure</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.webapp.WebAppContext&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Get</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;securityHandler&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Set</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticator&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">New</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.jetty.KeycloakJettyAuthenticator&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">New</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Set</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Get</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Configure</span>&gt;</span>
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;WAR&#x7684;<code>WEB-INF</code>&#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>keycloak.json</code>&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x8BE5;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_java_adapter_config" target="_blank">Java&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;</a> &#x90E8;&#x5206;&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x63CF;&#x8FF0;&#x3002;</p>
<blockquote>
<p>Jetty 9.x&#x9002;&#x914D;&#x5668;&#x5C06;&#x65E0;&#x6CD5;&#x627E;&#x5230;<code>keycloak.json</code>&#x6587;&#x4EF6;&#x3002; &#x60A8;&#x5FC5;&#x987B;&#x5728;<code>jetty-web.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x6240;&#x6709;&#x9002;&#x914D;&#x5668;&#x8BBE;&#x7F6E;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x8FF0;&#x3002;</p>
</blockquote>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x5728;<code>jetty-web.xml</code>&#x4E2D;&#x5B9A;&#x4E49;&#x6240;&#x6709;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;keycloak.json&#x3002; &#x60A8;&#x53EA;&#x9700;&#x8981;&#x5F04;&#x6E05;&#x695A;json&#x8BBE;&#x7F6E;&#x5982;&#x4F55;&#x4E0E;<code>org.keycloak.representations.adapters.config.AdapterConfig</code>&#x7C7B;&#x5339;&#x914D;&#x3002;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE Configure PUBLIC &quot;-//Mort Bay Consulting//DTD Configure//EN&quot; &quot;http://www.eclipse.org/jetty/configure_9_0.dtd&quot;&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Configure</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.webapp.WebAppContext&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Get</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;securityHandler&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Set</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticator&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">New</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.jetty.KeycloakJettyAuthenticator&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Set</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;adapterConfig&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">New</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.representations.adapters.config.AdapterConfig&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Set</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;realm&quot;</span>&gt;</span>tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">Set</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Set</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;resource&quot;</span>&gt;</span>customer-portal<span class="hljs-tag">&lt;/<span class="hljs-name">Set</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Set</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authServerUrl&quot;</span>&gt;</span>http://localhost:8081/auth<span class="hljs-tag">&lt;/<span class="hljs-name">Set</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Set</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sslRequired&quot;</span>&gt;</span>external<span class="hljs-tag">&lt;/<span class="hljs-name">Set</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Set</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;credentials&quot;</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Map</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">Entry</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">Item</span>&gt;</span>secret<span class="hljs-tag">&lt;/<span class="hljs-name">Item</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">Item</span>&gt;</span>password<span class="hljs-tag">&lt;/<span class="hljs-name">Item</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">Entry</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">Map</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">Set</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">New</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Set</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">New</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Set</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Get</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Configure</span>&gt;</span>
</code></pre>
<p>&#x60A8;&#x4E0D;&#x5FC5;&#x7834;&#x89E3;&#x6253;&#x5F00;WAR&#x4EE5;&#x4F7F;&#x7528;keycloak&#x4FDD;&#x62A4;&#x5B83;&#x3002; &#x800C;&#x662F;&#x4F7F;&#x7528;yourwar.xml&#x7684;&#x540D;&#x79F0;&#x5728;webapps&#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;jetty-web.xml&#x6587;&#x4EF6;&#x3002; Jetty&#x5E94;&#x8BE5;&#x6361;&#x8D77;&#x6765;&#x3002; &#x5728;&#x6B64;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x76F4;&#x63A5;&#x5728;xml&#x6587;&#x4EF6;&#x4E2D;&#x58F0;&#x660E;keycloak.json&#x914D;&#x7F6E;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x540C;&#x65F6;&#x6307;&#x5B9A;<code>login-config</code>&#x5E76;&#x4F7F;&#x7528;&#x6807;&#x51C6;servlet&#x5B89;&#x5168;&#x6027;&#x6765;&#x6307;&#x5B9A;URL&#x4E0A;&#x7684;&#x89D2;&#x8272;&#x57FA;&#x7840;&#x7EA6;&#x675F;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
      <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
      <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">module-name</span>&gt;</span>customer-portal<span class="hljs-tag">&lt;/<span class="hljs-name">module-name</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-collection</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-name</span>&gt;</span>Customers<span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-collection</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">auth-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">user-data-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transport-guarantee</span>&gt;</span>CONFIDENTIAL<span class="hljs-tag">&lt;/<span class="hljs-name">transport-guarantee</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">user-data-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-constraint</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">login-config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-method</span>&gt;</span>BASIC<span class="hljs-tag">&lt;/<span class="hljs-name">auth-method</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">realm-name</span>&gt;</span>this is ignored currently<span class="hljs-tag">&lt;/<span class="hljs-name">realm-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">login-config</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
<p><a name="72_____2_1_9__Spring_Security_&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="219-spring-security-&#x9002;&#x914D;&#x5668;"><a name="219-spring-security-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#219-spring-security-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.9. Spring Security &#x9002;&#x914D;&#x5668;</h4>
<p>&#x8981;&#x4F7F;&#x7528;Spring Security&#x548C;Keycloak&#x4FDD;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x8BF7;&#x5C06;&#x6B64;&#x9002;&#x914D;&#x5668;&#x6DFB;&#x52A0;&#x4E3A;&#x9879;&#x76EE;&#x7684;&#x4F9D;&#x8D56;&#x9879;&#x3002; &#x7136;&#x540E;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;Spring Security&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x63D0;&#x4F9B;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;bean&#xFF0C;&#x5E76;&#x5C06;Keycloak&#x5B89;&#x5168;&#x8FC7;&#x6EE4;&#x5668;&#x6DFB;&#x52A0;&#x5230;&#x7BA1;&#x9053;&#x4E2D;&#x3002;</p>
<p>&#x4E0E;&#x5176;&#x4ED6;Keycloak Adapters&#x4E0D;&#x540C;&#xFF0C;&#x60A8;&#x4E0D;&#x5E94;&#x5728;web.xml&#x4E2D;&#x914D;&#x7F6E;&#x5B89;&#x5168;&#x6027;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x4ECD;&#x7136;&#x9700;&#x8981;keycloak.json&#x3002;</p>
<p><a name="73______&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"></a></p>
<h5 id="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><a name="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;</h5>
<p>&#x6DFB;&#x52A0;Keycloak Spring Security&#x9002;&#x914D;&#x5668;&#x4F5C;&#x4E3A;Maven POM&#x6216;Gradle&#x6784;&#x5EFA;&#x7684;&#x4F9D;&#x8D56;&#x9879;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.keycloak<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>keycloak-spring-security-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><a name="74______Spring&#x5B89;&#x5168;&#x914D;&#x7F6E;"></a></p>
<h5 id="spring&#x5B89;&#x5168;&#x914D;&#x7F6E;"><a name="spring&#x5B89;&#x5168;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#spring&#x5B89;&#x5168;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>Spring&#x5B89;&#x5168;&#x914D;&#x7F6E;</h5>
<p>Keycloak Spring Security&#x9002;&#x914D;&#x5668;&#x5229;&#x7528;Spring Security&#x7075;&#x6D3B;&#x7684;&#x5B89;&#x5168;&#x914D;&#x7F6E;&#x8BED;&#x6CD5;&#x3002;</p>
<p><a name="75_______Java&#x914D;&#x7F6E;"></a></p>
<h6 id="java&#x914D;&#x7F6E;"><a name="java&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#java&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>Java&#x914D;&#x7F6E;</h6>
<p>Keycloak&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;KeycloakWebSecurityConfigurerAdapter&#x4F5C;&#x4E3A;&#x521B;&#x5EFA;<a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/config/annotation/web/WebSecurityConfigurer.html" target="_blank">WebSecurityConfigurer</a>&#x5B9E;&#x4F8B;&#x3002; &#x8BE5;&#x5B9E;&#x73B0;&#x5141;&#x8BB8;&#x901A;&#x8FC7;&#x91CD;&#x5199;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x3002; &#x867D;&#x7136;&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5B83;&#xFF0C;&#x4F46;&#x5B83;&#x6781;&#x5927;&#x5730;&#x7B80;&#x5316;&#x4E86;&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;&#x914D;&#x7F6E;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-meta">@KeycloakConfiguration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">KeycloakWebSecurityConfigurerAdapter</span>
</span>{
    <span class="hljs-comment">/**
     * Registers the KeycloakAuthenticationProvider with the authentication manager.
     */</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureGlobal</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        auth.authenticationProvider(keycloakAuthenticationProvider());
    }

    <span class="hljs-comment">/**
     * Defines the session authentication strategy.
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> SessionAuthenticationStrategy <span class="hljs-title">sessionAuthenticationStrategy</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RegisterSessionAuthenticationStrategy(<span class="hljs-keyword">new</span> SessionRegistryImpl());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception
    </span>{
        <span class="hljs-keyword">super</span>.configure(http);
        http
                .authorizeRequests()
                .antMatchers(<span class="hljs-string">&quot;/customers*&quot;</span>).hasRole(<span class="hljs-string">&quot;USER&quot;</span>)
                .antMatchers(<span class="hljs-string">&quot;/admin*&quot;</span>).hasRole(<span class="hljs-string">&quot;ADMIN&quot;</span>)
                .anyRequest().permitAll();
    }
}
</code></pre>
<p>&#x60A8;&#x5FC5;&#x987B;&#x4E3A;&#x516C;&#x5171;&#x6216;&#x673A;&#x5BC6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7B56;&#x7565;bean&#xFF0C;&#x5176;&#x7C7B;&#x578B;&#x5E94;&#x4E3A;<code>RegisterSessionAuthenticationStrategy</code>&#xFF0C;&#x5BF9;&#x4E8E;&#x4EC5;&#x627F;&#x8F7D;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;<code>NullAuthenticatedSessionStrategy</code>&#x3002;</p>
<p>&#x76EE;&#x524D;&#x4E0D;&#x652F;&#x6301;Spring Security&#x7684;<code>SessionFixationProtectionStrategy</code>&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5728;&#x901A;&#x8FC7;Keycloak&#x767B;&#x5F55;&#x540E;&#x66F4;&#x6539;&#x4F1A;&#x8BDD;&#x6807;&#x8BC6;&#x7B26;&#x3002; &#x5982;&#x679C;&#x4F1A;&#x8BDD;&#x6807;&#x8BC6;&#x7B26;&#x66F4;&#x6539;&#xFF0C;&#x5219;&#x901A;&#x7528;&#x6CE8;&#x9500;&#x5C06;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;Keycloak&#x4E0D;&#x77E5;&#x9053;&#x65B0;&#x7684;&#x4F1A;&#x8BDD;&#x6807;&#x8BC6;&#x7B26;&#x3002;</p>
<blockquote>
<p><code>@KeycloakConfiguration</code>&#x6CE8;&#x91CA;&#x662F;&#x4E00;&#x4E2A;&#x5143;&#x6570;&#x636E;&#x6CE8;&#x91CA;&#xFF0C;&#x5B83;&#x5B9A;&#x4E49;&#x4E86;&#x5728;Spring Security&#x4E2D;&#x96C6;&#x6210;Keycloak&#x6240;&#x9700;&#x7684;&#x6240;&#x6709;&#x6CE8;&#x91CA;&#x3002; &#x5982;&#x679C;&#x4F60;&#x6709;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x7684;Spring Security&#x8BBE;&#x7F6E;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x5730;&#x770B;&#x4E00;&#x4E0B;<code>@KeycloakConfiguration</code>&#x6CE8;&#x91CA;&#x7684;&#x6CE8;&#x91CA;&#xFF0C;&#x5E76;&#x521B;&#x5EFA;&#x4F60;&#x81EA;&#x5DF1;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x5143;&#x6CE8;&#x91CA;&#xFF0C;&#x6216;&#x8005;&#x53EA;&#x662F;&#x4E3A;Keycloak&#x9002;&#x914D;&#x5668;&#x4F7F;&#x7528;&#x7279;&#x5B9A;&#x7684;Spring&#x6CE8;&#x91CA;&#x3002;</p>
</blockquote>
<p><a name="76_______XML&#x914D;&#x7F6E;"></a></p>
<h6 id="xml&#x914D;&#x7F6E;"><a name="xml&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#xml&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>XML&#x914D;&#x7F6E;</h6>
<p>&#x867D;&#x7136;Spring Security&#x7684;XML&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7B80;&#x5316;&#x4E86;&#x914D;&#x7F6E;&#xFF0C;&#x4F46;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x53EF;&#x80FD;&#x6709;&#x70B9;&#x5197;&#x957F;&#x3002;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="hljs-attr">xmlns:security</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/security&quot;</span>
       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/security
       http://www.springframework.org/schema/security/spring-security.xsd&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.keycloak.adapters.springsecurity&quot;</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security:authentication-manager</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;authenticationManager&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">security:authentication-provider</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;keycloakAuthenticationProvider&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security:authentication-manager</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;adapterDeploymentContext&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.springsecurity.AdapterDeploymentContextFactoryBean&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/WEB-INF/keycloak.json&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakAuthenticationEntryPoint&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.springsecurity.authentication.KeycloakAuthenticationEntryPoint&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakAuthenticationProvider&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.springsecurity.authentication.KeycloakAuthenticationProvider&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakPreAuthActionsFilter&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.springsecurity.filter.KeycloakPreAuthActionsFilter&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakAuthenticationProcessingFilter&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.springsecurity.filter.KeycloakAuthenticationProcessingFilter&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticationManager&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;authenticationManager&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakLogoutHandler&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.springsecurity.authentication.KeycloakLogoutHandler&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;adapterDeploymentContext&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;logoutFilter&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.security.web.authentication.logout.LogoutFilter&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;logoutSuccessUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;handlers&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;keycloakLogoutHandler&quot;</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;logoutRequestMatcher&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.security.web.util.matcher.AntPathRequestMatcher&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pattern&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/sso/logout**&quot;</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;httpMethod&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;GET&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security:http</span> <span class="hljs-attr">auto-config</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attr">entry-point-ref</span>=<span class="hljs-string">&quot;keycloakAuthenticationEntryPoint&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">security:custom-filter</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;keycloakPreAuthActionsFilter&quot;</span> <span class="hljs-attr">before</span>=<span class="hljs-string">&quot;LOGOUT_FILTER&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">security:custom-filter</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;keycloakAuthenticationProcessingFilter&quot;</span> <span class="hljs-attr">before</span>=<span class="hljs-string">&quot;FORM_LOGIN_FILTER&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">security:intercept-url</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;/customers**&quot;</span> <span class="hljs-attr">access</span>=<span class="hljs-string">&quot;ROLE_USER&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">security:intercept-url</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;/admin**&quot;</span> <span class="hljs-attr">access</span>=<span class="hljs-string">&quot;ROLE_ADMIN&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">security:custom-filter</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;logoutFilter&quot;</span> <span class="hljs-attr">position</span>=<span class="hljs-string">&quot;LOGOUT_FILTER&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security:http</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span>
</code></pre>
<p><a name="77______&#x591A;&#x79DF;&#x6237;"></a></p>
<h5 id="&#x591A;&#x79DF;&#x6237;"><a name="&#x591A;&#x79DF;&#x6237;" class="anchor-navigation-ex-anchor" href="#&#x591A;&#x79DF;&#x6237;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x591A;&#x79DF;&#x6237;</h5>
<p>Keycloak Spring Security&#x9002;&#x914D;&#x5668;&#x8FD8;&#x652F;&#x6301;&#x591A;&#x79DF;&#x6237;&#x3002; &#x800C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;<code>keycloak.json</code>&#x7684;&#x8DEF;&#x5F84;&#x6CE8;&#x5165;<code>AdapterDeploymentContextFactoryBean</code>&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x6CE8;&#x5165;<code>KeycloakConfigResolver</code>&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x3002; &#x6709;&#x5173;&#x5982;&#x4F55;&#x5B9E;&#x73B0;<code>KeycloakConfigResolver</code>&#x7684;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_multi_tenancy" target="_blank">&#x591A;&#x79DF;&#x6237;</a>&#x3002;</p>
<p><a name="78______&#x547D;&#x540D;&#x5B89;&#x5168;&#x89D2;&#x8272;"></a></p>
<h5 id="&#x547D;&#x540D;&#x5B89;&#x5168;&#x89D2;&#x8272;"><a name="&#x547D;&#x540D;&#x5B89;&#x5168;&#x89D2;&#x8272;" class="anchor-navigation-ex-anchor" href="#&#x547D;&#x540D;&#x5B89;&#x5168;&#x89D2;&#x8272;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x547D;&#x540D;&#x5B89;&#x5168;&#x89D2;&#x8272;</h5>
<p>&#x4F7F;&#x7528;&#x57FA;&#x4E8E;&#x89D2;&#x8272;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65F6;&#xFF0C;Spring Security&#x8981;&#x6C42;&#x89D2;&#x8272;&#x540D;&#x79F0;&#x4EE5;<code>ROLE_</code>&#x5F00;&#x5934;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5FC5;&#x987B;&#x5728;Keycloak&#x4E2D;&#x5C06;&#x7BA1;&#x7406;&#x5458;&#x89D2;&#x8272;&#x58F0;&#x660E;&#x4E3A;<code>ROLE_ADMIN</code>&#x6216;&#x7C7B;&#x4F3C;&#x540D;&#x79F0;&#xFF0C;&#x800C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;<code>ADMIN</code>&#x3002;</p>
<p>&#x7C7B;<code>org.keycloak.adapters.springsecurity.authentication.KeycloakAuthenticationProvider</code>&#x652F;&#x6301;&#x53EF;&#x9009;&#x7684;<code>org.springframework.security.core.authority.mapping.GrantedAuthoritiesMapper</code>&#xFF0C;&#x5B83;&#x53EF;&#x7528;&#x4E8E;&#x5C06;&#x6765;&#x81EA;Keycloak&#x7684;&#x89D2;&#x8272;&#x6620;&#x5C04;&#x5230;Spring Security&#x8BA4;&#x53EF;&#x7684;&#x89D2;&#x8272;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x4F7F;&#x7528;<code>org.springframework.security.core.authority.mapping.SimpleAuthorityMapper</code>&#x63D2;&#x5165;<code>ROLE_</code>&#x524D;&#x7F00;&#x5E76;&#x5C06;&#x89D2;&#x8272;&#x540D;&#x79F0;&#x8F6C;&#x6362;&#x4E3A;&#x5927;&#x5199;&#x3002; &#x8BE5;&#x7C7B;&#x662F;Spring Security Core&#x6A21;&#x5757;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</p>
<p><a name="79______&#x5BA2;&#x6237;&#x7AEF;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x652F;&#x6301;"></a></p>
<h5 id="&#x5BA2;&#x6237;&#x7AEF;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x652F;&#x6301;"><a name="&#x5BA2;&#x6237;&#x7AEF;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x652F;&#x6301;" class="anchor-navigation-ex-anchor" href="#&#x5BA2;&#x6237;&#x7AEF;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x652F;&#x6301;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5BA2;&#x6237;&#x7AEF;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x652F;&#x6301;</h5>
<p>&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x5BA2;&#x6237;&#x7AEF;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#xFF0C;Keycloak&#x63D0;&#x4F9B;&#x4E86;Spring&#x7684;<code>RestTemplate</code>&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x4E3A;&#x60A8;&#x5904;&#x7406;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x8BA4;&#x8BC1;&#x3002; &#x8981;&#x542F;&#x7528;&#x6B64;&#x529F;&#x80FD;&#xFF0C;&#x60A8;&#x7684;&#x5B89;&#x5168;&#x914D;&#x7F6E;&#x5FC5;&#x987B;&#x6DFB;&#x52A0;<code>KeycloakRestTemplate</code>bean&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5B83;&#x5FC5;&#x987B;&#x4F5C;&#x4E3A;&#x539F;&#x578B;&#x786E;&#x5B9A;&#x8303;&#x56F4;&#x624D;&#x80FD;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;Java&#x914D;&#x7F6E;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-meta">@ComponentScan</span>(basePackageClasses = KeycloakSecurityComponents.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">KeycloakWebSecurityConfigurerAdapter</span> </span>{

    ...

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">public</span> KeycloakClientRequestFactory keycloakClientRequestFactory;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)
    <span class="hljs-function"><span class="hljs-keyword">public</span> KeycloakRestTemplate <span class="hljs-title">keycloakRestTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> KeycloakRestTemplate(keycloakClientRequestFactory);
    }

    ...
}
</code></pre>
<p>&#x5BF9;&#x4E8E;XML&#x914D;&#x7F6E;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keycloakRestTemplate&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.springsecurity.client.KeycloakRestTemplate&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;prototype&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;factory&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;keycloakClientRequestFactory&quot;</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</code></pre>
<p>&#x7136;&#x540E;&#xFF0C;&#x53EA;&#x8981;&#x9700;&#x8981;&#x8C03;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>KeycloakRestTemplate</code>&#x3002; &#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RemoteProductService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ProductService</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> KeycloakRestTemplate template;

    <span class="hljs-keyword">private</span> String endpoint;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getProducts</span><span class="hljs-params">()</span> </span>{
        ResponseEntity&lt;String[]&gt; response = template.getForEntity(endpoint, String[].class);
        <span class="hljs-keyword">return</span> Arrays.asList(response.getBody());
    }
}
</code></pre>
<p><a name="80______Spring_Boot&#x96C6;&#x6210;"></a></p>
<h5 id="spring-boot&#x96C6;&#x6210;"><a name="spring-boot&#x96C6;&#x6210;" class="anchor-navigation-ex-anchor" href="#spring-boot&#x96C6;&#x6210;"><i class="fa fa-link" aria-hidden="true"></i></a>Spring Boot&#x96C6;&#x6210;</h5>
<p>&#x53EF;&#x4EE5;&#x7EC4;&#x5408;Spring Boot&#x548C;Spring Security&#x9002;&#x914D;&#x5668;&#x3002;</p>
<p>&#x5982;&#x679C;&#x60A8;&#x4F7F;&#x7528;Keycloak Spring Boot Starter&#x6765;&#x4F7F;&#x7528;Spring Security&#x9002;&#x914D;&#x5668;&#xFF0C;&#x60A8;&#x53EA;&#x9700;&#x6DFB;&#x52A0;Spring Security&#x542F;&#x52A8;&#x5668;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><a name="81_______&#x4F7F;&#x7528;Spring_Boot&#x914D;&#x7F6E;"></a></p>
<h6 id="&#x4F7F;&#x7528;spring-boot&#x914D;&#x7F6E;"><a name="&#x4F7F;&#x7528;spring-boot&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;spring-boot&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;Spring Boot&#x914D;&#x7F6E;</h6>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Spring Security Adapter&#x4F1A;&#x67E5;&#x627E;<code>keycloak.json</code>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6DFB;&#x52A0;&#x6B64;bean&#x6765;&#x786E;&#x4FDD;&#x5B83;&#x67E5;&#x770B;Spring Boot Adapter&#x63D0;&#x4F9B;&#x7684;&#x914D;&#x7F6E;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> KeycloakConfigResolver <span class="hljs-title">KeycloakConfigResolver</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> KeycloakSpringBootConfigResolver();
}
</code></pre>
<p><a name="82_______&#x907F;&#x514D;Bean&#x6CE8;&#x518C;&#x4E24;&#x6B21;"></a></p>
<h6 id="&#x907F;&#x514D;bean&#x6CE8;&#x518C;&#x4E24;&#x6B21;"><a name="&#x907F;&#x514D;bean&#x6CE8;&#x518C;&#x4E24;&#x6B21;" class="anchor-navigation-ex-anchor" href="#&#x907F;&#x514D;bean&#x6CE8;&#x518C;&#x4E24;&#x6B21;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x907F;&#x514D;Bean&#x6CE8;&#x518C;&#x4E24;&#x6B21;</h6>
<p>Spring Boot&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E0A;&#x4E0B;&#x6587;&#x6025;&#x5207;&#x5730;&#x6CE8;&#x518C;&#x8FC7;&#x6EE4;&#x5668;bean&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x5728;Spring Boot&#x73AF;&#x5883;&#x4E2D;&#x8FD0;&#x884C;Keycloak Spring Security&#x9002;&#x914D;&#x5668;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5C06;<code>FilterRegistrationBean</code>&#x6DFB;&#x52A0;&#x5230;&#x5B89;&#x5168;&#x914D;&#x7F6E;&#x4E2D;&#xFF0C;&#x4EE5;&#x9632;&#x6B62;Keycloak&#x8FC7;&#x6EE4;&#x5668;&#x88AB;&#x6CE8;&#x518C;&#x4E24;&#x6B21;&#x3002;</p>
<p>Spring Boot 2.1&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x4E5F;&#x4F1A;&#x7981;&#x7528;<code>spring.main.allow-bean-definition-overriding</code>&#x3002; &#x8FD9;&#x53EF;&#x80FD;&#x610F;&#x5473;&#x7740;&#x5982;&#x679C;&#x6269;&#x5C55;<code>KeycloakWebSecurityConfigurerAdapter</code>&#x7684;<code>Configuration</code>&#x7C7B;&#x6CE8;&#x518C;&#x4E86;&#x4E00;&#x4E2A;&#x5DF2;&#x88AB;<code>@ComponentScan</code>&#x68C0;&#x6D4B;&#x5230;&#x7684;bean&#xFF0C;&#x5219;&#x4F1A;&#x9047;&#x5230;<code>BeanDefinitionOverrideException</code>&#x3002; &#x901A;&#x8FC7;&#x8986;&#x76D6;&#x6CE8;&#x518C;&#x4EE5;&#x4F7F;&#x7528;&#x7279;&#x5B9A;&#x4E8E;Boot&#x7684;<code>@ConditionalOnMissingBean</code>&#x6CE8;&#x91CA;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x4E0B;&#x9762;&#x7684;<code>HttpSessionManager</code>&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">KeycloakWebSecurityConfigurerAdapter</span>
</span>{
    ...

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">keycloakAuthenticationProcessingFilterRegistrationBean</span><span class="hljs-params">(
            KeycloakAuthenticationProcessingFilter filter)</span> </span>{
        FilterRegistrationBean registrationBean = <span class="hljs-keyword">new</span> FilterRegistrationBean(filter);
        registrationBean.setEnabled(<span class="hljs-keyword">false</span>);
        <span class="hljs-keyword">return</span> registrationBean;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">keycloakPreAuthActionsFilterRegistrationBean</span><span class="hljs-params">(
            KeycloakPreAuthActionsFilter filter)</span> </span>{
        FilterRegistrationBean registrationBean = <span class="hljs-keyword">new</span> FilterRegistrationBean(filter);
        registrationBean.setEnabled(<span class="hljs-keyword">false</span>);
        <span class="hljs-keyword">return</span> registrationBean;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">keycloakAuthenticatedActionsFilterBean</span><span class="hljs-params">(
            KeycloakAuthenticatedActionsFilter filter)</span> </span>{
        FilterRegistrationBean registrationBean = <span class="hljs-keyword">new</span> FilterRegistrationBean(filter);
        registrationBean.setEnabled(<span class="hljs-keyword">false</span>);
        <span class="hljs-keyword">return</span> registrationBean;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">keycloakSecurityContextRequestFilterBean</span><span class="hljs-params">(
        KeycloakSecurityContextRequestFilter filter)</span> </span>{
        FilterRegistrationBean registrationBean = <span class="hljs-keyword">new</span> FilterRegistrationBean(filter);
        registrationBean.setEnabled(<span class="hljs-keyword">false</span>);
        <span class="hljs-keyword">return</span> registrationBean;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@ConditionalOnMissingBean</span>(HttpSessionManager.class)
    <span class="hljs-function"><span class="hljs-keyword">protected</span> HttpSessionManager <span class="hljs-title">httpSessionManager</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HttpSessionManager();
    }
    ...
}
</code></pre>
<p><a name="83_____2_1_10__Java_Servlet_Filter_&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="2110-java-servlet-filter-&#x9002;&#x914D;&#x5668;"><a name="2110-java-servlet-filter-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#2110-java-servlet-filter-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.10. Java Servlet Filter &#x9002;&#x914D;&#x5668;</h4>
<p>&#x5982;&#x679C;&#x8981;&#x5728;&#x6CA1;&#x6709;Keycloak&#x9002;&#x914D;&#x5668;&#x7684;&#x5E73;&#x53F0;&#x4E0A;&#x90E8;&#x7F72;Java Servlet&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5219;&#x9009;&#x62E9;&#x4F7F;&#x7528;servlet&#x8FC7;&#x6EE4;&#x5668;&#x9002;&#x914D;&#x5668;&#x3002; &#x6B64;&#x9002;&#x914D;&#x5668;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x4E0E;&#x5176;&#x4ED6;&#x9002;&#x914D;&#x5668;&#x7565;&#x6709;&#x4E0D;&#x540C;&#x3002; &#x60A8;&#x6CA1;&#x6709;&#x5728;web.xml&#x4E2D;&#x5B9A;&#x4E49;&#x5B89;&#x5168;&#x6027;&#x7EA6;&#x675F;&#x3002; &#x800C;&#x662F;&#x4F7F;&#x7528;Keycloak servlet&#x8FC7;&#x6EE4;&#x5668;&#x9002;&#x914D;&#x5668;&#x5B9A;&#x4E49;&#x8FC7;&#x6EE4;&#x5668;&#x6620;&#x5C04;&#xFF0C;&#x4EE5;&#x4FDD;&#x62A4;&#x8981;&#x4FDD;&#x62A4;&#x7684;URL&#x6A21;&#x5F0F;&#x3002;</p>
<blockquote>
<p>Backchannel&#x6CE8;&#x9500;&#x4E0E;&#x6807;&#x51C6;&#x9002;&#x914D;&#x5668;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x7565;&#x6709;&#x4E0D;&#x540C;&#x3002; &#x5B83;&#x4E0D;&#x4F1A;&#x4F7F;HTTP&#x4F1A;&#x8BDD;&#x65E0;&#x6548;&#xFF0C;&#x800C;&#x662F;&#x5C06;&#x4F1A;&#x8BDD;ID&#x6807;&#x8BB0;&#x4E3A;&#x5DF2;&#x6CE8;&#x9500;&#x3002; &#x6CA1;&#x6709;&#x6807;&#x51C6;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x4F1A;&#x8BDD;ID&#x4F7F;HTTP&#x4F1A;&#x8BDD;&#x65E0;&#x6548;&#x3002;</p>
</blockquote>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
      <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
      <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">module-name</span>&gt;</span>application<span class="hljs-tag">&lt;/<span class="hljs-name">module-name</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>Keycloak Filter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.keycloak.adapters.servlet.KeycloakOIDCFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>Keycloak Filter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/keycloak/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/protected/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
<p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x4E2D;&#x6709;&#x4E24;&#x4E2A;url&#x6A21;&#x5F0F;&#x3002; <code>/protected/*</code> &#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x4FDD;&#x62A4;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x800C;<code>/keycloak/*</code> url-pattern&#x5904;&#x7406;&#x6765;&#x81EA;Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;&#x56DE;&#x8C03;&#x3002;</p>
<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x5728;&#x914D;&#x7F6E;&#x7684;<code>url-patterns</code>&#x4E0B;&#x9762;&#x6392;&#x9664;&#x4E00;&#x4E9B;&#x8DEF;&#x5F84;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Filter init-param<code>keycloak.config.skipPattern</code>&#x6765;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x8BE5;&#x8868;&#x8FBE;&#x5F0F;&#x63CF;&#x8FF0;&#x4E86;keycloak&#x8FC7;&#x6EE4;&#x5668;&#x5E94;&#x7ACB;&#x5373;&#x59D4;&#x6258;&#x7ED9;&#x7684;&#x8DEF;&#x5F84;&#x6A21;&#x5F0F;&#x3002; &#x8FC7;&#x6EE4;&#x94FE;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0D;&#x914D;&#x7F6E;skipPattern&#x3002;</p>
<p>&#x6A21;&#x5F0F;&#x4E0E;<code>requestURI</code>&#x5339;&#x914D;&#xFF0C;&#x6CA1;&#x6709;<code>context-path</code>&#x3002; &#x7ED9;&#x5B9A;context-path <code>/myapp</code>&#xFF0C;&#x5BF9;<code>/myapp/index.html</code>&#x7684;&#x8BF7;&#x6C42;&#x5C06;&#x4E0E;<code>/index.html</code>&#x5339;&#x914D;&#x8DF3;&#x8FC7;&#x6A21;&#x5F0F;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>keycloak.config.skipPattern<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>^/(path1|path2|path3).*<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
</code></pre>
<p>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x60A8;&#x5E94;&#x8BE5;&#x5728;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x4F7F;&#x7528;&#x7BA1;&#x7406;URL&#x914D;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8BE5;URL&#x6307;&#x5411;&#x8FC7;&#x6EE4;&#x5668;&#x7684;url-pattern&#x6240;&#x6DB5;&#x76D6;&#x7684;&#x5B89;&#x5168;&#x90E8;&#x5206;&#x3002;</p>
<p>&#x7BA1;&#x7406;&#x5458;URL&#x5C06;&#x5BF9;&#x7BA1;&#x7406;&#x5458;URL&#x8FDB;&#x884C;&#x56DE;&#x8C03;&#xFF0C;&#x4EE5;&#x6267;&#x884C;backchannel&#x6CE8;&#x9500;&#x7B49;&#x64CD;&#x4F5C;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x6B64;&#x793A;&#x4F8B;&#x4E2D;&#x7684;Admin URL&#x5E94;&#x4E3A;<code>http[s]://hostname/{context-root}/keycloak</code>&#x3002;</p>
<p>Keycloak&#x8FC7;&#x6EE4;&#x5668;&#x5177;&#x6709;&#x4E0E;&#x5176;&#x4ED6;&#x9002;&#x914D;&#x5668;&#x76F8;&#x540C;&#x7684;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF0C;&#x9664;&#x975E;&#x60A8;&#x5FC5;&#x987B;&#x5C06;&#x5B83;&#x4EEC;&#x5B9A;&#x4E49;&#x4E3A;&#x8FC7;&#x6EE4;&#x5668;init&#x53C2;&#x6570;&#x800C;&#x4E0D;&#x662F;&#x4E0A;&#x4E0B;&#x6587;&#x53C2;&#x6570;&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;&#x6B64;&#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x8BF7;&#x5728;WAR poms&#x4E2D;&#x5305;&#x542B;&#x6B64;maven&#x5DE5;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.keycloak<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>keycloak-servlet-filter-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><a name="84______&#x5728;OSGi&#x4E0A;&#x4F7F;&#x7528;"></a></p>
<h5 id="&#x5728;osgi&#x4E0A;&#x4F7F;&#x7528;"><a name="&#x5728;osgi&#x4E0A;&#x4F7F;&#x7528;" class="anchor-navigation-ex-anchor" href="#&#x5728;osgi&#x4E0A;&#x4F7F;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5728;OSGi&#x4E0A;&#x4F7F;&#x7528;</h5>
<p>servlet&#x8FC7;&#x6EE4;&#x5668;&#x9002;&#x914D;&#x5668;&#x6253;&#x5305;&#x4E3A;OSGi&#x5305;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x5728;&#x5177;&#x6709;HTTP&#x670D;&#x52A1;&#x548C;HTTP&#x767D;&#x677F;&#x7684;&#x901A;&#x7528;OSGi&#x73AF;&#x5883;&#xFF08;R6&#x53CA;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#xFF09;&#x4E2D;&#x4F7F;&#x7528;&#x3002;</p>
<p><a name="85_______&#x5B89;&#x88C5;"></a></p>
<h6 id="&#x5B89;&#x88C5;"><a name="&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B89;&#x88C5;</h6>
<p>&#x9002;&#x914D;&#x5668;&#x53CA;&#x5176;&#x4F9D;&#x8D56;&#x9879;&#x4F5C;&#x4E3A;Maven&#x5DE5;&#x4EF6;&#x5206;&#x53D1;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x9700;&#x8981;&#x4F7F;&#x7528;Internet&#x8FDE;&#x63A5;&#x6765;&#x8BBF;&#x95EE;Maven Central&#xFF0C;&#x6216;&#x8005;&#x5C06;&#x5DE5;&#x4EF6;&#x7F13;&#x5B58;&#x5728;&#x672C;&#x5730;Maven&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x3002;</p>
<p>&#x5982;&#x679C;&#x60A8;&#x4F7F;&#x7528;&#x7684;&#x662F;Apache Karaf&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4ECE;Keycloak&#x529F;&#x80FD;&#x4ED3;&#x5E93;&#x5B89;&#x88C5;&#x4E00;&#x4E2A;&#x529F;&#x80FD;&#xFF1A;</p>
<pre><code>karaf@root()&gt; feature:repo-add mvn:org.keycloak/keycloak-osgi-features/6.0.1/xml/features
karaf@root()&gt; feature:install keycloak-servlet-filter-adapter
</code></pre><p>&#x5BF9;&#x4E8E;&#x5176;&#x4ED6;OSGi&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;&#x8FD0;&#x884C;&#x65F6;&#x6587;&#x6863;&#xFF0C;&#x4E86;&#x89E3;&#x5982;&#x4F55;&#x5B89;&#x88C5;&#x9002;&#x914D;&#x5668;&#x5305;&#x53CA;&#x5176;&#x4F9D;&#x8D56;&#x9879;&#x3002;</p>
<blockquote>
<p>&#x5982;&#x679C;&#x4F60;&#x7684;OSGi&#x5E73;&#x53F0;&#x662F;&#x5E26;&#x6709;Pax Web&#x7684;Apache Karaf&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x4F7F;&#x7528;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse_adapter" target="_blank">JBoss Fuse 6</a>&#x6216;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_fuse7_adapter" target="_blank">JBoss Fuse 7</a>&#x9002;&#x914D;&#x5668;&#x3002;</p>
</blockquote>
<p><a name="86_______&#x914D;&#x7F6E;"></a></p>
<h6 id="&#x914D;&#x7F6E;"><a name="&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x914D;&#x7F6E;</h6>
<p>&#x9996;&#x5148;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;OSGi HTTP&#x670D;&#x52A1;&#x5C06;&#x9002;&#x914D;&#x5668;&#x6CE8;&#x518C;&#x4E3A;servlet&#x8FC7;&#x6EE4;&#x5668;&#x3002; &#x6700;&#x5E38;&#x89C1;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x7F16;&#x7A0B;&#xFF08;&#x4F8B;&#x5982;&#x901A;&#x8FC7;bundle&#x6FC0;&#x6D3B;&#x5668;&#xFF09;&#x548C;&#x58F0;&#x660E;&#xFF08;&#x4F7F;&#x7528;OSGi&#x6CE8;&#x91CA;&#xFF09;&#x3002; &#x6211;&#x4EEC;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x540E;&#x8005;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x7B80;&#x5316;&#x4E86;&#x52A8;&#x6001;&#x6CE8;&#x518C;&#x548C;&#x53D6;&#x6D88;&#x6CE8;&#x518C;&#x8FC7;&#x6EE4;&#x5668;&#x7684;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> mypackage;

<span class="hljs-keyword">import</span> javax.servlet.Filter;
<span class="hljs-keyword">import</span> org.keycloak.adapters.servlet.KeycloakOIDCFilter;
<span class="hljs-keyword">import</span> org.osgi.service.component.annotations.Component;
<span class="hljs-keyword">import</span> org.osgi.service.http.whiteboard.HttpWhiteboardConstants;

<span class="hljs-meta">@Component</span>(
    immediate = <span class="hljs-keyword">true</span>,
    service = Filter.class,
    property = {
        KeycloakOIDCFilter.CONFIG_FILE_PARAM + <span class="hljs-string">&quot;=&quot;</span> + <span class="hljs-string">&quot;keycloak.json&quot;</span>,
        HttpWhiteboardConstants.HTTP_WHITEBOARD_FILTER_PATTERN + <span class="hljs-string">&quot;=&quot;</span> +<span class="hljs-string">&quot;/*&quot;</span>,
        HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_SELECT + <span class="hljs-string">&quot;=&quot;</span> + <span class="hljs-string">&quot;(osgi.http.whiteboard.context.name=mycontext)&quot;</span>
    }
)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KeycloakFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">KeycloakOIDCFilter</span> </span>{
  <span class="hljs-comment">//</span>
}
</code></pre>
<p>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x4F7F;&#x7528;OSGi&#x58F0;&#x660E;&#x6027;&#x670D;&#x52A1;&#x89C4;&#x8303;&#x5C06;&#x8FC7;&#x6EE4;&#x5668;&#x516C;&#x5F00;&#x4E3A;<code>javax.servlet.Filter</code>&#x7C7B;&#x4E0B;&#x7684;OSGI&#x670D;&#x52A1;&#x3002; &#x4E00;&#x65E6;&#x5728;OSGi&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x8868;&#x4E2D;&#x53D1;&#x5E03;&#x4E86;&#x7C7B;&#xFF0C;&#x5B83;&#x5C06;&#x7531;OSGi HTTP&#x670D;&#x52A1;&#x5B9E;&#x73B0;&#x83B7;&#x53D6;&#x5E76;&#x7528;&#x4E8E;&#x8FC7;&#x6EE4;&#x5BF9;&#x6307;&#x5B9A;servlet&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x8BF7;&#x6C42;&#x3002; &#x8FD9;&#x5C06;&#x4E3A;&#x6BCF;&#x4E2A;&#x5339;&#x914D;servlet&#x4E0A;&#x4E0B;&#x6587;&#x8DEF;&#x5F84;+&#x8FC7;&#x6EE4;&#x5668;&#x8DEF;&#x5F84;&#x7684;&#x8BF7;&#x6C42;&#x89E6;&#x53D1;Keycloak&#x9002;&#x914D;&#x5668;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x7EC4;&#x4EF6;&#x5904;&#x4E8E;OSGi Configuration Admin Service&#x7684;&#x63A7;&#x5236;&#x4E4B;&#x4E0B;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x914D;&#x7F6E;&#x5176;&#x5C5E;&#x6027;&#x3002; &#x4E3A;&#x6B64;&#xFF0C;&#x8981;&#x5728;OSGi&#x8FD0;&#x884C;&#x65F6;&#x7684;&#x6807;&#x51C6;&#x914D;&#x7F6E;&#x4F4D;&#x7F6E;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>mypackage.KeycloakFilter.cfg</code>&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-properties">keycloak.config.file = /path/to/keycloak.json
osgi.http.whiteboard.filter.pattern = /secure/*
</code></pre>
<p>&#x6216;&#x8005;&#x4F7F;&#x7528;&#x4EA4;&#x4E92;&#x5F0F;&#x63A7;&#x5236;&#x53F0;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x5141;&#x8BB8;&#xFF1A;</p>
<pre><code>karaf@root()&gt; config:edit mypackage.KeycloakFilter
karaf@root()&gt; config:property-set keycloak.config.file &apos;${karaf.etc}/keycloak.json&apos;
karaf@root()&gt; config:update
</code></pre><p>&#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x66F4;&#x591A;&#x63A7;&#x5236;&#x6743;&#xFF0C;&#x4F8B;&#x5982; &#x63D0;&#x4F9B;&#x81EA;&#x5B9A;&#x4E49;<code>KeycloakConfigResolver</code>&#x6765;&#x5B9E;&#x73B0;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_multi_tenancy" target="_blank">&#x591A;&#x79DF;&#x6237;</a>&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7F16;&#x7A0B;&#x65B9;&#x5F0F;&#x6CE8;&#x518C;&#x8FC7;&#x6EE4;&#x5668;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Activator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BundleActivator</span> </span>{

  <span class="hljs-keyword">private</span> ServiceRegistration registration;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">(BundleContext context)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    Hashtable props = <span class="hljs-keyword">new</span> Hashtable();
    props.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_FILTER_PATTERN, <span class="hljs-string">&quot;/secure/*&quot;</span>);
    props.put(KeycloakOIDCFilter.CONFIG_RESOLVER_PARAM, <span class="hljs-keyword">new</span> MyConfigResolver());

    <span class="hljs-keyword">this</span>.registration = context.registerService(Filter.class.getName(), <span class="hljs-keyword">new</span> KeycloakOIDCFilter(), props);
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">(BundleContext context)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    <span class="hljs-keyword">this</span>.registration.unregister();
  }
}
</code></pre>
<p>&#x6709;&#x5173;&#x7A0B;&#x5E8F;&#x5316;&#x6CE8;&#x518C;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="http://felix.apache.org/documentation/subprojects/apache-felix-http-service.html#using-the-osgi-http-whiteboard" target="_blank">Apache Felix HTTP&#x670D;&#x52A1;</a>&#x3002;</p>
<p><a name="87_____2_1_11__JAAS_&#x63D2;&#x4EF6;"></a></p>
<h4 id="2111-jaas-&#x63D2;&#x4EF6;"><a name="2111-jaas-&#x63D2;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#2111-jaas-&#x63D2;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.11. JAAS &#x63D2;&#x4EF6;</h4>
<p>&#x901A;&#x5E38;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x5927;&#x591A;&#x6570;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;JAAS&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5982;&#x679C;&#x5B83;&#x4EEC;&#x662F;&#x57FA;&#x4E8E;HTTP&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x60A8;&#x6700;&#x6709;&#x53EF;&#x80FD;&#x9009;&#x62E9;&#x6211;&#x4EEC;&#x7684;&#x5176;&#x4ED6;&#x9002;&#x914D;&#x5668;&#x4E4B;&#x4E00;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x67D0;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x7CFB;&#x7EDF;&#x4ECD;&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x7EAF;&#x7CB9;&#x7684;&#x4F20;&#x7EDF;JAAS&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002; Keycloak&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x4E2A;&#x767B;&#x5F55;&#x6A21;&#x5757;&#x6765;&#x5E2E;&#x52A9;&#x89E3;&#x51B3;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x63D0;&#x4F9B;&#x7684;&#x767B;&#x5F55;&#x6A21;&#x5757;&#x662F;&#xFF1A;</p>
<ul>
<li><p>org.keycloak.adapters.jaas.DirectAccessGrantsLoginModule</p>
<p>&#x6B64;&#x767B;&#x5F55;&#x6A21;&#x5757;&#x5141;&#x8BB8;&#x4F7F;&#x7528;Keycloak&#x4E2D;&#x7684;&#x7528;&#x6237;&#x540D;/&#x5BC6;&#x7801;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x5B83;&#x4F7F;&#x7528;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_resource_owner_password_credentials_flow" target="_blank">&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x8BC1;</a>&#x6D41;&#x6765;&#x9A8C;&#x8BC1;&#x63D0;&#x4F9B;&#x7684;&#x7528;&#x6237;&#x540D;/&#x5BC6;&#x7801;&#x662F;&#x5426;&#x6709;&#x6548;&#x3002; &#x5B83;&#x5BF9;&#x975E;&#x57FA;&#x4E8E;Web&#x7684;&#x7CFB;&#x7EDF;&#x975E;&#x5E38;&#x6709;&#x7528;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x4F9D;&#x8D56;JAAS&#x5E76;&#x5E0C;&#x671B;&#x4F7F;&#x7528;Keycloak&#xFF0C;&#x4F46;&#x7531;&#x4E8E;&#x5176;&#x975E;Web&#x6027;&#x8D28;&#x800C;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x57FA;&#x4E8E;&#x6807;&#x51C6;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x6D41;&#x7A0B;&#x3002; &#x6B64;&#x7C7B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x793A;&#x4F8B;&#x53EF;&#x4EE5;&#x662F;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x6216;SSH&#x3002;</p>
</li>
<li><p>org.keycloak.adapters.jaas.BearerTokenLoginModule</p>
<p>&#x6B64;&#x767B;&#x5F55;&#x6A21;&#x5757;&#x5141;&#x8BB8;&#x901A;&#x8FC7;CallbackHandler&#x4F5C;&#x4E3A;&#x5BC6;&#x7801;&#x4F20;&#x9012;&#x7ED9;&#x5B83;&#x7684;Keycloak&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x60A8;&#x4ECE;&#x57FA;&#x4E8E;&#x6807;&#x51C6;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6D41;&#x7A0B;&#x83B7;&#x5F97;Keycloak&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x5E76;&#x4E14;&#x60A8;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x4E0E;&#x4F9D;&#x8D56;&#x4E8E;JAAS&#x7684;&#x5916;&#x90E8;&#x975E;&#x57FA;&#x4E8E;Web&#x7684;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x65F6;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x5F88;&#x6709;&#x7528;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x7CFB;&#x7EDF;&#x3002;</p>
</li>
</ul>
<p>&#x4E24;&#x4E2A;&#x6A21;&#x5757;&#x90FD;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x914D;&#x7F6E;&#x5C5E;&#x6027;&#xFF1A;</p>
<ul>
<li><p>keycloak-config-file</p>
<p><code>keycloak.json</code>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x4F4D;&#x7F6E;&#x3002; &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x4F4D;&#x4E8E;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F4D;&#x4E8E;&#x7C7B;&#x8DEF;&#x5F84;&#x4E0A;&#x3002; &#x5982;&#x679C;&#x5B83;&#x4F4D;&#x4E8E;&#x7C7B;&#x8DEF;&#x5F84;&#x4E0A;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x5728;&#x8BE5;&#x4F4D;&#x7F6E;&#x524D;&#x52A0;&#x4E0A;<code>classpath:</code>&#xFF08;&#x4F8B;&#x5982;<code>classpath:/path/keycloak.json</code>&#xFF09;&#x3002; &#x8FD9;&#x662F;<em>REQUIRED</em></p>
</li>
<li><p><code>role-principal-class</code></p>
<p>&#x4E3A;&#x9644;&#x52A0;&#x5230;JAAS Subject&#x7684;Role&#x4E3B;&#x4F53;&#x914D;&#x7F6E;&#x5907;&#x7528;&#x7C7B;&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>org.keycloak.adapters.jaas.RolePrincipal</code>&#x3002; &#x6CE8;&#x610F;&#xFF1A;&#x8BE5;&#x7C7B;&#x9700;&#x8981;&#x5177;&#x6709;&#x5E26;&#x6709;&#x5355;&#x4E2A;<code>String</code>&#x53C2;&#x6570;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</p>
</li>
<li><p><code>scope</code></p>
<p>&#x6B64;&#x9009;&#x9879;&#x4EC5;&#x9002;&#x7528;&#x4E8E;<code>DirectAccessGrantsLoginModule</code>&#x3002; &#x6307;&#x5B9A;&#x7684;&#x503C;&#x5C06;&#x7528;&#x4F5C;&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x636E;&#x6388;&#x4E88;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;OAuth2 <code>scope</code> &#x53C2;&#x6570;&#x3002;</p>
</li>
</ul>
<p><a name="88_____2_1_12__CLI___Desktop_&#x5E94;&#x7528;"></a></p>
<h4 id="2112-cli--desktop-&#x5E94;&#x7528;"><a name="2112-cli--desktop-&#x5E94;&#x7528;" class="anchor-navigation-ex-anchor" href="#2112-cli--desktop-&#x5E94;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.12. CLI / Desktop &#x5E94;&#x7528;</h4>
<p>Keycloak&#x652F;&#x6301;&#x901A;&#x8FC7;&#x7CFB;&#x7EDF;&#x6D4F;&#x89C8;&#x5668;&#x6267;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6B65;&#x9AA4;&#xFF0C;&#x901A;&#x8FC7;<code>KeycloakInstalled</code>adapter&#x4FDD;&#x62A4;&#x684C;&#x9762;&#xFF08;&#x4F8B;&#x5982;Swing&#xFF0C;JavaFX&#xFF09;&#x6216;CLI&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p><code>KeycloakInstalled</code>&#x9002;&#x914D;&#x5668;&#x652F;&#x6301;<code>desktop</code>&#x548C;<code>manual</code>&#x53D8;&#x4F53;&#x3002; &#x684C;&#x9762;&#x7248;&#x672C;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x6D4F;&#x89C8;&#x5668;&#x6765;&#x6536;&#x96C6;&#x7528;&#x6237;&#x51ED;&#x636E;&#x3002; &#x624B;&#x52A8;&#x53D8;&#x4F53;&#x4ECE;<code>STDIN</code>&#x8BFB;&#x53D6;&#x7528;&#x6237;&#x51ED;&#x636E;&#x3002;</p>
<p>&#x63D0;&#x793A;&#xFF1A;Google&#x5728;<a href="https://developers.google.com/identity/protocols/OAuth2InstalledApp" target="_blank">OAuth2InstalledApp</a>&#x4E0A;&#x63D0;&#x4F9B;&#x4E86;&#x6709;&#x5173;&#x6B64;&#x65B9;&#x6CD5;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x3002;</p>
<p><a name="89______&#x5B83;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;"></a></p>
<h5 id="&#x5B83;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;"><a name="&#x5B83;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;" class="anchor-navigation-ex-anchor" href="#&#x5B83;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B83;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;</h5>
<p>&#x4E3A;&#x4E86;&#x4F7F;&#x7528;<code>desktop</code>&#x53D8;&#x4F53;&#x5BF9;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;<code>KeycloakInstalled</code>&#x9002;&#x914D;&#x5668;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x684C;&#x9762;&#x6D4F;&#x89C8;&#x5668;&#x7A97;&#x53E3;&#xFF0C;&#x5F53;&#x5728;<code>KeycloakInstalled</code>&#x5BF9;&#x8C61;&#x4E0A;&#x8C03;&#x7528;<code>loginDesktop()</code>&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x7528;&#x6237;&#x4F7F;&#x7528;&#x5E38;&#x89C4;&#x7684;Keycloak&#x767B;&#x5F55;&#x9875;&#x9762;&#x8FDB;&#x884C;&#x767B;&#x5F55;&#x3002;</p>
<p>&#x4F7F;&#x7528;redirect&#x53C2;&#x6570;&#x6253;&#x5F00;&#x767B;&#x5F55;&#x9875;&#x9762;URL&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x6307;&#x5411;&#x672C;&#x5730;<code>ServerSocket</code>&#xFF0C;&#x8BE5;&#x5730;&#x5740;<code>ServerSocket</code>&#x5728;&#x7531;&#x9002;&#x914D;&#x5668;&#x542F;&#x52A8;&#x7684;<code>localhost</code>&#x4E0A;&#x7684;&#x7A7A;&#x95F2;&#x4E34;&#x65F6;&#x7AEF;&#x53E3;&#x4E0A;&#x8FDB;&#x884C;&#x4FA6;&#x542C;&#x3002;</p>
<p>&#x6210;&#x529F;&#x767B;&#x5F55;&#x540E;&#xFF0C;<code>KeycloakInstalled</code>&#x4ECE;&#x4F20;&#x5165;&#x7684;HTTP&#x8BF7;&#x6C42;&#x63A5;&#x6536;&#x6388;&#x6743;&#x4EE3;&#x7801;&#x5E76;&#x6267;&#x884C;&#x6388;&#x6743;&#x4EE3;&#x7801;&#x6D41;&#x3002; &#x4E00;&#x65E6;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x4EE3;&#x7801;&#x5B8C;&#x6210;&#xFF0C;<code>ServerSocket</code>&#x5C31;&#x4F1A;&#x5173;&#x95ED;&#x3002;</p>
<blockquote>
<p>&#x5982;&#x679C;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x6709;&#x4E00;&#x4E2A;&#x6D3B;&#x52A8;&#x7684;Keycloak&#x4F1A;&#x8BDD;&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;&#x663E;&#x793A;&#x767B;&#x5F55;&#x8868;&#x5355;&#xFF0C;&#x4F46;&#x4F1A;&#x7EE7;&#x7EED;&#x8FDB;&#x884C;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x57FA;&#x4E8E;Web&#x7684;SSO&#x5E73;&#x6ED1;&#x4F53;&#x9A8C;&#x3002;</p>
</blockquote>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x6700;&#x7EC8;&#x4F1A;&#x6536;&#x5230;&#x4EE4;&#x724C;&#xFF08;access_token&#xFF0C;refresh_token&#xFF0C;id_token&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x4EE4;&#x724C;&#x6765;&#x8C03;&#x7528;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x3002;</p>
<p><code>KeycloakInstalled</code>&#x9002;&#x914D;&#x5668;&#x652F;&#x6301;&#x66F4;&#x65B0;&#x9648;&#x65E7;&#x4EE4;&#x724C;&#x3002;</p>
<p><a name="90______&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"></a></p>
<h5 id="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><a name="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;</h5>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.keycloak<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>keycloak-installed-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><a name="91______&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"></a></p>
<h5 id="&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"><a name="&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;</h5>
<p>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x4E3A;<code>public</code> OpenID Connect&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5176;&#x4E2D;<code>Standard Flow Enabled</code>&#x548C; <a href="http://localhost:*&#x4F5C;&#x4E3A;&#x5141;&#x8BB8;&#x7684;`Valid" target="_blank">http://localhost:*&#x4F5C;&#x4E3A;&#x5141;&#x8BB8;&#x7684;`Valid</a> Redirect URI`&#x3002;</p>
<p><a name="92______&#x7528;&#x6CD5;"></a></p>
<h5 id="&#x7528;&#x6CD5;"><a name="&#x7528;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#&#x7528;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7528;&#x6CD5;</h5>
<p><code>KeycloakInstalled</code>&#x9002;&#x914D;&#x5668;&#x4ECE;&#x7C7B;&#x8DEF;&#x5F84;&#x4E0A;&#x7684;<code>META-INF/keycloak.json</code>&#x8BFB;&#x53D6;&#x5B83;&#x7684;&#x914D;&#x7F6E;&#x3002; &#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>KeycloakInstalled</code>constructor&#x4E3A;<code>InputStream</code>&#x6216;<code>KeycloakDeployment</code>&#x63D0;&#x4F9B;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x3002;</p>
<p>&#x5728;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;<code>desktop-app</code>&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;<code>keycloak.json</code>&#xFF1A;</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;realm&quot;</span>: <span class="hljs-string">&quot;desktop-app-auth&quot;</span>,
  <span class="hljs-string">&quot;auth-server-url&quot;</span>: <span class="hljs-string">&quot;http://localhost:8081/auth&quot;</span>,
  <span class="hljs-string">&quot;ssl-required&quot;</span>: <span class="hljs-string">&quot;external&quot;</span>,
  <span class="hljs-string">&quot;resource&quot;</span>: <span class="hljs-string">&quot;desktop-app&quot;</span>,
  <span class="hljs-string">&quot;public-client&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;use-resource-role-mappings&quot;</span>: <span class="hljs-literal">true</span>
}
</code></pre>
<p>&#x4E0B;&#x9762;&#x7684;&#x8349;&#x56FE;&#x6F14;&#x793A;&#x4E86;&#x5982;&#x4F55;&#x4F7F;&#x7528;<code>KeycloakInstalled</code>&#x9002;&#x914D;&#x5668;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-comment">// reads the configuration from classpath: META-INF/keycloak.json</span>
KeycloakInstalled keycloak = <span class="hljs-keyword">new</span> KeycloakInstalled();

<span class="hljs-comment">// opens desktop browser</span>
keycloak.loginDesktop();

AccessToken token = keycloak.getToken();
<span class="hljs-comment">// use token to send backend request</span>

<span class="hljs-comment">// ensure token is valid for at least 30 seconds</span>
<span class="hljs-keyword">long</span> minValidity = <span class="hljs-number">30L</span>;
String tokenString = keycloak.getTokenString(minValidity, TimeUnit.SECONDS);


 <span class="hljs-comment">// when you want to logout the user.</span>
keycloak.logout();
</code></pre>
<blockquote>
<p><code>KeycloakInstalled</code>&#x7C7B;&#x652F;&#x6301;&#x901A;&#x8FC7;<code>loginResponseWriter</code>&#x548C;<code>logoutResponseWriter</code>&#x5C5E;&#x6027;&#x81EA;&#x5B9A;&#x4E49;&#x767B;&#x5F55;/&#x6CE8;&#x9500;&#x8BF7;&#x6C42;&#x8FD4;&#x56DE;&#x7684;http&#x54CD;&#x5E94;&#x3002;</p>
</blockquote>
<p><a name="93______&#x4F8B;&#x5B50;"></a></p>
<h5 id="&#x4F8B;&#x5B50;"><a name="&#x4F8B;&#x5B50;" class="anchor-navigation-ex-anchor" href="#&#x4F8B;&#x5B50;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F8B;&#x5B50;</h5>
<p>&#x4EE5;&#x4E0B;&#x63D0;&#x4F9B;&#x4E86;&#x4E0A;&#x8FF0;&#x914D;&#x7F6E;&#x7684;&#x793A;&#x4F8B;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">import</span> java.util.Locale;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">import</span> org.keycloak.adapters.installed.KeycloakInstalled;
<span class="hljs-keyword">import</span> org.keycloak.representations.AccessToken;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DesktopApp</span> </span>{

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{

                KeycloakInstalled keycloak = <span class="hljs-keyword">new</span> KeycloakInstalled();
                keycloak.setLocale(Locale.ENGLISH);
                keycloak.loginDesktop();

                AccessToken token = keycloak.getToken();
                Executors.newSingleThreadExecutor().submit(() -&gt; {

                        System.out.println(<span class="hljs-string">&quot;Logged in...&quot;</span>);
                        System.out.println(<span class="hljs-string">&quot;Token: &quot;</span> + token.getSubject());
                        System.out.println(<span class="hljs-string">&quot;Username: &quot;</span> + token.getPreferredUsername());
                        <span class="hljs-keyword">try</span> {
                                System.out.println(<span class="hljs-string">&quot;AccessToken: &quot;</span> + keycloak.getTokenString());
                        } <span class="hljs-keyword">catch</span> (Exception ex) {
                                ex.printStackTrace();
                        }

                        <span class="hljs-keyword">int</span> timeoutSeconds = <span class="hljs-number">20</span>;
                        System.out.printf(<span class="hljs-string">&quot;Logging out in...%d Seconds%n&quot;</span>, timeoutSeconds);
                        <span class="hljs-keyword">try</span> {
                                TimeUnit.SECONDS.sleep(timeoutSeconds);
                        } <span class="hljs-keyword">catch</span> (Exception e) {
                                e.printStackTrace();
                        }

                        <span class="hljs-keyword">try</span> {
                                keycloak.logout();
                        } <span class="hljs-keyword">catch</span> (Exception e) {
                                e.printStackTrace();
                        }

                        System.out.println(<span class="hljs-string">&quot;Exiting...&quot;</span>);
                        System.exit(<span class="hljs-number">0</span>);
                });
        }
}
</code></pre>
<p><a name="94_____2_1_13__&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;"></a></p>
<h4 id="2113-&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;"><a name="2113-&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;" class="anchor-navigation-ex-anchor" href="#2113-&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.13. &#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;</h4>
<p>&#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>KeycloakSecurityContext</code>&#x63A5;&#x53E3;&#x3002; &#x5982;&#x679C;&#x8981;&#x4ECE;&#x4EE4;&#x724C;&#x4E2D;&#x68C0;&#x7D22;&#x5176;&#x4ED6;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF08;&#x4F8B;&#x5982;&#x7528;&#x6237;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4FE1;&#x606F;&#xFF09;&#xFF0C;&#x6216;&#x8005;&#x8981;&#x8C03;&#x7528;&#x53D7;Keycloak&#x4FDD;&#x62A4;&#x7684;RESTful&#x670D;&#x52A1;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x5F88;&#x6709;&#x7528;&#x3002;</p>
<p>&#x5728;servlet&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5B83;&#x5728;&#x5B89;&#x5168;&#x8C03;&#x7528;&#x4E2D;&#x53EF;&#x7528;&#x4F5C;HttpServletRequest&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#xFF1A;</p>
<pre><code class="lang-java">httpServletRequest
    .getAttribute(KeycloakSecurityContext.class.getName());
</code></pre>
<p>&#x6216;&#x8005;&#xFF0C;&#x5B83;&#x5728;HttpSession&#x4E2D;&#x7684;&#x4E0D;&#x5B89;&#x5168;&#x8BF7;&#x6C42;&#x4E2D;&#x53EF;&#x7528;&#xFF1A;</p>
<pre><code>httpServletRequest.getSession()
    .getAttribute(KeycloakSecurityContext.class.getName());
</code></pre><p><a name="95_____2_1_14__&#x9519;&#x8BEF;&#x5904;&#x7406;"></a></p>
<h4 id="2114-&#x9519;&#x8BEF;&#x5904;&#x7406;"><a name="2114-&#x9519;&#x8BEF;&#x5904;&#x7406;" class="anchor-navigation-ex-anchor" href="#2114-&#x9519;&#x8BEF;&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.14. &#x9519;&#x8BEF;&#x5904;&#x7406;</h4>
<p>Keycloak&#x4E3A;&#x57FA;&#x4E8E;servlet&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x529F;&#x80FD;&#x3002; &#x5728;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x4E2D;&#x9047;&#x5230;&#x9519;&#x8BEF;&#x65F6;&#xFF0C;Keycloak&#x5C06;&#x8C03;&#x7528;<code>HttpServletResponse.sendError()</code>&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x5728;<code>web.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x9875;&#x9762;&#x6765;&#x5904;&#x7406;&#x60A8;&#x60F3;&#x8981;&#x7684;&#x9519;&#x8BEF;&#x3002; Keycloak&#x53EF;&#x80FD;&#x4F1A;&#x4E22;&#x5931;400,401,403&#x548C;500&#x9519;&#x8BEF;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">error-page</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">error-code</span>&gt;</span>403<span class="hljs-tag">&lt;/<span class="hljs-name">error-code</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">location</span>&gt;</span>/ErrorHandler<span class="hljs-tag">&lt;/<span class="hljs-name">location</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">error-page</span>&gt;</span>
</code></pre>
<p>Keycloak&#x8FD8;&#x8BBE;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x68C0;&#x7D22;&#x7684;<code>HttpServletRequest</code>&#x5C5E;&#x6027;&#x3002; &#x5C5E;&#x6027;&#x540D;&#x79F0;&#x662F;<code>org.keycloak.adapters.spi.AuthenticationError</code>&#xFF0C;&#x5E94;&#x8BE5;&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A;<code>org.keycloak.adapters.OIDCAuthenticationError</code>&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">import</span> org.keycloak.adapters.OIDCAuthenticationError;
<span class="hljs-keyword">import</span> org.keycloak.adapters.OIDCAuthenticationError.Reason;
...

OIDCAuthenticationError error = (OIDCAuthenticationError) httpServletRequest
    .getAttribute(<span class="hljs-string">&apos;org.keycloak.adapters.spi.AuthenticationError&apos;</span>);

Reason reason = error.getReason();
System.out.println(reason.name());
</code></pre>
<p><a name="96_____2_1_15__&#x6CE8;&#x9500;"></a></p>
<h4 id="2115-&#x6CE8;&#x9500;"><a name="2115-&#x6CE8;&#x9500;" class="anchor-navigation-ex-anchor" href="#2115-&#x6CE8;&#x9500;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.15. &#x6CE8;&#x9500;</h4>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x591A;&#x79CD;&#x65B9;&#x5F0F;&#x6CE8;&#x9500;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x5BF9;&#x4E8E;Java EE servlet&#x5BB9;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x8C03;&#x7528;<code>HttpServletRequest.logout()</code>&#x3002; &#x5BF9;&#x4E8E;&#x5176;&#x4ED6;&#x6D4F;&#x89C8;&#x5668;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x6D4F;&#x89C8;&#x5668;&#x91CD;&#x5B9A;&#x5411;&#x5230;<code>http://auth-server/auth/realms/{realm-name}/protocol/openid-connect/logout?redirect_uri=encodedRedirectUri</code>&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x6709;&#x4E0E;&#x60A8;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x8FDB;&#x884C;SSO&#x4F1A;&#x8BDD;&#x3002;</p>
<p>&#x5F53;&#x4F7F;&#x7528;<code>HttpServletRequest.logout()</code>&#x9009;&#x9879;&#x65F6;&#xFF0C;&#x9002;&#x914D;&#x5668;&#x5BF9;&#x4F20;&#x9012;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x7684;Keycloak&#x670D;&#x52A1;&#x5668;&#x6267;&#x884C;&#x53CD;&#x5411;&#x901A;&#x9053;POST&#x8C03;&#x7528;&#x3002; &#x5982;&#x679C;&#x8BE5;&#x65B9;&#x6CD5;&#x662F;&#x4ECE;&#x672A;&#x53D7;&#x4FDD;&#x62A4;&#x7684;&#x9875;&#x9762;&#xFF08;&#x4E0D;&#x68C0;&#x67E5;&#x6709;&#x6548;&#x4EE4;&#x724C;&#x7684;&#x9875;&#x9762;&#xFF09;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x5219;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x53EF;&#x80FD;&#x4E0D;&#x53EF;&#x7528;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x9002;&#x914D;&#x5668;&#x4F1A;&#x8DF3;&#x8FC7;&#x8BE5;&#x8C03;&#x7528;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x53D7;&#x4FDD;&#x62A4;&#x7684;&#x9875;&#x9762;&#x6765;&#x6267;&#x884C;<code>HttpServletRequest.logout()</code>&#xFF0C;&#x4EE5;&#x4FBF;&#x59CB;&#x7EC8;&#x8003;&#x8651;&#x5F53;&#x524D;&#x4EE4;&#x724C;&#xFF0C;&#x5E76;&#x5728;&#x9700;&#x8981;&#x65F6;&#x6267;&#x884C;&#x4E0E;Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;&#x4EA4;&#x4E92;&#x3002;</p>
<p>&#x5982;&#x679C;&#x60A8;&#x5E0C;&#x671B;&#x5728;&#x6CE8;&#x9500;&#x8FC7;&#x7A0B;&#x4E2D;&#x907F;&#x514D;&#x6CE8;&#x9500;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x53C2;&#x6570;<code>initiating_idp</code>&#xFF0C;&#x5176;&#x503C;&#x4E3A;&#x76F8;&#x5173;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x7684;&#x6807;&#x8BC6;&#xFF08;&#x522B;&#x540D;&#xFF09;&#x3002; &#x5F53;&#x6CE8;&#x9500;&#x7AEF;&#x70B9;&#x4F5C;&#x4E3A;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x542F;&#x52A8;&#x7684;&#x5355;&#x4E00;&#x6CE8;&#x9500;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x8FD9;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p>
<p><a name="97_____2_1_16__&#x53C2;&#x6570;&#x8F6C;&#x53D1;"></a></p>
<h4 id="2116-&#x53C2;&#x6570;&#x8F6C;&#x53D1;"><a name="2116-&#x53C2;&#x6570;&#x8F6C;&#x53D1;" class="anchor-navigation-ex-anchor" href="#2116-&#x53C2;&#x6570;&#x8F6C;&#x53D1;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.16. &#x53C2;&#x6570;&#x8F6C;&#x53D1;</h4>
<p>Keycloak&#x521D;&#x59CB;&#x6388;&#x6743;&#x7AEF;&#x70B9;&#x8BF7;&#x6C42;&#x652F;&#x6301;&#x5404;&#x79CD;&#x53C2;&#x6570;&#x3002; &#x5927;&#x591A;&#x6570;&#x53C2;&#x6570;&#x5728;<a href="https://openid.net/specs/openid-connect-core-1_0.html#AuthorizationEndpoint" target="_blank">OIDC&#x89C4;&#x8303;</a>&#x4E2D;&#x63CF;&#x8FF0;&#x3002; &#x67D0;&#x4E9B;&#x53C2;&#x6570;&#x7531;&#x9002;&#x914D;&#x5668;&#x6839;&#x636E;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x81EA;&#x52A8;&#x6DFB;&#x52A0;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x5728;&#x6BCF;&#x6B21;&#x8C03;&#x7528;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x53C2;&#x6570;&#x3002; &#x6253;&#x5F00;&#x53D7;&#x4FDD;&#x62A4;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;URI&#x65F6;&#xFF0C;&#x7279;&#x5B9A;&#x53C2;&#x6570;&#x5C06;&#x8F6C;&#x53D1;&#x5230;Keycloak&#x6388;&#x6743;&#x7AEF;&#x70B9;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x8BF7;&#x6C42;&#x8131;&#x673A;&#x4EE4;&#x724C;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>scope</code>&#x53C2;&#x6570;&#x6253;&#x5F00;&#x53D7;&#x4FDD;&#x62A4;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;URI&#xFF0C;&#x5982;&#xFF1A;</p>
<pre><code>http://myappserver/mysecuredapp?scope=offline_access
</code></pre><p>&#x5E76;&#x4E14;&#x53C2;&#x6570;<code>scope = offline_access</code>&#x5C06;&#x81EA;&#x52A8;&#x8F6C;&#x53D1;&#x5230;Keycloak&#x6388;&#x6743;&#x7AEF;&#x70B9;&#x3002;</p>
<p>&#x652F;&#x6301;&#x7684;&#x53C2;&#x6570;&#x662F;&#xFF1A;</p>
<ul>
<li>scope - &#x4F7F;&#x7528;&#x4EE5;&#x7A7A;&#x683C;&#x5206;&#x9694;&#x7684;&#x8303;&#x56F4;&#x5217;&#x8868;&#x3002; &#x4EE5;&#x7A7A;&#x683C;&#x5206;&#x9694;&#x7684;&#x5217;&#x8868;&#x901A;&#x5E38;&#x5F15;&#x7528;&#x5728;&#x7279;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x5B9A;&#x4E49;&#x7684;<a href="https://www.keycloak.org/docs/6.0/server_admin/#_client_scopes" target="_blank">&#x5BA2;&#x6237;&#x7AEF;&#x8303;&#x56F4;</a>&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x8303;&#x56F4;<code>openid</code>&#x5C06;&#x59CB;&#x7EC8;&#x7531;&#x9002;&#x914D;&#x5668;&#x6DFB;&#x52A0;&#x5230;&#x4F5C;&#x7528;&#x57DF;&#x5217;&#x8868;&#x4E2D;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x8F93;&#x5165;&#x8303;&#x56F4;&#x9009;&#x9879;<code>address phone</code>&#xFF0C;&#x5219;&#x5BF9;Keycloak&#x7684;&#x8BF7;&#x6C42;&#x5C06;&#x5305;&#x542B;&#x8303;&#x56F4;&#x53C2;&#x6570;<code>scope=openid address phone</code>&#x3002;</li>
<li>prompt - Keycloak&#x652F;&#x6301;&#x4EE5;&#x4E0B;&#x8BBE;&#x7F6E;&#xFF1A;<ul>
<li><code>login</code> - &#x5373;&#x4F7F;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x4E5F;&#x4F1A;&#x5FFD;&#x7565;SSO&#x5E76;&#x59CB;&#x7EC8;&#x663E;&#x793A;Keycloak&#x767B;&#x5F55;&#x9875;&#x9762;</li>
<li><code>consent</code> - &#x4EC5;&#x9002;&#x7528;&#x4E8E;<code>Consent Required(&#x9700;&#x8981;&#x540C;&#x610F;)</code>&#x7684;&#x5BA2;&#x6237;&#x3002; &#x5982;&#x679C;&#x4F7F;&#x7528;&#x5B83;&#xFF0C;&#x5373;&#x4F7F;&#x7528;&#x6237;&#x5148;&#x524D;&#x5DF2;&#x540C;&#x610F;&#x6B64;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E5F;&#x5C06;&#x59CB;&#x7EC8;&#x663E;&#x793A;&#x201C;&#x540C;&#x610F;&#x201D;&#x9875;&#x9762;&#x3002;</li>
<li><code>none</code> - &#x767B;&#x5F55;&#x9875;&#x9762;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x663E;&#x793A;; &#x76F8;&#x53CD;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x6237;&#x5C1A;&#x672A;&#x901A;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5219;&#x4F1A;&#x5C06;&#x7528;&#x6237;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5E76;&#x663E;&#x793A;&#x9519;&#x8BEF;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x5141;&#x8BB8;&#x60A8;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7AEF;&#x521B;&#x5EFA;&#x8FC7;&#x6EE4;&#x5668;/&#x62E6;&#x622A;&#x5668;&#xFF0C;&#x5E76;&#x5411;&#x7528;&#x6237;&#x663E;&#x793A;&#x81EA;&#x5B9A;&#x4E49;&#x9519;&#x8BEF;&#x9875;&#x9762;&#x3002; &#x8BF7;&#x53C2;&#x9605;&#x89C4;&#x8303;&#x4E2D;&#x7684;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x3002;</li>
</ul>
</li>
<li>max_age - &#x4EC5;&#x5728;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65F6;&#x4F7F;&#x7528;&#x3002; &#x6307;&#x5B9A;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6301;&#x7EED;&#x7684;&#x6700;&#x957F;&#x5141;&#x8BB8;&#x65F6;&#x95F4;&#xFF08;&#x4ECE;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65F6;&#x5F00;&#x59CB;&#x8BA1;&#x7B97;&#xFF09;&#x3002; &#x5982;&#x679C;&#x7528;&#x6237;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65F6;&#x95F4;&#x8D85;&#x8FC7;<code>maxAge</code>&#xFF0C;&#x5219;&#x4F1A;&#x5FFD;&#x7565;SSO&#x5E76;&#x4E14;&#x5FC5;&#x987B;&#x91CD;&#x65B0;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;</li>
<li>login_hint - &#x7528;&#x4E8E;&#x9884;&#x586B;&#x5145;&#x767B;&#x5F55;&#x8868;&#x5355;&#x4E0A;&#x7684;&#x7528;&#x6237;&#x540D;/&#x7535;&#x5B50;&#x90AE;&#x4EF6;&#x5B57;&#x6BB5;&#x3002;</li>
<li>kc_idp_hint - &#x7528;&#x4E8E;&#x544A;&#x8BC9;Keycloak&#x8DF3;&#x8FC7;&#x663E;&#x793A;&#x767B;&#x5F55;&#x9875;&#x9762;&#x5E76;&#x81EA;&#x52A8;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#x3002; <a href="https://www.keycloak.org/docs/6.0/server_admin/#_client_suggested_idp" target="_blank">&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x6587;&#x6863;</a>&#x4E2D;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x3002;</li>
</ul>
<p>&#x5927;&#x591A;&#x6570;&#x53C2;&#x6570;&#x5728;<a href="https://openid.net/specs/openid-connect-core-1_0.html#AuthorizationEndpoint" target="_blank">OIDC&#x89C4;&#x8303;</a>&#x4E2D;&#x63CF;&#x8FF0;&#x3002; &#x552F;&#x4E00;&#x7684;&#x4F8B;&#x5916;&#x662F;&#x53C2;&#x6570;<code>kc_idp_hint</code>&#xFF0C;&#x5B83;&#x7279;&#x5B9A;&#x4E8E;Keycloak&#x5E76;&#x5305;&#x542B;&#x8981;&#x81EA;&#x52A8;&#x4F7F;&#x7528;&#x7684;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#x7684;&#x540D;&#x79F0;&#x3002; &#x6709;&#x5173;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_admin/" target="_blank">&#x670D;&#x52A1;&#x5668;&#x7BA1;&#x7406;&#x6307;&#x5357;</a>&#x4E2D;&#x7684;<code>Identity Brokering</code>&#x90E8;&#x5206;&#x3002;</p>
<blockquote>
<p>&#x5982;&#x679C;&#x4F7F;&#x7528;&#x9644;&#x52A0;&#x53C2;&#x6570;&#x6253;&#x5F00;URL&#xFF0C;&#x5219;&#x5982;&#x679C;&#x5DF2;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5219;&#x9002;&#x914D;&#x5668;&#x4E0D;&#x4F1A;&#x5C06;&#x60A8;&#x91CD;&#x5B9A;&#x5411;&#x5230;Keycloak&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x5DF2;&#x7ECF;&#x5BF9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;<code>mysecredapp</code>&#x8FDB;&#x884C;&#x4E86;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5219;&#x6253;&#x5F00;<code>http://myappserver/mysecuredapp?prompt=login</code>&#x5C06;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x60A8;&#x91CD;&#x5B9A;&#x5411;&#x5230;Keycloak&#x767B;&#x5F55;&#x9875;&#x9762;&#x3002; &#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x66F4;&#x6539;&#x6B64;&#x884C;&#x4E3A;&#x3002;</p>
</blockquote>
<p><a name="98_____2_1_17__&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"></a></p>
<h4 id="2117-&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><a name="2117-&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;" class="anchor-navigation-ex-anchor" href="#2117-&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.17. &#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;</h4>
<p>&#x5F53;&#x673A;&#x5BC6;OIDC&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x53D1;&#x9001;&#x53CD;&#x5411;&#x4FE1;&#x9053;&#x8BF7;&#x6C42;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x4EA4;&#x6362;&#x4EE4;&#x724C;&#x4EE3;&#x7801;&#x6216;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#xFF09;&#x65F6;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x9488;&#x5BF9;Keycloak&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6709;&#x4E09;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x5BF9;&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;ID&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#xFF0C;&#x4F7F;&#x7528;&#x7B7E;&#x540D;JWT&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x6216;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x7684;&#x7B7E;&#x540D;JWT&#x8FDB;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;</p>
<p><a name="99______&#x5BA2;&#x6237;&#x7AEF;ID&#x548C;&#x5BA2;&#x6237;&#x7AEF;Secret"></a></p>
<h5 id="&#x5BA2;&#x6237;&#x7AEF;id&#x548C;&#x5BA2;&#x6237;&#x7AEF;secret"><a name="&#x5BA2;&#x6237;&#x7AEF;id&#x548C;&#x5BA2;&#x6237;&#x7AEF;secret" class="anchor-navigation-ex-anchor" href="#&#x5BA2;&#x6237;&#x7AEF;id&#x548C;&#x5BA2;&#x6237;&#x7AEF;secret"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5BA2;&#x6237;&#x7AEF;ID&#x548C;&#x5BA2;&#x6237;&#x7AEF;Secret</h5>
<p>&#x8FD9;&#x662F;OAuth2&#x89C4;&#x8303;&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x4F20;&#x7EDF;&#x65B9;&#x6CD5;&#x3002; &#x5BA2;&#x6237;&#x7AEF;&#x6709;&#x4E00;&#x4E2A;secret&#xFF0C;&#x9700;&#x8981;&#x77E5;&#x9053;&#x9002;&#x914D;&#x5668;&#xFF08;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF09;&#x548C;Keycloak&#x670D;&#x52A1;&#x5668;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x5728;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x4E3A;&#x7279;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x751F;&#x6210;&#x5BC6;&#x7801;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x6B64;&#x5BC6;&#x94A5;&#x7C98;&#x8D34;&#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7AEF;&#x7684;<code>keycloak.json</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-string">&quot;credentials&quot;</span>: {
    <span class="hljs-string">&quot;secret&quot;</span>: <span class="hljs-string">&quot;19666a4f-32dd-4049-b082-684c74115f28&quot;</span>
}
</code></pre>
<p><a name="100______&#x4F7F;&#x7528;&#x7B7E;&#x540D;JWT&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"></a></p>
<h5 id="&#x4F7F;&#x7528;&#x7B7E;&#x540D;jwt&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><a name="&#x4F7F;&#x7528;&#x7B7E;&#x540D;jwt&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;&#x7B7E;&#x540D;jwt&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;&#x7B7E;&#x540D;JWT&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;</h5>
<p>&#x8FD9;&#x57FA;&#x4E8E;<a href="https://tools.ietf.org/html/rfc7523" target="_blank">RFC7523</a>&#x89C4;&#x8303;&#x3002; &#x5B83;&#x4EE5;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5DE5;&#x4F5C;&#xFF1A;</p>
<ul>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x5FC5;&#x987B;&#x5177;&#x6709;&#x79C1;&#x94A5;&#x548C;&#x8BC1;&#x4E66;&#x3002; &#x5BF9;&#x4E8E;Keycloak&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F20;&#x7EDF;&#x7684;<code>keystore</code>&#x6587;&#x4EF6;&#x83B7;&#x5F97;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x7C7B;&#x8DEF;&#x5F84;&#x4E0A;&#x6216;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x67D0;&#x4E2A;&#x4F4D;&#x7F6E;&#x83B7;&#x5F97;&#x3002;</li>
<li>&#x542F;&#x52A8;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x540E;&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x4F7F;&#x7528;URL&#x7B49;<a href="https://self-issued.info/docs/draft-ietf-jose-json-web-key.html" target="_blank">JWKS</a>&#x683C;&#x5F0F;&#x4E0B;&#x8F7D;&#x5176;&#x516C;&#x94A5;&#x3002; &#x4F5C;&#x4E3A;<a href="http://myhost.com/myapp/k_jwks&#xFF0C;&#x5047;&#x8BBE;http://myhost.com/myapp&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x57FA;&#x672C;URL&#x3002;" target="_blank">http://myhost.com/myapp/k_jwks&#xFF0C;&#x5047;&#x8BBE;http://myhost.com/myapp&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x57FA;&#x672C;URL&#x3002;</a> Keycloak&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6B64;URL&#xFF08;&#x89C1;&#x4E0B;&#x6587;&#xFF09;&#x3002;</li>
<li>&#x5728;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x671F;&#x95F4;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x751F;&#x6210;JWT&#x4EE4;&#x724C;&#x5E76;&#x4F7F;&#x7528;&#x5176;&#x79C1;&#x94A5;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x7B7E;&#x540D;&#xFF0C;&#x5E76;&#x5728;<code>client_assertion</code>&#x53C2;&#x6570;&#x4E2D;&#x7684;&#x7279;&#x5B9A;&#x53CD;&#x5411;&#x901A;&#x9053;&#x8BF7;&#x6C42;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x4EE3;&#x7801;&#x5230;&#x4EE4;&#x724C;&#x8BF7;&#x6C42;&#xFF09;&#x4E2D;&#x5C06;&#x5176;&#x53D1;&#x9001;&#x5230;Keycloak&#x3002;</li>
<li>Keycloak&#x5FC5;&#x987B;&#x5177;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x516C;&#x94A5;&#x6216;&#x8BC1;&#x4E66;&#xFF0C;&#x4EE5;&#x4FBF;&#x5B83;&#x53EF;&#x4EE5;&#x9A8C;&#x8BC1;JWT&#x4E0A;&#x7684;&#x7B7E;&#x540D;&#x3002; &#x5728;Keycloak&#x4E2D;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x636E;&#x3002; &#x9996;&#x5148;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x9009;&#x62E9;<code>Signed JWT</code>&#x4F5C;&#x4E3A;&#x5728;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x7684;&#x201C;&#x51ED;&#x636E;&#x201D;&#x9009;&#x9879;&#x5361;&#x4E2D;&#x9A8C;&#x8BC1;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x65B9;&#x6CD5;&#x3002; &#x7136;&#x540E;&#x4F60;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#xFF1A;<ul>
<li>&#x914D;&#x7F6E;JWKS URL&#xFF0C;Keycloak&#x53EF;&#x4EE5;&#x5728;&#x5176;&#x4E2D;&#x4E0B;&#x8F7D;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x516C;&#x94A5;&#x3002; &#x8FD9;&#x53EF;&#x4EE5;&#x662F;&#x8BF8;&#x5982;<a href="http://myhost.com/myapp/k_jwks&#x4E4B;&#x7C7B;&#x7684;URL&#xFF08;&#x53C2;&#x89C1;&#x4E0A;&#x9762;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF09;&#x3002;" target="_blank">http://myhost.com/myapp/k_jwks&#x4E4B;&#x7C7B;&#x7684;URL&#xFF08;&#x53C2;&#x89C1;&#x4E0A;&#x9762;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF09;&#x3002;</a> &#x6B64;&#x9009;&#x9879;&#x662F;&#x6700;&#x7075;&#x6D3B;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x65CB;&#x8F6C;&#x5176;&#x952E;&#xFF0C;&#x7136;&#x540E;Keycloak&#x603B;&#x662F;&#x5728;&#x9700;&#x8981;&#x65F6;&#x4E0B;&#x8F7D;&#x65B0;&#x5BC6;&#x94A5;&#x800C;&#x65E0;&#x9700;&#x66F4;&#x6539;&#x914D;&#x7F6E;&#x3002; &#x66F4;&#x51C6;&#x786E;&#x5730;&#x8BF4;&#xFF0C;Keycloak&#x5728;&#x770B;&#x5230;&#x7531;&#x672A;&#x77E5;&#x7684;<code>kid</code>&#xFF08;&#x5BC6;&#x94A5;ID&#xFF09;&#x7B7E;&#x540D;&#x7684;&#x4EE4;&#x724C;&#x65F6;&#x4E0B;&#x8F7D;&#x65B0;&#x5BC6;&#x94A5;&#x3002;</li>
<li>&#x4EE5;PEM&#x683C;&#x5F0F;&#xFF0C;JWK&#x683C;&#x5F0F;&#x6216;&#x4ECE;&#x5BC6;&#x94A5;&#x5E93;&#x4E0A;&#x8F7D;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x516C;&#x94A5;&#x6216;&#x8BC1;&#x4E66;&#x3002; &#x4F7F;&#x7528;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x516C;&#x94A5;&#x662F;&#x786C;&#x7F16;&#x7801;&#x7684;&#xFF0C;&#x5FC5;&#x987B;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x751F;&#x6210;&#x65B0;&#x5BC6;&#x94A5;&#x5BF9;&#x65F6;&#x8FDB;&#x884C;&#x66F4;&#x6539;&#x3002; &#x5982;&#x679C;&#x60A8;&#x6CA1;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x5BC6;&#x94A5;&#x5E93;&#xFF0C;&#x60A8;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x4ECE;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x751F;&#x6210;&#x81EA;&#x5DF1;&#x7684;&#x5BC6;&#x94A5;&#x5E93;&#x3002; &#x6709;&#x5173;&#x5982;&#x4F55;&#x8BBE;&#x7F6E;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x7684;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_admin/" target="_blank">&#x670D;&#x52A1;&#x5668;&#x7BA1;&#x7406;&#x6307;&#x5357;</a>&#x3002;</li>
</ul>
</li>
</ul>
<p>&#x8981;&#x5728;&#x9002;&#x914D;&#x5668;&#x7AEF;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x5728;<code>keycloak.json</code>&#x6587;&#x4EF6;&#x4E2D;&#x4F7F;&#x7528;&#x8FD9;&#x6837;&#x7684;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre><code class="lang-json"><span class="hljs-string">&quot;credentials&quot;</span>: {
  <span class="hljs-string">&quot;jwt&quot;</span>: {
    <span class="hljs-string">&quot;client-keystore-file&quot;</span>: <span class="hljs-string">&quot;classpath:keystore-client.jks&quot;</span>,
    <span class="hljs-string">&quot;client-keystore-type&quot;</span>: <span class="hljs-string">&quot;JKS&quot;</span>,
    <span class="hljs-string">&quot;client-keystore-password&quot;</span>: <span class="hljs-string">&quot;storepass&quot;</span>,
    <span class="hljs-string">&quot;client-key-password&quot;</span>: <span class="hljs-string">&quot;keypass&quot;</span>,
    <span class="hljs-string">&quot;client-key-alias&quot;</span>: <span class="hljs-string">&quot;clientkey&quot;</span>,
    <span class="hljs-string">&quot;token-expiration&quot;</span>: <span class="hljs-number">10</span>
  }
}
</code></pre>
<p>&#x4F7F;&#x7528;&#x6B64;&#x914D;&#x7F6E;&#xFF0C;&#x5BC6;&#x94A5;&#x5E93;&#x6587;&#x4EF6;<code>keystore-client.jks</code>&#x5FC5;&#x987B;&#x5728;WAR&#x4E2D;&#x7684;&#x7C7B;&#x8DEF;&#x5F84;&#x4E0A;&#x53EF;&#x7528;&#x3002; &#x5982;&#x679C;&#x4E0D;&#x4F7F;&#x7528;&#x524D;&#x7F00;<code>classpath:</code>&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x6307;&#x5411;&#x8FD0;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x83B7;&#x5F97;&#x7075;&#x611F;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x793A;&#x4F8B;&#x5206;&#x53D1;&#x5230;&#x4E3B;&#x8981;&#x6F14;&#x793A;&#x793A;&#x4F8B;&#x4E2D;&#x7684;<code>product-portal</code>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p><a name="101______&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x4F7F;&#x7528;&#x7B7E;&#x540D;JWT&#x8FDB;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"></a></p>
<h5 id="&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x4F7F;&#x7528;&#x7B7E;&#x540D;jwt&#x8FDB;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><a name="&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x4F7F;&#x7528;&#x7B7E;&#x540D;jwt&#x8FDB;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x4F7F;&#x7528;&#x7B7E;&#x540D;jwt&#x8FDB;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x4F7F;&#x7528;&#x7B7E;&#x540D;JWT&#x8FDB;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;</h5>
<p>&#x8FD9;&#x4E0E;&#x4F7F;&#x7528;&#x7B7E;&#x540D;JWT&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x76F8;&#x540C;&#xFF0C;&#x9664;&#x4E86;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x800C;&#x4E0D;&#x662F;&#x79C1;&#x94A5;&#x548C;&#x8BC1;&#x4E66;&#x3002;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x6709;&#x4E00;&#x4E2A;<code>secret(&#x79D8;&#x5BC6;)</code>&#xFF0C;&#x9700;&#x8981;&#x77E5;&#x9053;&#x9002;&#x914D;&#x5668;&#xFF08;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF09;&#x548C;Keycloak&#x670D;&#x52A1;&#x5668;&#x3002; &#x60A8;&#x9700;&#x8981;&#x9009;&#x62E9;<code>Signed JWT with Client Secret</code>&#x4F5C;&#x4E3A;&#x5728;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x7684;<code>Credentials&#x51ED;&#x636E;</code>&#x9009;&#x9879;&#x5361;&#x4E2D;&#x9A8C;&#x8BC1;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x6B64;<code>secret(&#x79D8;&#x5BC6;)</code>&#x7C98;&#x8D34;&#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7AEF;&#x7684;<code>keycloak.json</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF1A;</p>
<pre><code class="lang-json"><span class="hljs-string">&quot;credentials&quot;</span>: {
  <span class="hljs-string">&quot;secret-jwt&quot;</span>: {
    <span class="hljs-string">&quot;secret&quot;</span>: <span class="hljs-string">&quot;19666a4f-32dd-4049-b082-684c74115f28&quot;</span>
  }
}
</code></pre>
<p><a name="102______&#x6DFB;&#x52A0;&#x81EA;&#x5DF1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65B9;&#x6CD5;"></a></p>
<h5 id="&#x6DFB;&#x52A0;&#x81EA;&#x5DF1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65B9;&#x6CD5;"><a name="&#x6DFB;&#x52A0;&#x81EA;&#x5DF1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65B9;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#&#x6DFB;&#x52A0;&#x81EA;&#x5DF1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65B9;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6DFB;&#x52A0;&#x81EA;&#x5DF1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65B9;&#x6CD5;</h5>
<p>&#x60A8;&#x4E5F;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x81EA;&#x5DF1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65B9;&#x6CD5;&#x3002; &#x60A8;&#x5C06;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x3002; &#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_development/" target="_blank">&#x670D;&#x52A1;&#x5668;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6307;&#x5357;</a>&#x4E2D;&#x7684;<code>Authentication SPI</code>&#x90E8;&#x5206;&#x3002;</p>
<p><a name="103_____2_1_18__&#x591A;&#x79DF;&#x6237;"></a></p>
<h4 id="2118-&#x591A;&#x79DF;&#x6237;"><a name="2118-&#x591A;&#x79DF;&#x6237;" class="anchor-navigation-ex-anchor" href="#2118-&#x591A;&#x79DF;&#x6237;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.18. &#x591A;&#x79DF;&#x6237;</h4>
<p>&#x5728;&#x6211;&#x4EEC;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#xFF0C;&#x591A;&#x79DF;&#x6237;&#x610F;&#x5473;&#x7740;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x591A;&#x4E2A;Keycloak&#x9886;&#x57DF;&#x6765;&#x4FDD;&#x62A4;&#x5355;&#x4E2A;&#x76EE;&#x6807;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF08;WAR&#xFF09;&#x3002; &#x9886;&#x57DF;&#x53EF;&#x4EE5;&#x4F4D;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;Keycloak&#x5B9E;&#x4F8B;&#x4E2D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F4D;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x5B9E;&#x4F8B;&#x4E0A;&#x3002;</p>
<p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x6709;&#x591A;&#x4E2A;<code>keycloak.json</code>&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x591A;&#x4E2A;WAR&#x5B9E;&#x4F8B;&#xFF0C;&#x5E76;&#x5C06;&#x4E0D;&#x540C;&#x7684;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x90E8;&#x7F72;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x8DEF;&#x5F84;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x8FD8;&#x5E0C;&#x671B;&#x57FA;&#x4E8E;&#x4E0A;&#x4E0B;&#x6587;&#x4E4B;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x5185;&#x5BB9;&#x9009;&#x62E9;&#x9886;&#x57DF;&#x3002;</p>
<p>Keycloak&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x89E3;&#x6790;&#x5668;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x4F7F;&#x7528;&#x7684;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x3002;</p>
<p>&#x8981;&#x5B9E;&#x73B0;&#x6B64;&#x76EE;&#x7684;&#xFF0C;&#x9996;&#x5148;&#x9700;&#x8981;&#x521B;&#x5EFA;<code>org.keycloak.adapters.KeycloakConfigResolver</code>&#x7684;&#x5B9E;&#x73B0;&#x3002; &#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> example;

<span class="hljs-keyword">import</span> org.keycloak.adapters.KeycloakConfigResolver;
<span class="hljs-keyword">import</span> org.keycloak.adapters.KeycloakDeployment;
<span class="hljs-keyword">import</span> org.keycloak.adapters.KeycloakDeploymentBuilder;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PathBasedKeycloakConfigResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">KeycloakConfigResolver</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> KeycloakDeployment <span class="hljs-title">resolve</span><span class="hljs-params">(OIDCHttpFacade.Request request)</span> </span>{
        <span class="hljs-keyword">if</span> (path.startsWith(<span class="hljs-string">&quot;alternative&quot;</span>)) {
            KeycloakDeployment deployment = cache.get(realm);
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == deployment) {
                InputStream is = getClass().getResourceAsStream(<span class="hljs-string">&quot;/tenant1-keycloak.json&quot;</span>);
                <span class="hljs-keyword">return</span> KeycloakDeploymentBuilder.build(is);
            }
        } <span class="hljs-keyword">else</span> {
            InputStream is = getClass().getResourceAsStream(<span class="hljs-string">&quot;/default-keycloak.json&quot;</span>);
            <span class="hljs-keyword">return</span> KeycloakDeploymentBuilder.build(is);
        }
    }

}
</code></pre>
<p>&#x60A8;&#x8FD8;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x4E0E;<code>web.xml</code>&#x4E2D;&#x7684;<code>keycloak.config.resolver</code>context-param&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x7684;<code>KeycloakConfigResolver</code>&#x5B9E;&#x73B0;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span>&gt;</span>
    ...
    <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>keycloak.config.resolver<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>example.PathBasedKeycloakConfigResolver<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
<p><a name="104_____2_1_19__&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x96C6;&#x7FA4;"></a></p>
<h4 id="2119-&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x96C6;&#x7FA4;"><a name="2119-&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x96C6;&#x7FA4;" class="anchor-navigation-ex-anchor" href="#2119-&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x96C6;&#x7FA4;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.19. &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x96C6;&#x7FA4;</h4>
<p>&#x672C;&#x7AE0;&#x6D89;&#x53CA;&#x652F;&#x6301;&#x90E8;&#x7F72;&#x5230;JBoss EAP&#xFF0C;WildFly&#x548C;JBoss AS&#x7684;&#x96C6;&#x7FA4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>&#x6839;&#x636E;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x662F;&#x5426;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;&#x9009;&#x9879;&#xFF1A;</p>
<ul>
<li>&#x65E0;&#x72B6;&#x6001;&#x6216;&#x6709;&#x72B6;&#x6001;</li>
<li>&#x53EF;&#x5206;&#x53D1;&#x7684;(&#x590D;&#x5236;&#x7684;http&#x4F1A;&#x8BDD;)&#x6216;&#x4E0D;&#x53EF;&#x5206;&#x53D1;&#x7684;</li>
<li>&#x4F9D;&#x8D56;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#x63D0;&#x4F9B;&#x7684;&#x7C98;&#x6027;&#x4F1A;&#x8BDD;</li>
<li>&#x4E0E;Keycloak&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x57DF;&#x540D;&#x4E2D;&#x6258;&#x7BA1;</li>
</ul>
<p>&#x5904;&#x7406;&#x7FA4;&#x96C6;&#x5E76;&#x4E0D;&#x50CF;&#x666E;&#x901A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90A3;&#x4E48;&#x7B80;&#x5355;&#x3002; &#x4E3B;&#x8981;&#x662F;&#x56E0;&#x4E3A;&#x6D4F;&#x89C8;&#x5668;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90FD;&#x5411;Keycloak&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x4E0D;&#x50CF;&#x5728;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#x4E0A;&#x542F;&#x7528;&#x7C98;&#x6027;&#x4F1A;&#x8BDD;&#x90A3;&#x4E48;&#x7B80;&#x5355;&#x3002;</p>
<p><a name="105______&#x65E0;&#x72B6;&#x6001;&#x4EE4;&#x724C;&#x5B58;&#x50A8;"></a></p>
<h5 id="&#x65E0;&#x72B6;&#x6001;&#x4EE4;&#x724C;&#x5B58;&#x50A8;"><a name="&#x65E0;&#x72B6;&#x6001;&#x4EE4;&#x724C;&#x5B58;&#x50A8;" class="anchor-navigation-ex-anchor" href="#&#x65E0;&#x72B6;&#x6001;&#x4EE4;&#x724C;&#x5B58;&#x50A8;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x65E0;&#x72B6;&#x6001;&#x4EE4;&#x724C;&#x5B58;&#x50A8;</h5>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Keycloak&#x4FDD;&#x62A4;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;HTTP&#x4F1A;&#x8BDD;&#x6765;&#x5B58;&#x50A8;&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;&#x3002; &#x8FD9;&#x610F;&#x5473;&#x7740;&#x60A8;&#x5FC5;&#x987B;&#x542F;&#x7528;&#x7C98;&#x6027;&#x4F1A;&#x8BDD;&#x6216;&#x590D;&#x5236;HTTP&#x4F1A;&#x8BDD;&#x3002;</p>
<p>&#x4F5C;&#x4E3A;&#x5728;HTTP&#x4F1A;&#x8BDD;&#x4E2D;&#x5B58;&#x50A8;&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x66FF;&#x4EE3;&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x4E3A;&#x5C06;&#x5176;&#x5B58;&#x50A8;&#x5728;cookie&#x4E2D;&#x3002; &#x5982;&#x679C;&#x8981;&#x4F7F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x65E0;&#x72B6;&#x6001;&#x6216;&#x8005;&#x60A8;&#x4E0D;&#x5E0C;&#x671B;&#x5728;HTTP&#x4F1A;&#x8BDD;&#x4E2D;&#x5B58;&#x50A8;&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x8FD9;&#x5C06;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;cookie&#x5B58;&#x50A8;&#x6765;&#x4FDD;&#x5B58;&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x8BF7;&#x7F16;&#x8F91;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;<code>WEB-INF/keycloak.json</code>&#x5E76;&#x6DFB;&#x52A0;&#xFF1A;</p>
<pre><code>&quot;token-store&quot;: &quot;cookie&quot;
</code></pre><blockquote>
<p><code>token-store</code>&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x662F;<code>session</code>&#xFF0C;&#x5B83;&#x5C06;&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;&#x5B58;&#x50A8;&#x5728;HTTP&#x4F1A;&#x8BDD;&#x4E2D;&#x3002;</p>
</blockquote>
<p>&#x4F7F;&#x7528;cookie&#x5B58;&#x50A8;&#x7684;&#x4E00;&#x4E2A;&#x9650;&#x5236;&#x662F;&#x6574;&#x4E2A;&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;&#x5728;cookie&#x4E2D;&#x4F20;&#x9012;&#x7ED9;&#x6BCF;&#x4E2A;HTTP&#x8BF7;&#x6C42;&#x3002; &#x8FD9;&#x53EF;&#x80FD;&#x4F1A;&#x5F71;&#x54CD;&#x6027;&#x80FD;&#x3002;</p>
<p>&#x53E6;&#x4E00;&#x4E2A;&#x5C0F;&#x9650;&#x5236;&#x662F;&#x5BF9;&#x5355;&#x70B9;&#x767B;&#x51FA;&#x7684;&#x6709;&#x9650;&#x652F;&#x6301;&#x3002; &#x5982;&#x679C;&#x60A8;&#x4ECE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x672C;&#x8EAB;&#x521D;&#x59CB;&#x5316;servlet&#x6CE8;&#x9500;&#xFF08;HttpServletRequest.logout&#xFF09;&#xFF0C;&#x5B83;&#x5C06;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#xFF0C;&#x56E0;&#x4E3A;&#x9002;&#x914D;&#x5668;&#x5C06;&#x5220;&#x9664;KEYCLOAK_ADAPTER_STATE cookie&#x3002; &#x4F46;&#x662F;&#xFF0C;Keycloak&#x4E0D;&#x4F1A;&#x5C06;&#x4ECE;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x521D;&#x59CB;&#x5316;&#x7684;&#x53CD;&#x5411;&#x901A;&#x9053;&#x6CE8;&#x9500;&#x4F20;&#x64AD;&#x5230;&#x4F7F;&#x7528;cookie&#x5B58;&#x50A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x5EFA;&#x8BAE;&#x5BF9;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x8D85;&#x65F6;&#x4F7F;&#x7528;&#x77ED;&#x503C;&#xFF08;&#x4F8B;&#x5982;1&#x5206;&#x949F;&#xFF09;&#x3002;</p>
<blockquote>
<p>&#x67D0;&#x4E9B;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#x4E0D;&#x5141;&#x8BB8;&#x4EFB;&#x4F55;&#x914D;&#x7F6E;&#x7C98;&#x6027;&#x4F1A;&#x8BDD;cookie&#x540D;&#x79F0;&#x6216;&#x5185;&#x5BB9;&#xFF0C;&#x4F8B;&#x5982;Amazon ALB&#x3002; &#x5BF9;&#x4E8E;&#x8FD9;&#x4E9B;&#xFF0C;&#x5EFA;&#x8BAE;&#x5C06;<code>shouldAttachRoute</code>&#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x4E3A;<code>false</code>&#x3002;</p>
</blockquote>
<p><a name="106______&#x76F8;&#x5BF9;URI&#x4F18;&#x5316;"></a></p>
<h5 id="&#x76F8;&#x5BF9;uri&#x4F18;&#x5316;"><a name="&#x76F8;&#x5BF9;uri&#x4F18;&#x5316;" class="anchor-navigation-ex-anchor" href="#&#x76F8;&#x5BF9;uri&#x4F18;&#x5316;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x76F8;&#x5BF9;URI&#x4F18;&#x5316;</h5>
<p>&#x5728;Keycloak&#x548C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6258;&#x7BA1;&#x5728;&#x540C;&#x4E00;&#x57DF;&#xFF08;&#x901A;&#x8FC7;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x6216;&#x8D1F;&#x8F7D;&#x5E73;&#x8861;&#x5668;&#xFF09;&#x7684;&#x90E8;&#x7F72;&#x65B9;&#x6848;&#x4E2D;&#xFF0C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x4E2D;&#x4F7F;&#x7528;&#x76F8;&#x5BF9;URI&#x9009;&#x9879;&#x4F1A;&#x5F88;&#x65B9;&#x4FBF;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x76F8;&#x5BF9;URI&#xFF0C;URI&#x5C06;&#x76F8;&#x5BF9;&#x4E8E;&#x7528;&#x4E8E;&#x8BBF;&#x95EE;Keycloak&#x7684;URL&#x8FDB;&#x884C;&#x89E3;&#x6790;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;URL&#x662F;<code>https://acme.org/myapp</code>&#xFF0C;&#x800C;Keycloak&#x7684;URL&#x662F;<code>https://acme.org/auth</code>&#xFF0C;&#x90A3;&#x4E48;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;redirect-uri <code>/myapp</code> &#x800C;&#x4E0D;&#x662F; <code>https://acme.org/myapp</code>&#x3002;</p>
<p><a name="107______&#x7BA1;&#x7406;&#x5458;URL&#x914D;&#x7F6E;"></a></p>
<h5 id="&#x7BA1;&#x7406;&#x5458;url&#x914D;&#x7F6E;"><a name="&#x7BA1;&#x7406;&#x5458;url&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x7BA1;&#x7406;&#x5458;url&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7BA1;&#x7406;&#x5458;URL&#x914D;&#x7F6E;</h5>
<p>&#x53EF;&#x4EE5;&#x5728;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x914D;&#x7F6E;&#x7279;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x7BA1;&#x7406;URL&#x3002; &#x5B83;&#x7531;Keycloak&#x670D;&#x52A1;&#x5668;&#x7528;&#x4E8E;&#x5411;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53D1;&#x9001;&#x540E;&#x7AEF;&#x8BF7;&#x6C42;&#x4EE5;&#x6267;&#x884C;&#x5404;&#x79CD;&#x4EFB;&#x52A1;&#xFF0C;&#x4F8B;&#x5982;&#x6CE8;&#x9500;&#x7528;&#x6237;&#x6216;&#x63A8;&#x9001;&#x64A4;&#x9500;&#x7B56;&#x7565;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x53CD;&#x5411;&#x901A;&#x9053;&#x6CE8;&#x9500;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x662F;&#xFF1A;</p>
<ol>
<li>&#x7528;&#x6237;&#x4ECE;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53D1;&#x9001;&#x6CE8;&#x9500;&#x8BF7;&#x6C42;</li>
<li>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5411;Keycloak&#x53D1;&#x9001;&#x6CE8;&#x9500;&#x8BF7;&#x6C42;</li>
<li>Keycloak&#x670D;&#x52A1;&#x5668;&#x4F7F;&#x7528;&#x6237;&#x4F1A;&#x8BDD;&#x65E0;&#x6548;</li>
<li>&#x7136;&#x540E;&#xFF0C;Keycloak&#x670D;&#x52A1;&#x5668;&#x5411;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53D1;&#x9001;&#x53CD;&#x5411;&#x901A;&#x9053;&#x8BF7;&#x6C42;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E0E;&#x4F1A;&#x8BDD;&#x5173;&#x8054;&#x7684;&#x7BA1;&#x7406;URL</li>
<li>&#x5F53;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6536;&#x5230;&#x6CE8;&#x9500;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x4F7F;&#x76F8;&#x5E94;&#x7684;HTTP&#x4F1A;&#x8BDD;&#x65E0;&#x6548;</li>
</ol>
<p>&#x5982;&#x679C;admin URL&#x5305;&#x542B; <code>${application.session.host}</code> &#xFF0C;&#x5B83;&#x5C06;&#x88AB;&#x66FF;&#x6362;&#x4E3A;&#x4E0E;HTTP&#x4F1A;&#x8BDD;&#x5173;&#x8054;&#x7684;&#x8282;&#x70B9;&#x7684;URL&#x3002;</p>
<p><a name="108______&#x6CE8;&#x518C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8282;&#x70B9;"></a></p>
<h5 id="&#x6CE8;&#x518C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8282;&#x70B9;"><a name="&#x6CE8;&#x518C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8282;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x518C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8282;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x518C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8282;&#x70B9;</h5>
<p>&#x4E0A;&#x4E00;&#x8282;&#x63CF;&#x8FF0;&#x4E86;Keycloak&#x5982;&#x4F55;&#x5411;&#x4E0E;&#x7279;&#x5B9A;HTTP&#x4F1A;&#x8BDD;&#x5173;&#x8054;&#x7684;&#x8282;&#x70B9;&#x53D1;&#x9001;&#x6CE8;&#x9500;&#x8BF7;&#x6C42;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7BA1;&#x7406;&#x5458;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x5C06;&#x7BA1;&#x7406;&#x4EFB;&#x52A1;&#x4F20;&#x64AD;&#x5230;&#x6240;&#x6709;&#x5DF2;&#x6CE8;&#x518C;&#x7684;&#x7FA4;&#x96C6;&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5C06;&#x65B0;&#x7684;not before&#x7B56;&#x7565;&#x63A8;&#x9001;&#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6216;&#x4ECE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6CE8;&#x9500;&#x6240;&#x6709;&#x7528;&#x6237;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Keycloak&#x9700;&#x8981;&#x77E5;&#x9053;&#x6240;&#x6709;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x53EF;&#x4EE5;&#x5C06;&#x4E8B;&#x4EF6;&#x53D1;&#x9001;&#x7ED9;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x8282;&#x70B9;&#x3002; &#x4E3A;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x652F;&#x6301;&#x81EA;&#x52A8;&#x53D1;&#x73B0;&#x673A;&#x5236;&#xFF1A;</p>
<ol>
<li>&#x5F53;&#x65B0;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8282;&#x70B9;&#x52A0;&#x5165;&#x7FA4;&#x96C6;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x5411;Keycloak&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x6CE8;&#x518C;&#x8BF7;&#x6C42;</li>
<li>&#x8BE5;&#x8BF7;&#x6C42;&#x53EF;&#x4EE5;&#x4EE5;&#x914D;&#x7F6E;&#x7684;&#x5468;&#x671F;&#x6027;&#x95F4;&#x9694;&#x91CD;&#x65B0;&#x53D1;&#x9001;&#x5230;Keycloak</li>
<li>&#x5982;&#x679C;Keycloak&#x670D;&#x52A1;&#x5668;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x8D85;&#x65F6;&#x5185;&#x672A;&#x6536;&#x5230;&#x91CD;&#x65B0;&#x6CE8;&#x518C;&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x5B83;&#x4F1A;&#x81EA;&#x52A8;&#x53D6;&#x6D88;&#x6CE8;&#x518C;&#x7279;&#x5B9A;&#x8282;&#x70B9;</li>
<li>&#x5F53;Keycloak&#x53D1;&#x9001;&#x53D6;&#x6D88;&#x6CE8;&#x518C;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x8BE5;&#x8282;&#x70B9;&#x4E5F;&#x4F1A;&#x5728;Keycloak&#x4E2D;&#x53D6;&#x6D88;&#x6CE8;&#x518C;&#xFF0C;&#x8FD9;&#x901A;&#x5E38;&#x662F;&#x5728;&#x8282;&#x70B9;&#x5173;&#x95ED;&#x6216;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53D6;&#x6D88;&#x90E8;&#x7F72;&#x671F;&#x95F4;&#x3002; &#x5F53;&#x672A;&#x8C03;&#x7528;&#x672A;&#x90E8;&#x7F72;&#x4FA6;&#x542C;&#x5668;&#x65F6;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x6267;&#x884C;&#x5F3A;&#x5236;&#x5173;&#x95ED;&#xFF0C;&#x8FD9;&#x5BFC;&#x81F4;&#x9700;&#x8981;&#x81EA;&#x52A8;&#x53D6;&#x6D88;&#x6CE8;&#x518C;</li>
</ol>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x7981;&#x7528;&#x53D1;&#x9001;&#x542F;&#x52A8;&#x6CE8;&#x518C;&#x548C;&#x5B9A;&#x671F;&#x91CD;&#x65B0;&#x6CE8;&#x518C;&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x6709;&#x67D0;&#x4E9B;&#x7FA4;&#x96C6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x624D;&#x9700;&#x8981;&#x5B83;&#x3002;</p>
<p>&#x8981;&#x542F;&#x7528;&#x8BE5;&#x529F;&#x80FD;&#xFF0C;&#x8BF7;&#x7F16;&#x8F91;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;<code>WEB-INF/keycloak.json</code>&#x6587;&#x4EF6;&#x5E76;&#x6DFB;&#x52A0;&#xFF1A;</p>
<pre><code>&quot;register-node-at-startup&quot;: true,
&quot;register-node-period&quot;: 600,
</code></pre><p>&#x8FD9;&#x610F;&#x5473;&#x7740;&#x9002;&#x914D;&#x5668;&#x5C06;&#x5728;&#x542F;&#x52A8;&#x65F6;&#x53D1;&#x9001;&#x6CE8;&#x518C;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x6BCF;10&#x5206;&#x949F;&#x91CD;&#x65B0;&#x6CE8;&#x518C;&#x4E00;&#x6B21;&#x3002;</p>
<p>&#x5728;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x6700;&#x5927;&#x8282;&#x70B9;&#x91CD;&#x65B0;&#x6CE8;&#x518C;&#x8D85;&#x65F6;&#xFF08;&#x5E94;&#x8BE5;&#x5927;&#x4E8E;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x4E2D;&#x7684;<em>register-node-period</em>&#xFF09;&#x3002; &#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x624B;&#x52A8;&#x6DFB;&#x52A0;&#x548C;&#x5220;&#x9664;&#x7FA4;&#x96C6;&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x4E0D;&#x60F3;&#x4F9D;&#x8D56;&#x81EA;&#x52A8;&#x6CE8;&#x518C;&#x529F;&#x80FD;&#xFF0C;&#x6216;&#x8005;&#x5982;&#x679C;&#x60A8;&#x60F3;&#x8981;&#x5728;&#x4E0D;&#x4F7F;&#x7528;&#x81EA;&#x52A8;&#x6CE8;&#x9500;&#x529F;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5220;&#x9664;&#x9648;&#x65E7;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8282;&#x70B9;&#xFF0C;&#x8FD9;&#x5C06;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p>
<p><a name="109______&#x5237;&#x65B0;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;&#x4EE4;&#x724C;"></a></p>
<h5 id="&#x5237;&#x65B0;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;&#x4EE4;&#x724C;"><a name="&#x5237;&#x65B0;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;&#x4EE4;&#x724C;" class="anchor-navigation-ex-anchor" href="#&#x5237;&#x65B0;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;&#x4EE4;&#x724C;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5237;&#x65B0;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;&#x4EE4;&#x724C;</h5>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9002;&#x914D;&#x5668;&#x4EC5;&#x5728;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x8FC7;&#x671F;&#x65F6;&#x5237;&#x65B0;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x9002;&#x914D;&#x5668;&#x4EE5;&#x5728;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x4E0A;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x3002; &#x8FD9;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x6027;&#x80FD;&#x4EA7;&#x751F;&#x5F71;&#x54CD;&#xFF0C;&#x56E0;&#x4E3A;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5C06;&#x5411;Keycloak&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x66F4;&#x591A;&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x8981;&#x542F;&#x7528;&#x8BE5;&#x529F;&#x80FD;&#xFF0C;&#x8BF7;&#x7F16;&#x8F91;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;<code>WEB-INF/keycloak.json</code>&#x6587;&#x4EF6;&#x5E76;&#x6DFB;&#x52A0;&#xFF1A;</p>
<pre><code>&quot;always-refresh-token&quot;: true
</code></pre><blockquote>
<p>&#x8FD9;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x6027;&#x80FD;&#x4EA7;&#x751F;&#x91CD;&#x5927;&#x5F71;&#x54CD;&#x3002; &#x5982;&#x679C;&#x60A8;&#x4E0D;&#x80FD;&#x4F9D;&#x8D56;&#x53CD;&#x5411;&#x901A;&#x9053;&#x6D88;&#x606F;&#x4F20;&#x64AD;&#x6CE8;&#x9500;&#x800C;&#x4E0D;&#x662F;&#x7B56;&#x7565;&#x4E4B;&#x524D;&#xFF0C;&#x5219;&#x4EC5;&#x542F;&#x7528;&#x6B64;&#x529F;&#x80FD;&#x3002; &#x53E6;&#x4E00;&#x4EF6;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x7684;&#x5230;&#x671F;&#x65F6;&#x95F4;&#x5F88;&#x77ED;&#xFF0C;&#x56E0;&#x6B64;&#x5373;&#x4F7F;&#x672A;&#x4F20;&#x64AD;&#x6CE8;&#x9500;&#xFF0C;&#x4EE4;&#x724C;&#x4E5F;&#x4F1A;&#x5728;&#x6CE8;&#x9500;&#x540E;&#x7684;&#x51E0;&#x5206;&#x949F;&#x5185;&#x5230;&#x671F;&#x3002;</p>
</blockquote>
<p><a name="110____2_2__JavaScript_&#x9002;&#x914D;&#x5668;"></a></p>
<h3 id="22-javascript-&#x9002;&#x914D;&#x5668;"><a name="22-javascript-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#22-javascript-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. JavaScript &#x9002;&#x914D;&#x5668;</h3>
<p>Keycloak&#x9644;&#x5E26;&#x4E86;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;JavaScript&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x4FDD;&#x62A4;HTML5/JavaScript&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;JavaScript&#x9002;&#x914D;&#x5668;&#x5185;&#x7F6E;&#x4E86;&#x5BF9;Cordova&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x652F;&#x6301;&#x3002;</p>
<p>&#x8BE5;&#x5E93;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4ECE;Keycloak&#x670D;&#x52A1;&#x5668;&#x68C0;&#x7D22;&#x5230;<code>/auth/js/keycloak.js</code>&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;ZIP&#x5B58;&#x6863;&#x5206;&#x53D1;&#x3002;</p>
<p>&#x6700;&#x4F73;&#x505A;&#x6CD5;&#x662F;&#x76F4;&#x63A5;&#x4ECE;Keycloak Server&#x52A0;&#x8F7D;JavaScript&#x9002;&#x914D;&#x5668;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x5728;&#x5347;&#x7EA7;&#x670D;&#x52A1;&#x5668;&#x65F6;&#x81EA;&#x52A8;&#x66F4;&#x65B0;&#x3002; &#x5982;&#x679C;&#x5C06;&#x9002;&#x914D;&#x5668;&#x590D;&#x5236;&#x5230;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x8BF7;&#x786E;&#x4FDD;&#x4EC5;&#x5728;&#x5347;&#x7EA7;&#x670D;&#x52A1;&#x5668;&#x540E;&#x5347;&#x7EA7;&#x9002;&#x914D;&#x5668;&#x3002;</p>
<p>&#x5173;&#x4E8E;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x6CE8;&#x610F;&#x4E8B;&#x9879;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x5FC5;&#x987B;&#x662F;&#x516C;&#x5171;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x5B89;&#x5168;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x5B58;&#x50A8;&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x636E;&#x3002; &#x8FD9;&#x4F7F;&#x5F97;&#x786E;&#x4FDD;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x7684;&#x91CD;&#x5B9A;&#x5411;URI&#x6B63;&#x786E;&#x4E14;&#x5C3D;&#x53EF;&#x80FD;&#x5177;&#x4F53;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;JavaScript&#x9002;&#x914D;&#x5668;&#xFF0C;&#x5FC5;&#x987B;&#x9996;&#x5148;&#x5728;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x4E3A;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x786E;&#x4FDD;&#x4E3A;<code>Access Type</code>&#x9009;&#x62E9;<code>public</code>&#x3002;</p>
<p>&#x60A8;&#x8FD8;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x6709;&#x6548;&#x7684;&#x91CD;&#x5B9A;&#x5411;URI&#x548C;&#x6709;&#x6548;&#x7684;Web&#x6E90;&#x3002; &#x5C3D;&#x53EF;&#x80FD;&#x5177;&#x4F53;&#xFF0C;&#x56E0;&#x4E3A;&#x672A;&#x80FD;&#x8FD9;&#x6837;&#x505A;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x5B89;&#x5168;&#x6F0F;&#x6D1E;&#x3002;</p>
<p>&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x540E;&#xFF0C;&#x5355;&#x51FB;<code>Installation(&#x5B89;&#x88C5;)</code>&#x9009;&#x9879;&#x5361;&#xFF0C;&#x9009;&#x62E9;<code>Format Option(&#x683C;&#x5F0F;&#x9009;&#x9879;)</code>&#x7684;<code>Keycloak OIDC JSON</code>&#xFF0C;&#x7136;&#x540E;&#x5355;&#x51FB;<code>Download(&#x4E0B;&#x8F7D;)</code>&#x3002; &#x4E0B;&#x8F7D;&#x7684;<code>keycloak.json</code>&#x6587;&#x4EF6;&#x5E94;&#x8BE5;&#x5B58;&#x653E;&#x5728;&#x60A8;&#x7684;Web&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x4E0E;HTML&#x9875;&#x9762;&#x76F8;&#x540C;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<p>&#x6216;&#x8005;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x8DF3;&#x8FC7;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5E76;&#x624B;&#x52A8;&#x914D;&#x7F6E;&#x9002;&#x914D;&#x5668;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#x663E;&#x793A;&#x5982;&#x4F55;&#x521D;&#x59CB;&#x5316;JavaScript&#x9002;&#x914D;&#x5668;&#xFF1A;</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;keycloak.js&quot;</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="actionscript">
        <span class="hljs-keyword">var</span> keycloak = Keycloak();
        keycloak.init().success(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(authenticated)</span> </span>{
            alert(authenticated ? <span class="hljs-string">&apos;authenticated&apos;</span> : <span class="hljs-string">&apos;not authenticated&apos;</span>);
        }).error(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            alert(<span class="hljs-string">&apos;failed to initialize&apos;</span>);
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</code></pre>
<p>&#x5982;&#x679C;<code>keycloak.json</code>&#x6587;&#x4EF6;&#x4F4D;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5B83;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> keycloak = Keycloak(<span class="hljs-string">&apos;http://localhost:8080/myapp/keycloak.json&apos;</span>);
</code></pre>
<p>&#x6216;&#x8005;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6240;&#x9700;&#x7684;&#x914D;&#x7F6E;&#x4F20;&#x5165;JavaScript&#x5BF9;&#x8C61;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> keycloak = Keycloak({
    url: <span class="hljs-string">&apos;http://keycloak-server/auth&apos;</span>,
    realm: <span class="hljs-string">&apos;myrealm&apos;</span>,
    clientId: <span class="hljs-string">&apos;myapp&apos;</span>
});
</code></pre>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x8C03;&#x7528;<code>login</code>&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x9009;&#x9879;&#x53EF;&#x7528;&#x4E8E;&#x4F7F;&#x9002;&#x914D;&#x5668;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x5C06;<code>login-required</code>&#x6216;<code>check-sso</code>&#x4F20;&#x9012;&#x7ED9;init&#x51FD;&#x6570;&#x3002; &#x5982;&#x679C;&#x7528;&#x6237;&#x767B;&#x5F55;&#x5230;Keycloak&#xFF0C;&#x5219;<code>login-required</code>&#x5C06;&#x5BF9;&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5426;&#x5219;&#x5C06;&#x663E;&#x793A;&#x767B;&#x5F55;&#x9875;&#x9762;&#x3002; <code>check-sso</code>&#x5C06;&#x4EC5;&#x5728;&#x7528;&#x6237;&#x5DF2;&#x767B;&#x5F55;&#x65F6;&#x9A8C;&#x8BC1;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x6237;&#x672A;&#x767B;&#x5F55;&#xFF0C;&#x5219;&#x6D4F;&#x89C8;&#x5668;&#x5C06;&#x88AB;&#x91CD;&#x5B9A;&#x5411;&#x56DE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E76;&#x4FDD;&#x6301;&#x672A;&#x7ECF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;</p>
<p>&#x8981;&#x542F;&#x7528;<code>login-required</code>&#xFF0C;&#x8BF7;&#x5C06;<code>onLoad</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>login-required</code>&#x5E76;&#x4F20;&#x9012;&#x7ED9;init&#x65B9;&#x6CD5;&#xFF1A;</p>
<pre><code class="lang-javascript">keycloak.init({ onLoad: <span class="hljs-string">&apos;login-required&apos;</span> })
</code></pre>
<p>&#x5728;&#x5BF9;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x4E4B;&#x540E;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5728;<code>Authorization</code>&#x6807;&#x5934;&#x4E2D;&#x5305;&#x542B;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x6765;&#x5411;Keycloak&#x4FDD;&#x62A4;&#x5BF9;RESTful&#x670D;&#x52A1;&#x7684;&#x8BF7;&#x6C42;&#x3002; &#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> loadData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;username&apos;</span>).innerText = keycloak.subject;

    <span class="hljs-keyword">var</span> url = <span class="hljs-string">&apos;http://localhost:8080/restful-service&apos;</span>;

    <span class="hljs-keyword">var</span> req = <span class="hljs-keyword">new</span> XMLHttpRequest();
    req.open(<span class="hljs-string">&apos;GET&apos;</span>, url, <span class="hljs-literal">true</span>);
    req.setRequestHeader(<span class="hljs-string">&apos;Accept&apos;</span>, <span class="hljs-string">&apos;application/json&apos;</span>);
    req.setRequestHeader(<span class="hljs-string">&apos;Authorization&apos;</span>, <span class="hljs-string">&apos;Bearer &apos;</span> + keycloak.token);

    req.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (req.readyState == <span class="hljs-number">4</span>) {
            <span class="hljs-keyword">if</span> (req.status == <span class="hljs-number">200</span>) {
                alert(<span class="hljs-string">&apos;Success&apos;</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.status == <span class="hljs-number">403</span>) {
                alert(<span class="hljs-string">&apos;Forbidden&apos;</span>);
            }
        }
    }

    req.send();
};
</code></pre>
<p>&#x9700;&#x8981;&#x8BB0;&#x4F4F;&#x7684;&#x4E00;&#x4EF6;&#x4E8B;&#x662F;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x5F88;&#x77ED;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5728;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x4E4B;&#x524D;&#x5237;&#x65B0;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>updateToken</code>&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C;&#x3002; <code>updateToken</code>&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;promise&#x5BF9;&#x8C61;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x6210;&#x529F;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x65F6;&#x624D;&#x80FD;&#x8F7B;&#x677E;&#x8C03;&#x7528;&#x670D;&#x52A1;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;&#x5219;&#x5411;&#x7528;&#x6237;&#x663E;&#x793A;&#x9519;&#x8BEF;&#x3002; &#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-javascript">keycloak.updateToken(<span class="hljs-number">30</span>).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    loadData();
}).error(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    alert(<span class="hljs-string">&apos;Failed to refresh token&apos;</span>);
});
</code></pre>
<p><a name="111_____2_2_1__&#x4F1A;&#x8BDD;&#x72B6;&#x6001;iframe"></a></p>
<h4 id="221-&#x4F1A;&#x8BDD;&#x72B6;&#x6001;iframe"><a name="221-&#x4F1A;&#x8BDD;&#x72B6;&#x6001;iframe" class="anchor-navigation-ex-anchor" href="#221-&#x4F1A;&#x8BDD;&#x72B6;&#x6001;iframe"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.1. &#x4F1A;&#x8BDD;&#x72B6;&#x6001;iframe</h4>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;JavaScript&#x9002;&#x914D;&#x5668;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x9690;&#x85CF;&#x7684;iframe&#xFF0C;&#x7528;&#x4E8E;&#x68C0;&#x6D4B;&#x662F;&#x5426;&#x5DF2;&#x53D1;&#x751F;&#x5355;&#x4E00;&#x6CE8;&#x9500;&#x3002; &#x8FD9;&#x4E0D;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#xFF0C;&#x800C;&#x662F;&#x901A;&#x8FC7;&#x67E5;&#x770B;&#x7279;&#x6B8A;&#x72B6;&#x6001;cookie&#x6765;&#x68C0;&#x7D22;&#x72B6;&#x6001;&#x3002; &#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5728;&#x4F20;&#x9012;&#x7ED9;<code>init</code>&#x65B9;&#x6CD5;&#x7684;&#x9009;&#x9879;&#x4E2D;&#x8BBE;&#x7F6E;<code>checkLoginIframe:false</code>&#x6765;&#x7981;&#x7528;&#x6B64;&#x529F;&#x80FD;&#x3002;</p>
<p>&#x4F60;&#x4E0D;&#x5E94;&#x8BE5;&#x76F4;&#x63A5;&#x770B;&#x8FD9;&#x4E2A;cookie&#x3002; &#x5B83;&#x7684;&#x683C;&#x5F0F;&#x53EF;&#x4EE5;&#x66F4;&#x6539;&#xFF0C;&#x5B83;&#x4E5F;&#x4E0E;Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;URL&#x76F8;&#x5173;&#x8054;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E0E;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x76F8;&#x5173;&#x8054;&#x3002;</p>
<p><a name="112_____2_2_2__&#x9690;&#x5F0F;&#x548C;&#x6DF7;&#x5408;&#x6D41;"></a></p>
<h4 id="222-&#x9690;&#x5F0F;&#x548C;&#x6DF7;&#x5408;&#x6D41;"><a name="222-&#x9690;&#x5F0F;&#x548C;&#x6DF7;&#x5408;&#x6D41;" class="anchor-navigation-ex-anchor" href="#222-&#x9690;&#x5F0F;&#x548C;&#x6DF7;&#x5408;&#x6D41;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.2. &#x9690;&#x5F0F;&#x548C;&#x6DF7;&#x5408;&#x6D41;</h4>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;JavaScript&#x9002;&#x914D;&#x5668;&#x4F7F;&#x7528;<a href="https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth" target="_blank">&#x6388;&#x6743;&#x4EE3;&#x7801;</a> &#x6D41;&#x7A0B;&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x6B64;&#x6D41;&#x7A0B;&#xFF0C;Keycloak&#x670D;&#x52A1;&#x5668;&#x5411;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8FD4;&#x56DE;&#x6388;&#x6743;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x4EE4;&#x724C;&#x3002; &#x5728;&#x5C06;&#x6D4F;&#x89C8;&#x5668;&#x91CD;&#x5B9A;&#x5411;&#x56DE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x540E;&#xFF0C;JavaScript&#x9002;&#x914D;&#x5668;&#x4F1A;&#x4EA4;&#x6362;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x548C;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x7684;<code>code</code>&#x3002;</p>
<p>Keycloak&#x8FD8;&#x652F;&#x6301;<a href="https://openid.net/specs/openid-connect-core-1_0.html#ImplicitFlowAuth" target="_blank">Implicit</a> &#x6D41;&#x7A0B;&#xFF0C;&#x5176;&#x4E2D;&#x5728;&#x4F7F;&#x7528;Keycloak&#x6210;&#x529F;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x540E;&#x7ACB;&#x5373;&#x53D1;&#x9001;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x8FD9;&#x53EF;&#x80FD;&#x6BD4;&#x6807;&#x51C6;&#x6D41;&#x5177;&#x6709;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x989D;&#x5916;&#x7684;&#x8BF7;&#x6C42;&#x6765;&#x4EA4;&#x6362;&#x4EE4;&#x724C;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4F46;&#x662F;&#x5F53;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x5230;&#x671F;&#x65F6;&#x5B83;&#x4F1A;&#x4EA7;&#x751F;&#x5F71;&#x54CD;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x5728;URL&#x7247;&#x6BB5;&#x4E2D;&#x53D1;&#x9001;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x5B89;&#x5168;&#x6F0F;&#x6D1E;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x4EE4;&#x724C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Web&#x670D;&#x52A1;&#x5668;&#x65E5;&#x5FD7;&#x548C;/&#x6216;&#x6D4F;&#x89C8;&#x5668;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x6CC4;&#x9732;&#x3002;</p>
<p>&#x8981;&#x542F;&#x7528;&#x9690;&#x5F0F;&#x6D41;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x5728;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x7528;<code>Implicit Flow Enabled</code>&#x6807;&#x5FD7;&#x3002; &#x60A8;&#x8FD8;&#x9700;&#x8981;&#x5C06;&#x503C;&#x4E3A;<code>implicit</code>&#x7684;&#x53C2;&#x6570;<code>flow</code>&#x4F20;&#x9012;&#x7ED9;<code>init</code>&#x65B9;&#x6CD5;&#xFF1A;</p>
<pre><code class="lang-javascript">keycloak.init({ flow: <span class="hljs-string">&apos;implicit&apos;</span> })
</code></pre>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;&#x53EA;&#x63D0;&#x4F9B;&#x4E86;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x3002; &#x8FD9;&#x610F;&#x5473;&#x7740;&#x4E00;&#x65E6;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x5230;&#x671F;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5FC5;&#x987B;&#x518D;&#x6B21;&#x91CD;&#x5B9A;&#x5411;&#x5230;Keycloak&#x4EE5;&#x83B7;&#x53D6;&#x65B0;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;</p>
<p>Keycloak&#x8FD8;&#x652F;&#x6301;<a href="https://openid.net/specs/openid-connect-core-1_0.html#HybridFlowAuth" target="_blank">Hybrid</a> &#x6D41;&#x7A0B;&#x3002;</p>
<p>&#x8FD9;&#x8981;&#x6C42;&#x5BA2;&#x6237;&#x7AEF;&#x5728;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x542F;&#x7528;<code>Standard Flow Enabled</code>&#x548C;<code>Implicit Flow Enabled</code>&#x6807;&#x5FD7;&#x3002; &#x7136;&#x540E;Keycloak&#x670D;&#x52A1;&#x5668;&#x5C06;&#x4EE3;&#x7801;&#x548C;&#x4EE4;&#x724C;&#x53D1;&#x9001;&#x5230;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x4F7F;&#x7528;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x4EA4;&#x6362;&#x4EE3;&#x7801;&#x4EE5;&#x8BBF;&#x95EE;&#x548C;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x3002; &#x4E0E;&#x9690;&#x5F0F;&#x6D41;&#x7C7B;&#x4F3C;&#xFF0C;&#x6DF7;&#x5408;&#x6D41;&#x6709;&#x5229;&#x4E8E;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x56E0;&#x4E3A;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x53EF;&#x7ACB;&#x5373;&#x4F7F;&#x7528;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x4EE4;&#x724C;&#x4ECD;&#x7136;&#x5728;URL&#x4E2D;&#x53D1;&#x9001;&#xFF0C;&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;&#x5B89;&#x5168;&#x6F0F;&#x6D1E;&#x53EF;&#x80FD;&#x4ECD;&#x7136;&#x9002;&#x7528;&#x3002;</p>
<p>&#x6DF7;&#x5408;&#x6D41;&#x7A0B;&#x7684;&#x4E00;&#x4E2A;&#x4F18;&#x70B9;&#x662F;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x53EF;&#x4F9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;Hybrid&#x6D41;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x5C06;&#x503C;&#x4E3A;<code>hybrid</code>&#x7684;&#x53C2;&#x6570;<code>flow</code>&#x4F20;&#x9012;&#x7ED9;<code>init</code>&#x65B9;&#x6CD5;&#xFF1A;</p>
<pre><code class="lang-javascript">keycloak.init({ flow: <span class="hljs-string">&apos;hybrid&apos;</span> })
</code></pre>
<p><a name="113_____2_2_3__&#x4E0E;Cordova&#x7684;&#x6DF7;&#x5408;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"></a></p>
<h4 id="223-&#x4E0E;cordova&#x7684;&#x6DF7;&#x5408;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><a name="223-&#x4E0E;cordova&#x7684;&#x6DF7;&#x5408;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#223-&#x4E0E;cordova&#x7684;&#x6DF7;&#x5408;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.3. &#x4E0E;Cordova&#x7684;&#x6DF7;&#x5408;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</h4>
<p>Keycloak&#x652F;&#x6301;&#x4F7F;&#x7528;<a href="https://cordova.apache.org/" target="_blank">Apache Cordova</a>&#x5F00;&#x53D1;&#x7684;&#x6DF7;&#x5408;&#x79FB;&#x52A8;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; Javascript&#x9002;&#x914D;&#x5668;&#x6709;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#xFF1A;<code>cordova</code>&#x548C;<code>cordova-native</code>&#xFF1A;</p>
<p>&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;cordova&#xFF0C;&#x5982;&#x679C;&#x672A;&#x914D;&#x7F6E;&#x9002;&#x914D;&#x5668;&#x7C7B;&#x578B;&#x4E14;window.cordova&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x9002;&#x914D;&#x5668;&#x5C06;&#x81EA;&#x52A8;&#x9009;&#x62E9;&#x3002; &#x767B;&#x5F55;&#x65F6;&#xFF0C;&#x5B83;&#x5C06;&#x6253;&#x5F00;<a href="https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-inappbrowser/" target="_blank">InApp&#x6D4F;&#x89C8;&#x5668;</a>&#xFF0C;&#x8BA9;&#x7528;&#x6237;&#x4E0E;Keycloak&#x4EA4;&#x4E92;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x5230;app&#x901A;&#x8FC7;&#x91CD;&#x5B9A;&#x5411;&#x5230;<code>http://localhost</code>&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5C06;&#x6B64;URL&#x5217;&#x5165;&#x767D;&#x540D;&#x5355;&#xFF0C;&#x4F5C;&#x4E3A;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x90E8;&#x5206;&#x4E2D;&#x7684;&#x6709;&#x6548;redirect-uri&#x3002;</p>
<p>&#x867D;&#x7136;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x6613;&#x4E8E;&#x8BBE;&#x7F6E;&#xFF0C;&#x4F46;&#x5B83;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x7F3A;&#x70B9;&#xFF1A;<em>InApp-Browser&#x662F;&#x5D4C;&#x5165;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x4E0D;&#x662F;&#x624B;&#x673A;&#x7684;&#x9ED8;&#x8BA4;&#x6D4F;&#x89C8;&#x5668;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x5B83;&#x5C06;&#x5177;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x5E76;&#x4E14;&#x5B58;&#x50A8;&#x7684;&#x51ED;&#x636E;&#x5C06;&#x4E0D;&#x53EF;&#x7528;. </em> InApp-Browser&#x53EF;&#x80FD;&#x4E5F;&#x4F1A;&#x66F4;&#x6162;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5728;&#x6E32;&#x67D3;&#x66F4;&#x590D;&#x6742;&#x7684;&#x4E3B;&#x9898;&#x65F6;&#x3002; * &#x5728;&#x4F7F;&#x7528;&#x6B64;&#x6A21;&#x5F0F;&#x4E4B;&#x524D;&#xFF0C;&#x9700;&#x8981;&#x8003;&#x8651;&#x5B89;&#x5168;&#x95EE;&#x9898;&#xFF0C;&#x4F8B;&#x5982;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x7528;&#x6237;&#x7684;&#x51ED;&#x636E;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x63A7;&#x5236;&#x6D4F;&#x89C8;&#x5668;&#x5448;&#x73B0;&#x767B;&#x5F55;&#x9875;&#x9762;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x8981;&#x5141;&#x8BB8; &#x5728;&#x60A8;&#x4E0D;&#x4FE1;&#x4EFB;&#x7684;&#x5E94;&#x7528;&#x4E2D;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x6B64;&#x793A;&#x4F8B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x5E2E;&#x52A9;&#x60A8;&#x5165;&#x95E8;&#xFF1A;<a href="https://github.com/keycloak/keycloak/tree/master/examples/cordova" target="_blank">https://github.com/keycloak/keycloak/tree/master/examples/cordova</a></p>
<p>&#x66FF;&#x4EE3;&#x6A21;&#x5F0F;<code>cordova-nativei</code>&#x91C7;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x6CD5;&#x3002; &#x5B83;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x6253;&#x5F00;&#x767B;&#x5F55;&#x9875;&#x9762;&#x3002; &#x7528;&#x6237;&#x901A;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x540E;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x4F7F;&#x7528;&#x7279;&#x6B8A;URL&#x91CD;&#x5B9A;&#x5411;&#x56DE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x4ECE;&#x90A3;&#x91CC;&#xFF0C;Keycloak&#x9002;&#x914D;&#x5668;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4ECE;URL&#x8BFB;&#x53D6;&#x4EE3;&#x7801;&#x6216;&#x4EE4;&#x724C;&#x6765;&#x5B8C;&#x6210;&#x767B;&#x5F55;&#x3002;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5C06;&#x9002;&#x914D;&#x5668;&#x7C7B;&#x578B;<code>cordova-native</code>&#x4F20;&#x9012;&#x7ED9;<code>init</code>&#x65B9;&#x6CD5;&#x6765;&#x6FC0;&#x6D3B;&#x672C;&#x673A;&#x6A21;&#x5F0F;&#xFF1A;</p>
<pre><code class="lang-javascript">keycloak.init({ adapter: <span class="hljs-string">&apos;cordova-native&apos;</span> })
</code></pre>
<p>&#x6B64;&#x9002;&#x914D;&#x5668;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x63D2;&#x4EF6;&#xFF1A;</p>
<ul>
<li><a href="https://github.com/google/cordova-plugin-browsertab" target="_blank">cordova-plugin-browsertab</a>: &#x5141;&#x8BB8;&#x8BE5;&#x5E94;&#x7528;&#x5728;&#x7CFB;&#x7EDF;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x6253;&#x5F00;&#x7F51;&#x9875;</li>
<li><a href="https://github.com/e-imaxina/cordova-plugin-deeplinks" target="_blank">cordova-plugin-deeplinks</a>: &#x5141;&#x8BB8;&#x6D4F;&#x89C8;&#x5668;&#x901A;&#x8FC7;&#x7279;&#x6B8A;&#x7F51;&#x5740;&#x91CD;&#x5B9A;&#x5411;&#x56DE;&#x60A8;&#x7684;&#x5E94;&#x7528;</li>
</ul>
<p>&#x94FE;&#x63A5;&#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6280;&#x672F;&#x7EC6;&#x8282;&#x5728;&#x6BCF;&#x4E2A;&#x5E73;&#x53F0;&#x4E0A;&#x90FD;&#x6709;&#x6240;&#x4E0D;&#x540C;&#xFF0C;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x7279;&#x6B8A;&#x8BBE;&#x7F6E;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://github.com/e-imaxina/cordova-plugin-deeplinks/blob/master/README.md" target="_blank">deeplinks&#x63D2;&#x4EF6;&#x6587;&#x6863;</a>&#x7684;Android&#x548C;iOS&#x90E8;&#x5206;&#x3002;</p>
<p>&#x6253;&#x5F00;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6709;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x94FE;&#x63A5;:&#x81EA;&#x5B9A;&#x4E49;&#x65B9;&#x6848;(&#x5373;<code>myapp://login</code>&#x6216;<code>android-app://com.example.myapp/https/example.com/login</code>)&#x548C;<a href="(https:/developer.apple.com/ios/universal-links">Universal Links(iOS) )</a>)/ <a href="https://developer.android.com/training/app-links/deep-linking" target="_blank">Deep Links(Android)</a>. &#x867D;&#x7136;&#x524D;&#x8005;&#x66F4;&#x5BB9;&#x6613;&#x8BBE;&#x7F6E;&#x5E76;&#x4E14;&#x66F4;&#x5BB9;&#x6613;&#x5DE5;&#x4F5C;,&#x4F46;&#x540E;&#x8005;&#x63D0;&#x4F9B;&#x4E86;&#x989D;&#x5916;&#x7684;&#x5B89;&#x5168;&#x6027;,&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x662F;&#x552F;&#x4E00;&#x7684;,&#x53EA;&#x6709;&#x57DF;&#x7684;&#x6240;&#x6709;&#x8005;&#x624D;&#x80FD;&#x6CE8;&#x518C;&#x5B83;&#x4EEC;. iOS&#x4E0A;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x5740;. &#x6211;&#x4EEC;&#x5EFA;&#x8BAE;&#x60A8;&#x4F7F;&#x7528;&#x901A;&#x7528;&#x94FE;&#x63A5;,&#x5E76;&#x5728;&#x5176;&#x4E0A;&#x9644;&#x5E26;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x5740;&#x94FE;&#x63A5;&#x7684;&#x5907;&#x7528;&#x7F51;&#x7AD9;,&#x4EE5;&#x83B7;&#x5F97;&#x6700;&#x4F73;&#x53EF;&#x9760;&#x6027;.</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x5EFA;&#x8BAE;&#x91C7;&#x7528;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#x6765;&#x6539;&#x5584;&#x4E0E;Keycloak&#x9002;&#x914D;&#x5668;&#x7684;&#x517C;&#x5BB9;&#x6027;&#xFF1A;</p>
<ul>
<li>&#x5F53;<code>response-mode</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>query</code>&#x65F6;&#xFF0C;iOS&#x4E0A;&#x7684;Universal Links&#x4F3C;&#x4E4E;&#x66F4;&#x53EF;&#x9760;</li>
<li>&#x4E3A;&#x9632;&#x6B62;Android&#x5728;&#x91CD;&#x5B9A;&#x5411;&#x4E0A;&#x6253;&#x5F00;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7684;&#x65B0;&#x5B9E;&#x4F8B;&#xFF0C;&#x8BF7;&#x5C06;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x6BB5;&#x6DFB;&#x52A0;&#x5230;<code>config.xml</code>&#xFF1A;</li>
</ul>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">preference</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;AndroidLaunchMode&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;singleTask&quot;</span> /&gt;</span>
</code></pre>
<p>&#x6709;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x663E;&#x793A;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x672C;&#x673A;&#x6A21;&#x5F0F;&#xFF1A;<a href="https://github.com/keycloak/keycloak/tree/master/examples/cordova-native" target="_blank">https://github.com/keycloak/keycloak/tree/master/examples/cordova-native</a></p>
<p><a name="114_____2_2_4__&#x65E9;&#x671F;&#x7684;&#x6D4F;&#x89C8;&#x5668;"></a></p>
<h4 id="224-&#x65E9;&#x671F;&#x7684;&#x6D4F;&#x89C8;&#x5668;"><a name="224-&#x65E9;&#x671F;&#x7684;&#x6D4F;&#x89C8;&#x5668;" class="anchor-navigation-ex-anchor" href="#224-&#x65E9;&#x671F;&#x7684;&#x6D4F;&#x89C8;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.4. &#x65E9;&#x671F;&#x7684;&#x6D4F;&#x89C8;&#x5668;</h4>
<p>JavaScript&#x9002;&#x914D;&#x5668;&#x4F9D;&#x8D56;&#x4E8E;Base64&#xFF08;window.btoa&#x548C;window.atob&#xFF09;&#xFF0C;HTML5 History API&#x548C;&#x53EF;&#x9009;&#x7684;Promise API&#x3002; &#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x652F;&#x6301;&#x90A3;&#x4E9B;&#x6CA1;&#x6709;&#x8FD9;&#x4E9B;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;IE9&#xFF09;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x6DFB;&#x52A0;polyfillers&#x3002;</p>
<p>&#x793A;&#x4F8B;polyfill&#x5E93;&#xFF1A;</p>
<ul>
<li>Base64 - <a href="https://github.com/davidchambers/Base64.js" target="_blank">https://github.com/davidchambers/Base64.js</a></li>
<li>HTML5 History - <a href="https://github.com/devote/HTML5-History-API" target="_blank">https://github.com/devote/HTML5-History-API</a></li>
<li>Promise - <a href="https://github.com/stefanpenner/es6-promise" target="_blank">https://github.com/stefanpenner/es6-promise</a></li>
</ul>
<p><a name="115_____2_2_5__JavaScript&#x9002;&#x914D;&#x5668;&#x53C2;&#x8003;"></a></p>
<h4 id="225-javascript&#x9002;&#x914D;&#x5668;&#x53C2;&#x8003;"><a name="225-javascript&#x9002;&#x914D;&#x5668;&#x53C2;&#x8003;" class="anchor-navigation-ex-anchor" href="#225-javascript&#x9002;&#x914D;&#x5668;&#x53C2;&#x8003;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.5. JavaScript&#x9002;&#x914D;&#x5668;&#x53C2;&#x8003;</h4>
<p><a name="116______&#x6784;&#x9020;&#x51FD;&#x6570;"></a></p>
<h5 id="&#x6784;&#x9020;&#x51FD;&#x6570;"><a name="&#x6784;&#x9020;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#&#x6784;&#x9020;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6784;&#x9020;&#x51FD;&#x6570;</h5>
<pre><code class="lang-javascript"><span class="hljs-keyword">new</span> Keycloak();
<span class="hljs-keyword">new</span> Keycloak(<span class="hljs-string">&apos;http://localhost/keycloak.json&apos;</span>);
<span class="hljs-keyword">new</span> Keycloak({ url: <span class="hljs-string">&apos;http://localhost/auth&apos;</span>, realm: <span class="hljs-string">&apos;myrealm&apos;</span>, clientId: <span class="hljs-string">&apos;myApp&apos;</span> });
</code></pre>
<p><a name="117______&#x5C5E;&#x6027;"></a></p>
<h5 id="&#x5C5E;&#x6027;"><a name="&#x5C5E;&#x6027;" class="anchor-navigation-ex-anchor" href="#&#x5C5E;&#x6027;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5C5E;&#x6027;</h5>
<ul>
<li><p>authenticated</p>
<p>&#x5982;&#x679C;&#x7528;&#x6237;&#x901A;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5219;&#x4E3A;<code>true</code>&#xFF0C;&#x5426;&#x5219;&#x4E3A;<code>false</code>&#x3002;</p>
</li>
<li><p>token</p>
<p>base64&#x7F16;&#x7801;&#x7684;&#x4EE4;&#x724C;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5BF9;&#x670D;&#x52A1;&#x7684;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;<code>Authorization</code>&#x5934;&#x4E2D;&#x53D1;&#x9001;&#x3002;</p>
</li>
<li><p>tokenParsed</p>
<p>&#x89E3;&#x6790;&#x540E;&#x7684;&#x4EE4;&#x724C;&#x4F5C;&#x4E3A;JavaScript&#x5BF9;&#x8C61;&#x3002;</p>
</li>
<li><p>subject</p>
<p>&#x7528;&#x6237;ID&#x3002;</p>
</li>
<li><p>idToken</p>
<p>base64&#x7F16;&#x7801;&#x7684;ID&#x4EE4;&#x724C;&#x3002;</p>
</li>
<li><p>idTokenParsed</p>
<p>&#x89E3;&#x6790;&#x7684;id&#x4EE4;&#x724C;&#x4F5C;&#x4E3A;JavaScript&#x5BF9;&#x8C61;&#x3002;</p>
</li>
<li><p>realmAccess</p>
<p>&#x4E0E;&#x4EE4;&#x724C;&#x5173;&#x8054;&#x7684;&#x57DF;&#x89D2;&#x8272;&#x3002;</p>
</li>
<li><p>resourceAccess</p>
<p>&#x4E0E;&#x4EE4;&#x724C;&#x5173;&#x8054;&#x7684;&#x8D44;&#x6E90;&#x89D2;&#x8272;&#x3002;</p>
</li>
<li><p>refreshToken</p>
<p>base64&#x7F16;&#x7801;&#x7684;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#xFF0C;&#x53EF;&#x7528;&#x4E8E;&#x68C0;&#x7D22;&#x65B0;&#x4EE4;&#x724C;&#x3002;</p>
</li>
<li><p>refreshTokenParsed</p>
<p>&#x89E3;&#x6790;&#x540E;&#x7684;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x4F5C;&#x4E3A;JavaScript&#x5BF9;&#x8C61;&#x3002;</p>
</li>
<li><p>timeSkew</p>
<p>&#x6D4F;&#x89C8;&#x5668;&#x65F6;&#x95F4;&#x4E0E;Keycloak&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x4F30;&#x8BA1;&#x65F6;&#x95F4;&#x5DEE;&#xFF0C;&#x4EE5;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#x3002; &#x6B64;&#x503C;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x4F30;&#x8BA1;&#x503C;&#xFF0C;&#x4F46;&#x5728;&#x786E;&#x5B9A;&#x4EE4;&#x724C;&#x662F;&#x5426;&#x5DF2;&#x8FC7;&#x671F;&#x65F6;&#x8DB3;&#x591F;&#x51C6;&#x786E;&#x3002;</p>
</li>
<li><p>responseMode</p>
<p>&#x5728;init&#x4E2D;&#x4F20;&#x9012;&#x7684;&#x54CD;&#x5E94;&#x6A21;&#x5F0F;&#xFF08;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;fragment&#xFF09;&#x3002;</p>
</li>
<li><p>flow</p>
<p>&#x6D41;&#x7A0B;&#x5728;init&#x4E2D;&#x4F20;&#x9012;&#x3002;</p>
</li>
<li><p>adapter</p>
<p>&#x5141;&#x8BB8;&#x60A8;&#x8986;&#x76D6;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x65B9;&#x5F0F;&#x4EE5;&#x53CA;&#x5E93;&#x5904;&#x7406;&#x5176;&#x4ED6;&#x4E0E;&#x6D4F;&#x89C8;&#x5668;&#x76F8;&#x5173;&#x7684;&#x51FD;&#x6570;&#x3002; &#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;&#x201C;default(&#x9ED8;&#x8BA4;)&#x201D; - &#x5E93;&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;api&#x8FDB;&#x884C;&#x91CD;&#x5B9A;&#x5411;&#xFF08;&#x8FD9;&#x662F;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#xFF09;&#x201C;cordova&#x201D; - &#x5E93;&#x5C06;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;InAppBrowser cordova&#x63D2;&#x4EF6;&#x52A0;&#x8F7D;keycloak&#x767B;&#x5F55;/&#x6CE8;&#x518C;&#x9875;&#x9762;&#xFF08;&#x8FD9;&#x5728;&#x5E93;&#x65F6;&#x81EA;&#x52A8;&#x4F7F;&#x7528;&#xFF09; &#x6B63;&#x5728;&#x4F7F;&#x7528;Cordova&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#xFF09;&#x201C;cordova-native&#x201D; - &#x56FE;&#x4E66;&#x9986;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;BrowserTabs cordova&#x63D2;&#x4EF6;&#x4F7F;&#x7528;&#x624B;&#x673A;&#x7684;&#x7CFB;&#x7EDF;&#x6D4F;&#x89C8;&#x5668;&#x6253;&#x5F00;&#x767B;&#x5F55;&#x548C;&#x6CE8;&#x518C;&#x9875;&#x9762;&#x3002; &#x8FD9;&#x9700;&#x8981;&#x989D;&#x5916;&#x8BBE;&#x7F6E;&#x4EE5;&#x91CD;&#x5B9A;&#x5411;&#x56DE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;(&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#hybrid-apps-with-cordova" target="_blank">&#x4F7F;&#x7528;Cordova&#x7684;&#x6DF7;&#x5408;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</a>).custom - &#x5141;&#x8BB8;&#x60A8;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;&#x9002;&#x914D;&#x5668;&#xFF08;&#x4EC5;&#x9002;&#x7528;&#x4E8E;&#x9AD8;&#x7EA7;&#x7528;&#x4F8B;&#xFF09;</p>
</li>
<li><p>responseType</p>
<p>&#x54CD;&#x5E94;&#x7C7B;&#x578B;&#x901A;&#x8FC7;&#x767B;&#x5F55;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x5230;Keycloak&#x3002; &#x8FD9;&#x662F;&#x6839;&#x636E;&#x521D;&#x59CB;&#x5316;&#x671F;&#x95F4;&#x4F7F;&#x7528;&#x7684;&#x6D41;&#x91CF;&#x503C;&#x786E;&#x5B9A;&#x7684;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x6B64;&#x503C;&#x6765;&#x8986;&#x76D6;&#x3002;</p>
</li>
</ul>
<p><a name="118______&#x65B9;&#x6CD5;"></a></p>
<h5 id="&#x65B9;&#x6CD5;"><a name="&#x65B9;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x65B9;&#x6CD5;</h5>
<p><a name="119_______init&#xFF08;&#x9009;&#x9879;&#xFF09;"></a></p>
<h6 id="init&#xFF08;&#x9009;&#x9879;&#xFF09;"><a name="init&#xFF08;&#x9009;&#x9879;&#xFF09;" class="anchor-navigation-ex-anchor" href="#init&#xFF08;&#x9009;&#x9879;&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>init&#xFF08;&#x9009;&#x9879;&#xFF09;</h6>
<p>&#x8C03;&#x7528;&#x521D;&#x59CB;&#x5316;&#x9002;&#x914D;&#x5668;&#x3002;</p>
<p>&#x9009;&#x9879;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5176;&#x4E2D;&#xFF1A;</p>
<ul>
<li>onLoad - &#x6307;&#x5B9A;&#x8981;&#x5728;&#x52A0;&#x8F7D;&#x65F6;&#x6267;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#x3002; &#x652F;&#x6301;&#x7684;&#x503C;&#x4E3A;<code>login-required</code>&#x6216;<code>check-sso</code>&#x3002;</li>
<li>token - &#x8BBE;&#x7F6E;&#x4EE4;&#x724C;&#x7684;&#x521D;&#x59CB;&#x503C;&#x3002;</li>
<li>refreshToken - &#x8BBE;&#x7F6E;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x7684;&#x521D;&#x59CB;&#x503C;&#x3002;</li>
<li>idToken - &#x8BBE;&#x7F6E;id&#x4EE4;&#x724C;&#x7684;&#x521D;&#x59CB;&#x503C;&#xFF08;&#x4EC5;&#x4E0E;token&#x6216;refreshToken&#x4E00;&#x8D77;&#xFF09;&#x3002;</li>
<li>timeSkew - &#x5728;&#x51E0;&#x79D2;&#x949F;&#x5185;&#x8BBE;&#x7F6E;&#x672C;&#x5730;&#x65F6;&#x95F4;&#x548C;Keycloak&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x504F;&#x5DEE;&#x521D;&#x59CB;&#x503C;&#xFF08;&#x4EC5;&#x4E0E;token&#x6216;refreshToken&#x4E00;&#x8D77;&#xFF09;&#x3002;</li>
<li>checkLoginIframe - &#x8BBE;&#x7F6E;&#x4E3A;&#x542F;&#x7528;/&#x7981;&#x7528;&#x76D1;&#x63A7;&#x767B;&#x5F55;&#x72B6;&#x6001;&#xFF08;&#x9ED8;&#x8BA4;&#x4E3A;true&#xFF09;&#x3002;</li>
<li>checkLoginIframeInterval - &#x8BBE;&#x7F6E;&#x68C0;&#x67E5;&#x767B;&#x5F55;&#x72B6;&#x6001;&#x7684;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#xFF08;&#x9ED8;&#x8BA4;&#x4E3A;5&#x79D2;&#xFF09;&#x3002;</li>
<li>responseMode - &#x5C06;OpenID Connect&#x54CD;&#x5E94;&#x6A21;&#x5F0F;&#x8BBE;&#x7F6E;&#x4E3A;&#x5728;&#x767B;&#x5F55;&#x8BF7;&#x6C42;&#x65F6;&#x53D1;&#x9001;&#x5230;Keycloak&#x670D;&#x52A1;&#x5668;&#x3002; &#x6709;&#x6548;&#x503C;&#x662F;&#x67E5;&#x8BE2;&#x6216;&#x7247;&#x6BB5;&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;fragment&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5728;&#x6210;&#x529F;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x540E;&#xFF0C;Keycloak&#x5C06;&#x91CD;&#x5B9A;&#x5411;&#x5230;javascript&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5E76;&#x5728;URL&#x7247;&#x6BB5;&#x4E2D;&#x6DFB;&#x52A0;OpenID Connect&#x53C2;&#x6570;&#x3002; &#x8FD9;&#x901A;&#x5E38;&#x6BD4;&#x67E5;&#x8BE2;&#x66F4;&#x5B89;&#x5168;&#x548C;&#x63A8;&#x8350;&#x3002;</li>
<li>flow - &#x8BBE;&#x7F6E;OpenID Connect&#x6D41;&#x7A0B;&#x3002; &#x6709;&#x6548;&#x503C;&#x662F;standard(&#x6807;&#x51C6;&#x503C;)&#xFF0C;implicit (&#x9690;&#x5F0F;&#x503C;)&#x6216;hybrid(&#x6DF7;&#x5408;&#x503C;)&#x3002;</li>
<li>promiseType - &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A;<code>native</code>&#xFF0C;&#x5219;&#x8FD4;&#x56DE;promise&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;&#x90FD;&#x5C06;&#x8FD4;&#x56DE;&#x672C;&#x673A;JavaScript promise&#x3002; &#x5982;&#x679C;&#x672A;&#x8BBE;&#x7F6E;&#xFF0C;&#x5C06;&#x8FD4;&#x56DE;Keycloak&#x7279;&#x5B9A;&#x7684;promise&#x5BF9;&#x8C61;&#x3002;</li>
</ul>
<p>&#x8FD4;&#x56DE;promise&#x8BBE;&#x7F6E;&#x5728;&#x6210;&#x529F;&#x6216;&#x9519;&#x8BEF;&#x65F6;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x3002;</p>
<p><a name="120_______login_&#x9009;&#x9879;_"></a></p>
<h6 id="login&#x9009;&#x9879;"><a name="login&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#login&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>login(&#x9009;&#x9879;)</h6>
<p>&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x767B;&#x5F55;&#x8868;&#x5355;&#xFF08;&#x9009;&#x9879;&#x662F;&#x5E26;&#x6709;redirectUri&#x548C;/&#x6216;&#x63D0;&#x793A;&#x5B57;&#x6BB5;&#x7684;&#x53EF;&#x9009;&#x5BF9;&#x8C61;&#xFF09;&#x3002;</p>
<p>&#x9009;&#x9879;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5176;&#x4E2D;&#xFF1A;</p>
<ul>
<li>redirectUri - &#x6307;&#x5B9A;&#x767B;&#x5F55;&#x540E;&#x8981;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x7684;URI&#x3002;</li>
<li>prompt - &#x6B64;&#x53C2;&#x6570;&#x5141;&#x8BB8;&#x7A0D;&#x5FAE;&#x81EA;&#x5B9A;&#x4E49;Keycloak&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;&#x767B;&#x5F55;&#x6D41;&#x7A0B;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x503C;&#x4E3A;<code>login</code>&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5F3A;&#x5236;&#x663E;&#x793A;&#x767B;&#x5F55;&#x5C4F;&#x5E55;&#x3002; &#x6709;&#x5173;<code>prompt</code>&#x53C2;&#x6570;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x548C;&#x6240;&#x6709;&#x53EF;&#x80FD;&#x503C;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_params_forwarding" target="_blank">&#x53C2;&#x6570;&#x8F6C;&#x53D1;&#x90E8;&#x5206;</a> &#x3002;</li>
<li>maxAge - &#x4EC5;&#x5728;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65F6;&#x4F7F;&#x7528;&#x3002; &#x6307;&#x5B9A;&#x81EA;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x4EE5;&#x6765;&#x7684;&#x6700;&#x957F;&#x65F6;&#x95F4;&#x3002; &#x5982;&#x679C;&#x7528;&#x6237;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65F6;&#x95F4;&#x6BD4;<code>maxAge</code>&#x957F;&#xFF0C;&#x5219;&#x4F1A;&#x5FFD;&#x7565;SSO&#xFF0C;&#x5E76;&#x4E14;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;</li>
<li>loginHint - &#x7528;&#x4E8E;&#x9884;&#x586B;&#x5145;&#x767B;&#x5F55;&#x8868;&#x5355;&#x4E0A;&#x7684;&#x7528;&#x6237;&#x540D;/&#x7535;&#x5B50;&#x90AE;&#x4EF6;&#x5B57;&#x6BB5;&#x3002;</li>
<li>scope - &#x7528;&#x4E8E;&#x5C06;scope&#x53C2;&#x6570;&#x8F6C;&#x53D1;&#x5230;Keycloak&#x767B;&#x5F55;&#x7AEF;&#x70B9;&#x3002; &#x4F7F;&#x7528;&#x4EE5;&#x7A7A;&#x683C;&#x5206;&#x9694;&#x7684;&#x8303;&#x56F4;&#x5217;&#x8868;&#x3002; &#x8FD9;&#x4E9B;&#x901A;&#x5E38;&#x5F15;&#x7528;&#x5728;&#x7279;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x5B9A;&#x4E49;&#x7684;<a href="https://www.keycloak.org/docs/6.0/server_admin/#_client_scopes" target="_blank">&#x5BA2;&#x6237;&#x7AEF;&#x8303;&#x56F4;</a>&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x8303;&#x56F4;<code>openid</code>&#x5C06;&#x59CB;&#x7EC8;&#x7531;&#x9002;&#x914D;&#x5668;&#x6DFB;&#x52A0;&#x5230;&#x4F5C;&#x7528;&#x57DF;&#x5217;&#x8868;&#x4E2D;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x8F93;&#x5165;&#x8303;&#x56F4;&#x9009;&#x9879;<code>address phone</code>&#xFF0C;&#x5219;&#x5BF9;Keycloak&#x7684;&#x8BF7;&#x6C42;&#x5C06;&#x5305;&#x542B;&#x8303;&#x56F4;&#x53C2;&#x6570;<code>scope=openid address phone</code>&#x3002;</li>
<li>idpHint - &#x7528;&#x4E8E;&#x544A;&#x8BC9;Keycloak&#x8DF3;&#x8FC7;&#x663E;&#x793A;&#x767B;&#x5F55;&#x9875;&#x9762;&#x5E76;&#x81EA;&#x52A8;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#x3002; [&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x6587;&#x6863;]&#x4E2D;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;(<a href="https://www.keycloak.org/docs/6.0/server_admin/#_client_suggested_idp)&#x3002;" target="_blank">https://www.keycloak.org/docs/6.0/server_admin/#_client_suggested_idp)&#x3002;</a></li>
<li>action - &#x5982;&#x679C;&#x503C;&#x4E3A;&apos;register&apos;&#xFF0C;&#x5219;&#x5C06;&#x7528;&#x6237;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x6CE8;&#x518C;&#x9875;&#x9762;&#xFF0C;&#x5426;&#x5219;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x767B;&#x5F55;&#x9875;&#x9762;&#x3002;</li>
<li>locale - &#x6839;&#x636E;OIDC 1.0&#x89C4;&#x8303;&#x7684;3.1.2.1&#x8282;&#x8BBE;&#x7F6E;&apos;ui_locales&apos;&#x67E5;&#x8BE2;&#x53C2;&#x6570;&#x3002;</li>
<li>kcLocale - &#x4E3A;UI&#x6307;&#x5B9A;&#x6240;&#x9700;&#x7684;Keycloak&#x8BED;&#x8A00;&#x73AF;&#x5883;&#x3002; &#x8FD9;&#x4E0E;locale param&#x7684;&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x5728;&#x4E8E;&#x5B83;&#x544A;&#x8BC9;Keycloak&#x670D;&#x52A1;&#x5668;&#x8BBE;&#x7F6E;cookie&#x5E76;&#x5C06;&#x7528;&#x6237;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x66F4;&#x65B0;&#x4E3A;&#x65B0;&#x7684;&#x9996;&#x9009;&#x8BED;&#x8A00;&#x73AF;&#x5883;&#x3002;</li>
<li>cordovaOptions - &#x6307;&#x5B9A;&#x4F20;&#x9012;&#x7ED9;Cordova&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5185;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x53C2;&#x6570;&#xFF08;&#x5982;&#x679C;&#x9002;&#x7528;&#xFF09;&#x3002; &#x9009;&#x9879;<code>hidden</code>&#x548C;<code>location</code>&#x4E0D;&#x53D7;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x7684;&#x5F71;&#x54CD;&#x3002; &#x6240;&#x6709;&#x53EF;&#x7528;&#x9009;&#x9879;&#x5747;&#x5728;<a href="https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-inappbrowser/" target="_blank">https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-inappbrowser/</a>&#x4E2D;&#x5B9A;&#x4E49;&#x3002; &#x4F7F;&#x7528;&#x793A;&#x4F8B;&#xFF1A;<code>{ zoom: &quot;no&quot;, hardwareback: &quot;yes&quot; }</code>;</li>
</ul>
<p><a name="121_______createLoginUrl_&#x9009;&#x9879;_"></a></p>
<h6 id="createloginurl&#x9009;&#x9879;"><a name="createloginurl&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#createloginurl&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>createLoginUrl(&#x9009;&#x9879;)</h6>
<p>&#x8FD4;&#x56DE;&#x767B;&#x5F55;&#x8868;&#x5355;&#x7684;URL&#xFF08;&#x9009;&#x9879;&#x662F;&#x5E26;&#x6709;redirectUri&#x548C;/&#x6216;&#x63D0;&#x793A;&#x5B57;&#x6BB5;&#x7684;&#x53EF;&#x9009;&#x5BF9;&#x8C61;&#xFF09;&#x3002;</p>
<p>Options&#x662F;&#x4E00;&#x4E2A;Object&#xFF0C;&#x5B83;&#x652F;&#x6301;&#x76F8;&#x540C;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x5982;&#x51FD;&#x6570;<code>login</code>&#x3002;</p>
<p><a name="122_______logout_&#x9009;&#x9879;_"></a></p>
<h6 id="logout&#x9009;&#x9879;"><a name="logout&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#logout&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>logout(&#x9009;&#x9879;)</h6>
<p>&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x6CE8;&#x9500;&#x3002;</p>
<p>&#x9009;&#x9879;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5176;&#x4E2D;&#xFF1A;</p>
<ul>
<li>redirectUri - &#x6307;&#x5B9A;&#x6CE8;&#x9500;&#x540E;&#x8981;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x7684;URI&#x3002;</li>
</ul>
<p><a name="123_______createLogoutUrl_&#x9009;&#x9879;_"></a></p>
<h6 id="createlogouturl&#x9009;&#x9879;"><a name="createlogouturl&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#createlogouturl&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>createLogoutUrl(&#x9009;&#x9879;)</h6>
<p>&#x8FD4;&#x56DE;&#x7528;&#x4E8E;&#x6CE8;&#x9500;&#x7528;&#x6237;&#x7684;URL&#x3002;</p>
<p>&#x9009;&#x9879;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5176;&#x4E2D;&#xFF1A;</p>
<ul>
<li>redirectUri - &#x6307;&#x5B9A;&#x6CE8;&#x9500;&#x540E;&#x8981;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x7684;URI&#x3002;</li>
</ul>
<p><a name="124_______register_&#x9009;&#x9879;_"></a></p>
<h6 id="register&#x9009;&#x9879;"><a name="register&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#register&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>register(&#x9009;&#x9879;)</h6>
<p>&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x6CE8;&#x518C;&#x8868;&#x5355;&#x3002; &#x4F7F;&#x7528;&#x9009;&#x9879; action = &apos;register&apos;&#x767B;&#x5F55;&#x7684;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;</p>
<p>&#x9009;&#x9879;&#x4E0E;&#x767B;&#x5F55;&#x65B9;&#x6CD5;&#x76F8;&#x540C;&#xFF0C;&#x4F46;&apos;action&apos;&#x8BBE;&#x7F6E;&#x4E3A;&apos;register&apos;</p>
<p><a name="125_______createRegisterUrl_&#x9009;&#x9879;_"></a></p>
<h6 id="createregisterurl&#x9009;&#x9879;"><a name="createregisterurl&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#createregisterurl&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>createRegisterUrl(&#x9009;&#x9879;)</h6>
<p>&#x8FD4;&#x56DE;&#x6CE8;&#x518C;&#x9875;&#x9762;&#x7684;url&#x3002; &#x5E26;&#x6709;&#x9009;&#x9879;action = &apos;register&apos;&#x7684;createLoginUrl&#x7684;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;</p>
<p>&#x9009;&#x9879;&#x4E0E;createLoginUrl&#x65B9;&#x6CD5;&#x76F8;&#x540C;&#xFF0C;&#x4F46;&apos;action&apos;&#x8BBE;&#x7F6E;&#x4E3A;&apos;register&apos;</p>
<p><a name="126_______accountManagement__"></a></p>
<h6 id="accountmanagement"><a name="accountmanagement" class="anchor-navigation-ex-anchor" href="#accountmanagement"><i class="fa fa-link" aria-hidden="true"></i></a>accountManagement()</h6>
<p>&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x5E10;&#x6237;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x3002;</p>
<p><a name="127_______createAccountUrl__"></a></p>
<h6 id="createaccounturl"><a name="createaccounturl" class="anchor-navigation-ex-anchor" href="#createaccounturl"><i class="fa fa-link" aria-hidden="true"></i></a>createAccountUrl()</h6>
<p>&#x8FD4;&#x56DE;&#x5E10;&#x6237;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x7684;URL&#x3002;</p>
<p><a name="128_______hasRealmRole_role_"></a></p>
<h6 id="hasrealmrolerole"><a name="hasrealmrolerole" class="anchor-navigation-ex-anchor" href="#hasrealmrolerole"><i class="fa fa-link" aria-hidden="true"></i></a>hasRealmRole(role)</h6>
<p>&#x5982;&#x679C;&#x4EE4;&#x724C;&#x5177;&#x6709;&#x7ED9;&#x5B9A;&#x7684;&#x57DF;&#x89D2;&#x8272;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;true&#x3002;</p>
<p><a name="129_______hasResourceRole_role__resource_"></a></p>
<h6 id="hasresourcerolerole-resource"><a name="hasresourcerolerole-resource" class="anchor-navigation-ex-anchor" href="#hasresourcerolerole-resource"><i class="fa fa-link" aria-hidden="true"></i></a>hasResourceRole(role, resource)</h6>
<p>&#x5982;&#x679C;&#x4EE4;&#x724C;&#x5177;&#x6709;&#x8D44;&#x6E90;&#x7684;&#x7ED9;&#x5B9A;&#x89D2;&#x8272;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;true&#xFF08;&#x5982;&#x679C;&#x672A;&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7684;clientId&#xFF0C;&#x5219;&#x8D44;&#x6E90;&#x662F;&#x53EF;&#x9009;&#x7684;&#xFF09;&#x3002;</p>
<p><a name="130_______loadUserProfile__"></a></p>
<h6 id="loaduserprofile"><a name="loaduserprofile" class="anchor-navigation-ex-anchor" href="#loaduserprofile"><i class="fa fa-link" aria-hidden="true"></i></a>loadUserProfile()</h6>
<p>&#x52A0;&#x8F7D;&#x7528;&#x6237;&#x4E2A;&#x4EBA;&#x8D44;&#x6599;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6210;&#x529F;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x6216;&#x8005;&#x65E0;&#x6CD5;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;promise&#x8BBE;&#x7F6E;&#x8981;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-javascript">keycloak.loadUserProfile().success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
        alert(<span class="hljs-built_in">JSON</span>.stringify(profile, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;  &quot;</span>));
    }).error(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        alert(<span class="hljs-string">&apos;Failed to load user profile&apos;</span>);
    });
</code></pre>
<p><a name="131_______isTokenExpired_minValidity_"></a></p>
<h6 id="istokenexpiredminvalidity"><a name="istokenexpiredminvalidity" class="anchor-navigation-ex-anchor" href="#istokenexpiredminvalidity"><i class="fa fa-link" aria-hidden="true"></i></a>isTokenExpired(minValidity)</h6>
<p>&#x5982;&#x679C;&#x4EE4;&#x724C;&#x5728;&#x5230;&#x671F;&#x4E4B;&#x524D;&#x7684;&#x5269;&#x4F59;&#x65F6;&#x95F4;&#x5C0F;&#x4E8E;minValidity&#x79D2;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;true&#xFF08;minValidity&#x662F;&#x53EF;&#x9009;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x672A;&#x6307;&#x5B9A;0&#x5219;&#x4F7F;&#x7528;&#xFF09;&#x3002;</p>
<p><a name="132_______updateToken_minValidity_"></a></p>
<h6 id="updatetokenminvalidity"><a name="updatetokenminvalidity" class="anchor-navigation-ex-anchor" href="#updatetokenminvalidity"><i class="fa fa-link" aria-hidden="true"></i></a>updateToken(minValidity)</h6>
<p>&#x5982;&#x679C;&#x4EE4;&#x724C;&#x5728;minValidity&#x79D2;&#x5185;&#x5230;&#x671F;&#xFF08;minValidity&#x662F;&#x53EF;&#x9009;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x672A;&#x6307;&#x5B9A;5&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#xFF09;&#x4EE4;&#x724C;&#x5C06;&#x88AB;&#x5237;&#x65B0;&#x3002; &#x5982;&#x679C;&#x542F;&#x7528;&#x4E86;&#x4F1A;&#x8BDD;&#x72B6;&#x6001;iframe&#xFF0C;&#x5219;&#x8FD8;&#x4F1A;&#x68C0;&#x67E5;&#x4F1A;&#x8BDD;&#x72B6;&#x6001;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4EE4;&#x724C;&#x4ECD;&#x7136;&#x6709;&#x6548;&#xFF0C;&#x6216;&#x8005;&#x4EE4;&#x724C;&#x4E0D;&#x518D;&#x6709;&#x6548;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x627F;&#x8BFA;&#x8BBE;&#x7F6E;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x3002; &#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-javascript">keycloak.updateToken(<span class="hljs-number">5</span>).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">refreshed</span>) </span>{
        <span class="hljs-keyword">if</span> (refreshed) {
            alert(<span class="hljs-string">&apos;Token was successfully refreshed&apos;</span>);
        } <span class="hljs-keyword">else</span> {
            alert(<span class="hljs-string">&apos;Token is still valid&apos;</span>);
        }
    }).error(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        alert(<span class="hljs-string">&apos;Failed to refresh the token, or the session has expired&apos;</span>);
    });
</code></pre>
<p><a name="133_______clearToken__"></a></p>
<h6 id="cleartoken"><a name="cleartoken" class="anchor-navigation-ex-anchor" href="#cleartoken"><i class="fa fa-link" aria-hidden="true"></i></a>clearToken()</h6>
<p>&#x6E05;&#x9664;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x72B6;&#x6001;&#xFF0C;&#x5305;&#x62EC;&#x4EE4;&#x724C;&#x3002; &#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x68C0;&#x6D4B;&#x5230;&#x4F1A;&#x8BDD;&#x5DF2;&#x8FC7;&#x671F;&#xFF0C;&#x4F8B;&#x5982;&#x66F4;&#x65B0;&#x4EE4;&#x724C;&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x6B64;&#x529F;&#x80FD;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p>
<p>&#x8C03;&#x7528;&#x6B64;&#x7ED3;&#x679C;&#x4F1A;&#x5BFC;&#x81F4;&#x8C03;&#x7528;onAuthLogout&#x56DE;&#x8C03;&#x4FA6;&#x542C;&#x5668;&#x3002;</p>
<p><a name="134______Callback_Events"></a></p>
<h5 id="callback-events"><a name="callback-events" class="anchor-navigation-ex-anchor" href="#callback-events"><i class="fa fa-link" aria-hidden="true"></i></a>Callback Events</h5>
<p>&#x9002;&#x914D;&#x5668;&#x652F;&#x6301;&#x4E3A;&#x67D0;&#x4E9B;&#x4E8B;&#x4EF6;&#x8BBE;&#x7F6E;&#x56DE;&#x8C03;&#x4FA6;&#x542C;&#x5668;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-javascript">keycloak.onAuthSuccess = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ alert(<span class="hljs-string">&apos;authenticated&apos;</span>); }
</code></pre>
<p>&#x53EF;&#x7528;&#x7684;&#x4E8B;&#x4EF6;&#x662F;&#xFF1A;</p>
<ul>
<li>onReady(authenticated) - &#x521D;&#x59CB;&#x5316;&#x9002;&#x914D;&#x5668;&#x65F6;&#x8C03;&#x7528;&#x3002;</li>
<li>onAuthSuccess - &#x5728;&#x6210;&#x529F;&#x9A8C;&#x8BC1;&#x7528;&#x6237;&#x65F6;&#x8C03;&#x7528;&#x3002;</li>
<li>onAuthError - &#x5982;&#x679C;&#x5728;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x671F;&#x95F4;&#x51FA;&#x9519;&#xFF0C;&#x5219;&#x8C03;&#x7528;&#x3002;</li>
<li>onAuthRefreshSuccess - &#x5237;&#x65B0;&#x4EE4;&#x724C;&#x65F6;&#x8C03;&#x7528;&#x3002;</li>
<li>onAuthRefreshError - &#x5982;&#x679C;&#x5728;&#x5C1D;&#x8BD5;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x65F6;&#x51FA;&#x73B0;&#x9519;&#x8BEF;&#xFF0C;&#x5219;&#x8C03;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x3002;</li>
<li>onAuthLogout - &#x5982;&#x679C;&#x7528;&#x6237;&#x5DF2;&#x6CE8;&#x9500;&#xFF0C;&#x5219;&#x8C03;&#x7528;&#xFF08;&#x4EC5;&#x5728;&#x542F;&#x7528;&#x4F1A;&#x8BDD;&#x72B6;&#x6001;iframe&#x65F6;&#x6216;&#x5728;Cordova&#x6A21;&#x5F0F;&#x4E0B;&#x8C03;&#x7528;&#xFF09;&#x3002;</li>
<li>onTokenExpired - &#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x8FC7;&#x671F;&#x65F6;&#x8C03;&#x7528;&#x3002; &#x5982;&#x679C;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x53EF;&#x7528;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;updateToken&#x5237;&#x65B0;&#x4EE4;&#x724C;&#xFF0C;&#x6216;&#x8005;&#x5728;&#x4E0D;&#x4F7F;&#x7528;updateToken&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF08;&#x5373;&#x4F7F;&#x7528;implicit flow&lt;&#x9690;&#x5F0F;&#x6D41;&gt;&#xFF09;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x767B;&#x5F55;&#x5C4F;&#x5E55;&#x4EE5;&#x83B7;&#x53D6;&#x65B0;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;</li>
</ul>
<p><a name="135____2_3__Node_js_&#x9002;&#x914D;&#x5668;"></a></p>
<h3 id="23-nodejs-&#x9002;&#x914D;&#x5668;"><a name="23-nodejs-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#23-nodejs-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. Node.js &#x9002;&#x914D;&#x5668;</h3>
<p>Keycloak&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x6784;&#x5EFA;&#x5728;<a href="https://github.com/senchalabs/connect" target="_blank">Connect</a>&#x4E4B;&#x4E0A;&#x7684;Node.js&#x9002;&#x914D;&#x5668;&#xFF0C;&#x4EE5;&#x4FDD;&#x62A4;&#x670D;&#x52A1;&#x5668;&#x7AEF;JavaScript&#x5E94;&#x7528;&#x7A0B;&#x5E8F; - &#x76EE;&#x6807;&#x662F;&#x8DB3;&#x591F;&#x7075;&#x6D3B;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0E;<a href="https://expressjs.com/" target="_blank">Express.js</a>&#x7B49;&#x6846;&#x67B6;&#x96C6;&#x6210;&#x3002;</p>
<p>&#x8BE5;&#x5E93;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4ECE;<a href="https://www.npmjs.com/package/keycloak-connect" target="_blank">Keycloak&#x7EC4;&#x7EC7;</a>&#x4E0B;&#x8F7D;&#xFF0C;&#x6E90;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x5728;<a href="https://github.com/keycloak/keycloak-nodejs-connect" target="_blank">GitHub</a>&#x4E0A;&#x83B7;&#x5F97;&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;Node.js&#x9002;&#x914D;&#x5668;&#xFF0C;&#x9996;&#x5148;&#x5FC5;&#x987B;&#x5728;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x4E3A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x9002;&#x914D;&#x5668;&#x652F;&#x6301;&#x516C;&#x5171;&#xFF0C;&#x673A;&#x5BC6;&#x548C;&#x4EC5;&#x627F;&#x8F7D;&#x8BBF;&#x95EE;&#x7C7B;&#x578B;&#x3002; &#x9009;&#x62E9;&#x54EA;&#x4E00;&#x4E2A;&#x53D6;&#x51B3;&#x4E8E;&#x7528;&#x4F8B;&#x573A;&#x666F;&#x3002;</p>
<p>&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x540E;&#xFF0C;&#x5355;&#x51FB;<code>Installation</code>&#x9009;&#x9879;&#x5361;&#xFF0C;&#x4E3A;<code>Format Option</code>&#x9009;&#x62E9;<code>Keycloak OIDC JSON</code>&#xFF0C;&#x7136;&#x540E;&#x5355;&#x51FB;<code>Download</code>&#x3002; &#x4E0B;&#x8F7D;&#x7684;<code>keycloak.json</code>&#x6587;&#x4EF6;&#x5E94;&#x8BE5;&#x4F4D;&#x4E8E;&#x9879;&#x76EE;&#x7684;&#x6839;&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x3002;</p>
<p><a name="136_____2_3_1__&#x5B89;&#x88C5;"></a></p>
<h4 id="231-&#x5B89;&#x88C5;"><a name="231-&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#231-&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.1. &#x5B89;&#x88C5;</h4>
<p>&#x5047;&#x8BBE;&#x60A8;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x4E86;<a href="https://nodejs.org/" target="_blank">Node.js</a>&#xFF0C;&#x8BF7;&#x4E3A;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#xFF1A;</p>
<pre><code class="lang-bash">mkdir myapp &amp;&amp; <span class="hljs-built_in">cd</span> myapp
</code></pre>
<p>&#x4F7F;&#x7528;<code>npm init</code>&#x547D;&#x4EE4;&#x4E3A;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x521B;&#x5EFA;<code>package.json</code>&#x3002; &#x73B0;&#x5728;&#x5728;&#x4F9D;&#x8D56;&#x9879;&#x5217;&#x8868;&#x4E2D;&#x6DFB;&#x52A0;Keycloak&#x8FDE;&#x63A5;&#x9002;&#x914D;&#x5668;&#xFF1A;</p>
<pre><code class="lang-json">    <span class="hljs-string">&quot;dependencies&quot;</span>: {
        <span class="hljs-string">&quot;keycloak-connect&quot;</span>: <span class="hljs-string">&quot;6.0.1&quot;</span>
    }
</code></pre>
<p><a name="137_____2_3_2__&#x7528;&#x6CD5;"></a></p>
<h4 id="232-&#x7528;&#x6CD5;"><a name="232-&#x7528;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#232-&#x7528;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.2. &#x7528;&#x6CD5;</h4>
<ul>
<li><p>&#x5B9E;&#x4F8B;&#x5316;Keycloak&#x7C7B;</p>
<p><code>Keycloak</code>&#x7C7B;&#x63D0;&#x4F9B;&#x4E86;&#x4E0E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x914D;&#x7F6E;&#x548C;&#x96C6;&#x6210;&#x7684;&#x4E2D;&#x5FC3;&#x70B9;&#x3002; &#x6700;&#x7B80;&#x5355;&#x7684;&#x521B;&#x5EFA;&#x4E0D;&#x6D89;&#x53CA;&#x4EFB;&#x4F55;&#x53C2;&#x6570;&#x3002;</p>
</li>
</ul>
<pre><code class="lang-javascript">    <span class="hljs-keyword">var</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;express-session&apos;</span>);
    <span class="hljs-keyword">var</span> Keycloak = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;keycloak-connect&apos;</span>);

    <span class="hljs-keyword">var</span> memoryStore = <span class="hljs-keyword">new</span> session.MemoryStore();
    <span class="hljs-keyword">var</span> keycloak = <span class="hljs-keyword">new</span> Keycloak({ store: memoryStore });
</code></pre>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x5C06;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4E3B;&#x8981;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x65C1;&#x8FB9;&#x627E;&#x5230;&#x540D;&#x4E3A;<code>keycloak.json</code>&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x4EE5;&#x521D;&#x59CB;&#x5316;&#x7279;&#x5B9A;&#x4E8E;keycloak&#x7684;&#x8BBE;&#x7F6E;&#xFF08;&#x516C;&#x94A5;&#xFF0C;&#x57DF;&#x540D;&#xFF0C;&#x5404;&#x79CD;URL&#xFF09;&#x3002; <code>keycloak.json</code>&#x6587;&#x4EF6;&#x662F;&#x4ECE;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x83B7;&#x5F97;&#x7684;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x5B9E;&#x4F8B;&#x5316;&#x4F1A;&#x5BFC;&#x81F4;&#x4F7F;&#x7528;&#x6240;&#x6709;&#x5408;&#x7406;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x3002; &#x4F5C;&#x4E3A;&#x66FF;&#x4EE3;&#x65B9;&#x6848;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x914D;&#x7F6E;&#x5BF9;&#x8C61;&#xFF0C;&#x800C;&#x4E0D;&#x662F;<code>keycloak.json</code>&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-javascript">    <span class="hljs-keyword">let</span> kcConfig = {
        clientId: <span class="hljs-string">&apos;myclient&apos;</span>,
        bearerOnly: <span class="hljs-literal">true</span>,
        serverUrl: <span class="hljs-string">&apos;http://localhost:8080/auth&apos;</span>,
        realm: <span class="hljs-string">&apos;myrealm&apos;</span>,
        realmPublicKey: <span class="hljs-string">&apos;MIIBIjANB...&apos;</span>
    };

    <span class="hljs-keyword">let</span> keycloak = <span class="hljs-keyword">new</span> Keycloak({ store: memoryStore }, kcConfig);
</code></pre>
<p>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x65B9;&#x6CD5;&#x5C06;&#x7528;&#x6237;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x5176;&#x9996;&#x9009;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;</p>
<pre><code class="lang-javascript">    <span class="hljs-keyword">let</span> keycloak = <span class="hljs-keyword">new</span> Keycloak({ store: memoryStore, idpHint: myIdP }, kcConfig);
</code></pre>
<ul>
<li><p>&#x914D;&#x7F6E;Web&#x4F1A;&#x8BDD;&#x5B58;&#x50A8;</p>
<p>&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;Web&#x4F1A;&#x8BDD;&#x6765;&#x7BA1;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x72B6;&#x6001;&#x4EE5;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x81F3;&#x5C11;&#x4E00;&#x4E2A;<code>store</code>&#x53C2;&#x6570;&#x521D;&#x59CB;&#x5316;<code>Keycloak(...)</code>&#xFF0C;&#x4F20;&#x5165;<code>express-session</code>&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x5B9E;&#x9645;&#x4F1A;&#x8BDD;&#x5B58;&#x50A8;&#x3002;</p>
</li>
</ul>
<pre><code class="lang-javascript">    <span class="hljs-keyword">var</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;express-session&apos;</span>);
    <span class="hljs-keyword">var</span> memoryStore = <span class="hljs-keyword">new</span> session.MemoryStore();

    <span class="hljs-keyword">var</span> keycloak = <span class="hljs-keyword">new</span> Keycloak({ store: memoryStore });
</code></pre>
<ul>
<li><p>&#x4F20;&#x9012;&#x81EA;&#x5B9A;&#x4E49;&#x8303;&#x56F4;&#x503C;</p>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8303;&#x56F4;&#x503C;<code>openid</code>&#x4F5C;&#x4E3A;&#x67E5;&#x8BE2;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;Keycloak&#x7684;&#x767B;&#x5F55;URL&#xFF0C;&#x4F46;&#x60A8;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x5176;&#x4ED6;&#x81EA;&#x5B9A;&#x4E49;&#x503C;&#xFF1A;</p>
</li>
</ul>
<pre><code class="lang-javascript">    <span class="hljs-keyword">var</span> keycloak = <span class="hljs-keyword">new</span> Keycloak({ scope: <span class="hljs-string">&apos;offline_access&apos;</span> });
</code></pre>
<p><a name="138_____2_3_3__&#x5B89;&#x88C5;&#x4E2D;&#x95F4;&#x4EF6;"></a></p>
<h4 id="233-&#x5B89;&#x88C5;&#x4E2D;&#x95F4;&#x4EF6;"><a name="233-&#x5B89;&#x88C5;&#x4E2D;&#x95F4;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#233-&#x5B89;&#x88C5;&#x4E2D;&#x95F4;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.3. &#x5B89;&#x88C5;&#x4E2D;&#x95F4;&#x4EF6;</h4>
<p>&#x5B9E;&#x4F8B;&#x5316;&#x540E;&#xFF0C;&#x5C06;&#x4E2D;&#x95F4;&#x4EF6;&#x5B89;&#x88C5;&#x5230;&#x652F;&#x6301;connect&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF1A;</p>
<pre><code class="lang-javascript">    <span class="hljs-keyword">var</span> app = express();

    app.use( keycloak.middleware() );
</code></pre>
<p><a name="139_____2_3_4__&#x68C0;&#x67E5;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"></a></p>
<h4 id="234-&#x68C0;&#x67E5;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><a name="234-&#x68C0;&#x67E5;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;" class="anchor-navigation-ex-anchor" href="#234-&#x68C0;&#x67E5;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.4. &#x68C0;&#x67E5;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;</h4>
<p>&#x8981;&#x5728;&#x8BBF;&#x95EE;&#x8D44;&#x6E90;&#x4E4B;&#x524D;&#x68C0;&#x67E5;&#x7528;&#x6237;&#x662F;&#x5426;&#x5DF2;&#x901A;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x53EA;&#x9700;&#x4F7F;&#x7528;<code>keycloak.checkSso()</code>&#x3002; &#x5B83;&#x53EA;&#x4F1A;&#x5728;&#x7528;&#x6237;&#x5DF2;&#x767B;&#x5F55;&#x65F6;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x5982;&#x679C;&#x7528;&#x6237;&#x672A;&#x767B;&#x5F55;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5C06;&#x91CD;&#x5B9A;&#x5411;&#x56DE;&#x539F;&#x59CB;&#x8BF7;&#x6C42;&#x7684;URL&#x5E76;&#x4FDD;&#x6301;&#x672A;&#x7ECF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF1A;</p>
<pre><code class="lang-javascript">    app.get( <span class="hljs-string">&apos;/check-sso&apos;</span>, keycloak.checkSso(), checkSsoHandler );
</code></pre>
<p><a name="140_____2_3_5__&#x4FDD;&#x62A4;&#x8D44;&#x6E90;"></a></p>
<h4 id="235-&#x4FDD;&#x62A4;&#x8D44;&#x6E90;"><a name="235-&#x4FDD;&#x62A4;&#x8D44;&#x6E90;" class="anchor-navigation-ex-anchor" href="#235-&#x4FDD;&#x62A4;&#x8D44;&#x6E90;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.5. &#x4FDD;&#x62A4;&#x8D44;&#x6E90;</h4>
<ul>
<li><p>&#x7B80;&#x5355;&#x8BA4;&#x8BC1;</p>
<p>&#x8981;&#x5F3A;&#x5236;&#x5728;&#x8BBF;&#x95EE;&#x8D44;&#x6E90;&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x5BF9;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x53EA;&#x9700;&#x4F7F;&#x7528;<code>keycloak.protect()</code>&#x7684;&#x65E0;&#x53C2;&#x6570;&#x7248;&#x672C;&#xFF1A;</p>
</li>
</ul>
<pre><code class="lang-javascript">    app.get( <span class="hljs-string">&apos;/complain&apos;</span>, keycloak.protect(), complaintHandler );
</code></pre>
<ul>
<li><p>&#x57FA;&#x4E8E;&#x89D2;&#x8272;&#x7684;&#x6388;&#x6743;</p>
<p>&#x8981;&#x4FDD;&#x62A4;&#x5177;&#x6709;&#x5F53;&#x524D;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x89D2;&#x8272;&#x7684;&#x8D44;&#x6E90;&#xFF1A;</p>
</li>
</ul>
<pre><code class="lang-javascript">    app.get( <span class="hljs-string">&apos;/special&apos;</span>, keycloak.protect(<span class="hljs-string">&apos;special&apos;</span>), specialHandler );
</code></pre>
<p>&#x8981;&#x4FDD;&#x62A4;&#x5177;&#x6709;<strong>&#x4E0D;&#x540C;</strong>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x89D2;&#x8272;&#x7684;&#x8D44;&#x6E90;&#xFF1A;</p>
<pre><code class="lang-javascript">    app.get( <span class="hljs-string">&apos;/extra-special&apos;</span>, keycloak.protect(<span class="hljs-string">&apos;other-app:special&apos;</span>), extraSpecialHandler );
</code></pre>
<p>&#x8981;&#x4FDD;&#x62A4;&#x5177;&#x6709;&#x9886;&#x57DF;&#x89D2;&#x8272;&#x7684;&#x8D44;&#x6E90;&#xFF1A;</p>
<pre><code class="lang-javascript">    app.get( <span class="hljs-string">&apos;/admin&apos;</span>, keycloak.protect( <span class="hljs-string">&apos;realm:admin&apos;</span> ), adminHandler );
</code></pre>
<ul>
<li><p>&#x9AD8;&#x7EA7;&#x6388;&#x6743;</p>
<p>&#x4E3A;&#x4E86;&#x4FDD;&#x62A4;&#x57FA;&#x4E8E;URL&#x672C;&#x8EAB;&#x90E8;&#x5206;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x5047;&#x8BBE;&#x6BCF;&#x4E2A;&#x90E8;&#x5206;&#x90FD;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x89D2;&#x8272;&#xFF1A;</p>
</li>
</ul>
<pre><code class="lang-javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">protectBySection</span>(<span class="hljs-params">token, request</span>) </span>{
      <span class="hljs-keyword">return</span> token.hasRole( request.params.section );
    }

    app.get( <span class="hljs-string">&apos;/:section/:page&apos;</span>, keycloak.protect( protectBySection ), sectionHandler );
</code></pre>
<p><a name="141_____2_3_6__&#x5176;&#x4ED6;URLs"></a></p>
<h4 id="236-&#x5176;&#x4ED6;urls"><a name="236-&#x5176;&#x4ED6;urls" class="anchor-navigation-ex-anchor" href="#236-&#x5176;&#x4ED6;urls"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.6. &#x5176;&#x4ED6;URLs</h4>
<ul>
<li><p>&#x663E;&#x5F0F;&#x7528;&#x6237;&#x89E6;&#x53D1;&#x7684;&#x6CE8;&#x9500;</p>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E2D;&#x95F4;&#x4EF6;&#x6355;&#x83B7;&#x5BF9;<code>/logout</code>&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;Keycloak&#x4E3A;&#x4E2D;&#x5FC3;&#x7684;&#x6CE8;&#x9500;&#x5DE5;&#x4F5C;&#x6D41;&#x53D1;&#x9001;&#x7528;&#x6237;&#x3002; &#x8FD9;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E3A;<code>middleware()</code>&#x8C03;&#x7528;&#x6307;&#x5B9A;<code>logout</code>&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x6765;&#x6539;&#x53D8;&#xFF1A;</p>
</li>
</ul>
<pre><code class="lang-javascript">    app.use( keycloak.middleware( { logout: <span class="hljs-string">&apos;/logoff&apos;</span> } ));
</code></pre>
<ul>
<li><p>Keycloak Admin Callbacks</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x4E2D;&#x95F4;&#x4EF6;&#x652F;&#x6301;&#x6765;&#x81EA;Keycloak&#x63A7;&#x5236;&#x53F0;&#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x4EE5;&#x6CE8;&#x9500;&#x5355;&#x4E2A;&#x4F1A;&#x8BDD;&#x6216;&#x6240;&#x6709;&#x4F1A;&#x8BDD;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x7684;&#x7BA1;&#x7406;&#x56DE;&#x8C03;&#x76F8;&#x5BF9;&#x4E8E;<code>/</code>&#x7684;&#x6839;URL&#x53D1;&#x751F;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5411;<code>middleware()</code>&#x8C03;&#x7528;&#x63D0;&#x4F9B;<code>admin</code>&#x53C2;&#x6570;&#x6765;&#x66F4;&#x6539;&#xFF1A;</p>
</li>
</ul>
<pre><code class="lang-javascript">    app.use( keycloak.middleware( { admin: <span class="hljs-string">&apos;/callbacks&apos;</span> } );
</code></pre>
<p><a name="142____2_4__Keycloak_&#x770B;&#x95E8;&#x4EBA;"></a></p>
<h3 id="24-keycloak-&#x770B;&#x95E8;&#x4EBA;"><a name="24-keycloak-&#x770B;&#x95E8;&#x4EBA;" class="anchor-navigation-ex-anchor" href="#24-keycloak-&#x770B;&#x95E8;&#x4EBA;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. Keycloak &#x770B;&#x95E8;&#x4EBA;</h3>
<p>Keycloak&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;Go&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x9002;&#x914D;&#x5668;&#xFF0C;&#x7528;&#x4E8E;OpenID Connect&#xFF08;OIDC&#xFF09;&#xFF0C;&#x5B83;&#x652F;&#x6301;&#x6D4F;&#x89C8;&#x5668;cookie&#x6216;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x4E2D;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;</p>
<p>&#x672C;&#x6587;&#x6863;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86;&#x5982;&#x4F55;&#x6784;&#x5EFA;&#x548C;&#x914D;&#x7F6E;keycloak-gatekeeper&#xFF0C;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x5176;&#x6BCF;&#x4E2A;&#x529F;&#x80FD;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;&#x968F;&#x9644;&#x7684;&#x5E2E;&#x52A9;&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x547D;&#x4EE4;&#x548C;&#x5F00;&#x5173;&#x7684;&#x5B8C;&#x6574;&#x5217;&#x8868;&#x3002; &#x901A;&#x8FC7;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x8F93;&#x5165;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x6765;&#x67E5;&#x770B;&#x6587;&#x4EF6;&#xFF08;&#x4FEE;&#x6539;&#x4F4D;&#x7F6E;&#x4EE5;&#x5339;&#x914D;&#x5B89;&#x88C5;keycloak-gatekeeper&#x7684;&#x4F4D;&#x7F6E;&#xFF09;&#xFF1A;</p>
<pre><code class="lang-bash">    $ bin/keycloak-gatekeeper <span class="hljs-built_in">help</span>
</code></pre>
<p><a name="143_____2_4_1__&#x6784;&#x5EFA;"></a></p>
<h4 id="241-&#x6784;&#x5EFA;"><a name="241-&#x6784;&#x5EFA;" class="anchor-navigation-ex-anchor" href="#241-&#x6784;&#x5EFA;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.1. &#x6784;&#x5EFA;</h4>
<p>&#x5148;&#x51B3;&#x6761;&#x4EF6;</p>
<ul>
<li>Golang &#x5FC5;&#x987B;&#x5B89;&#x88C5;.</li>
<li>Make &#x5FC5;&#x987B;&#x5B89;&#x88C5;.</li>
</ul>
<p>&#x8FC7;&#x7A0B;</p>
<ul>
<li>&#x8FD0;&#x884C;<code>make dep-install</code>&#x6765;&#x5B89;&#x88C5;&#x6240;&#x6709;&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#x9879;&#x3002;</li>
<li>&#x8FD0;&#x884C;<code>make test</code>&#x6765;&#x8FD0;&#x884C;&#x5305;&#x542B;&#x7684;&#x6D4B;&#x8BD5;&#x3002;</li>
<li>&#x8FD0;&#x884C;<code>make</code>&#x6765;&#x6784;&#x5EFA;&#x9879;&#x76EE;&#x3002; &#x5982;&#x679C;&#x60A8;&#x5E0C;&#x671B;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6240;&#x6709;&#x5FC5;&#x9700;&#x4F9D;&#x8D56;&#x9879;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>make static</code>&#x3002;</li>
</ul>
<blockquote>
<p>&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;docker&#x5BB9;&#x5668;&#x6784;&#x5EFA;&#xFF1A;<code>make docker-build</code>&#x3002; Docker&#x955C;&#x50CF;&#x53EF;&#x5728;<a href="https://hub.docker.com/r/keycloak/keycloak-gatekeeper/" target="_blank">https://hub.docker.com/r/keycloak/keycloak-gatekeeper/</a>&#x4E0A;&#x627E;&#x5230;&#x3002;</p>
</blockquote>
<p><a name="144_____2_4_2__&#x914D;&#x7F6E;&#x9009;&#x9879;"></a></p>
<h4 id="242-&#x914D;&#x7F6E;&#x9009;&#x9879;"><a name="242-&#x914D;&#x7F6E;&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#242-&#x914D;&#x7F6E;&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.2. &#x914D;&#x7F6E;&#x9009;&#x9879;</h4>
<p>&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x6765;&#x81EA;yaml/json&#x6587;&#x4EF6;&#x6216;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x9009;&#x9879;&#x5217;&#x8868;&#x3002;</p>
<pre><code># is the url for retrieve the OpenID configuration - normally the &lt;server&gt;/auth/realm/&lt;realm_name&gt;
discovery-url: https://keycloak.example.com/auth/realms/&lt;REALM_NAME&gt;
# the client id for the &apos;client&apos; application
client-id: &lt;CLIENT_ID&gt;
# the secret associated to the &apos;client&apos; application
client-secret: &lt;CLIENT_SECRET&gt;
# the interface definition you wish the proxy to listen, all interfaces is specified as &apos;:&lt;port&gt;&apos;, unix sockets as unix://&lt;REL_PATH&gt;|&lt;/ABS PATH&gt;
listen: 127.0.0.1:3000
# whether to enable refresh tokens
enable-refresh-tokens: true
# the location of a certificate you wish the proxy to use for TLS support
tls-cert:
# the location of a private key for TLS
tls-private-key:
# the redirection url, essentially the site url, note: /oauth/callback is added at the end
redirection-url: http://127.0.0.1:3000
# the encryption key used to encode the session state
encryption-key: &lt;ENCRYPTION_KEY&gt;
# the upstream endpoint which we should proxy request
upstream-url: http://127.0.0.1:80
# additional scopes to add to add to the default (openid+email+profile)
scopes:
- vpn-user
# a collection of resource i.e. urls that you wish to protect
resources:
- uri: /admin/test
  # the methods on this url that should be protected, if missing, we assuming all
  methods:
  - GET
  # a list of roles the user must have in order to access urls under the above
  # If all you want is authentication ONLY, simply remove the roles array - the user must be authenticated but
  # no roles are required
  roles:
  - openvpn:vpn-user
  - openvpn:prod-vpn
  - test
- uri: /admin/*
  methods:
  - GET
  roles:
  - openvpn:vpn-user
  - openvpn:commons-prod-vpn
</code></pre><p>&#x5728;&#x547D;&#x4EE4;&#x884C;&#x53D1;&#x51FA;&#x7684;&#x9009;&#x9879;&#x5177;&#x6709;&#x66F4;&#x9AD8;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x5E76;&#x5C06;&#x8986;&#x76D6;&#x6216;&#x5408;&#x5E76;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x5F15;&#x7528;&#x7684;&#x9009;&#x9879;&#x3002; &#x8FD9;&#x91CC;&#x663E;&#x793A;&#x4E86;&#x6BCF;&#x79CD;&#x6837;&#x5F0F;&#x7684;&#x793A;&#x4F8B;&#x3002;</p>
<p><a name="145_____2_4_3__&#x793A;&#x4F8B;&#x7528;&#x6CD5;&#x548C;&#x914D;&#x7F6E;"></a></p>
<h4 id="243-&#x793A;&#x4F8B;&#x7528;&#x6CD5;&#x548C;&#x914D;&#x7F6E;"><a name="243-&#x793A;&#x4F8B;&#x7528;&#x6CD5;&#x548C;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#243-&#x793A;&#x4F8B;&#x7528;&#x6CD5;&#x548C;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.3. &#x793A;&#x4F8B;&#x7528;&#x6CD5;&#x548C;&#x914D;&#x7F6E;</h4>
<p>&#x5047;&#x8BBE;&#x60A8;&#x6709;&#x4E00;&#x4E9B;Web&#x670D;&#x52A1;&#xFF0C;&#x60A8;&#x5E0C;&#x671B;&#x53D7;&#x5230;Keycloak&#x7684;&#x4FDD;&#x62A4;&#xFF1A;</p>
<ul>
<li>&#x4F7F;&#x7528;Keycloak GUI&#x6216;CLI&#x521B;&#x5EFA;<strong>&#x5BA2;&#x6237;&#x7AEF;</strong>; &#x5BA2;&#x6237;&#x7AEF;&#x534F;&#x8BAE;&#x662F;<strong>&apos;openid-connect&apos;</strong>&#xFF0C;&#x8BBF;&#x95EE;&#x7C7B;&#x578B;&#xFF1A;<strong>confidential</strong>&#x3002;</li>
<li>&#x6DFB;&#x52A0;<strong><a href="http://127.0.0.1:3000/oauth/callback" target="_blank">http://127.0.0.1:3000/oauth/callback</a></strong>&#x7684;&#x6709;&#x6548;&#x91CD;&#x5B9A;&#x5411;URI&#x3002;</li>
<li>&#x6293;&#x4F4F;&#x5BA2;&#x6237;&#x7AEF;ID&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x3002;</li>
<li>&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x6216;&#x73B0;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x4E0B;&#x521B;&#x5EFA;&#x5404;&#x79CD;&#x89D2;&#x8272;&#x4EE5;&#x8FDB;&#x884C;&#x6388;&#x6743;&#x3002;</li>
</ul>
<p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<pre><code>client-id: &lt;CLIENT_ID&gt;
client-secret: &lt;CLIENT_SECRET&gt; # require for access_type: confidential
# Note the redirection-url is optional, it will default to the X-Forwarded-Proto / X-Forwarded-Host r the URL scheme and host not found
discovery-url: https://keycloak.example.com/auth/realms/&lt;REALM_NAME&gt;
enable-default-deny: true
encryption_key: AgXa7xRcoClDEU0ZDSH4X0XhL5Qy2Z2j
listen: 127.0.0.1:3000
redirection-url: http://127.0.0.1:3000
upstream-url: http://127.0.0.1:80
resources:
- uri: /admin*
  methods:
  - GET
  roles:
  - client:test1
  - client:test2
  require-any-role: true
  groups:
  - admins
  - users
- uri: /backend*
  roles:
  - client:test1
- uri: /public/*
  white-listed: true
- uri: /favicon
  white-listed: true
- uri: /css/*
  white-listed: true
- uri: /img/*
  white-listed: true
headers:
  myheader1: value_1
  myheader2: value_2
</code></pre><p>&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;&#x914D;&#x7F6E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x4EFB;&#x4F55;&#x5185;&#x5BB9;&#xFF0C;&#x4F8B;&#x5982;&#x5728;&#x6B64;&#x793A;&#x4F8B;&#x4E2D;&#x3002;</p>
<pre><code class="lang-bash">bin/keycloak-gatekeeper \
    --discovery-url=https://keycloak.example.com/auth/realms/&lt;REALM_NAME&gt; \
    --client-id=&lt;CLIENT_ID&gt; \
    --client-secret=&lt;SECRET&gt; \
    --listen=127.0.0.1:3000 \ <span class="hljs-comment"># unix sockets format unix://path</span>
    --redirection-url=http://127.0.0.1:3000 \
    --enable-refresh-tokens=<span class="hljs-literal">true</span> \
    --encryption-key=AgXa7xRcoClDEU0ZDSH4X0XhL5Qy2Z2j \
    --upstream-url=http://127.0.0.1:80 \
    --enable-default-deny=<span class="hljs-literal">true</span> \
    --resources=<span class="hljs-string">&quot;uri=/admin*|roles=test1,test2&quot;</span> \
    --resources=<span class="hljs-string">&quot;uri=/backend*|roles=test1&quot;</span> \
    --resources=<span class="hljs-string">&quot;uri=/css/*|white-listed=true&quot;</span> \
    --resources=<span class="hljs-string">&quot;uri=/img/*|white-listed=true&quot;</span> \
    --resources=<span class="hljs-string">&quot;uri=/public/*|white-listed=true&quot;</span> \
    --headers=<span class="hljs-string">&quot;myheader1=value1&quot;</span> \
    --headers=<span class="hljs-string">&quot;myheader2=value2&quot;</span>
</code></pre>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8D44;&#x6E90;&#x4E0A;&#x5B9A;&#x4E49;&#x7684;&#x89D2;&#x8272;&#x6267;&#x884C;&#x903B;&#x8F91;<code>AND</code>&#xFF0C;&#x56E0;&#x6B64;&#x6307;&#x5B9A;&#x7684;&#x6240;&#x6709;&#x89D2;&#x8272;&#x5FC5;&#x987B;&#x5B58;&#x5728;&#x4E8E;&#x58F0;&#x660E;&#x4E2D;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>require-any-role</code>&#x9009;&#x9879;&#x8FDB;&#x884C;&#x66F4;&#x6539;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x8981;&#x4E00;&#x4E2A;&#x89D2;&#x8272;&#x662F; &#x76EE;&#x524D;&#x6388;&#x4E88;&#x8BB8;&#x53EF;&#x3002;</p>
<p><a name="146_____2_4_4__OpenID&#x63D0;&#x4F9B;&#x5546;&#x901A;&#x4FE1;"></a></p>
<h4 id="244-openid&#x63D0;&#x4F9B;&#x5546;&#x901A;&#x4FE1;"><a name="244-openid&#x63D0;&#x4F9B;&#x5546;&#x901A;&#x4FE1;" class="anchor-navigation-ex-anchor" href="#244-openid&#x63D0;&#x4F9B;&#x5546;&#x901A;&#x4FE1;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.4. OpenID&#x63D0;&#x4F9B;&#x5546;&#x901A;&#x4FE1;</h4>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0E;OpenID&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x7684;&#x901A;&#x4FE1;&#x662F;&#x76F4;&#x63A5;&#x7684;&#x3002; &#x5982;&#x679C;&#x60A8;&#x613F;&#x610F;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x6307;&#x5B9A;&#x8F6C;&#x53D1;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF1A;</p>
<pre><code>openid-provider-proxy: http://proxy.example.com:8080
</code></pre><p><a name="147_____2_4_5__HTTP&#x8DEF;&#x7531;"></a></p>
<h4 id="245-http&#x8DEF;&#x7531;"><a name="245-http&#x8DEF;&#x7531;" class="anchor-navigation-ex-anchor" href="#245-http&#x8DEF;&#x7531;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.5. HTTP&#x8DEF;&#x7531;</h4>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x90FD;&#x5C06;&#x4EE3;&#x7406;&#x5230;&#x4E0A;&#x6E38;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x5E0C;&#x671B;&#x786E;&#x4FDD;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x90FD;&#x662F;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6B64;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code>--resource=uri=/* # note, unless specified the method is assumed to be &apos;any|ANY&apos;
</code></pre><p>HTTP&#x8DEF;&#x7531;&#x89C4;&#x5219;&#x9075;&#x5FAA;<a href="https://github.com/go-chi/chi#router-design" target="_blank">chi</a>&#x7684;&#x6307;&#x5BFC;&#x539F;&#x5219;&#x3002; &#x8D44;&#x6E90;&#x7684;&#x6392;&#x5E8F;&#x65E0;&#x5173;&#x7D27;&#x8981;&#xFF0C;&#x8DEF;&#x7531;&#x5668;&#x5C06;&#x4E3A;&#x60A8;&#x5904;&#x7406;&#x3002;</p>
<p><a name="148_____2_4_6__&#x4EC5;&#x9650;&#x4F1A;&#x8BDD;&#x7684;cookie"></a></p>
<h4 id="246-&#x4EC5;&#x9650;&#x4F1A;&#x8BDD;&#x7684;cookie"><a name="246-&#x4EC5;&#x9650;&#x4F1A;&#x8BDD;&#x7684;cookie" class="anchor-navigation-ex-anchor" href="#246-&#x4EC5;&#x9650;&#x4F1A;&#x8BDD;&#x7684;cookie"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.6. &#x4EC5;&#x9650;&#x4F1A;&#x8BDD;&#x7684;cookie</h4>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8BBF;&#x95EE;&#x548C;&#x5237;&#x65B0;cookie&#x4EC5;&#x9650;&#x4F1A;&#x8BDD;&#xFF0C;&#x5E76;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x5173;&#x95ED;&#x65F6;&#x5904;&#x7406;; &#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>--enable-session-cookies</code>&#x9009;&#x9879;&#x7981;&#x7528;&#x6B64;&#x529F;&#x80FD;&#x3002;</p>
<p><a name="149_____2_4_7__&#x8F6C;&#x53D1;&#x7B7E;&#x540D;&#x4EE3;&#x7406;"></a></p>
<h4 id="247-&#x8F6C;&#x53D1;&#x7B7E;&#x540D;&#x4EE3;&#x7406;"><a name="247-&#x8F6C;&#x53D1;&#x7B7E;&#x540D;&#x4EE3;&#x7406;" class="anchor-navigation-ex-anchor" href="#247-&#x8F6C;&#x53D1;&#x7B7E;&#x540D;&#x4EE3;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.7. &#x8F6C;&#x53D1;&#x7B7E;&#x540D;&#x4EE3;&#x7406;</h4>
<p>&#x8F6C;&#x53D1;&#x7B7E;&#x540D;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x4F7F;&#x7528;IdP&#x53D1;&#x51FA;&#x7684;&#x4EE4;&#x724C;&#x5728;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x548C;&#x6388;&#x6743;&#x7684;&#x673A;&#x5236;&#x3002; &#x5728;&#x6B64;&#x6A21;&#x5F0F;&#x4E0B;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x4EE3;&#x7406;&#x5C06;&#x81EA;&#x52A8;&#x83B7;&#x53D6;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF08;&#x4EE3;&#x8868;&#x60A8;&#x5904;&#x7406;&#x5237;&#x65B0;&#x6216;&#x767B;&#x5F55;&#xFF09;&#x5E76;&#x4F7F;&#x7528;Authorization&#x6807;&#x5934;&#x6807;&#x8BB0;&#x51FA;&#x7AD9;&#x8BF7;&#x6C42;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;--forwarding-domains&#x9009;&#x9879;&#x63A7;&#x5236;&#x6807;&#x8BB0;&#x54EA;&#x4E9B;&#x57DF;&#x3002; &#x6CE8;&#x610F;&#xFF0C;&#x6B64;&#x9009;&#x9879;&#x5728;&#x57DF;&#x4E0A;&#x4F7F;&#x7528;<strong>contains</strong>&#x6BD4;&#x8F83;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x60F3;&#x5339;&#x914D;*.svc.cluster.local&#x4E0B;&#x7684;&#x6240;&#x6709;&#x57DF;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF1A; - forwarding-domain=svc.cluster.local&#x3002;</p>
<p>&#x76EE;&#x524D;&#xFF0C;&#x8BE5;&#x670D;&#x52A1;&#x4F7F;&#x7528;oauth client_credentials&#x6388;&#x6743;&#x7C7B;&#x578B;&#x6267;&#x884C;&#x767B;&#x5F55;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x7684;IdP&#x670D;&#x52A1;&#x5FC5;&#x987B;&#x652F;&#x6301;&#x76F4;&#x63A5;&#xFF08;&#x7528;&#x6237;&#x540D;/&#x5BC6;&#x7801;&#xFF09;&#x767B;&#x5F55;&#x3002;</p>
<p>&#x793A;&#x4F8B;&#x8BBE;&#x7F6E;&#xFF1A;</p>
<p>&#x60A8;&#x6536;&#x96C6;&#x4E86;&#x5141;&#x8BB8;&#x5F7C;&#x6B64;&#x4EA4;&#x8C08;&#x7684;&#x5FAE;&#x670D;&#x52A1;; &#x60A8;&#x5DF2;&#x7ECF;&#x5728;Keycloak&#x4E2D;&#x8BBE;&#x7F6E;&#x4E86;&#x51ED;&#x636E;&#xFF0C;&#x89D2;&#x8272;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E3A;&#x95EE;&#x9898;&#x4EE4;&#x724C;&#x63D0;&#x4F9B;&#x4E86;&#x7CBE;&#x7EC6;&#x7684;&#x89D2;&#x8272;&#x63A7;&#x5236;&#x3002;</p>
<pre><code class="lang-bash">- name: keycloak-gatekeeper
  image: quay.io/gambol99/keycloak-generic-adapter:latest
  args:
  - --enable-forwarding=<span class="hljs-literal">true</span>
  - --forwarding-username=projecta
  - --forwarding-password=some_password
  - --forwarding-domains=projecta.svc.cluster.local
  - --forwarding-domains=projectb.svc.cluster.local
  - --tls-ca-certificate=/etc/secrets/ca.pem
  - --tls-ca-key=/etc/secrets/ca-key.pem
  <span class="hljs-comment"># Note: if you don&apos;t specify any forwarding domains, all domains will be signed; Also the code checks is the</span>
  <span class="hljs-comment"># domain &apos;contains&apos; the value (it&apos;s not a regex) so if you wanted to sign all requests to svc.cluster.local, just use</span>
  <span class="hljs-comment"># svc.cluster.local</span>
  volumeMounts:
  - name: keycloak-socket
    mountPoint: /var/run/keycloak
- name: projecta
  image: some_images

<span class="hljs-comment"># test the forward proxy</span>
$ curl -k --proxy http://127.0.0.1:3000 https://test.projesta.svc.cluster.local
</code></pre>
<p>&#x5728;&#x63A5;&#x6536;&#x65B9;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;Keycloak Gatekeeper&#xFF08;--no=redirects=true&#xFF09;&#x5E76;&#x5141;&#x8BB8;&#x6B64;&#x9879;&#x9A8C;&#x8BC1;&#x5E76;&#x5904;&#x7406;&#x60A8;&#x7684;&#x5165;&#x573A;&#x8BB8;&#x53EF;&#x3002; &#x6216;&#x8005;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x8BF7;&#x6C42;&#x4E2D;&#x627E;&#x5230;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x4F5C;&#x4E3A;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x3002;</p>
<p><a name="150_____2_4_8__&#x8F6C;&#x53D1;&#x5DF2;&#x7B7E;&#x540D;&#x7684;HTTPS&#x8FDE;&#x63A5;"></a></p>
<h4 id="248-&#x8F6C;&#x53D1;&#x5DF2;&#x7B7E;&#x540D;&#x7684;https&#x8FDE;&#x63A5;"><a name="248-&#x8F6C;&#x53D1;&#x5DF2;&#x7B7E;&#x540D;&#x7684;https&#x8FDE;&#x63A5;" class="anchor-navigation-ex-anchor" href="#248-&#x8F6C;&#x53D1;&#x5DF2;&#x7B7E;&#x540D;&#x7684;https&#x8FDE;&#x63A5;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.8. &#x8F6C;&#x53D1;&#x5DF2;&#x7B7E;&#x540D;&#x7684;HTTPS&#x8FDE;&#x63A5;</h4>
<p>&#x5904;&#x7406;HTTPS&#x9700;&#x8981;&#x4E2D;&#x95F4;&#x4EBA;&#x8FDB;&#x884C;TLS&#x8FDE;&#x63A5;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;<code>--tls-ca-certificate</code>&#x548C;<code>--tls-ca-key</code>&#xFF0C;&#x4EE3;&#x7406;&#x5C06;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x8BC1;&#x4E66;&#x3002; &#x5982;&#x679C;&#x60A8;&#x5E0C;&#x671B;&#x9A8C;&#x8BC1;&#x4FE1;&#x4EFB;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x751F;&#x6210;CA.</p>
<pre><code class="lang-bash">$ openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout ca.key -out ca.pem
$ bin/keycloak-gatekeeper \
  --enable-forwarding \
  --forwarding-username=USERNAME \
  --forwarding-password=PASSWORD \
  --client-id=CLIENT_ID \
  --client-secret=SECRET \
  --discovery-url=https://keycloak.example.com/auth/realms/<span class="hljs-built_in">test</span> \
  --tls-ca-certificate=ca.pem \
  --tls-ca-key=ca-key.pem
</code></pre>
<p><a name="151_____2_4_9__HTTPS&#x91CD;&#x5B9A;&#x5411;"></a></p>
<h4 id="249-https&#x91CD;&#x5B9A;&#x5411;"><a name="249-https&#x91CD;&#x5B9A;&#x5411;" class="anchor-navigation-ex-anchor" href="#249-https&#x91CD;&#x5B9A;&#x5411;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.9. HTTPS&#x91CD;&#x5B9A;&#x5411;</h4>
<p>&#x4EE3;&#x7406;&#x652F;&#x6301;HTTP&#x4FA6;&#x542C;&#x5668;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x552F;&#x4E00;&#x771F;&#x6B63;&#x7684;&#x8981;&#x6C42;&#x662F;&#x6267;&#x884C;HTTP&#x2192;HTTPS&#x91CD;&#x5B9A;&#x5411;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x542F;&#x7528;&#x4EE5;&#x4E0B;&#x9009;&#x9879;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-bullet">-</span>-listen-http=<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">80</span>
<span class="hljs-bullet">-</span>-enable-security-filter=<span class="hljs-literal">true</span>  <span class="hljs-comment"># is required for the https redirect</span>
<span class="hljs-bullet">-</span>-enable-https-redirection
</code></pre>
<p><a name="152_____2_4_10__&#x6211;&#x4EEC;&#x52A0;&#x5BC6;&#x914D;&#x7F6E;"></a></p>
<h4 id="2410-&#x6211;&#x4EEC;&#x52A0;&#x5BC6;&#x914D;&#x7F6E;"><a name="2410-&#x6211;&#x4EEC;&#x52A0;&#x5BC6;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#2410-&#x6211;&#x4EEC;&#x52A0;&#x5BC6;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.10. &#x6211;&#x4EEC;&#x52A0;&#x5BC6;&#x914D;&#x7F6E;</h4>
<p>&#x4EE5;&#x4E0B;&#x662F;Let&apos;s Encrypt&#x652F;&#x6301;&#x6240;&#x9700;&#x914D;&#x7F6E;&#x7684;&#x793A;&#x4F8B;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">listen:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">443</span>
<span class="hljs-attr">enable-https-redirection:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">enable-security-filter:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">use-letsencrypt:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">letsencrypt-cache-dir:</span> ./cache/
<span class="hljs-attr">redirection-url:</span> https://domain.tld:<span class="hljs-number">443</span>/
<span class="hljs-attr">hostnames:</span>
<span class="hljs-bullet">  -</span> domain.tld
</code></pre>
<p>&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x7AEF;&#x53E3;443&#x8FDB;&#x884C;&#x4FA6;&#x542C;&#x3002;</p>
<p><a name="153_____2_4_11__&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x52A0;&#x5BC6;"></a></p>
<h4 id="2411-&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x52A0;&#x5BC6;"><a name="2411-&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x52A0;&#x5BC6;" class="anchor-navigation-ex-anchor" href="#2411-&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x52A0;&#x5BC6;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.11. &#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x52A0;&#x5BC6;</h4>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F1A;&#x8BDD;&#x4EE4;&#x724C;&#x4EE5;&#x660E;&#x6587;&#x5F62;&#x5F0F;&#x653E;&#x5165;cookie&#x4E2D;&#x3002; &#x5982;&#x679C;&#x60A8;&#x66F4;&#x559C;&#x6B22;&#x52A0;&#x5BC6;&#x4F1A;&#x8BDD;cookie&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<code>--enable-encrypted-token</code>&#x548C;<code>--encryption-key</code>&#x9009;&#x9879;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5728;X-Auth-Token&#x6807;&#x5934;&#x4E2D;&#x8F6C;&#x53D1;&#x5230;&#x4E0A;&#x6E38;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#x3002;</p>
<p><a name="154_____2_4_12__&#x4E0A;&#x6E38;&#x6807;&#x9898;"></a></p>
<h4 id="2412-&#x4E0A;&#x6E38;&#x6807;&#x9898;"><a name="2412-&#x4E0A;&#x6E38;&#x6807;&#x9898;" class="anchor-navigation-ex-anchor" href="#2412-&#x4E0A;&#x6E38;&#x6807;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.12. &#x4E0A;&#x6E38;&#x6807;&#x9898;</h4>
<p>&#x5728;&#x53D7;&#x4FDD;&#x62A4;&#x7684;&#x8D44;&#x6E90;&#x4E0A;&#xFF0C;&#x4E0A;&#x6E38;&#x7AEF;&#x70B9;&#x5C06;&#x63A5;&#x6536;&#x4EE3;&#x7406;&#x6DFB;&#x52A0;&#x7684;&#x591A;&#x4E2A;&#x6807;&#x5934;&#x4EE5;&#x53CA;&#x81EA;&#x5B9A;&#x4E49;&#x58F0;&#x660E;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-javascript"># add the header to the upstream endpoint
id := user.(*userContext)
cx.Request().Header.Set(&quot;X-Auth-Email&quot;, id.email)
cx.Request().Header.Set(&quot;X-Auth-ExpiresIn&quot;, id.expiresAt.String())
cx.Request().Header.Set(&quot;X-Auth-Groups&quot;, strings.Join(id.groups, &quot;,&quot;))
cx.Request().Header.Set(&quot;X-Auth-Roles&quot;, strings.Join(id.roles, &quot;,&quot;))
cx.Request().Header.Set(&quot;X-Auth-Subject&quot;, id.id)
cx.Request().Header.Set(&quot;X-Auth-Token&quot;, id.token.Encode())
cx.Request().Header.Set(&quot;X-Auth-Userid&quot;, id.name)
cx.Request().Header.Set(&quot;X-Auth-Username&quot;, id.name)
// step: add the authorization header if requested
if r.config.EnableAuthorizationHeader {
        cx.Request().Header.Set(&quot;Authorization&quot;, fmt.Sprintf(&quot;Bearer %s&quot;, id.token.Encode()))
}
</code></pre>
<p>&#x8981;&#x63A7;&#x5236;<code>Authorization</code>&#x5934;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<code>enable-authorization-header</code> yaml&#x914D;&#x7F6E;&#x6216;<code>--enable-authorization-header</code>&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6B64;&#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x4E3A;<code>true</code>&#x3002;</p>
<p><a name="155_____2_4_13__&#x81EA;&#x5B9A;&#x4E49;&#x58F0;&#x660E;&#x6807;&#x5934;"></a></p>
<h4 id="2413-&#x81EA;&#x5B9A;&#x4E49;&#x58F0;&#x660E;&#x6807;&#x5934;"><a name="2413-&#x81EA;&#x5B9A;&#x4E49;&#x58F0;&#x660E;&#x6807;&#x5934;" class="anchor-navigation-ex-anchor" href="#2413-&#x81EA;&#x5B9A;&#x4E49;&#x58F0;&#x660E;&#x6807;&#x5934;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.13. &#x81EA;&#x5B9A;&#x4E49;&#x58F0;&#x660E;&#x6807;&#x5934;</h4>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>--add-claims</code>&#x9009;&#x9879;&#x5C06;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x4E2D;&#x7684;&#x5176;&#x4ED6;&#x58F0;&#x660E;&#x6CE8;&#x5165;&#x5230;&#x6388;&#x6743;&#x6807;&#x5934;&#x4E2D;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x6765;&#x81EA;Keycloak&#x63D0;&#x4F9B;&#x5546;&#x7684;&#x4EE4;&#x724C;&#x53EF;&#x80FD;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x58F0;&#x660E;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">&quot;resource_access&quot;:</span> {},
<span class="hljs-attr">&quot;name&quot;:</span> <span class="hljs-string">&quot;Beloved User&quot;</span>,
<span class="hljs-attr">&quot;preferred_username&quot;:</span> <span class="hljs-string">&quot;beloved.user&quot;</span>,
<span class="hljs-attr">&quot;given_name&quot;:</span> <span class="hljs-string">&quot;Beloved&quot;</span>,
<span class="hljs-attr">&quot;family_name&quot;:</span> <span class="hljs-string">&quot;User&quot;</span>,
<span class="hljs-attr">&quot;email&quot;:</span> <span class="hljs-string">&quot;beloved@example.com&quot;</span>
</code></pre>
<p>&#x4E3A;&#x4E86;&#x8BF7;&#x6C42;&#x60A8;&#x5728;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6807;&#x5934;&#x4E2D;&#x6536;&#x5230;given_name&#xFF0C;family_name&#x548C;name&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x6DFB;&#x52A0;<code>--add-claims=given_name</code> &#x548C; <code>--add-claims=family_name</code>&#x7B49;&#x7B49;&#xFF0C;&#x6216;&#x8005;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x914D;&#x7F6E;&#x4E2D;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C; &#x6587;&#x4EF6;&#xFF0C;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">add-claims:</span>
<span class="hljs-bullet">-</span> given_name
<span class="hljs-bullet">-</span> family_name
<span class="hljs-bullet">-</span> name
</code></pre>
<p>&#x8FD9;&#x4F1A;&#x5C06;&#x9644;&#x52A0;&#x6807;&#x5934;&#x4E0E;&#x6807;&#x51C6;&#x8BF7;&#x6C42;&#x4E00;&#x8D77;&#x6DFB;&#x52A0;&#x5230;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x8BF7;&#x6C42;&#x4E2D;&#x3002;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">X-Auth-Family-Name:</span> User
<span class="hljs-attr">X-Auth-Given-Name:</span> Beloved
<span class="hljs-attr">X-Auth-Name:</span> Beloved User
</code></pre>
<p><a name="156_____2_4_14__&#x81EA;&#x5B9A;&#x4E49;&#x6807;&#x9898;"></a></p>
<h4 id="2414-&#x81EA;&#x5B9A;&#x4E49;&#x6807;&#x9898;"><a name="2414-&#x81EA;&#x5B9A;&#x4E49;&#x6807;&#x9898;" class="anchor-navigation-ex-anchor" href="#2414-&#x81EA;&#x5B9A;&#x4E49;&#x6807;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.14. &#x81EA;&#x5B9A;&#x4E49;&#x6807;&#x9898;</h4>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>--headers=&quot;name=value&quot;</code>&#x9009;&#x9879;&#x6216;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6CE8;&#x5165;&#x81EA;&#x5B9A;&#x4E49;&#x6807;&#x5934;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">headers:</span>
<span class="hljs-attr">  name:</span> value
</code></pre>
<p><a name="157_____2_4_15__&#x52A0;&#x5BC6;&#x5BC6;&#x94A5;"></a></p>
<h4 id="2415-&#x52A0;&#x5BC6;&#x5BC6;&#x94A5;"><a name="2415-&#x52A0;&#x5BC6;&#x5BC6;&#x94A5;" class="anchor-navigation-ex-anchor" href="#2415-&#x52A0;&#x5BC6;&#x5BC6;&#x94A5;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.15. &#x52A0;&#x5BC6;&#x5BC6;&#x94A5;</h4>
<p>&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x65E0;&#x72B6;&#x6001;&#x800C;&#x4E0D;&#x5FC5;&#x4F9D;&#x8D56;&#x4E2D;&#x592E;&#x7F13;&#x5B58;&#x6765;&#x6301;&#x4E45;&#x5316;refresh_tokens&#xFF0C;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x88AB;&#x52A0;&#x5BC6;&#x5E76;&#x4F7F;&#x7528;<strong>crypto/aes </strong>&#x4F5C;&#x4E3A;cookie&#x6DFB;&#x52A0;&#x3002; &#x5982;&#x679C;&#x60A8;&#x5728;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#x540E;&#x9762;&#x8FD0;&#x884C;&#xFF0C;&#x5219;&#x5BC6;&#x94A5;&#x5FC5;&#x987B;&#x76F8;&#x540C;&#x3002; &#x5BC6;&#x94A5;&#x957F;&#x5EA6;&#x5E94;&#x4E3A;16&#x6216;32&#x5B57;&#x8282;&#xFF0C;&#x5177;&#x4F53;&#x53D6;&#x51B3;&#x4E8E;&#x60A8;&#x662F;&#x5426;&#x9700;&#x8981;AES-128&#x6216;AES-256&#x3002;</p>
<p><a name="158_____2_4_16__&#x8981;&#x6C42;&#x5339;&#x914D;"></a></p>
<h4 id="2416-&#x8981;&#x6C42;&#x5339;&#x914D;"><a name="2416-&#x8981;&#x6C42;&#x5339;&#x914D;" class="anchor-navigation-ex-anchor" href="#2416-&#x8981;&#x6C42;&#x5339;&#x914D;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.16. &#x8981;&#x6C42;&#x5339;&#x914D;</h4>
<p>&#x4EE3;&#x7406;&#x652F;&#x6301;&#x9488;&#x5BF9;&#x6240;&#x5448;&#x73B0;&#x7684;&#x4EE4;&#x724C;&#x6DFB;&#x52A0;&#x58F0;&#x660E;&#x5339;&#x914D;&#x7684;&#x53D8;&#x91CF;&#x5217;&#x8868;&#x4EE5;&#x7528;&#x4E8E;&#x9644;&#x52A0;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x5C06;&apos;iss&apos;&#x6216;&apos;aud&apos;&#x4E0E;&#x4EE4;&#x724C;&#x6216;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x5339;&#x914D;; &#x6BCF;&#x4E2A;&#x5339;&#x914D;&#x90FD;&#x662F;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x3002; &#x4F8B;&#x5982;&#xFF0C;<code>--match-claims&apos;aud=sso.*&apos;</code>&#x6216;<code>--claim iss = https//.*&apos;</code>&#x6216;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">match-claims:</span>
<span class="hljs-attr">  aud:</span> openvpn
<span class="hljs-attr">  iss:</span> https://keycloak.example.com/auth/realms/commons
</code></pre>
<p>&#x6216;&#x8005;&#x901A;&#x8FC7;CLI&#xFF0C;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-bullet">-</span>-match-claims=auth=openvpn
<span class="hljs-bullet">-</span>-match-claims=iss=http://keycloak.example.com/realms/commons
</code></pre>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x5141;&#x8BB8;&#x7684;&#x7535;&#x5B50;&#x90AE;&#x4EF6;&#x57DF;; &#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x8981;&#x4EC5;&#x9650;&#x4E8E;example.com&#x57DF;&#x4E0A;&#x7684;&#x7528;&#x6237;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">match-claims:</span>
<span class="hljs-attr">  email:</span> ^.*@example.com$
</code></pre>
<p>&#x9002;&#x914D;&#x5668;&#x652F;&#x6301;&#x5339;&#x914D;&#x591A;&#x503C;&#x5B57;&#x7B26;&#x4E32;&#x58F0;&#x660E;&#x3002; &#x5982;&#x679C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x503C;&#x5339;&#x914D;&#xFF0C;&#x5339;&#x914D;&#x5C06;&#x6210;&#x529F;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">match-claims:</span>
<span class="hljs-attr">  perms:</span> perm1
</code></pre>
<p>&#x5C06;&#x6210;&#x529F;&#x5339;&#x914D;</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;iss&quot;</span>: <span class="hljs-string">&quot;https://sso.example.com&quot;</span>,
  <span class="hljs-string">&quot;sub&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
  <span class="hljs-string">&quot;perms&quot;</span>: [<span class="hljs-string">&quot;perm1&quot;</span>, <span class="hljs-string">&quot;perm2&quot;</span>]
}
</code></pre>
<p><a name="159_____2_4_17__&#x7EC4;&#x8981;&#x6C42;"></a></p>
<h4 id="2417-&#x7EC4;&#x8981;&#x6C42;"><a name="2417-&#x7EC4;&#x8981;&#x6C42;" class="anchor-navigation-ex-anchor" href="#2417-&#x7EC4;&#x8981;&#x6C42;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.17. &#x7EC4;&#x8981;&#x6C42;</h4>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8D44;&#x6E90;&#x4E2D;&#x53EF;&#x7528;&#x7684;<code>groups</code>&#x53C2;&#x6570;&#x5339;&#x914D;&#x4EE4;&#x724C;&#x4E2D;&#x7684;&#x7EC4;&#x58F0;&#x660E;&#x3002; &#x867D;&#x7136;&#x9690;&#x542B;&#x5730;&#x8981;&#x6C42;&#x89D2;&#x8272;&#xFF0C;&#x4F8B;&#x5982;<code>roles=admin,user</code>&#xFF0C;&#x5176;&#x4E2D;&#x7528;&#x6237;&#x5FC5;&#x987B;&#x5177;&#x6709;&#x89D2;&#x8272;&apos;admin&apos;&#x548C;&apos;user&apos;&#xFF0C;&#x7EC4;&#x5E94;&#x7528;OR&#x64CD;&#x4F5C;&#xFF0C;&#x56E0;&#x6B64;<code>groups=users,testers</code>&#x8981;&#x6C42;&#x7528;&#x6237;&#x5FC5;&#x987B; &#x5728;&apos;users&apos;&#x6216;&apos;testers&apos;&#x4E2D;&#x3002; &#x58F0;&#x660E;&#x540D;&#x79F0;&#x88AB;&#x786C;&#x7F16;&#x7801;&#x4E3A;<code>groups</code>&#xFF0C;&#x56E0;&#x6B64;JWT&#x6807;&#x8BB0;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<pre><code class="lang-java">{
  <span class="hljs-string">&quot;iss&quot;</span>: <span class="hljs-string">&quot;https://sso.example.com&quot;</span>,
  <span class="hljs-string">&quot;sub&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
  <span class="hljs-string">&quot;aud&quot;</span>: <span class="hljs-string">&quot;test&quot;</span>,
  <span class="hljs-string">&quot;exp&quot;</span>: <span class="hljs-number">1515269245</span>,
  <span class="hljs-string">&quot;iat&quot;</span>: <span class="hljs-number">1515182845</span>,
  <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;beloved@example.com&quot;</span>,
  <span class="hljs-string">&quot;groups&quot;</span>: [
    <span class="hljs-string">&quot;group_one&quot;</span>,
    <span class="hljs-string">&quot;group_two&quot;</span>
  ],
  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Beloved&quot;</span>
}
</code></pre>
<p><a name="160_____2_4_18__&#x81EA;&#x5B9A;&#x4E49;&#x9875;&#x9762;"></a></p>
<h4 id="2418-&#x81EA;&#x5B9A;&#x4E49;&#x9875;&#x9762;"><a name="2418-&#x81EA;&#x5B9A;&#x4E49;&#x9875;&#x9762;" class="anchor-navigation-ex-anchor" href="#2418-&#x81EA;&#x5B9A;&#x4E49;&#x9875;&#x9762;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.18. &#x81EA;&#x5B9A;&#x4E49;&#x9875;&#x9762;</h4>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Keycloak Gatekeeper&#x4F1A;&#x7ACB;&#x5373;&#x91CD;&#x5B9A;&#x5411;&#x60A8;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;403&#x4EE5;&#x62D2;&#x7EDD;&#x8BBF;&#x95EE;&#x3002; &#x5927;&#x591A;&#x6570;&#x7528;&#x6237;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x5411;&#x7528;&#x6237;&#x663E;&#x793A;&#x66F4;&#x53CB;&#x597D;&#x7684;&#x767B;&#x5F55;&#x548C;&#x8BBF;&#x95EE;&#x88AB;&#x62D2;&#x7EDD;&#x7684;&#x9875;&#x9762;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>--signin-page=PATH</code>&#x5C06;&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;&#xFF08;&#x6216;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF09;&#x8DEF;&#x5F84;&#x4F20;&#x9012;&#x7ED9;&#x6587;&#x4EF6;&#x3002; &#x767B;&#x5F55;&#x9875;&#x9762;&#x5C06;&#x6709;&#x4E00;&#x4E2A;&#x201C;&#x91CD;&#x5B9A;&#x5411;&#x201D;&#x53D8;&#x91CF;&#x4F20;&#x9012;&#x5230;&#x4F5C;&#x7528;&#x57DF;&#x5E76;&#x4FDD;&#x5B58;oauth&#x91CD;&#x5B9A;&#x5411;URL&#x3002; &#x5982;&#x679C;&#x4F60;&#x60F3;&#x5C06;&#x5176;&#x4ED6;&#x53D8;&#x91CF;&#x4F20;&#x9012;&#x7ED9;&#x6A21;&#x677F;&#xFF0C;&#x6BD4;&#x5982;title&#xFF0C;sitename&#x7B49;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>--tags key=pair</code>&#x9009;&#x9879;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;<code>--tags title=&quot;This is my site&quot;</code>&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x4ECE;``&#x8BBF;&#x95EE;&#x8BE5;&#x53D8;&#x91CF;&#x3002;</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>Sign-in<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><a name="161_____2_4_19__&#x767D;&#x540D;&#x5355;_URL_s"></a></p>
<h4 id="2419-&#x767D;&#x540D;&#x5355;-urls"><a name="2419-&#x767D;&#x540D;&#x5355;-urls" class="anchor-navigation-ex-anchor" href="#2419-&#x767D;&#x540D;&#x5355;-urls"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.19. &#x767D;&#x540D;&#x5355; URL&apos;s</h4>
<p>&#x6839;&#x636E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;URL&#x7684;&#x5E03;&#x5C40;&#x65B9;&#x5F0F;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x4FDD;&#x62A4;&#x6839;/ URL&#xFF0C;&#x4F46;&#x5728;&#x8DEF;&#x5F84;&#x5217;&#x8868;&#x4E2D;&#x6709;&#x4F8B;&#x5916;&#xFF0C;&#x4F8B;&#x5982;<code>/health</code>&#x3002; &#x867D;&#x7136;&#x901A;&#x8FC7;&#x8C03;&#x6574;&#x8DEF;&#x5F84;&#x53EF;&#x4EE5;&#x6700;&#x597D;&#x5730;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x60A8;&#x53EF;&#x4EE5;&#x5411;&#x53D7;&#x4FDD;&#x62A4;&#x8D44;&#x6E90;&#x6DFB;&#x52A0;&#x4F8B;&#x5916;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">  resources:</span>
<span class="hljs-attr">  - uri:</span> /some_white_listed_url
<span class="hljs-attr">    white-listed:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">  - uri:</span> /*
<span class="hljs-attr">    methods:</span>
<span class="hljs-bullet">      -</span> GET
<span class="hljs-attr">    roles:</span>
<span class="hljs-bullet">      -</span> &lt;CLIENT_APP_NAME&gt;:&lt;ROLE_NAME<span class="hljs-string">&gt;
      - &lt;CLIENT_APP_NAME&gt;:&lt;ROLE_NAME&gt;
</span></code></pre>
<p>&#x6216;&#x8005;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x4E0A;</p>
<pre><code class="lang-bash">  --resources <span class="hljs-string">&quot;uri=/some_white_listed_url|white-listed=true&quot;</span>
  --resources <span class="hljs-string">&quot;uri=/*&quot;</span>  <span class="hljs-comment"># requires authentication on the rest</span>
  --resources <span class="hljs-string">&quot;uri=/admin*|roles=admin,superuser|methods=POST,DELETE&quot;</span>
</code></pre>
<p><a name="162_____2_4_20__&#x4EA4;&#x4E92;_TLS"></a></p>
<h4 id="2420-&#x4EA4;&#x4E92;-tls"><a name="2420-&#x4EA4;&#x4E92;-tls" class="anchor-navigation-ex-anchor" href="#2420-&#x4EA4;&#x4E92;-tls"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.20. &#x4EA4;&#x4E92; TLS</h4>
<p>&#x4EE3;&#x7406;&#x652F;&#x6301;&#x901A;&#x8FC7;&#x6DFB;&#x52A0;<code>--tls-ca-certificate</code>&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;&#x6216;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x9009;&#x9879;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x5F3A;&#x5236;&#x6267;&#x884C;&#x76F8;&#x4E92;TLS&#x3002; &#x8FDE;&#x63A5;&#x7684;&#x6240;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;&#x7531;&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x7684;CA&#x7B7E;&#x540D;&#x7684;&#x8BC1;&#x4E66;&#x3002;</p>
<p><a name="163_____2_4_21__&#x8BC1;&#x4E66;&#x8F6E;&#x6362;"></a></p>
<h4 id="2421-&#x8BC1;&#x4E66;&#x8F6E;&#x6362;"><a name="2421-&#x8BC1;&#x4E66;&#x8F6E;&#x6362;" class="anchor-navigation-ex-anchor" href="#2421-&#x8BC1;&#x4E66;&#x8F6E;&#x6362;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.21. &#x8BC1;&#x4E66;&#x8F6E;&#x6362;</h4>
<p>&#x5982;&#x679C;&#x6587;&#x4EF6;&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x66F4;&#x6539;&#xFF0C;&#x4EE3;&#x7406;&#x5C06;&#x81EA;&#x52A8;&#x8F6E;&#x6362;&#x670D;&#x52A1;&#x5668;&#x8BC1;&#x4E66;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5185;&#x8054;&#x66F4;&#x6539;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x505C;&#x673A;&#x65F6;&#x95F4;&#x3002; &#x5728;&#x8BC1;&#x4E66;&#x8F6E;&#x6362;&#x4E4B;&#x524D;&#x8FDE;&#x63A5;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x7EE7;&#x7EED;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#x65B0;&#x8BC1;&#x4E66;&#x63D0;&#x4F9B;&#x7684;&#x6240;&#x6709;&#x65B0;&#x8FDE;&#x63A5;&#x3002;</p>
<p><a name="164_____2_4_22__&#x5237;&#x65B0;_tokens"></a></p>
<h4 id="2422-&#x5237;&#x65B0;-tokens"><a name="2422-&#x5237;&#x65B0;-tokens" class="anchor-navigation-ex-anchor" href="#2422-&#x5237;&#x65B0;-tokens"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.22. &#x5237;&#x65B0; tokens</h4>
<p>&#x5982;&#x679C;&#x5BF9;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x7684;&#x8BF7;&#x6C42;&#x5305;&#x542B;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x5E76;&#x4E14;<code>--enable-refresh-tokens</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>true</code>&#xFF0C;&#x5219;&#x4EE3;&#x7406;&#x5C06;&#x81EA;&#x52A8;&#x4E3A;&#x60A8;&#x5237;&#x65B0;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x4EE4;&#x724C;&#x672C;&#x8EAB;&#x4FDD;&#x5B58;&#x4E3A;&#x52A0;&#x5BC6;&#x7684; <strong>(--encryption-key=KEY)</strong> cookie <strong>(cookie name: kc-state).</strong>&#x3002;&#x6216;&#x5B58;&#x50A8; <strong>(still requires encryption key)</strong>&#x3002;</p>
<p>&#x76EE;&#x524D;&#x652F;&#x6301;&#x7684;&#x552F;&#x4E00;&#x5B58;&#x50A8;&#x9009;&#x9879;&#x662F;<a href="https://github.com/antirez/redis" target="_blank">Redis</a> &#x548C;<a href="https://github.com/boltdb/bolt" target="_blank">Boltdb</a>&#x3002;</p>
<p>&#x8981;&#x542F;&#x7528;&#x672C;&#x5730;boltdb&#x5B58;&#x50A8;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<code>--store-url boltdb:///PATH</code>&#x6216;&#x4F7F;&#x7528;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;<code>boltdb://PATH</code>&#x3002;</p>
<p>&#x8981;&#x542F;&#x7528;&#x672C;&#x5730;redis&#x5B58;&#x50A8;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;<code>redis://[USER:PASSWORD@]HOST:PORT</code>&#x3002; &#x5728;&#x8FD9;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x5728;&#x653E;&#x5165;&#x5546;&#x5E97;&#x4E4B;&#x524D;&#x90FD;&#x4F1A;&#x88AB;&#x52A0;&#x5BC6;&#x3002;</p>
<p><a name="165_____2_4_23__&#x6CE8;&#x9500;&#x7AEF;&#x70B9;"></a></p>
<h4 id="2423-&#x6CE8;&#x9500;&#x7AEF;&#x70B9;"><a name="2423-&#x6CE8;&#x9500;&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#2423-&#x6CE8;&#x9500;&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.23. &#x6CE8;&#x9500;&#x7AEF;&#x70B9;</h4>
<p>&#x63D0;&#x4F9B;<strong>/oauth/logout?redirect=url</strong>&#x4F5C;&#x4E3A;&#x5E2E;&#x52A9;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x7684;&#x5E2E;&#x52A9;&#x7A0B;&#x5E8F;&#x3002; &#x9664;&#x4E86;&#x5220;&#x9664;&#x4EFB;&#x4F55;&#x4F1A;&#x8BDD;cookie&#x4E4B;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x5C1D;&#x8BD5;&#x901A;&#x8FC7;&#x63D0;&#x4F9B;&#x8005;&#x64A4;&#x9500;&#x901A;&#x8FC7;&#x540A;&#x9500;URL(config <strong>revocation-url</strong> or <strong>--revocation-url</strong>)&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x3002; &#x5BF9;&#x4E8E;Keycloak&#xFF0C;&#x5176;&#x7F51;&#x5740;&#x4E3A;<a href="https://keycloak.example.com/auth/realms/REALM_NAME/protocol/openid-connect/logout" target="_blank">https://keycloak.example.com/auth/realms/REALM_NAME/protocol/openid-connect/logout</a>&#x3002; &#x5982;&#x679C;&#x672A;&#x6307;&#x5B9A;url&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5C1D;&#x8BD5;&#x4ECE;OpenID&#x53D1;&#x73B0;&#x54CD;&#x5E94;&#x4E2D;&#x83B7;&#x53D6;url&#x3002;</p>
<p><a name="166_____2_4_24__&#x8DE8;&#x57DF;&#x8D44;&#x6E90;&#x5171;&#x4EAB;__CORS_"></a></p>
<h4 id="2424-&#x8DE8;&#x57DF;&#x8D44;&#x6E90;&#x5171;&#x4EAB;-cors"><a name="2424-&#x8DE8;&#x57DF;&#x8D44;&#x6E90;&#x5171;&#x4EAB;-cors" class="anchor-navigation-ex-anchor" href="#2424-&#x8DE8;&#x57DF;&#x8D44;&#x6E90;&#x5171;&#x4EAB;-cors"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.24. &#x8DE8;&#x57DF;&#x8D44;&#x6E90;&#x5171;&#x4EAB; (CORS)</h4>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x901A;&#x8FC7;<code>--cors-[method]</code>&#x6DFB;&#x52A0;CORS&#x5934;&#x3002;</p>
<ul>
<li>Access-Control-Allow-Origin</li>
<li>Access-Control-Allow-Methods</li>
<li>Access-Control-Allow-Headers</li>
<li>Access-Control-Expose-Headers</li>
<li>Access-Control-Allow-Credentials</li>
<li>Access-Control-Max-Age</li>
</ul>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6DFB;&#x52A0;&#xFF1A;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">cors-origins:</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">&apos;*&apos;</span>
<span class="hljs-attr">cors-methods:</span>
<span class="hljs-bullet">-</span> GET
<span class="hljs-bullet">-</span> POST
</code></pre>
<p>&#x6216;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x884C;&#xFF1A;</p>
<pre><code>--cors-origins [--cors-origins option]                  &#x4E00;&#x7EC4;&#x8981;&#x6DFB;&#x52A0;&#x5230;CORS&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x7684;&#x8D77;&#x6E90; (Access-Control-Allow-Origin)
--cors-methods [--cors-methods option]                  &#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x4E2D;&#x5141;&#x8BB8;&#x7684;&#x65B9;&#x6CD5; (Access-Control-Allow-Methods)
--cors-headers [--cors-headers option]                  &#x8981;&#x6DFB;&#x52A0;&#x5230;CORS&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x7684;&#x4E00;&#x7EC4;&#x6807;&#x5934; (Access-Control-Allow-Headers)
--cors-exposes-headers [--cors-exposes-headers option]  &#x8BBE;&#x7F6E;&#x516C;&#x5F00;&#x7684;cors&#x6807;&#x5934;&#x8BBF;&#x95EE;&#x63A7;&#x5236; (Access-Control-Expose-Headers)
</code></pre><p><a name="167_____2_4_25__&#x4E0A;&#x6E38;URL"></a></p>
<h4 id="2425-&#x4E0A;&#x6E38;url"><a name="2425-&#x4E0A;&#x6E38;url" class="anchor-navigation-ex-anchor" href="#2425-&#x4E0A;&#x6E38;url"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.25. &#x4E0A;&#x6E38;URL</h4>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>--upstream-url</code>&#x9009;&#x9879;&#x63A7;&#x5236;&#x4E0A;&#x6E38;&#x7AEF;&#x70B9;&#x3002; &#x901A;&#x8FC7;<code>--skip-upstream-tls-verify</code> / <code>--upstream-keepalives</code>&#x9009;&#x9879;&#x914D;&#x7F6E;TLS&#x9A8C;&#x8BC1;&#x548C;&#x4FDD;&#x6301;&#x6D3B;&#x52A8;&#x652F;&#x6301;&#xFF0C;&#x652F;&#x6301;HTTP&#x548C;HTTPS&#x3002; &#x6CE8;&#x610F;&#xFF0C;&#x4EE3;&#x7406;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;UNIX&#x5957;&#x63A5;&#x5B57;&#x4E0A;&#x6E38;&#xFF0C;<code>--upstream-url unix://path/to/the/file.sock</code>&#x3002;</p>
<p><a name="168_____2_4_26__&#x7AEF;&#x70B9;"></a></p>
<h4 id="2426-&#x7AEF;&#x70B9;"><a name="2426-&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#2426-&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.26. &#x7AEF;&#x70B9;</h4>
<ul>
<li><strong>/oauth/authorize</strong> &#x662F;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7AEF;&#x70B9;&#xFF0C;&#x5B83;&#x5C06;&#x751F;&#x6210;OpenID&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;</li>
<li><strong>/oauth/callback</strong> &#x662F;&#x63D0;&#x4F9B;&#x8005;OpenID&#x56DE;&#x8C03;&#x7AEF;&#x70B9;</li>
<li><strong>/oauth/expired</strong> &#x662F;&#x4E00;&#x4E2A;&#x8F85;&#x52A9;&#x7AEF;&#x70B9;&#xFF0C;&#x7528;&#x4E8E;&#x68C0;&#x67E5;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x662F;&#x5426;&#x5DF2;&#x8FC7;&#x671F;&#xFF0C;200&#x8868;&#x793A;ok&#xFF0C;401&#x8868;&#x793A;&#x65E0;&#x4EE4;&#x724C;&#xFF0C;401&#x8868;&#x793A;&#x5DF2;&#x8FC7;&#x671F;</li>
<li><strong>/oauth/health</strong> &#x662F;&#x4EE3;&#x7406;&#x7684;&#x8FD0;&#x884C;&#x72B6;&#x51B5;&#x68C0;&#x67E5;&#x7AEF;&#x70B9;&#xFF0C;&#x60A8;&#x4E5F;&#x53EF;&#x4EE5;&#x4ECE;&#x6807;&#x5934;&#x4E2D;&#x83B7;&#x53D6;&#x7248;&#x672C;</li>
<li><strong>/oauth/login</strong> &#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x901A;&#x8FC7;<code>grant_type=password</code>&#x767B;&#x5F55;&#x7684;&#x4E2D;&#x7EE7;&#x7AEF;&#x70B9;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;POST /oauth/login<code>&#x8868;&#x5355;&#x503C;&#x4E3A;</code>username=USERNAME&#xFF06;password=PASSWORD`&#xFF08;&#x5FC5;&#x987B;&#x542F;&#x7528;&#xFF09;</li>
<li><strong>/oauth/logout</strong> &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x65B9;&#x4FBF;&#x7684;&#x7AEF;&#x70B9;&#x6765;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#xFF0C;&#x5B83;&#x603B;&#x662F;&#x4F1A;&#x5C1D;&#x8BD5;&#x4ECE;&#x8131;&#x673A;&#x4EE4;&#x724C;&#x4E2D;&#x6267;&#x884C;&#x53CD;&#x5411;&#x901A;&#x9053;&#x6CE8;&#x9500;</li>
<li><strong>/oauth/token</strong> &#x662F;&#x4E00;&#x4E2A;&#x5E2E;&#x52A9;&#x7AEF;&#x70B9;&#xFF0C;&#x5B83;&#x5C06;&#x4E3A;&#x60A8;&#x663E;&#x793A;&#x5F53;&#x524D;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</li>
<li><strong>/oauth/metrics</strong> &#x662F;&#x4E00;&#x4E2A;Prometheus&#x6307;&#x6807;&#x5904;&#x7406;&#x7A0B;&#x5E8F;</li>
</ul>
<p><a name="169_____2_4_27__&#x5EA6;&#x91CF;"></a></p>
<h4 id="2427-&#x5EA6;&#x91CF;"><a name="2427-&#x5EA6;&#x91CF;" class="anchor-navigation-ex-anchor" href="#2427-&#x5EA6;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.27. &#x5EA6;&#x91CF;</h4>
<p>&#x5047;&#x8BBE;&#x5DF2;&#x7ECF;&#x8BBE;&#x7F6E;&#x4E86;<code>--enable-metrics</code>&#xFF0C;&#x53EF;&#x4EE5;&#x5728;<strong>/oauth/metrics </strong>&#x4E0A;&#x627E;&#x5230;Prometheus&#x7AEF;&#x70B9;; &#x76EE;&#x524D;&#xFF0C;&#x552F;&#x4E00;&#x516C;&#x5F00;&#x7684;&#x5EA6;&#x91CF;&#x6807;&#x51C6;&#x662F;&#x6BCF;&#x4E2A;HTTP&#x4EE3;&#x7801;&#x7684;&#x8BA1;&#x6570;&#x5668;&#x3002;</p>
<p><a name="170_____2_4_28__&#x9650;&#x5236;"></a></p>
<h4 id="2428-&#x9650;&#x5236;"><a name="2428-&#x9650;&#x5236;" class="anchor-navigation-ex-anchor" href="#2428-&#x9650;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.28. &#x9650;&#x5236;</h4>
<p>&#x5982;&#x679C;&#x60A8;&#x5728;&#x6D4F;&#x89C8;&#x5668;cookie&#x4E2D;&#x4F7F;&#x7528;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x6216;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#xFF0C;&#x8BF7;&#x8BB0;&#x4F4F;[&#x6D4F;&#x89C8;&#x5668;cookie&#x9650;&#x5236;]&#xFF08;<a href="http://browsercookielimits.squawky.net/&#xFF09;&#x3002;" target="_blank">http://browsercookielimits.squawky.net/&#xFF09;&#x3002;</a> &#x5982;&#x679C;&#x60A8;&#x7684;cookie&#x8D85;&#x8FC7;4093&#x5B57;&#x8282;&#xFF0C;Keycloak-generic-adapter&#x4F1A;&#x81EA;&#x52A8;&#x5212;&#x5206;cookie&#x3002; cookie&#x7684;&#x5B9E;&#x9645;&#x5927;&#x5C0F;&#x53D6;&#x51B3;&#x4E8E;&#x53D1;&#x5E03;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x7684;&#x5185;&#x5BB9;&#x3002; &#x6B64;&#x5916;&#xFF0C;&#x52A0;&#x5BC6;&#x53EF;&#x80FD;&#x4F1A;&#x4E3A;cookie&#x5927;&#x5C0F;&#x6DFB;&#x52A0;&#x989D;&#x5916;&#x7684;&#x5B57;&#x8282;&#x3002; &#x5982;&#x679C;&#x60A8;&#x6709;&#x5927;&#x578B;Cookie&#xFF08;&gt; 200 KB&#xFF09;&#xFF0C;&#x5219;&#x53EF;&#x80FD;&#x4F1A;&#x8FBE;&#x5230;&#x6D4F;&#x89C8;&#x5668;Cookie&#x9650;&#x5236;&#x3002;</p>
<p>&#x6240;&#x6709;cookie&#x90FD;&#x662F;&#x6807;&#x5934;&#x8BF7;&#x6C42;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x73B0;&#x57FA;&#x7840;&#x7ED3;&#x6784;&#x4E2D;&#x7684;&#x6700;&#x5927;&#x6807;&#x5934;&#x5927;&#x5C0F;&#x9650;&#x5236;&#x5B58;&#x5728;&#x95EE;&#x9898;&#xFF08;&#x67D0;&#x4E9B;&#x8D1F;&#x8F7D;&#x5E73;&#x8861;&#x5668;&#x7684;&#x6B64;&#x503C;&#x975E;&#x5E38;&#x4F4E;&#xFF0C;&#x4F8B;&#x5982;8 KB&#xFF09;&#x3002; &#x786E;&#x4FDD;&#x6240;&#x6709;&#x7F51;&#x7EDC;&#x8BBE;&#x5907;&#x90FD;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x6807;&#x5934;&#x5927;&#x5C0F;&#x9650;&#x5236;&#x3002; &#x5426;&#x5219;&#xFF0C;&#x60A8;&#x7684;&#x7528;&#x6237;&#x5C06;&#x65E0;&#x6CD5;&#x83B7;&#x5F97;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;</p>
<p><a name="171_____2_4_29__&#x5DF2;&#x77E5;&#x7684;&#x95EE;&#x9898;"></a></p>
<h4 id="2429-&#x5DF2;&#x77E5;&#x7684;&#x95EE;&#x9898;"><a name="2429-&#x5DF2;&#x77E5;&#x7684;&#x95EE;&#x9898;" class="anchor-navigation-ex-anchor" href="#2429-&#x5DF2;&#x77E5;&#x7684;&#x95EE;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4.29. &#x5DF2;&#x77E5;&#x7684;&#x95EE;&#x9898;</h4>
<ul>
<li>Keycloak&#x670D;&#x52A1;&#x5668;4.7.0.Final&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x5DF2;&#x77E5;&#x95EE;&#x9898;&#xFF0C;&#x5176;&#x4E2D;Gatekeeper&#x65E0;&#x6CD5;&#x5728;<em>aud</em>&#x58F0;&#x660E;&#x4E2D;&#x627E;&#x5230;<em>client_id</em>&#x3002; &#x8FD9;&#x662F;&#x56E0;&#x4E3A;<em>client_id</em>&#x4E0D;&#x518D;&#x5728;&#x89C2;&#x4F17;&#x4E2D;&#x3002; &#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x662F;&#x5C06;&#x201C;Audience(&#x53D7;&#x4F17;)&#x201D;&#x534F;&#x8BAE;&#x6620;&#x5C04;&#x5668;&#x6DFB;&#x52A0;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5E76;&#x5C06;&#x53D7;&#x4F17;&#x6307;&#x5411;<em>client_id</em>&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://issues.jboss.org/browse/KEYCLOAK-8954" target="_blank">KEYCLOAK-8954</a>&#x3002; ==== mod_auth_openidc Apache HTTPD&#x6A21;&#x5757;</li>
</ul>
<p><a href="https://github.com/zmartzone/mod_auth_openidc" target="_blank">mod_auth_openidc</a>&#x662F;OpenID Connect&#x7684;Apache HTTP&#x63D2;&#x4EF6;&#x3002; &#x5982;&#x679C;&#x60A8;&#x7684;&#x8BED;&#x8A00;/&#x73AF;&#x5883;&#x652F;&#x6301;&#x4F7F;&#x7528;Apache HTTPD&#x4F5C;&#x4E3A;&#x4EE3;&#x7406;&#xFF0C;&#x90A3;&#x4E48;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<em>mod_auth_openidc</em>&#x6765;&#x4F7F;&#x7528;OpenID Connect&#x4FDD;&#x62A4;&#x60A8;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x6B64;&#x6A21;&#x5757;&#x7684;&#x914D;&#x7F6E;&#x8D85;&#x51FA;&#x4E86;&#x672C;&#x6587;&#x6863;&#x7684;&#x8303;&#x56F4;&#x3002; &#x6709;&#x5173;&#x914D;&#x7F6E;&#x7684;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<em>mod_auth_openidc</em> GitHub &#x4ED3;&#x5E93;&#x3002;</p>
<p>&#x8981;&#x914D;&#x7F6E;<em>mod_auth_openidc</em>&#xFF0C;&#x60A8;&#x9700;&#x8981;</p>
<ul>
<li>The client_id.</li>
<li>The client_secret.</li>
<li>redirect_uri&#x5230;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</li>
<li>Keycloak openid&#x914D;&#x7F6E;&#x7F51;&#x5740;</li>
<li><em>mod_auth_openidc</em>&#x7279;&#x5B9A;&#x7684;Apache HTTPD&#x6A21;&#x5757;&#x914D;&#x7F6E;&#x3002;</li>
</ul>
<p>&#x793A;&#x4F8B;&#x914D;&#x7F6E;&#x5982;&#x4E0B;&#x6240;&#x793A;&#x3002;</p>
<pre><code>LoadModule auth_openidc_module modules/mod_auth_openidc.so

ServerName ${HOSTIP}

&lt;VirtualHost *:80&gt;

    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    #this is required by mod_auth_openidc
    OIDCCryptoPassphrase a-random-secret-used-by-apache-oidc-and-balancer

    OIDCProviderMetadataURL ${KC_ADDR}/auth/realms/${KC_REALM}/.well-known/openid-configuration

    OIDCClientID ${CLIENT_ID}
    OIDCClientSecret ${CLIENT_SECRET}
    OIDCRedirectURI http://${HOSTIP}/${CLIENT_APP_NAME}/redirect_uri

    # maps the prefered_username claim to the REMOTE_USER environment variable
    OIDCRemoteUserClaim preferred_username

    &lt;Location /${CLIENT_APP_NAME}/&gt;
        AuthType openid-connect
        Require valid-user
    &lt;/Location&gt;
&lt;/VirtualHost&gt;
</code></pre><p>&#x6709;&#x5173;&#x5982;&#x4F55;&#x914D;&#x7F6E;mod_auth_openidc&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1;<a href="https://github.com/zmartzone/mod_auth_openidc" target="_blank">mod_auth_openidc</a> &#x9879;&#x76EE;&#x9875;&#x9762;&#x3002;</p>
<p><a name="172____2_5__&#x5176;&#x4ED6;OpenID&#x8FDE;&#x63A5;&#x5E93;"></a></p>
<h3 id="25-&#x5176;&#x4ED6;openid&#x8FDE;&#x63A5;&#x5E93;"><a name="25-&#x5176;&#x4ED6;openid&#x8FDE;&#x63A5;&#x5E93;" class="anchor-navigation-ex-anchor" href="#25-&#x5176;&#x4ED6;openid&#x8FDE;&#x63A5;&#x5E93;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5. &#x5176;&#x4ED6;OpenID&#x8FDE;&#x63A5;&#x5E93;</h3>
<p>Keycloak&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x63D0;&#x4F9B;&#x7684;&#x9002;&#x914D;&#x5668;&#x8FDB;&#x884C;&#x4FDD;&#x62A4;&#xFF0C;&#x8FD9;&#x4E9B;&#x9002;&#x914D;&#x5668;&#x901A;&#x5E38;&#x66F4;&#x6613;&#x4E8E;&#x4F7F;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x4E0E;Keycloak&#x96C6;&#x6210;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x9002;&#x914D;&#x5668;&#x4E0D;&#x9002;&#x7528;&#x4E8E;&#x60A8;&#x7684;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#xFF0C;&#x6846;&#x67B6;&#x6216;&#x5E73;&#x53F0;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x4F7F;&#x7528;&#x901A;&#x7528;OpenID Connect&#x8D44;&#x6E90;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#xFF08;RP&#xFF09;&#x5E93;&#x3002; &#x672C;&#x7AE0;&#x4ECB;&#x7ECD;&#x4E86;Keycloak&#x7684;&#x5177;&#x4F53;&#x7EC6;&#x8282;&#xFF0C;&#x4F46;&#x4E0D;&#x5305;&#x542B;&#x7279;&#x5B9A;&#x7684;&#x534F;&#x8BAE;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://openid.net/connect/" target="_blank">OpenID Connect&#x89C4;&#x8303;</a>&#x548C;<a href="https://tools.ietf.org/html/rfc6749" target="_blank">OAuth2&#x89C4;&#x8303;</a>&#x3002;</p>
<p><a name="173_____2_5_1__&#x7AEF;&#x70B9;"></a></p>
<h4 id="251-&#x7AEF;&#x70B9;"><a name="251-&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#251-&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.1. &#x7AEF;&#x70B9;</h4>
<p>&#x8981;&#x4E86;&#x89E3;&#x7684;&#x6700;&#x91CD;&#x8981;&#x7684;&#x7AEF;&#x70B9;&#x662F;<code>well-known(&#x4F17;&#x6240;&#x5468;&#x77E5;&#x7684;)</code>&#x914D;&#x7F6E;&#x7AEF;&#x70B9;&#x3002; &#x5B83;&#x5217;&#x51FA;&#x4E86;&#x4E0E;Keycloak&#x4E2D;&#x7684;OpenID Connect&#x5B9E;&#x73B0;&#x76F8;&#x5173;&#x7684;&#x7AEF;&#x70B9;&#x548C;&#x5176;&#x4ED6;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x3002; &#x7AEF;&#x70B9;&#x662F;&#xFF1A;</p>
<pre><code>/realms/{realm-name}/.well-known/openid-configuration
</code></pre><p>&#x8981;&#x83B7;&#x53D6;&#x5B8C;&#x6574;&#x7684;URL&#xFF0C;&#x8BF7;&#x6DFB;&#x52A0;Keycloak&#x7684;&#x57FA;&#x672C;URL&#xFF0C;&#x5E76;&#x5C06;<code>{realm-name}</code>&#x66FF;&#x6362;&#x4E3A;&#x60A8;&#x7684;&#x57DF;&#x7684;&#x540D;&#x79F0;&#x3002; &#x4F8B;&#x5982;&#xFF1A;</p>
<p><a href="http://localhost:8080/auth/realms/master/.well-known/openid-configuration" target="_blank">http://localhost:8080/auth/realms/master/.well-known/openid-configuration</a></p>
<p>&#x67D0;&#x4E9B;RP&#x5E93;&#x4ECE;&#x6B64;&#x7AEF;&#x70B9;&#x68C0;&#x7D22;&#x6240;&#x6709;&#x5FC5;&#x9700;&#x7684;&#x7AEF;&#x70B9;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;&#x5176;&#x4ED6;&#x7AEF;&#x70B9;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5355;&#x72EC;&#x5217;&#x51FA;&#x7AEF;&#x70B9;&#x3002;</p>
<p><a name="174______&#x6388;&#x6743;&#x7AEF;&#x70B9;"></a></p>
<h5 id="&#x6388;&#x6743;&#x7AEF;&#x70B9;"><a name="&#x6388;&#x6743;&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x6388;&#x6743;&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6388;&#x6743;&#x7AEF;&#x70B9;</h5>
<pre><code>/realms/{realm-name}/protocol/openid-connect/auth
</code></pre><p>&#x6388;&#x6743;&#x7AEF;&#x70B9;&#x6267;&#x884C;&#x6700;&#x7EC8;&#x7528;&#x6237;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x8FD9;&#x662F;&#x901A;&#x8FC7;&#x5C06;&#x7528;&#x6237;&#x4EE3;&#x7406;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x6B64;&#x7AEF;&#x70B9;&#x6765;&#x5B8C;&#x6210;&#x7684;&#x3002;</p>
<p>&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;OpenID Connect&#x89C4;&#x8303;&#x4E2D;&#x7684;<a href="https://openid.net/specs/openid-connect-core-1_0.html#AuthorizationEndpoint" target="_blank">&#x6388;&#x6743;&#x7AEF;&#x70B9;</a> &#x90E8;&#x5206;&#x3002;</p>
<p><a name="175______&#x4EE4;&#x724C;&#x7AEF;&#x70B9;"></a></p>
<h5 id="&#x4EE4;&#x724C;&#x7AEF;&#x70B9;"><a name="&#x4EE4;&#x724C;&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x4EE4;&#x724C;&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4EE4;&#x724C;&#x7AEF;&#x70B9;</h5>
<pre><code>/realms/{realm-name}/protocol/openid-connect/token
</code></pre><p>&#x4EE4;&#x724C;&#x7AEF;&#x70B9;&#x7528;&#x4E8E;&#x83B7;&#x53D6;&#x4EE4;&#x724C;&#x3002; &#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EA4;&#x6362;&#x6388;&#x6743;&#x4EE3;&#x7801;&#x6216;&#x76F4;&#x63A5;&#x63D0;&#x4F9B;&#x51ED;&#x8BC1;&#x6765;&#x83B7;&#x53D6;&#x4EE4;&#x724C;&#xFF0C;&#x5177;&#x4F53;&#x53D6;&#x51B3;&#x4E8E;&#x4F7F;&#x7528;&#x7684;&#x6D41;&#x7A0B;&#x3002; &#x4EE4;&#x724C;&#x7AEF;&#x70B9;&#x8FD8;&#x7528;&#x4E8E;&#x5728;&#x5230;&#x671F;&#x65F6;&#x83B7;&#x53D6;&#x65B0;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;</p>
<p>&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;OpenID Connect&#x89C4;&#x8303;&#x4E2D;&#x7684;<a href="https://openid.net/specs/openid-connect-core-1_0.html#TokenEndpoint" target="_blank">&#x4EE4;&#x724C;&#x7AEF;&#x70B9;</a>&#x90E8;&#x5206;&#x3002;</p>
<p><a name="176______Userinfo&#x7AEF;&#x70B9;"></a></p>
<h5 id="userinfo&#x7AEF;&#x70B9;"><a name="userinfo&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#userinfo&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>Userinfo&#x7AEF;&#x70B9;</h5>
<pre><code>/realms/{realm-name}/protocol/openid-connect/userinfo
</code></pre><p>userinfo&#x7AEF;&#x70B9;&#x8FD4;&#x56DE;&#x6709;&#x5173;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x7528;&#x6237;&#x7684;&#x6807;&#x51C6;&#x58F0;&#x660E;&#xFF0C;&#x5E76;&#x53D7;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x4FDD;&#x62A4;&#x3002;</p>
<p>&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;OpenID Connect&#x89C4;&#x8303;&#x4E2D;&#x7684;<a href="https://openid.net/specs/openid-connect-core-1_0.html#UserInfo" target="_blank">Userinfo&#x7AEF;&#x70B9;</a>&#x90E8;&#x5206;&#x3002;</p>
<p><a name="177______&#x6CE8;&#x9500;&#x7AEF;&#x70B9;"></a></p>
<h5 id="&#x6CE8;&#x9500;&#x7AEF;&#x70B9;"><a name="&#x6CE8;&#x9500;&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x9500;&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x9500;&#x7AEF;&#x70B9;</h5>
<pre><code>/realms/{realm-name}/protocol/openid-connect/logout
</code></pre><p>&#x6CE8;&#x9500;&#x7AEF;&#x70B9;&#x6CE8;&#x9500;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x7528;&#x6237;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x5C06;&#x7528;&#x6237;&#x4EE3;&#x7406;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x7AEF;&#x70B9;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5C06;&#x6CE8;&#x9500;&#x6D3B;&#x52A8;&#x7528;&#x6237;&#x4F1A;&#x8BDD;&#x3002; &#x4E4B;&#x540E;&#xFF0C;&#x7528;&#x6237;&#x4EE3;&#x7406;&#x5C06;&#x91CD;&#x5B9A;&#x5411;&#x56DE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>&#x7AEF;&#x70B9;&#x4E5F;&#x53EF;&#x4EE5;&#x7531;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x3002; &#x8981;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x6B64;&#x7AEF;&#x70B9;&#xFF0C;&#x9700;&#x8981;&#x5305;&#x542B;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x4EE5;&#x53CA;&#x9A8C;&#x8BC1;&#x5BA2;&#x6237;&#x7AEF;&#x6240;&#x9700;&#x7684;&#x51ED;&#x636E;&#x3002;</p>
<p><a name="178______&#x8BC1;&#x4E66;&#x7AEF;&#x70B9;"></a></p>
<h5 id="&#x8BC1;&#x4E66;&#x7AEF;&#x70B9;"><a name="&#x8BC1;&#x4E66;&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x8BC1;&#x4E66;&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8BC1;&#x4E66;&#x7AEF;&#x70B9;</h5>
<pre><code>/realms/{realm-name}/protocol/openid-connect/certs
</code></pre><p>&#x8BC1;&#x4E66;&#x7AEF;&#x70B9;&#x8FD4;&#x56DE;&#x7531;&#x9886;&#x57DF;&#x542F;&#x7528;&#x7684;&#x516C;&#x94A5;&#xFF0C;&#x7F16;&#x7801;&#x4E3A;JSON Web&#x5BC6;&#x94A5;&#xFF08;JWK&#xFF09;&#x3002; &#x6839;&#x636E;&#x9886;&#x57DF;&#x8BBE;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x542F;&#x7528;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5BC6;&#x94A5;&#x6765;&#x9A8C;&#x8BC1;&#x4EE4;&#x724C;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_admin/" target="_blank">&#x670D;&#x52A1;&#x5668;&#x7BA1;&#x7406;&#x6307;&#x5357;</a> &#x548C;<a href="https://tools.ietf.org/html/rfc7517" target="_blank">JSON Web&#x5BC6;&#x94A5;&#x89C4;&#x8303;</a>&#x3002;</p>
<p><a name="179______&#x5185;&#x7701;&#x7AEF;&#x70B9;"></a></p>
<h5 id="&#x5185;&#x7701;&#x7AEF;&#x70B9;"><a name="&#x5185;&#x7701;&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x5185;&#x7701;&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5185;&#x7701;&#x7AEF;&#x70B9;</h5>
<pre><code>/realms/{realm-name}/protocol/openid-connect/token/introspect
</code></pre><p>&#x5185;&#x7701;&#x7AEF;&#x70B9;&#x7528;&#x4E8E;&#x68C0;&#x7D22;&#x4EE4;&#x724C;&#x7684;&#x6D3B;&#x52A8;&#x72B6;&#x6001;&#x3002; &#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x9A8C;&#x8BC1;&#x8BBF;&#x95EE;&#x6216;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x3002; &#x5B83;&#x53EA;&#x80FD;&#x7531;&#x673A;&#x5BC6;&#x5BA2;&#x6237;&#x7AEF;&#x8C03;&#x7528;&#x3002;</p>
<p>&#x6709;&#x5173;&#x5982;&#x4F55;&#x5728;&#x6B64;&#x7AEF;&#x70B9;&#x4E0A;&#x8C03;&#x7528;&#x7684;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://tools.ietf.org/html/rfc7662" target="_blank">OAuth 2.0 Token Introspection&#x89C4;&#x8303;</a>&#x3002;</p>
<p><a name="180______&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x7AEF;&#x70B9;"></a></p>
<h5 id="&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x7AEF;&#x70B9;"><a name="&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x7AEF;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x7AEF;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x7AEF;&#x70B9;</h5>
<pre><code>/realms/{realm-name}/clients-registrations/openid-connect
</code></pre><p>&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x7AEF;&#x70B9;&#x7528;&#x4E8E;&#x52A8;&#x6001;&#x6CE8;&#x518C;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
<p>&#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_client_registration" target="_blank">&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x7AE0;&#x8282;</a>&#x548C;<a href="https://openid.net/specs/openid-connect-registration-1_0.html" target="_blank">OpenID Connect&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x89C4;&#x8303;</a>&#x3002;</p>
<p><a name="181_____2_5_2__&#x9A8C;&#x8BC1;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"></a></p>
<h4 id="252-&#x9A8C;&#x8BC1;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"><a name="252-&#x9A8C;&#x8BC1;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;" class="anchor-navigation-ex-anchor" href="#252-&#x9A8C;&#x8BC1;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.2. &#x9A8C;&#x8BC1;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</h4>
<p>&#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x624B;&#x52A8;&#x9A8C;&#x8BC1;Keycloak&#x53D1;&#x51FA;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x8C03;&#x7528;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_token_introspection_endpoint" target="_blank">&#x5185;&#x7701;&#x7AEF;&#x70B9;</a>&#x3002; &#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x7684;&#x7F3A;&#x70B9;&#x662F;&#x60A8;&#x5FC5;&#x987B;&#x5BF9;Keycloak&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8C03;&#x7528;&#x3002; &#x5982;&#x679C;&#x60A8;&#x540C;&#x65F6;&#x8FDB;&#x884C;&#x592A;&#x591A;&#x9A8C;&#x8BC1;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x4F1A;&#x5F88;&#x6162;&#x5E76;&#x4E14;&#x53EF;&#x80FD;&#x4F1A;&#x4F7F;&#x670D;&#x52A1;&#x5668;&#x8FC7;&#x8F7D;&#x3002; Keycloak&#x9881;&#x53D1;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x662F;<a href="https://tools.ietf.org/html/rfc7519" target="_blank">JSON Web&#x4EE4;&#x724C;&#xFF08;JWT&#xFF09;</a>&#xFF0C;&#x4F7F;&#x7528;<a href="https://www.rfc-editor.org/rfc/rfc7515.txt" target="_blank">JSON Web&#x7B7E;&#x540D;&#xFF08;JWS&#xFF09;</a>&#x8FDB;&#x884C;&#x6570;&#x5B57;&#x7B7E;&#x540D;&#x548C;&#x7F16;&#x7801;&#x3002; &#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x662F;&#x4EE5;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x7F16;&#x7801;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x5141;&#x8BB8;&#x60A8;&#x4F7F;&#x7528;&#x53D1;&#x5E03;&#x9886;&#x57DF;&#x7684;&#x516C;&#x94A5;&#x5728;&#x672C;&#x5730;&#x9A8C;&#x8BC1;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x9A8C;&#x8BC1;&#x4EE3;&#x7801;&#x4E2D;&#x5BF9;&#x57DF;&#x7684;&#x516C;&#x94A5;&#x8FDB;&#x884C;&#x786C;&#x7F16;&#x7801;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;[&#x8BC1;&#x4E66;&#x7AEF;&#x70B9;]&#x67E5;&#x627E;&#x548C;&#x7F13;&#x5B58;&#x516C;&#x94A5;(<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_certificate_endpoint)&#x4F7F;&#x7528;JWS&#x4E2D;&#x5D4C;&#x5165;&#x7684;&#x5BC6;&#x94A5;ID&#xFF08;KID&#xFF09;&#x3002;" target="_blank">https://www.keycloak.org/docs/latest/securing_apps/index.html#_certificate_endpoint)&#x4F7F;&#x7528;JWS&#x4E2D;&#x5D4C;&#x5165;&#x7684;&#x5BC6;&#x94A5;ID&#xFF08;KID&#xFF09;&#x3002;</a> &#x6839;&#x636E;&#x60A8;&#x7F16;&#x5199;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x6709;&#x8BB8;&#x591A;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x60A8;&#x8FDB;&#x884C;JWS&#x9A8C;&#x8BC1;&#x3002;</p>
<p><a name="182_____2_5_3__&#x6D41;"></a></p>
<h4 id="253-&#x6D41;"><a name="253-&#x6D41;" class="anchor-navigation-ex-anchor" href="#253-&#x6D41;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.3. &#x6D41;</h4>
<p><a name="183______&#x6388;&#x6743;&#x7801;"></a></p>
<h5 id="&#x6388;&#x6743;&#x7801;"><a name="&#x6388;&#x6743;&#x7801;" class="anchor-navigation-ex-anchor" href="#&#x6388;&#x6743;&#x7801;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6388;&#x6743;&#x7801;</h5>
<p>&#x6388;&#x6743;&#x4EE3;&#x7801;&#x6D41;&#x5C06;&#x7528;&#x6237;&#x4EE3;&#x7406;&#x91CD;&#x5B9A;&#x5411;&#x5230;Keycloak&#x3002; &#x4E00;&#x65E6;&#x7528;&#x6237;&#x6210;&#x529F;&#x901A;&#x8FC7;Keycloak&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5C31;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6388;&#x6743;&#x7801;&#xFF0C;&#x5E76;&#x5C06;&#x7528;&#x6237;&#x4EE3;&#x7406;&#x91CD;&#x5B9A;&#x5411;&#x56DE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x7136;&#x540E;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x6388;&#x6743;&#x4EE3;&#x7801;&#x53CA;&#x5176;&#x51ED;&#x636E;&#x4ECE;Keycloak&#x83B7;&#x53D6;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x548C;ID&#x4EE4;&#x724C;&#x3002;</p>
<p>&#x8BE5;&#x6D41;&#x7A0B;&#x9488;&#x5BF9;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F46;&#x4E5F;&#x5EFA;&#x8BAE;&#x7528;&#x4E8E;&#x672C;&#x673A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5305;&#x62EC;&#x53EF;&#x4EE5;&#x5D4C;&#x5165;&#x7528;&#x6237;&#x4EE3;&#x7406;&#x7684;&#x79FB;&#x52A8;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;OpenID Connect&#x89C4;&#x8303;&#x4E2D;&#x7684;<a href="https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth" target="_blank">&#x6388;&#x6743;&#x4EE3;&#x7801;&#x6D41;&#x7A0B;</a> &#x3002;</p>
<p><a name="184______&#x9690;&#x5F0F;"></a></p>
<h5 id="&#x9690;&#x5F0F;"><a name="&#x9690;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#&#x9690;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9690;&#x5F0F;</h5>
<p>&#x9690;&#x5F0F;&#x6D41;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x4E0E;&#x6388;&#x6743;&#x4EE3;&#x7801;&#x6D41;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x4E0D;&#x8FD4;&#x56DE;&#x6388;&#x6743;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x662F;&#x8FD4;&#x56DE;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x548C;ID&#x4EE4;&#x724C;&#x3002; &#x8FD9;&#x51CF;&#x5C11;&#x4E86;&#x989D;&#x5916;&#x8C03;&#x7528;&#x4EE5;&#x4EA4;&#x6362;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x7684;&#x6388;&#x6743;&#x7801;&#x7684;&#x9700;&#x8981;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x5B83;&#x4E0D;&#x5305;&#x62EC;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x3002; &#x8FD9;&#x5BFC;&#x81F4;&#x9700;&#x8981;&#x5141;&#x8BB8;&#x5177;&#x6709;&#x957F;&#x671F;&#x5230;&#x671F;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x8FD9;&#x662F;&#x6709;&#x95EE;&#x9898;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5F88;&#x96BE;&#x4F7F;&#x8FD9;&#x4E9B;&#x65E0;&#x6548;&#x3002; &#x6216;&#x8005;&#x5728;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x8FC7;&#x671F;&#x540E;&#x9700;&#x8981;&#x65B0;&#x7684;&#x91CD;&#x5B9A;&#x5411;&#x6765;&#x83B7;&#x53D6;&#x65B0;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EA;&#x60F3;&#x9A8C;&#x8BC1;&#x7528;&#x6237;&#x5E76;&#x5904;&#x7406;&#x6CE8;&#x9500;&#x672C;&#x8EAB;&#xFF0C;&#x5219;&#x9690;&#x5F0F;&#x6D41;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p>
<p>&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x6DF7;&#x5408;&#x6D41;&#x7A0B;&#xFF0C;&#x5176;&#x4E2D;&#x8FD4;&#x56DE;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x548C;&#x6388;&#x6743;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;&#x9690;&#x5F0F;&#x6D41;&#x548C;&#x6DF7;&#x5408;&#x6D41;&#x90FD;&#x5B58;&#x5728;&#x6F5C;&#x5728;&#x7684;&#x5B89;&#x5168;&#x98CE;&#x9669;&#xFF0C;&#x56E0;&#x4E3A;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x53EF;&#x80FD;&#x4F1A;&#x901A;&#x8FC7;Web&#x670D;&#x52A1;&#x5668;&#x65E5;&#x5FD7;&#x548C;&#x6D4F;&#x89C8;&#x5668;&#x5386;&#x53F2;&#x6CC4;&#x6F0F;&#x3002; &#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x7684;&#x77ED;&#x671F;&#x5230;&#x671F;&#xFF0C;&#x53EF;&#x4EE5;&#x7A0D;&#x5FAE;&#x51CF;&#x8F7B;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;OpenID Connect&#x89C4;&#x8303;&#x4E2D;&#x7684;<a href="https://openid.net/specs/openid-connect-core-1_0.html#ImplicitFlowAuth" target="_blank">Implicit Flow</a>&#x3002;</p>
<p><a name="185______&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x636E;"></a></p>
<h5 id="&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x636E;"><a name="&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x636E;" class="anchor-navigation-ex-anchor" href="#&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x636E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x636E;</h5>
<p>&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x636E;&#xFF08;&#x5728;Keycloak&#x4E2D;&#x79F0;&#x4E3A;&#x76F4;&#x63A5;&#x6388;&#x6743;&#xFF09;&#x5141;&#x8BB8;&#x4E3A;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7528;&#x6237;&#x51ED;&#x636E;&#x3002; &#x9664;&#x975E;&#x60A8;&#x7EDD;&#x5BF9;&#x9700;&#x8981;&#xFF0C;&#x5426;&#x5219;&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x6B64;&#x6D41;&#x7A0B;&#x3002; &#x8FD9;&#x53EF;&#x80FD;&#x6709;&#x7528;&#x7684;&#x793A;&#x4F8B;&#x662F;&#x9057;&#x7559;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x547D;&#x4EE4;&#x884C;&#x754C;&#x9762;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x6B64;&#x6D41;&#x7A0B;&#x6709;&#x8BB8;&#x591A;&#x9650;&#x5236;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;</p>
<ul>
<li>&#x7528;&#x6237;&#x51ED;&#x636E;&#x5C06;&#x516C;&#x5F00;&#x7ED9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</li>
<li>&#x5E94;&#x7528;&#x9700;&#x8981;&#x767B;&#x5F55;&#x9875;&#x9762;</li>
<li>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65B9;&#x6848;</li>
<li>&#x5BF9;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6D41;&#x7A0B;&#x7684;&#x66F4;&#x6539;&#x9700;&#x8981;&#x66F4;&#x6539;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</li>
<li>&#x4E0D;&#x652F;&#x6301;&#x8EAB;&#x4EFD;&#x4EE3;&#x7406;&#x6216;&#x793E;&#x4EA4;&#x767B;&#x5F55;</li>
<li>&#x4E0D;&#x652F;&#x6301;&#x6D41;&#x7A0B;&#xFF08;&#x7528;&#x6237;&#x81EA;&#x884C;&#x6CE8;&#x518C;&#xFF0C;&#x6240;&#x9700;&#x64CD;&#x4F5C;&#x7B49;&#xFF09;</li>
</ul>
<p>&#x8981;&#x5141;&#x8BB8;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x636E;&#x6388;&#x4E88;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5FC5;&#x987B;&#x542F;&#x7528;<code>Direct Access Grants Enabled</code>&#x9009;&#x9879;&#x3002;</p>
<p>&#x6B64;&#x6D41;&#x7A0B;&#x4E0D;&#x5305;&#x542B;&#x5728;OpenID Connect&#x4E2D;&#xFF0C;&#x4F46;&#x662F;&#x662F;OAuth 2.0&#x89C4;&#x8303;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</p>
<p>&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;OAuth 2.0&#x89C4;&#x8303;&#x4E2D;&#x7684;<a href="https://tools.ietf.org/html/rfc6749#section-4.3" target="_blank">&#x8D44;&#x6E90;&#x6240;&#x6709;&#x8005;&#x5BC6;&#x7801;&#x51ED;&#x636E;&#x6388;&#x6743;</a>&#x7AE0;&#x8282;&#x3002;</p>
<p><a name="186_______&#x4F7F;&#x7528;CURL&#x7684;&#x793A;&#x4F8B;"></a></p>
<h6 id="&#x4F7F;&#x7528;curl&#x7684;&#x793A;&#x4F8B;"><a name="&#x4F7F;&#x7528;curl&#x7684;&#x793A;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;curl&#x7684;&#x793A;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;CURL&#x7684;&#x793A;&#x4F8B;</h6>
<p>&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#x663E;&#x793A;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x540D;<code>user</code>&#x548C;&#x5BC6;&#x7801;<code>password</code>&#x4E3A;&#x9886;&#x57DF;<code>master</code>&#x4E2D;&#x7684;&#x7528;&#x6237;&#x83B7;&#x53D6;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x793A;&#x4F8B;&#x4F7F;&#x7528;&#x673A;&#x5BC6;&#x5BA2;&#x6237;&#x7AEF;<code>myclient</code>&#xFF1A;</p>
<pre><code class="lang-bash">curl \
  <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_id=myclient&quot;</span> \
  <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_secret=40cc097b-2a57-4c17-b36a-8fdf3fc2d578&quot;</span> \
  <span class="hljs-_">-d</span> <span class="hljs-string">&quot;username=user&quot;</span> \
  <span class="hljs-_">-d</span> <span class="hljs-string">&quot;password=password&quot;</span> \
  <span class="hljs-_">-d</span> <span class="hljs-string">&quot;grant_type=password&quot;</span> \
  <span class="hljs-string">&quot;http://localhost:8080/auth/realms/master/protocol/openid-connect/token&quot;</span>
</code></pre>
<p><a name="187______&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x636E;"></a></p>
<h5 id="&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x636E;"><a name="&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x636E;" class="anchor-navigation-ex-anchor" href="#&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x636E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x636E;</h5>
<p>&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#xFF09;&#x5E0C;&#x671B;&#x4EE3;&#x8868;&#x81EA;&#x5DF1;&#x800C;&#x4E0D;&#x662F;&#x4EE3;&#x8868;&#x7528;&#x6237;&#x83B7;&#x53D6;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x65F6;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x636E;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x8FD9;&#x5BF9;&#x4E8E;&#x901A;&#x5E38;&#x800C;&#x4E0D;&#x662F;&#x9488;&#x5BF9;&#x7279;&#x5B9A;&#x7528;&#x6237;&#x5E94;&#x7528;&#x5BF9;&#x7CFB;&#x7EDF;&#x7684;&#x66F4;&#x6539;&#x7684;&#x540E;&#x53F0;&#x670D;&#x52A1;&#x662F;&#x6709;&#x7528;&#x7684;&#x3002;</p>
<p>Keycloak&#x652F;&#x6301;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x5BC6;&#x94A5;&#x6216;&#x516C;&#x94A5;/&#x79C1;&#x94A5;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;</p>
<p>&#x6B64;&#x6D41;&#x7A0B;&#x4E0D;&#x5305;&#x542B;&#x5728;OpenID Connect&#x4E2D;&#xFF0C;&#x4F46;&#x662F;&#x662F;OAuth 2.0&#x89C4;&#x8303;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</p>
<p>&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;OAuth 2.0&#x89C4;&#x8303;&#x4E2D;&#x7684;<a href="https://tools.ietf.org/html/rfc6749#section-4.4" target="_blank">Client Credentials Grant</a>&#x7AE0;&#x8282;&#x3002;</p>
<p><a name="188_____2_5_4__&#x91CD;&#x5B9A;&#x5411;URI"></a></p>
<h4 id="254-&#x91CD;&#x5B9A;&#x5411;uri"><a name="254-&#x91CD;&#x5B9A;&#x5411;uri" class="anchor-navigation-ex-anchor" href="#254-&#x91CD;&#x5B9A;&#x5411;uri"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.4. &#x91CD;&#x5B9A;&#x5411;URI</h4>
<p>&#x4F7F;&#x7528;&#x57FA;&#x4E8E;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x6D41;&#x65F6;&#xFF0C;&#x4E3A;&#x60A8;&#x7684;&#x5BA2;&#x6237;&#x4F7F;&#x7528;&#x6709;&#x6548;&#x7684;&#x91CD;&#x5B9A;&#x5411;uris&#x5F88;&#x91CD;&#x8981;&#x3002; &#x91CD;&#x5B9A;&#x5411;uris&#x5E94;&#x5C3D;&#x53EF;&#x80FD;&#x5177;&#x4F53;&#x3002; &#x8FD9;&#x5C24;&#x5176;&#x9002;&#x7528;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x516C;&#x5171;&#x5BA2;&#x6237;&#x7AEF;&#xFF09;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x5982;&#x679C;&#x4E0D;&#x8FD9;&#x6837;&#x505A;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#xFF1A;</p>
<ul>
<li>Open redirects - &#x8FD9;&#x53EF;&#x4EE5;&#x5141;&#x8BB8;&#x653B;&#x51FB;&#x8005;&#x521B;&#x5EFA;&#x770B;&#x4F3C;&#x4ED6;&#x4EEC;&#x6765;&#x81EA;&#x60A8;&#x7684;&#x57DF;&#x7684;&#x6B3A;&#x9A97;&#x94FE;&#x63A5;</li>
<li>Unauthorized entry - &#x5F53;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x4F7F;&#x7528;Keycloak&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65F6;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x516C;&#x5171;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5176;&#x4E2D;&#x672A;&#x6B63;&#x786E;&#x914D;&#x7F6E;&#x91CD;&#x5B9A;&#x5411;uris&#x4EE5;&#x901A;&#x8FC7;&#x91CD;&#x5B9A;&#x5411;&#x7528;&#x6237;&#x800C;&#x65E0;&#x9700;&#x7528;&#x6237;&#x77E5;&#x8BC6;&#x6765;&#x83B7;&#x53D6;&#x8BBF;&#x95EE;&#x6743;&#x9650;</li>
</ul>
<p>&#x5728;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x751F;&#x4EA7;&#x4E2D;&#xFF0C;&#x59CB;&#x7EC8;&#x5BF9;&#x6240;&#x6709;&#x91CD;&#x5B9A;&#x5411;URI&#x4F7F;&#x7528;<code>https</code>&#x3002; &#x4E0D;&#x5141;&#x8BB8;&#x91CD;&#x5B9A;&#x5411;&#x5230;http&#x3002;</p>
<p>&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x7684;&#x91CD;&#x5B9A;&#x5411;URI&#xFF1A;</p>
<ul>
<li><p><code>http://localhost</code></p>
<p>&#x6B64;&#x91CD;&#x5B9A;&#x5411;URI&#x5BF9;&#x672C;&#x673A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5F88;&#x6709;&#x7528;&#xFF0C;&#x5E76;&#x5141;&#x8BB8;&#x672C;&#x673A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x968F;&#x673A;&#x7AEF;&#x53E3;&#x4E0A;&#x521B;&#x5EFA;&#x53EF;&#x7528;&#x4E8E;&#x83B7;&#x53D6;&#x6388;&#x6743;&#x4EE3;&#x7801;&#x7684;Web&#x670D;&#x52A1;&#x5668;&#x3002; &#x8FD9;&#x4E2A;&#x91CD;&#x5B9A;&#x5411;uri&#x5141;&#x8BB8;&#x4EFB;&#x4F55;&#x7AEF;&#x53E3;&#x3002;</p>
</li>
<li><p><code>urn:ietf:wg:oauth:2.0:oob</code></p>
<p>&#x5982;&#x679C;&#x65E0;&#x6CD5;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x52A8;Web&#x670D;&#x52A1;&#x5668;&#xFF08;&#x6216;&#x6D4F;&#x89C8;&#x5668;&#x4E0D;&#x53EF;&#x7528;&#xFF09;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7279;&#x6B8A;&#x7684;<code>urn:ietf:wg:oauth:2.0:oob</code>&#x91CD;&#x5B9A;&#x5411;uri&#x3002; &#x4F7F;&#x7528;&#x6B64;&#x91CD;&#x5B9A;&#x5411;uri&#x65F6;&#xFF0C;Keycloak&#x4F1A;&#x663E;&#x793A;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x6807;&#x9898;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x548C;&#x9875;&#x9762;&#x4E0A;&#x7684;&#x6846;&#x3002; &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x68C0;&#x6D4B;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x6807;&#x9898;&#x5DF2;&#x66F4;&#x6539;&#xFF0C;&#x6216;&#x8005;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x5C06;&#x4EE3;&#x7801;&#x590D;&#x5236;/&#x7C98;&#x8D34;&#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x901A;&#x8FC7;&#x6B64;&#x91CD;&#x5B9A;&#x5411;uri&#xFF0C;&#x7528;&#x6237;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x8BBE;&#x5907;&#x6765;&#x83B7;&#x53D6;&#x8981;&#x7C98;&#x8D34;&#x56DE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
</li>
</ul>
<p><a name="189___3__SAML"></a></p>
<h2 id="3-saml"><a name="3-saml" class="anchor-navigation-ex-anchor" href="#3-saml"><i class="fa fa-link" aria-hidden="true"></i></a>3. SAML</h2>
<p>&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x4F7F;&#x7528;Keycloak&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x6216;&#x901A;&#x7528;SAML&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x5E93;&#x4F7F;&#x7528;SAML&#x4FDD;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x670D;&#x52A1;&#x3002;</p>
<p><a name="190____3_1__Java_&#x9002;&#x914D;&#x5668;"></a></p>
<h3 id="31-java-&#x9002;&#x914D;&#x5668;"><a name="31-java-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#31-java-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. Java &#x9002;&#x914D;&#x5668;</h3>
<p>Keycloak&#x4E3A;Java&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x4E0D;&#x540C;&#x7684;&#x9002;&#x914D;&#x5668;&#x3002; &#x9009;&#x62E9;&#x6B63;&#x786E;&#x7684;&#x9002;&#x914D;&#x5668;&#x53D6;&#x51B3;&#x4E8E;&#x76EE;&#x6807;&#x5E73;&#x53F0;&#x3002;</p>
<p><a name="191_____3_1_1__&#x901A;&#x7528;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;"></a></p>
<h4 id="311-&#x901A;&#x7528;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;"><a name="311-&#x901A;&#x7528;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#311-&#x901A;&#x7528;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.1. &#x901A;&#x7528;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;</h4>
<p>Keycloak&#x652F;&#x6301;&#x7684;&#x6BCF;&#x4E2A;SAML&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;XML&#x6587;&#x672C;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002; &#x8FD9;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">keycloak-saml-adapter</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:keycloak:saml:adapter&quot;</span>
                       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
                       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;urn:keycloak:saml:adapter https://www.keycloak.org/schema/keycloak_saml_adapter_1_10.xsd&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">SP</span> <span class="hljs-attr">entityID</span>=<span class="hljs-string">&quot;http://localhost:8081/sales-post-sig/&quot;</span>
        <span class="hljs-attr">sslPolicy</span>=<span class="hljs-string">&quot;EXTERNAL&quot;</span>
        <span class="hljs-attr">nameIDPolicyFormat</span>=<span class="hljs-string">&quot;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&quot;</span>
        <span class="hljs-attr">logoutPage</span>=<span class="hljs-string">&quot;/logout.jsp&quot;</span>
        <span class="hljs-attr">forceAuthentication</span>=<span class="hljs-string">&quot;false&quot;</span>
        <span class="hljs-attr">isPassive</span>=<span class="hljs-string">&quot;false&quot;</span>
        <span class="hljs-attr">turnOffChangeSessionIdOnLogin</span>=<span class="hljs-string">&quot;false&quot;</span>
        <span class="hljs-attr">autodetectBearerOnly</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Keys</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Key</span> <span class="hljs-attr">signing</span>=<span class="hljs-string">&quot;true&quot;</span> &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">KeyStore</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;/WEB-INF/keystore.jks&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;store123&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">PrivateKey</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;http://localhost:8080/sales-post-sig/&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;test123&quot;</span>/&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Certificate</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;http://localhost:8080/sales-post-sig/&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">KeyStore</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Key</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Keys</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">PrincipalNameMapping</span> <span class="hljs-attr">policy</span>=<span class="hljs-string">&quot;FROM_NAME_ID&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">RoleIdentifiers</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Role&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">RoleIdentifiers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">IDP</span> <span class="hljs-attr">entityID</span>=<span class="hljs-string">&quot;idp&quot;</span>
             <span class="hljs-attr">signaturesRequired</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">SingleSignOnService</span> <span class="hljs-attr">requestBinding</span>=<span class="hljs-string">&quot;POST&quot;</span>
                             <span class="hljs-attr">bindingUrl</span>=<span class="hljs-string">&quot;http://localhost:8081/auth/realms/demo/protocol/saml&quot;</span>
                    /&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">SingleLogoutService</span>
                    <span class="hljs-attr">requestBinding</span>=<span class="hljs-string">&quot;POST&quot;</span>
                    <span class="hljs-attr">responseBinding</span>=<span class="hljs-string">&quot;POST&quot;</span>
                    <span class="hljs-attr">postBindingUrl</span>=<span class="hljs-string">&quot;http://localhost:8081/auth/realms/demo/protocol/saml&quot;</span>
                    <span class="hljs-attr">redirectBindingUrl</span>=<span class="hljs-string">&quot;http://localhost:8081/auth/realms/demo/protocol/saml&quot;</span>
                    /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Keys</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Key</span> <span class="hljs-attr">signing</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">KeyStore</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;/WEB-INF/keystore.jks&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;store123&quot;</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Certificate</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;demo&quot;</span>/&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">KeyStore</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">Key</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Keys</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">IDP</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">SP</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">keycloak-saml-adapter</span>&gt;</span>
</code></pre>
<p>&#x5176;&#x4E2D;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#x5F00;&#x5173;&#x53EF;&#x80FD;&#x662F;&#x9002;&#x914D;&#x5668;&#x7279;&#x5B9A;&#x7684;&#xFF0C;&#x6709;&#x4E9B;&#x5728;&#x6240;&#x6709;&#x9002;&#x914D;&#x5668;&#x4E0A;&#x90FD;&#x662F;&#x901A;&#x7528;&#x7684;&#x3002; &#x5BF9;&#x4E8E;Java&#x9002;&#x914D;&#x5668;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>${&#x2026;}</code>enclosure&#x4F5C;&#x4E3A;System&#x5C5E;&#x6027;&#x66FF;&#x6362;&#x3002; &#x4F8B;&#x5982;<code>${jboss.server.config.dir}</code>&#x3002;</p>
<p><a name="192______SP&#x5143;&#x7D20;"></a></p>
<h5 id="sp&#x5143;&#x7D20;"><a name="sp&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#sp&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a>SP&#x5143;&#x7D20;</h5>
<p>&#x4EE5;&#x4E0B;&#x662F;SP&#x5143;&#x7D20;&#x5C5E;&#x6027;&#x7684;&#x8BF4;&#x660E;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SP</span> <span class="hljs-attr">entityID</span>=<span class="hljs-string">&quot;sp&quot;</span>
    <span class="hljs-attr">sslPolicy</span>=<span class="hljs-string">&quot;ssl&quot;</span>
    <span class="hljs-attr">nameIDPolicyFormat</span>=<span class="hljs-string">&quot;format&quot;</span>
    <span class="hljs-attr">forceAuthentication</span>=<span class="hljs-string">&quot;true&quot;</span>
    <span class="hljs-attr">isPassive</span>=<span class="hljs-string">&quot;false&quot;</span>
    <span class="hljs-attr">autodetectBearerOnly</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>
...
<span class="hljs-tag">&lt;/<span class="hljs-name">SP</span>&gt;</span>
</code></pre>
<ul>
<li><p>entityID</p>
<p>&#x8FD9;&#x662F;&#x6B64;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#x3002; IdP&#x9700;&#x8981;&#x6B64;&#x503C;&#x6765;&#x786E;&#x5B9A;&#x4E0E;&#x4E4B;&#x901A;&#x4FE1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>REQUIRED</em>&#x3002;</p>
</li>
<li><p>sslPolicy</p>
<p>&#x8FD9;&#x662F;&#x9002;&#x914D;&#x5668;&#x5C06;&#x5F3A;&#x5236;&#x6267;&#x884C;&#x7684;SSL&#x7B56;&#x7565;&#x3002; &#x6709;&#x6548;&#x503C;&#x4E3A;&#xFF1A;<code>ALL</code>&#xFF0C;<code>EXTERNAL</code>&#x548C;<code>NONE</code>&#x3002; &#x5BF9;&#x4E8E;<code>ALL</code>&#xFF0C;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x5FC5;&#x987B;&#x901A;&#x8FC7;HTTPS&#x8FDB;&#x5165;&#x3002; &#x5BF9;&#x4E8E;<code>EXTERNAL</code>&#xFF0C;&#x53EA;&#x6709;&#x975E;&#x79C1;&#x6709;IP&#x5730;&#x5740;&#x5FC5;&#x987B;&#x901A;&#x8FC7;HTTPS&#x8FDE;&#x63A5;&#x3002; &#x5BF9;&#x4E8E;<code>NONE</code>&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x901A;&#x8FC7;HTTPS&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>EXTERNAL</code>&#x3002;</p>
</li>
<li><p>nameIDPolicyFormat</p>
<p>SAML&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x8BF7;&#x6C42;&#x7279;&#x5B9A;&#x7684;NameID&#x4E3B;&#x9898;&#x683C;&#x5F0F;&#x3002; &#x5982;&#x679C;&#x9700;&#x8981;&#x7279;&#x5B9A;&#x683C;&#x5F0F;&#xFF0C;&#x8BF7;&#x586B;&#x5199;&#x6B64;&#x503C;&#x3002; &#x5B83;&#x5FC5;&#x987B;&#x662F;&#x6807;&#x51C6;&#x7684;SAML&#x683C;&#x5F0F;&#x6807;&#x8BC6;&#x7B26;&#xFF1A;<code>urn:oasis:names:tc:SAML:2.0:nameid-format:transient</code>&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0D;&#x8BF7;&#x6C42;&#x7279;&#x6B8A;&#x683C;&#x5F0F;&#x3002;</p>
</li>
<li><p>forceAuthentication</p>
<p>SAML&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x8BF7;&#x6C42;&#x7528;&#x6237;&#x91CD;&#x65B0;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5373;&#x4F7F;&#x4ED6;&#x4EEC;&#x5DF2;&#x7ECF;&#x5728;IdP&#x767B;&#x5F55;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#x3002; &#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;<code>true</code>&#x4EE5;&#x542F;&#x7528;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>false</code>&#x3002;</p>
</li>
<li><p>isPassive</p>
<p>SAML&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x8BF7;&#x6C42;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x8981;&#x6C42;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5373;&#x4F7F;&#x4ED6;&#x4EEC;&#x672A;&#x5728;IdP&#x767B;&#x5F55;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#x3002; &#x5982;&#x679C;&#x4F60;&#x60F3;&#x8981;&#x8FD9;&#x4E2A;&#xFF0C;&#x8BF7;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;<code>true</code>&#x3002; &#x4E0D;&#x8981;&#x4E0E;<code>forceAuthentication</code>&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x76F8;&#x53CD;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>false</code>&#x3002;</p>
</li>
<li><p>turnOffChangeSessionIdOnLogin</p>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x5E73;&#x53F0;&#x4E0A;&#x6210;&#x529F;&#x767B;&#x5F55;&#x65F6;&#x4F1A;&#x66F4;&#x6539;&#x4F1A;&#x8BDD;ID&#x4EE5;&#x63D2;&#x5165;&#x5B89;&#x5168;&#x653B;&#x51FB;&#x5A92;&#x4ECB;&#x3002; &#x5C06;&#x5176;&#x66F4;&#x6539;&#x4E3A;<code>true</code>&#x4EE5;&#x7981;&#x7528;&#x6B64;&#x529F;&#x80FD;&#x3002; &#x5EFA;&#x8BAE;&#x60A8;&#x4E0D;&#x8981;&#x5C06;&#x5176;&#x5173;&#x95ED;&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>false</code>&#x3002;</p>
</li>
<li><p>autodetectBearerOnly</p>
<p>&#x5982;&#x679C;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x540C;&#x65F6;&#x63D0;&#x4F9B;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;Web&#x670D;&#x52A1;&#xFF08;&#x4F8B;&#x5982;SOAP&#x6216;REST&#xFF09;&#xFF0C;&#x5219;&#x5E94;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;<em>true</em>&#x3002; &#x5B83;&#x5141;&#x8BB8;&#x60A8;&#x5C06;&#x672A;&#x7ECF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7528;&#x6237;&#x91CD;&#x5B9A;&#x5411;&#x5230;Keycloak&#x767B;&#x5F55;&#x9875;&#x9762;&#xFF0C;&#x4F46;&#x662F;&#x5C06;HTTP<code>401</code>&#x72B6;&#x6001;&#x4EE3;&#x7801;&#x53D1;&#x9001;&#x7ED9;&#x672A;&#x7ECF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;SOAP&#x6216;REST&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x65E0;&#x6CD5;&#x7406;&#x89E3;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x767B;&#x5F55;&#x9875;&#x9762;&#x3002; Keycloak&#x57FA;&#x4E8E;&#x5178;&#x578B;&#x7684;&#x6807;&#x9898;&#x81EA;&#x52A8;&#x68C0;&#x6D4B;SOAP&#x6216;REST&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5982;<code>X-Requested-With</code>&#xFF0C;<code>SOAPAction</code>&#x6216;<code>Accept</code>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<em>false</em>&#x3002;</p>
</li>
<li><p>logoutPage</p>
<p>&#x8FD9;&#x4F1A;&#x5C06;&#x9875;&#x9762;&#x8BBE;&#x7F6E;&#x4E3A;&#x5728;&#x6CE8;&#x9500;&#x540E;&#x663E;&#x793A;&#x3002; &#x5982;&#x679C;&#x9875;&#x9762;&#x662F;&#x5B8C;&#x6574;&#x7684;URL&#xFF0C;&#x4F8B;&#x5982;<code>http://web.example.com/logout.html</code>&#xFF0C;&#x5219;&#x5728;&#x4F7F;&#x7528;HTTP<code>302</code>&#x72B6;&#x6001;&#x4EE3;&#x7801;&#x6CE8;&#x9500;&#x5230;&#x8BE5;&#x9875;&#x9762;&#x540E;&#xFF0C;&#x5C06;&#x91CD;&#x5B9A;&#x5411;&#x7528;&#x6237;&#x3002; &#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E86;&#x6CA1;&#x6709;scheme&#x90E8;&#x5206;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x4F8B;&#x5982;<code>/ logout.jsp</code>&#xFF0C;&#x5219;&#x5728;&#x6CE8;&#x9500;&#x540E;&#x4F1A;&#x663E;&#x793A;&#x8BE5;&#x9875;&#x9762;&#xFF0C; <em>&#x6839;&#x636E;web.xml&#x4E2D;&#x7684;&#x5B89;&#x5168;&#x6027;&#x7EA6;&#x675F;&#x58F0;&#x660E;&#xFF0C;&#x5B83;&#x662F;&#x5426;&#x4F4D;&#x4E8E;&#x53D7;&#x4FDD;&#x62A4;&#x533A;&#x57DF;&#x4E2D;</em>&#xFF0C;&#x5E76;&#x4E14;&#x76F8;&#x5BF9;&#x4E8E;&#x90E8;&#x7F72;&#x4E0A;&#x4E0B;&#x6587;&#x6839;&#x89E3;&#x6790;&#x9875;&#x9762;&#x3002;</p>
</li>
</ul>
<p><a name="193______&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#x5BC6;&#x94A5;&#x548C;&#x5173;&#x952E;&#x5143;&#x7D20;"></a></p>
<h5 id="&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#x5BC6;&#x94A5;&#x548C;&#x5173;&#x952E;&#x5143;&#x7D20;"><a name="&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#x5BC6;&#x94A5;&#x548C;&#x5173;&#x952E;&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#x5BC6;&#x94A5;&#x548C;&#x5173;&#x952E;&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#x5BC6;&#x94A5;&#x548C;&#x5173;&#x952E;&#x5143;&#x7D20;</h5>
<p>&#x5982;&#x679C;IdP&#x8981;&#x6C42;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF08;&#x6216;SP&#xFF09;&#x7B7E;&#x7F72;&#x5176;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x548C;/&#x6216;IdP&#x5C06;&#x52A0;&#x5BC6;&#x65AD;&#x8A00;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x5B9A;&#x4E49;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C;&#x7684;&#x5BC6;&#x94A5;&#x3002; &#x5BF9;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x7B7E;&#x540D;&#x7684;&#x6587;&#x6863;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5B9A;&#x4E49;&#x7528;&#x4E8E;&#x7B7E;&#x7F72;&#x6587;&#x6863;&#x7684;&#x79C1;&#x94A5;&#x548C;&#x516C;&#x94A5;&#x6216;&#x8BC1;&#x4E66;&#x3002; &#x5BF9;&#x4E8E;&#x52A0;&#x5BC6;&#xFF0C;&#x60A8;&#x53EA;&#x9700;&#x5B9A;&#x4E49;&#x7528;&#x4E8E;&#x89E3;&#x5BC6;&#x5B83;&#x7684;&#x79C1;&#x94A5;&#x3002;</p>
<p>&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x63CF;&#x8FF0;&#x60A8;&#x7684;&#x5BC6;&#x94A5;&#x3002; &#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x5728;Java KeyStore&#x4E2D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;PEM&#x683C;&#x5F0F;&#x7684;<code>keycloak-saml.xml</code>&#x4E2D;&#x590D;&#x5236;/&#x7C98;&#x8D34;&#x5BC6;&#x94A5;&#x3002;</p>
<pre><code class="lang-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Keys</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Key</span> <span class="hljs-attr">signing</span>=<span class="hljs-string">&quot;true&quot;</span> &gt;</span>
               ...
            <span class="hljs-tag">&lt;/<span class="hljs-name">Key</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Keys</span>&gt;</span>
</code></pre>
<p><code>Key</code>&#x5143;&#x7D20;&#x6709;&#x4E24;&#x4E2A;&#x53EF;&#x9009;&#x5C5E;&#x6027;<code>signing</code>&#x548C;<code>encryption</code>&#x3002; &#x8BBE;&#x7F6E;&#x4E3A;true&#x65F6;&#xFF0C;&#x8FD9;&#x4E9B;&#x5C06;&#x544A;&#x8BC9;&#x9002;&#x914D;&#x5668;&#x5BC6;&#x94A5;&#x7684;&#x7528;&#x9014;&#x3002; &#x5982;&#x679C;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#x90FD;&#x8BBE;&#x7F6E;&#x4E3A;true&#xFF0C;&#x5219;&#x5BC6;&#x94A5;&#x5C06;&#x7528;&#x4E8E;&#x7B7E;&#x540D;&#x6587;&#x6863;&#x548C;&#x89E3;&#x5BC6;&#x52A0;&#x5BC6;&#x65AD;&#x8A00;&#x3002; &#x60A8;&#x5FC5;&#x987B;&#x5C06;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x4E2D;&#x7684;&#x81F3;&#x5C11;&#x4E00;&#x4E2A;&#x8BBE;&#x7F6E;&#x4E3A;true&#x3002;</p>
<p><a name="194_______KeyStore&#x5143;&#x7D20;"></a></p>
<h6 id="keystore&#x5143;&#x7D20;"><a name="keystore&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#keystore&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a>KeyStore&#x5143;&#x7D20;</h6>
<p>&#x5728;<code>Key</code>&#x5143;&#x7D20;&#x4E2D;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4ECE;Java Keystore&#x52A0;&#x8F7D;&#x5BC6;&#x94A5;&#x548C;&#x8BC1;&#x4E66;&#x3002; &#x8FD9;&#x662F;&#x5728;<code>KeyStore</code>&#x5143;&#x7D20;&#x4E2D;&#x58F0;&#x660E;&#x7684;&#x3002;</p>
<pre><code class="lang-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Keys</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Key</span> <span class="hljs-attr">signing</span>=<span class="hljs-string">&quot;true&quot;</span> &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">KeyStore</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;/WEB-INF/keystore.jks&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;store123&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">PrivateKey</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;myPrivate&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;test123&quot;</span>/&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Certificate</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;myCertAlias&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">KeyStore</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Key</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Keys</span>&gt;</span>
</code></pre>
<p>&#x4EE5;&#x4E0B;&#x662F;&#x4F7F;&#x7528;<code>KeyStore</code>&#x5143;&#x7D20;&#x5B9A;&#x4E49;&#x7684;XML&#x914D;&#x7F6E;&#x5C5E;&#x6027;&#x3002;</p>
<ul>
<li><p>file</p>
<p>&#x5BC6;&#x94A5;&#x5E93;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x3002; &#x6B64;&#x9009;&#x9879;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x6587;&#x4EF6;&#x6216;&#x8D44;&#x6E90;&#x5C5E;&#x6027;&#x3002;</p>
</li>
<li><p>resource</p>
<p>KeyStore&#x7684;WAR&#x8D44;&#x6E90;&#x8DEF;&#x5F84;&#x3002; &#x8FD9;&#x662F;&#x5BF9;ServletContext.getResourceAsStream()&#x7684;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x8DEF;&#x5F84;&#x3002; &#x6B64;&#x9009;&#x9879;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x6587;&#x4EF6;&#x6216;&#x8D44;&#x6E90;&#x5C5E;&#x6027;&#x3002;</p>
</li>
<li><p>password</p>
<p>KeyStore&#x7684;&#x5BC6;&#x7801;&#x3002; &#x6B64;&#x9009;&#x9879;&#x4E3A;<em>REQUIRED</em>&#x3002;</p>
</li>
</ul>
<p>&#x5982;&#x679C;&#x8981;&#x5B9A;&#x4E49;SP&#x5C06;&#x7528;&#x4E8E;&#x7B7E;&#x7F72;&#x6587;&#x6863;&#x7684;&#x5BC6;&#x94A5;&#xFF0C;&#x5219;&#x8FD8;&#x5FC5;&#x987B;&#x5728;Java KeyStore&#x4E2D;&#x6307;&#x5B9A;&#x5BF9;&#x79C1;&#x94A5;&#x548C;&#x8BC1;&#x4E66;&#x7684;&#x5F15;&#x7528;&#x3002; &#x4E0A;&#x4F8B;&#x4E2D;&#x7684;<code>PrivateKey</code>&#x548C;<code>Certificate</code>&#x5143;&#x7D20;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x6307;&#x5411;&#x5BC6;&#x94A5;&#x5E93;&#x4E2D;&#x7684;&#x5BC6;&#x94A5;&#x6216;&#x8BC1;&#x4E66;&#x7684;<code>alias</code>&#x3002; &#x5BC6;&#x94A5;&#x5E93;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x5BC6;&#x7801;&#x624D;&#x80FD;&#x8BBF;&#x95EE;&#x79C1;&#x94A5;&#x3002; &#x5728;<code>PrivateKey</code>&#x5143;&#x7D20;&#x4E2D;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;<code>password</code>&#x5C5E;&#x6027;&#x4E2D;&#x5B9A;&#x4E49;&#x6B64;&#x5BC6;&#x7801;&#x3002;</p>
<p><a name="195_______Key_PEMS"></a></p>
<h6 id="key-pems"><a name="key-pems" class="anchor-navigation-ex-anchor" href="#key-pems"><i class="fa fa-link" aria-hidden="true"></i></a>Key PEMS</h6>
<p>&#x5728;<code>Key</code>&#x5143;&#x7D20;&#x4E2D;&#xFF0C;&#x60A8;&#x4F7F;&#x7528;&#x5B50;&#x5143;&#x7D20;<code>PrivateKeyPem</code>&#xFF0C;<code>PublicKeyPem</code>&#x548C;<code>CertificatePem</code>&#x76F4;&#x63A5;&#x58F0;&#x660E;&#x60A8;&#x7684;&#x952E;&#x548C;&#x8BC1;&#x4E66;&#x3002; &#x8FD9;&#x4E9B;&#x5143;&#x7D20;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x503C;&#x5FC5;&#x987B;&#x7B26;&#x5408;PEM&#x5BC6;&#x94A5;&#x683C;&#x5F0F;&#x3002; &#x5982;&#x679C;&#x4F7F;&#x7528;<code>openssl</code>&#x6216;&#x7C7B;&#x4F3C;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#x751F;&#x6210;&#x5BC6;&#x94A5;&#xFF0C;&#x901A;&#x5E38;&#x4F7F;&#x7528;&#x6B64;&#x9009;&#x9879;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Keys</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">Key</span> <span class="hljs-attr">signing</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">PrivateKeyPem</span>&gt;</span>
         2341251234AB31234==231BB998311222423522334
      <span class="hljs-tag">&lt;/<span class="hljs-name">PrivateKeyPem</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CertificatePem</span>&gt;</span>
         211111341251234AB31234==231BB998311222423522334
      <span class="hljs-tag">&lt;/<span class="hljs-name">CertificatePem</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">Key</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Keys</span>&gt;</span>
</code></pre>
<p><a name="196______SP_PrincipalNameMapping_&#x5143;&#x7D20;"></a></p>
<h5 id="sp-principalnamemapping-&#x5143;&#x7D20;"><a name="sp-principalnamemapping-&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#sp-principalnamemapping-&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a>SP PrincipalNameMapping &#x5143;&#x7D20;</h5>
<p>&#x6B64;&#x5143;&#x7D20;&#x662F;&#x53EF;&#x9009;&#x7684;&#x3002; &#x5728;&#x521B;&#x5EFA;&#x4ECE;&#x8BF8;&#x5982;<code>HttpServletRequest.getUserPrincipal()</code>&#x4E4B;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#x83B7;&#x5F97;&#x7684;Java Principal&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;<code>Principal.getName()</code>&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7684;&#x540D;&#x79F0;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SP</span> <span class="hljs-attr">...</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">PrincipalNameMapping</span> <span class="hljs-attr">policy</span>=<span class="hljs-string">&quot;FROM_NAME_ID&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SP</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">SP</span> <span class="hljs-attr">...</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">PrincipalNameMapping</span> <span class="hljs-attr">policy</span>=<span class="hljs-string">&quot;FROM_ATTRIBUTE&quot;</span> <span class="hljs-attr">attribute</span>=<span class="hljs-string">&quot;email&quot;</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SP</span>&gt;</span>
</code></pre>
<p><code>policy</code>&#x5C5E;&#x6027;&#x5B9A;&#x4E49;&#x7528;&#x4E8E;&#x586B;&#x5145;&#x6B64;&#x503C;&#x7684;&#x7B56;&#x7565;&#x3002; &#x6B64;&#x5C5E;&#x6027;&#x7684;&#x53EF;&#x80FD;&#x503C;&#x4E3A;&#xFF1A;</p>
<ul>
<li><p>FROM_NAME_ID</p>
<p>&#x6B64;&#x7B56;&#x7565;&#x4EC5;&#x4F7F;&#x7528;SAML&#x4E3B;&#x9898;&#x503C;&#x3002; &#x8FD9;&#x662F;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;</p>
</li>
<li><p>FROM_ATTRIBUTE</p>
<p>&#x8FD9;&#x5C06;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x6536;&#x5230;&#x7684;SAML&#x65AD;&#x8A00;&#x4E2D;&#x58F0;&#x660E;&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x4E2D;&#x63D0;&#x53D6;&#x503C;&#x3002; &#x60A8;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x8981;&#x5728;<code>attribute</code> XML&#x5C5E;&#x6027;&#x4E2D;&#x4F7F;&#x7528;&#x7684;SAML&#x65AD;&#x8A00;&#x5C5E;&#x6027;&#x7684;&#x540D;&#x79F0;&#x3002;</p>
</li>
</ul>
<p><a name="197______RoleIdentifiers_&#x5143;&#x7D20;"></a></p>
<h5 id="roleidentifiers-&#x5143;&#x7D20;"><a name="roleidentifiers-&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#roleidentifiers-&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a>RoleIdentifiers &#x5143;&#x7D20;</h5>
<p><code>RoleIdentifiers</code>&#x5143;&#x7D20;&#x5B9A;&#x4E49;&#x4ECE;&#x7528;&#x6237;&#x63A5;&#x6536;&#x7684;&#x65AD;&#x8A00;&#x4E2D;&#x7684;SAML&#x5C5E;&#x6027;&#x5E94;&#x8BE5;&#x7528;&#x4F5C;&#x7528;&#x6237;&#x7684;Java EE&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x7684;&#x89D2;&#x8272;&#x6807;&#x8BC6;&#x7B26;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">RoleIdentifiers</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">Attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Role&quot;</span>/&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">Attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;member&quot;</span>/&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">Attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;memberOf&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">RoleIdentifiers</span>&gt;</span>
</code></pre>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<code>Role</code>&#x5C5E;&#x6027;&#x503C;&#x5C06;&#x8F6C;&#x6362;&#x4E3A;Java EE&#x89D2;&#x8272;&#x3002; &#x4E00;&#x4E9B;IdP&#x4F7F;&#x7528;<code>member</code>&#x6216;<code>memberOf</code>attribute&#x65AD;&#x8A00;&#x53D1;&#x9001;&#x89D2;&#x8272;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;<code>Attribute</code>&#x5143;&#x7D20;&#xFF0C;&#x4EE5;&#x6307;&#x5B9A;&#x5FC5;&#x987B;&#x5C06;&#x54EA;&#x4E9B;SAML&#x5C5E;&#x6027;&#x8F6C;&#x6362;&#x4E3A;&#x89D2;&#x8272;&#x3002;</p>
<p><a name="198______IDP_&#x5143;&#x7D20;"></a></p>
<h5 id="idp-&#x5143;&#x7D20;"><a name="idp-&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#idp-&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a>IDP &#x5143;&#x7D20;</h5>
<p>IDP&#x5143;&#x7D20;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5185;&#x5BB9;&#x90FD;&#x63CF;&#x8FF0;&#x4E86;SP&#x6B63;&#x5728;&#x4E0E;&#x4E4B;&#x901A;&#x4FE1;&#x7684;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#xFF08;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x670D;&#x52A1;&#x5668;&#xFF09;&#x7684;&#x8BBE;&#x7F6E;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">IDP</span> <span class="hljs-attr">entityID</span>=<span class="hljs-string">&quot;idp&quot;</span>
     <span class="hljs-attr">signaturesRequired</span>=<span class="hljs-string">&quot;true&quot;</span>
     <span class="hljs-attr">signatureAlgorithm</span>=<span class="hljs-string">&quot;RSA_SHA1&quot;</span>
     <span class="hljs-attr">signatureCanonicalizationMethod</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;</span>&gt;</span>
...
<span class="hljs-tag">&lt;/<span class="hljs-name">IDP</span>&gt;</span>
</code></pre>
<p>&#x4EE5;&#x4E0B;&#x662F;&#x60A8;&#x53EF;&#x4EE5;&#x5728;<code>IDP</code>&#x5143;&#x7D20;&#x58F0;&#x660E;&#x4E2D;&#x6307;&#x5B9A;&#x7684;&#x5C5E;&#x6027;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x3002;</p>
<ul>
<li><p>entityID</p>
<p>&#x8FD9;&#x662F;IDP&#x7684;&#x53D1;&#x884C;&#x8005;ID&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>REQUIRED</em>&#x3002;</p>
</li>
<li><p>signaturesRequired</p>
<p>&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A;<code>true</code>&#xFF0C;&#x5219;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x5C06;&#x5BF9;&#x5B83;&#x53D1;&#x9001;&#x7ED9;IDP&#x7684;&#x6BCF;&#x4E2A;&#x6587;&#x6863;&#x8FDB;&#x884C;&#x7B7E;&#x540D;&#x3002; &#x6B64;&#x5916;&#xFF0C;&#x5BA2;&#x6237;&#x5C06;&#x671F;&#x671B;IDP&#x5C06;&#x7B7E;&#x7F72;&#x53D1;&#x9001;&#x7ED9;&#x5B83;&#x7684;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#x3002; &#x6B64;&#x5F00;&#x5173;&#x8BBE;&#x7F6E;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x7C7B;&#x578B;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x4F46;&#x7A0D;&#x540E;&#x60A8;&#x5C06;&#x770B;&#x5230;&#x60A8;&#x5BF9;&#x6B64;&#x6709;&#x4E00;&#x4E9B;&#x7EC6;&#x7C92;&#x5EA6;&#x63A7;&#x5236;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;<code>false</code>&#x3002;</p>
</li>
<li><p>signatureAlgorithm</p>
<p>&#x8FD9;&#x662F;IDP&#x671F;&#x671B;&#x7B7E;&#x540D;&#x6587;&#x6863;&#x4F7F;&#x7528;&#x7684;&#x7B7E;&#x540D;&#x7B97;&#x6CD5;&#x3002; &#x5141;&#x8BB8;&#x7684;&#x503C;&#x4E3A;&#xFF1A;<code>RSA_SHA1</code>&#xFF0C;<code>RSA_SHA256</code>&#xFF0C;<code>RSA_SHA512</code>&#x548C;<code>DSA_SHA1</code>&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;<code>RSA_SHA256</code>&#x3002;</p>
</li>
<li><p>signatureCanonicalizationMethod</p>
<p>&#x8FD9;&#x662F;IDP&#x671F;&#x671B;&#x7B7E;&#x540D;&#x6587;&#x6863;&#x4F7F;&#x7528;&#x7684;&#x7B7E;&#x540D;&#x89C4;&#x8303;&#x5316;&#x65B9;&#x6CD5;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>http://www.w3.org/2001/10/xml-exc-c14n#</code>&#xFF0C;&#x5BF9;&#x5927;&#x591A;&#x6570;IPDs&#x5E94;&#x8BE5;&#x662F;&#x597D;&#x7684;&#x3002;</p>
</li>
<li><p>metadataUrl</p>
<p>&#x7528;&#x4E8E;&#x68C0;&#x7D22;IDP&#x5143;&#x6570;&#x636E;&#x7684;URL&#xFF0C;&#x76EE;&#x524D;&#x4EC5;&#x7528;&#x4E8E;&#x5B9A;&#x671F;&#x83B7;&#x53D6;&#x7B7E;&#x540D;&#x548C;&#x52A0;&#x5BC6;&#x5BC6;&#x94A5;&#xFF0C;&#x5141;&#x8BB8;&#x5728;IDP&#x4E0A;&#x5FAA;&#x73AF;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x5BC6;&#x94A5;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x5728;SP&#x7AEF;&#x624B;&#x52A8;&#x66F4;&#x6539;&#x3002;</p>
</li>
</ul>
<p><a name="199______IDP_SingleSignOnService_&#x5B50;&#x5143;&#x7D20;"></a></p>
<h5 id="idp-singlesignonservice-&#x5B50;&#x5143;&#x7D20;"><a name="idp-singlesignonservice-&#x5B50;&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#idp-singlesignonservice-&#x5B50;&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a>IDP SingleSignOnService &#x5B50;&#x5143;&#x7D20;</h5>
<p><code>SingleSignOnService</code>&#x5B50;&#x5143;&#x7D20;&#x5B9A;&#x4E49;IDP&#x7684;&#x767B;&#x5F55;SAML&#x7AEF;&#x70B9;&#x3002; &#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x8981;&#x767B;&#x5F55;&#x65F6;&#xFF0C;&#x5B83;&#x5C06;&#x901A;&#x8FC7;&#x6B64;&#x5143;&#x7D20;&#x4E2D;&#x7684;&#x8BBE;&#x7F6E;&#x5411;IDP&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SingleSignOnService</span> <span class="hljs-attr">signRequest</span>=<span class="hljs-string">&quot;true&quot;</span>
                     <span class="hljs-attr">validateResponseSignature</span>=<span class="hljs-string">&quot;true&quot;</span>
                     <span class="hljs-attr">requestBinding</span>=<span class="hljs-string">&quot;post&quot;</span>
                     <span class="hljs-attr">bindingUrl</span>=<span class="hljs-string">&quot;url&quot;</span>/&gt;</span>
</code></pre>
<p>&#x4EE5;&#x4E0B;&#x662F;&#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x6B64;&#x5143;&#x7D20;&#x4E0A;&#x5B9A;&#x4E49;&#x7684;&#x914D;&#x7F6E;&#x5C5E;&#x6027;&#xFF1A;</p>
<ul>
<li><p>signRequest</p>
<p>&#x5BA2;&#x6237;&#x5E94;&#x8BE5;&#x7B7E;&#x7F72;authn&#x8BF7;&#x6C42;&#x5417;&#xFF1F; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x4E3A;IDP<code>ignaturesRequired</code>&#x5143;&#x7D20;&#x503C;&#x3002;</p>
</li>
<li><p>validateResponseSignature</p>
<p>&#x5BA2;&#x6237;&#x662F;&#x5426;&#x5E0C;&#x671B;IDP&#x7B7E;&#x7F72;&#x4ECE;auhtn&#x8BF7;&#x6C42;&#x53D1;&#x56DE;&#x7684;&#x65AD;&#x8A00;&#x54CD;&#x5E94;&#x6587;&#x6863;&#xFF1F; &#x6B64;&#x8BBE;&#x7F6E;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x4E3A;IDP<code>validateResponseSignature</code>&#x5143;&#x7D20;&#x503C;&#x3002;</p>
</li>
<li><p>requestBinding</p>
<p>&#x8FD9;&#x662F;&#x7528;&#x4E8E;&#x4E0E;IDP&#x901A;&#x4FE1;&#x7684;SAML&#x7ED1;&#x5B9A;&#x7C7B;&#x578B;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>POST</code>&#xFF0C;&#x4F46;&#x60A8;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;<code>REDIRECT</code>&#x3002;</p>
</li>
<li><p>responseBinding</p>
<p>SAML&#x5141;&#x8BB8;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x5B83;&#x60F3;&#x8981;authn&#x54CD;&#x5E94;&#x4F7F;&#x7528;&#x7684;&#x7ED1;&#x5B9A;&#x7C7B;&#x578B;&#x3002; &#x8FD9;&#x4E2A;&#x503C;&#x53EF;&#x4EE5;&#x662F;<code>POST</code>&#x6216;<code>REDIRECT</code>&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4E0D;&#x4F1A;&#x4E3A;&#x54CD;&#x5E94;&#x8BF7;&#x6C42;&#x7279;&#x5B9A;&#x7684;&#x7ED1;&#x5B9A;&#x7C7B;&#x578B;&#x3002;</p>
</li>
<li><p>assertionConsumerServiceUrl</p>
<p>IDP&#x767B;&#x5F55;&#x670D;&#x52A1;&#x5E94;&#x5411;&#x5176;&#x53D1;&#x9001;&#x54CD;&#x5E94;&#x7684;&#x65AD;&#x8A00;&#x4F7F;&#x7528;&#x8005;&#x670D;&#x52A1;&#xFF08;ACS&#xFF09;&#x7684;URL&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x53D6;&#x6D88;&#x8BBE;&#x7F6E;&#xFF0C;&#x4F9D;&#x8D56;&#x4E8E;IdP&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x3002; &#x8BBE;&#x7F6E;&#x65F6;&#xFF0C;&#x5B83;&#x5FC5;&#x987B;&#x4EE5;<code>/saml</code>&#x7ED3;&#x5C3E;&#xFF0C;&#x4F8B;&#x5982;<code>http://sp.domain.com/my/endpoint/for/saml</code>&#x3002; &#x6B64;&#x5C5E;&#x6027;&#x7684;&#x503C;&#x5728;SAML<code>AuthnRequest</code>&#x6D88;&#x606F;&#x7684;<code>AssertionConsumerServiceURL</code>&#x5C5E;&#x6027;&#x4E2D;&#x53D1;&#x9001;&#x3002; &#x8BE5;&#x5C5E;&#x6027;&#x901A;&#x5E38;&#x4F34;&#x968F;&#x7740;<code>responseBinding</code>&#x5C5E;&#x6027;&#x3002;</p>
</li>
<li><p>bindingUrl</p>
<p>&#x8FD9;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x5230;&#x7684;IDP&#x767B;&#x5F55;&#x670D;&#x52A1;&#x7684;URL&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>REQUIRED</em>&#x3002;</p>
</li>
</ul>
<p><a name="200______IDP_SingleLogoutService_&#x5B50;&#x5143;&#x7D20;"></a></p>
<h5 id="idp-singlelogoutservice-&#x5B50;&#x5143;&#x7D20;"><a name="idp-singlelogoutservice-&#x5B50;&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#idp-singlelogoutservice-&#x5B50;&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a>IDP SingleLogoutService &#x5B50;&#x5143;&#x7D20;</h5>
<p><code>SingleLogoutService</code>&#x5B50;&#x5143;&#x7D20;&#x5B9A;&#x4E49;IDP&#x7684;&#x6CE8;&#x9500;SAML&#x7AEF;&#x70B9;&#x3002; &#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x8981;&#x6CE8;&#x9500;&#x65F6;&#xFF0C;&#x5B83;&#x5C06;&#x901A;&#x8FC7;&#x6B64;&#x5143;&#x7D20;&#x4E2D;&#x7684;&#x8BBE;&#x7F6E;&#x5411;IDP&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SingleLogoutService</span> <span class="hljs-attr">validateRequestSignature</span>=<span class="hljs-string">&quot;true&quot;</span>
                     <span class="hljs-attr">validateResponseSignature</span>=<span class="hljs-string">&quot;true&quot;</span>
                     <span class="hljs-attr">signRequest</span>=<span class="hljs-string">&quot;true&quot;</span>
                     <span class="hljs-attr">signResponse</span>=<span class="hljs-string">&quot;true&quot;</span>
                     <span class="hljs-attr">requestBinding</span>=<span class="hljs-string">&quot;redirect&quot;</span>
                     <span class="hljs-attr">responseBinding</span>=<span class="hljs-string">&quot;post&quot;</span>
                     <span class="hljs-attr">postBindingUrl</span>=<span class="hljs-string">&quot;posturl&quot;</span>
                     <span class="hljs-attr">redirectBindingUrl</span>=<span class="hljs-string">&quot;redirecturl&quot;</span>&gt;</span>
</code></pre>
<ul>
<li><p>signRequest</p>
<p>&#x5BA2;&#x6237;&#x5E94;&#x8BE5;&#x7B7E;&#x7F72;&#x6CE8;&#x9500;&#x8BF7;&#x6C42;&#x5417;&#xFF1F; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x4E3A;IDP<code>signaturesRequired</code>&#x5143;&#x7D20;&#x503C;&#x3002;</p>
</li>
<li><p>signResponse</p>
<p>&#x5982;&#x679C;&#x5BA2;&#x6237;&#x7AEF;&#x7B7E;&#x7F72;&#x6CE8;&#x9500;&#x54CD;&#x5E94;&#xFF0C;&#x5B83;&#x4F1A;&#x53D1;&#x9001;&#x7ED9;IDP&#x8BF7;&#x6C42;&#x5417;&#xFF1F; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x4E3A;IDP<code>signaturesRequired</code>&#x5143;&#x7D20;&#x503C;&#x3002;</p>
</li>
<li><p>validateRequestSignature</p>
<p>&#x5BA2;&#x6237;&#x662F;&#x5426;&#x5E94;&#x8BE5;&#x671F;&#x5F85;&#x6765;&#x81EA;IDP&#x7684;&#x7B7E;&#x540D;&#x9000;&#x51FA;&#x8BF7;&#x6C42;&#x6587;&#x4EF6;&#xFF1F; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x4E3A;IDP<code>signaturesRequired</code>&#x5143;&#x7D20;&#x503C;&#x3002;</p>
</li>
<li><p>validateResponseSignature</p>
<p>&#x5BA2;&#x6237;&#x662F;&#x5426;&#x5E94;&#x8BE5;&#x671F;&#x5F85;&#x6765;&#x81EA;IDP&#x7684;&#x7B7E;&#x540D;&#x6CE8;&#x9500;&#x54CD;&#x5E94;&#x6587;&#x6863;&#xFF1F; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x4E3A;IDP<code>signaturesRequired</code>&#x5143;&#x7D20;&#x503C;&#x3002;</p>
</li>
<li><p>requestBinding</p>
<p>&#x8FD9;&#x662F;&#x7528;&#x4E8E;&#x5C06;SAML&#x8BF7;&#x6C42;&#x4F20;&#x9012;&#x7ED9;IDP&#x7684;SAML&#x7ED1;&#x5B9A;&#x7C7B;&#x578B;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>POST</code>&#xFF0C;&#x4F46;&#x60A8;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;REDIRECT&#x3002;</p>
</li>
<li><p>responseBinding</p>
<p>&#x8FD9;&#x662F;&#x7528;&#x4E8E;&#x5C06;SAML&#x54CD;&#x5E94;&#x4F20;&#x9012;&#x7ED9;IDP&#x7684;SAML&#x7ED1;&#x5B9A;&#x7C7B;&#x578B;&#x3002; &#x8FD9;&#x4E2A;&#x503C;&#x53EF;&#x4EE5;&#x662F;<code>POST</code>&#x6216;<code>REDIRECT</code>&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>POST</code>&#xFF0C;&#x4F46;&#x60A8;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;<code>REDIRECT</code>&#x3002;</p>
</li>
<li><p>postBindingUrl</p>
<p>&#x8FD9;&#x662F;&#x4F7F;&#x7528;POST&#x7ED1;&#x5B9A;&#x65F6;IDP&#x6CE8;&#x9500;&#x670D;&#x52A1;&#x7684;URL&#x3002; &#x5982;&#x679C;&#x4F7F;&#x7528;<code>POST</code>&#x7ED1;&#x5B9A;&#xFF0C;&#x5219;&#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>REQUIRED</em>&#x3002;</p>
</li>
<li><p>redirectBindingUrl</p>
<p>&#x8FD9;&#x662F;&#x4F7F;&#x7528;REDIRECT&#x7ED1;&#x5B9A;&#x65F6;IDP&#x6CE8;&#x9500;&#x670D;&#x52A1;&#x7684;URL&#x3002; &#x5982;&#x679C;&#x4F7F;&#x7528;REDIRECT&#x7ED1;&#x5B9A;&#xFF0C;&#x6B64;&#x8BBE;&#x7F6E;&#x4E3A;<em>REQUIRED</em>&#x3002;</p>
</li>
</ul>
<p><a name="201______IDP_Keys_&#x5B50;&#x5143;&#x7D20;"></a></p>
<h5 id="idp-keys-&#x5B50;&#x5143;&#x7D20;"><a name="idp-keys-&#x5B50;&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#idp-keys-&#x5B50;&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a>IDP Keys &#x5B50;&#x5143;&#x7D20;</h5>
<p>IDP&#x7684;Keys&#x5B50;&#x5143;&#x7D20;&#x4EC5;&#x7528;&#x4E8E;&#x5B9A;&#x4E49;&#x7528;&#x4E8E;&#x9A8C;&#x8BC1;IDP&#x7B7E;&#x540D;&#x7684;&#x6587;&#x6863;&#x7684;&#x8BC1;&#x4E66;&#x6216;&#x516C;&#x94A5;&#x3002; &#x5B83;&#x7684;&#x5B9A;&#x4E49;&#x65B9;&#x5F0F;&#x4E0E;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_saml-sp-keys" target="_blank">SP&#x7684;Keys&#x5143;&#x7D20;</a>&#x76F8;&#x540C;&#x3002; &#x4F46;&#x540C;&#x6837;&#xFF0C;&#x60A8;&#x53EA;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x8BC1;&#x4E66;&#x6216;&#x516C;&#x94A5;&#x5F15;&#x7528;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5982;&#x679C;IDP&#x548C;SP&#x5206;&#x522B;&#x7531;Keycloak&#x670D;&#x52A1;&#x5668;&#x548C;&#x9002;&#x914D;&#x5668;&#x5B9E;&#x73B0;&#xFF0C;&#x5219;&#x65E0;&#x9700;&#x6307;&#x5B9A;&#x7528;&#x4E8E;&#x7B7E;&#x540D;&#x9A8C;&#x8BC1;&#x7684;&#x5BC6;&#x94A5;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;&#x4E0B;&#x6587;&#x3002;</p>
<p>&#x5982;&#x679C;SP&#x548C;IDP&#x90FD;&#x7531;Keycloak&#x5B9E;&#x73B0;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5C06;SP&#x914D;&#x7F6E;&#x4E3A;&#x81EA;&#x52A8;&#x4ECE;&#x5DF2;&#x53D1;&#x5E03;&#x7684;&#x8BC1;&#x4E66;&#x83B7;&#x53D6;IDP&#x7B7E;&#x540D;&#x9A8C;&#x8BC1;&#x7684;&#x516C;&#x94A5;&#x3002; &#x8FD9;&#x662F;&#x901A;&#x8FC7;&#x5220;&#x9664;Keys&#x5B50;&#x5143;&#x7D20;&#x4E2D;&#x7B7E;&#x540D;&#x9A8C;&#x8BC1;&#x5BC6;&#x94A5;&#x7684;&#x6240;&#x6709;&#x58F0;&#x660E;&#x6765;&#x5B8C;&#x6210;&#x7684;&#x3002; &#x5982;&#x679C;Keys&#x5B50;&#x5143;&#x7D20;&#x5C06;&#x4FDD;&#x6301;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x7701;&#x7565;&#x5B83;&#x3002; &#x7136;&#x540E;&#xFF0C;SP&#x4ECE;SAML&#x63CF;&#x8FF0;&#x7B26;&#x81EA;&#x52A8;&#x83B7;&#x53D6;&#x5BC6;&#x94A5;&#xFF0C;&#x5176;&#x4F4D;&#x7F6E;&#x6765;&#x81EA;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_sp-idp-singlesignonservice" target="_blank">IDP SingleSignOnService&#x5B50;&#x5143;&#x7D20;</a>&#x4E2D;&#x6307;&#x5B9A;&#x7684;SAML&#x7AEF;&#x70B9;URL&#x3002;&#x7528;&#x4E8E;SAML&#x63CF;&#x8FF0;&#x7B26;&#x68C0;&#x7D22;&#x7684;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BBE;&#x7F6E;&#x901A;&#x5E38;&#x4E0D;&#x9700;&#x8981;&#x989D;&#x5916;&#x914D;&#x7F6E;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_sp-idp-httpclient" target="_blank">IDP HttpClient&#x5B50;&#x5143;&#x7D20;</a>&#x4E2D;&#x914D;&#x7F6E;&#x3002;</p>
<p>&#x8FD8;&#x53EF;&#x4EE5;&#x4E3A;&#x7B7E;&#x540D;&#x9A8C;&#x8BC1;&#x6307;&#x5B9A;&#x591A;&#x4E2A;&#x5BC6;&#x94A5;&#x3002; &#x8FD9;&#x662F;&#x901A;&#x8FC7;&#x5728;Keys&#x5B50;&#x5143;&#x7D20;&#x4E2D;&#x58F0;&#x660E;<code>signed</code>&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x4E3A;<code>true</code>&#x7684;&#x591A;&#x4E2A;Key&#x5143;&#x7D20;&#x6765;&#x5B8C;&#x6210;&#x7684;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x65CB;&#x8F6C;IDP&#x7B7E;&#x540D;&#x5BC6;&#x94A5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x5F88;&#x6709;&#x7528;&#xFF1A;&#x901A;&#x5E38;&#x6709;&#x4E00;&#x4E2A;&#x8FC7;&#x6E21;&#x671F;&#xFF0C;&#x5F53;&#x65B0;&#x7684;SAML&#x534F;&#x8BAE;&#x6D88;&#x606F;&#x548C;&#x65AD;&#x8A00;&#x7528;&#x65B0;&#x5BC6;&#x94A5;&#x7B7E;&#x540D;&#x4F46;&#x4ECD;&#x5E94;&#x63A5;&#x53D7;&#x7531;&#x5148;&#x524D;&#x5BC6;&#x94A5;&#x7B7E;&#x540D;&#x7684;&#x90A3;&#x4E9B;&#x6D88;&#x606F;&#x548C;&#x65AD;&#x8A00;&#x3002;</p>
<p>&#x65E0;&#x6CD5;&#x5C06;Keycloak&#x914D;&#x7F6E;&#x4E3A;&#x81EA;&#x52A8;&#x83B7;&#x53D6;&#x7B7E;&#x540D;&#x9A8C;&#x8BC1;&#x5BC6;&#x94A5;&#x5E76;&#x5B9A;&#x4E49;&#x5176;&#x4ED6;&#x9759;&#x6001;&#x7B7E;&#x540D;&#x9A8C;&#x8BC1;&#x5BC6;&#x94A5;&#x3002;</p>
<pre><code class="lang-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">IDP</span> <span class="hljs-attr">entityID</span>=<span class="hljs-string">&quot;idp&quot;</span>&gt;</span>
            ...
            <span class="hljs-tag">&lt;<span class="hljs-name">Keys</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Key</span> <span class="hljs-attr">signing</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">KeyStore</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;/WEB-INF/keystore.jks&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;store123&quot;</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Certificate</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;demo&quot;</span>/&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">KeyStore</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">Key</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Keys</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">IDP</span>&gt;</span>
</code></pre>
<p><a name="202______IDP_HttpClient_&#x5B50;&#x5143;&#x7D20;"></a></p>
<h5 id="idp-httpclient-&#x5B50;&#x5143;&#x7D20;"><a name="idp-httpclient-&#x5B50;&#x5143;&#x7D20;" class="anchor-navigation-ex-anchor" href="#idp-httpclient-&#x5B50;&#x5143;&#x7D20;"><i class="fa fa-link" aria-hidden="true"></i></a>IDP HttpClient &#x5B50;&#x5143;&#x7D20;</h5>
<p><code>HttpClient</code>&#x53EF;&#x9009;&#x5B50;&#x5143;&#x7D20;&#x5B9A;&#x4E49;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x7528;&#x4E8E;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_sp-idp-keys-automatic" target="_blank">&#x542F;&#x7528;</a>&#x65F6;&#x901A;&#x8FC7;IDP&#x7684;SAML&#x63CF;&#x8FF0;&#x7B26;&#x81EA;&#x52A8;&#x83B7;&#x53D6;&#x5305;&#x542B;&#x7528;&#x4E8E;IDP&#x7B7E;&#x540D;&#x9A8C;&#x8BC1;&#x7684;&#x516C;&#x94A5;&#x7684;&#x8BC1;&#x4E66;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">HttpClient</span> <span class="hljs-attr">connectionPoolSize</span>=<span class="hljs-string">&quot;10&quot;</span>
            <span class="hljs-attr">disableTrustManager</span>=<span class="hljs-string">&quot;false&quot;</span>
            <span class="hljs-attr">allowAnyHostname</span>=<span class="hljs-string">&quot;false&quot;</span>
            <span class="hljs-attr">clientKeystore</span>=<span class="hljs-string">&quot;classpath:keystore.jks&quot;</span>
            <span class="hljs-attr">clientKeystorePassword</span>=<span class="hljs-string">&quot;pwd&quot;</span>
            <span class="hljs-attr">truststore</span>=<span class="hljs-string">&quot;classpath:truststore.jks&quot;</span>
            <span class="hljs-attr">truststorePassword</span>=<span class="hljs-string">&quot;pwd&quot;</span>
            <span class="hljs-attr">proxyUrl</span>=<span class="hljs-string">&quot;http://proxy/&quot;</span> /&gt;</span>
</code></pre>
<ul>
<li><p>connectionPoolSize</p>
<p>&#x9002;&#x914D;&#x5668;&#x5C06;&#x5BF9;Keycloak&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x5355;&#x72EC;&#x7684;HTTP&#x8C03;&#x7528;&#xFF0C;&#x4EE5;&#x5C06;&#x8BBF;&#x95EE;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x4E3A;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x6B64;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x5B9A;&#x4E49;&#x5E94;&#x8BE5;&#x5408;&#x5E76;&#x5230;Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x3002; &#x8FD9;&#x662F;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>10</code>&#x3002;</p>
</li>
<li><p>disableTrustManager</p>
<p>&#x5982;&#x679C;Keycloak&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;HTTPS&#x5E76;&#x4E14;&#x6B64;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x4E3A;<code>true</code>&#xFF0C;&#x5219;&#x4E0D;&#x5FC5;&#x6307;&#x5B9A;&#x4FE1;&#x4EFB;&#x5E93;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x4EC5;&#x5E94;&#x5728;&#x5F00;&#x53D1;&#x671F;&#x95F4;&#x4F7F;&#x7528;&#xFF0C;<strong>&#x6C38;&#x8FDC;</strong>&#x4E0D;&#x4F1A;&#x5728;&#x751F;&#x4EA7;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5C06;&#x7981;&#x7528;SSL&#x8BC1;&#x4E66;&#x7684;&#x9A8C;&#x8BC1;&#x3002; &#x8FD9;&#x662F;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>false</code>&#x3002;</p>
</li>
<li><p>allowAnyHostname</p>
<p>&#x5982;&#x679C;Keycloak&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;HTTPS&#x5E76;&#x4E14;&#x6B64;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x4E3A;<code>true</code>&#xFF0C;&#x5219;&#x901A;&#x8FC7;&#x4FE1;&#x4EFB;&#x5E93;&#x9A8C;&#x8BC1;Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;&#x8BC1;&#x4E66;&#xFF0C;&#x4F46;&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;&#x4E3B;&#x673A;&#x540D;&#x9A8C;&#x8BC1;&#x3002; &#x6B64;&#x8BBE;&#x7F6E;&#x5E94;&#x4EC5;&#x5728;&#x5F00;&#x53D1;&#x671F;&#x95F4;&#x4F7F;&#x7528;&#xFF0C;<strong>&#x6C38;&#x8FDC;</strong>&#x4E0D;&#x4F1A;&#x5728;&#x751F;&#x4EA7;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5C06;&#x90E8;&#x5206;&#x7981;&#x7528;SSL&#x8BC1;&#x4E66;&#x7684;&#x9A8C;&#x8BC1;&#x3002; &#x8FD9;&#x79CD;&#x8BBE;&#x7F6E;&#x5728;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#x4E2D;&#x53EF;&#x80FD;&#x5F88;&#x6709;&#x7528;&#x3002; &#x8FD9;&#x662F;<em>OPTIONAL</em>&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;<code>false</code>&#x3002;</p>
</li>
<li><p>truststore</p>
<p>&#x8BE5;&#x503C;&#x662F;&#x4FE1;&#x4EFB;&#x5E93;&#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x3002; &#x5982;&#x679C;&#x5728;&#x8DEF;&#x5F84;&#x524D;&#x52A0;&#x4E0A;<code>classpath:</code>&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x4ECE;&#x90E8;&#x7F72;&#x7684;&#x7C7B;&#x8DEF;&#x5F84;&#x4E2D;&#x83B7;&#x53D6;&#x4FE1;&#x4EFB;&#x5E93;&#x3002; &#x7528;&#x4E8E;&#x4E0E;Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;&#x4F20;&#x51FA;HTTPS&#x901A;&#x4FE1;&#x3002; &#x53D1;&#x51FA;HTTPS&#x8BF7;&#x6C42;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x9A8C;&#x8BC1;&#x4ED6;&#x4EEC;&#x6B63;&#x5728;&#x4E0E;&#x4E4B;&#x901A;&#x4FE1;&#x7684;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4E3B;&#x673A;&#x3002; &#x8FD9;&#x5C31;&#x662F;&#x59D4;&#x6258;&#x4EBA;&#x6240;&#x505A;&#x7684;&#x3002; &#x5BC6;&#x94A5;&#x5E93;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x53EF;&#x4FE1;&#x4E3B;&#x673A;&#x8BC1;&#x4E66;&#x6216;&#x8BC1;&#x4E66;&#x9881;&#x53D1;&#x673A;&#x6784;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x63D0;&#x53D6;Keycloak&#x670D;&#x52A1;&#x5668;&#x7684;SSL&#x5BC6;&#x94A5;&#x5E93;&#x7684;&#x516C;&#x5171;&#x8BC1;&#x4E66;&#x6765;&#x521B;&#x5EFA;&#x6B64;&#x4FE1;&#x4EFB;&#x5E93;&#x3002; &#x9664;&#x975E;<code>disableTrustManager</code>&#x4E3A;&apos;true`&#xFF0C;&#x5426;&#x5219;&#x8FD9;&#x662F;<em>REQUIRED</em>&#x3002;</p>
</li>
<li><p>truststorePassword</p>
<p>&#x4FE1;&#x4EFB;&#x5E93;&#x7684;&#x5BC6;&#x7801;&#x3002; &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;<code>truststore</code>&#x5E76;&#x4E14;&#x4FE1;&#x4EFB;&#x5E93;&#x9700;&#x8981;&#x5BC6;&#x7801;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x662F;<em>REQUIRED</em>&#x3002;</p>
</li>
<li><p>clientKeystore</p>
<p>&#x8FD9;&#x662F;&#x5BC6;&#x94A5;&#x5E93;&#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x3002; &#x5F53;&#x9002;&#x914D;&#x5668;&#x5411;Keycloak&#x670D;&#x52A1;&#x5668;&#x53D1;&#x51FA;HTTPS&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x6B64;&#x5BC6;&#x94A5;&#x5E93;&#x5305;&#x542B;&#x53CC;&#x5411;SSL&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8BC1;&#x4E66;&#x3002; &#x8FD9;&#x662F;<em>OPTIONAL</em>&#x3002;</p>
</li>
<li><p>clientKeystorePassword</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x5E93;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x7684;&#x5BC6;&#x7801;&#x3002; &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;<code>clientKeystore</code>&#xFF0C;&#x8FD9;&#x662F;<em>REQUIRED</em>&#x3002;</p>
</li>
<li><p>proxyUrl</p>
<p>&#x7528;&#x4E8E;HTTP&#x8FDE;&#x63A5;&#x7684;HTTP&#x4EE3;&#x7406;&#x7684;URL&#x3002; &#x8FD9;&#x662F;<em>OPTIONAL</em>&#x3002;</p>
</li>
</ul>
<p><a name="203_____3_1_2__JBoss_EAP_WildFly_&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="312-jboss-eapwildfly-&#x9002;&#x914D;&#x5668;"><a name="312-jboss-eapwildfly-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#312-jboss-eapwildfly-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.2. JBoss EAP/WildFly &#x9002;&#x914D;&#x5668;</h4>
<p>&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x5728;JBoss EAP&#x6216;WildFly&#x4E0A;&#x7684;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;Keycloak SAML&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x3002;</p>
<p>&#x7136;&#x540E;&#xFF0C;&#x5728;WAR&#x4E2D;&#x63D0;&#x4F9B;keycloak&#x914D;&#x7F6E;&#xFF0C;<code>/WEB-INF/keycloak-saml.xml</code>&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5728;web.xml&#x4E2D;&#x5C06;auth-method&#x66F4;&#x6539;&#x4E3A;KEYCLOAK-SAML&#x3002; &#x672C;&#x8282;&#x5C06;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x3002;</p>
<p><a name="204______&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"></a></p>
<h5 id="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><a name="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;</h5>
<p>&#x6BCF;&#x4E2A;&#x9002;&#x914D;&#x5668;&#x90FD;&#x662F;Keycloak&#x4E0B;&#x8F7D;&#x7AD9;&#x70B9;&#x4E0A;&#x7684;&#x5355;&#x72EC;&#x4E0B;&#x8F7D;&#x3002;</p>
<blockquote>
<p>&#x6211;&#x4EEC;&#x53EA;&#x6D4B;&#x8BD5;&#x548C;&#x7EF4;&#x62A4;&#x9002;&#x914D;&#x5668;&#xFF0C;&#x5E76;&#x5728;&#x53D1;&#x5E03;&#x65F6;&#x63D0;&#x4F9B;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684;WildFly&#x3002; &#x4E00;&#x65E6;&#x53D1;&#x5E03;&#x4E86;&#x65B0;&#x7248;&#x672C;&#x7684;WildFly&#xFF0C;&#x5F53;&#x524D;&#x7684;&#x9002;&#x914D;&#x5668;&#x5C06;&#x88AB;&#x5F03;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;WildFly&#x7248;&#x672C;&#x53D1;&#x5E03;&#x540E;&#x5C06;&#x5220;&#x9664;&#x5BF9;&#x5B83;&#x4EEC;&#x7684;&#x652F;&#x6301;&#x3002; &#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x5C06;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4ECE;WildFly&#x5207;&#x6362;&#x5230;JBoss EAP&#xFF0C;&#x56E0;&#x4E3A;JBoss EAP&#x9002;&#x914D;&#x5668;&#x7684;&#x652F;&#x6301;&#x65F6;&#x95F4;&#x66F4;&#x957F;&#x3002;</p>
</blockquote>
<p>&#x5728;WildFly 9&#x6216;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x6216;JBoss EAP 7&#x4E0A;&#x5B89;&#x88C5;&#xFF1A;</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$WILDFLY_HOME</span>
$ unzip keycloak-saml-wildfly-adapter-dist.zip
</code></pre>
<p>&#x5728;JBoss EAP 6.x&#x4E0A;&#x5B89;&#x88C5;&#xFF1A;</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$JBOSS_HOME</span>
$ unzip keycloak-saml-eap6-adapter-dist.zip
</code></pre>
<p>&#x8FD9;&#x4E9B;zip&#x6587;&#x4EF6;&#x5728;WildFly&#x6216;JBoss EAP&#x53D1;&#x884C;&#x7248;&#x4E2D;&#x521B;&#x5EFA;&#x7279;&#x5B9A;&#x4E8E;WildFly/JBoss EAP SAML&#x9002;&#x914D;&#x5668;&#x7684;&#x65B0;JBoss&#x6A21;&#x5757;&#x3002;</p>
<p>&#x6DFB;&#x52A0;&#x6A21;&#x5757;&#x540E;&#xFF0C;&#x5FC5;&#x987B;&#x5728;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7684;&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#x4E2D;&#x542F;&#x7528;Keycloak SAML&#x5B50;&#x7CFB;&#x7EDF;&#xFF1A;<code>domain.xml</code>&#x6216;<code>standalone.xml</code>&#x3002;</p>
<p>&#x6709;&#x4E00;&#x4E2A;CLI&#x811A;&#x672C;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x60A8;&#x4FEE;&#x6539;&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#x3002; &#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;&#x5E76;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x7684;bin&#x76EE;&#x5F55;&#x8FD0;&#x884C;&#x811A;&#x672C;&#xFF1A;</p>
<p>WildFly 11&#x6216;&#x66F4;&#x65B0;&#x7248;&#x672C;</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$JBOSS_HOME</span>
$ ./bin/jboss-cli.sh -c --file=bin/adapter-elytron-install-saml.cli
</code></pre>
<p>WildFly 10&#x6216;&#x66F4;&#x8001;&#x7248;&#x672C;</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$JBOSS_HOME</span>
$ /bin/boss-cli.sh -c --file=bin/adapter-install-saml.cli
</code></pre>
<blockquote>
<p>&#x53EF;&#x4EE5;&#x5728;WildFly 11&#x6216;&#x66F4;&#x65B0;&#x7248;&#x672C;&#x4E0A;&#x4F7F;&#x7528;&#x4F20;&#x7EDF;&#x7684;&#x975E;Elytron&#x9002;&#x914D;&#x5668;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x60A8;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x4E9B;&#x7248;&#x672C;&#x4E0A;&#x4F7F;&#x7528;<code>adapter-install-saml.cli</code>&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x8F83;&#x65B0;&#x7684;Elytron&#x9002;&#x914D;&#x5668;&#x3002;</p>
</blockquote>
<p>&#x8BE5;&#x811A;&#x672C;&#x5C06;&#x6DFB;&#x52A0;&#x6269;&#x5C55;&#xFF0C;&#x5B50;&#x7CFB;&#x7EDF;&#x548C;&#x53EF;&#x9009;&#x7684;&#x5B89;&#x5168;&#x57DF;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x8FF0;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">server</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:domain:1.4&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">extensions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">extension</span> <span class="hljs-attr">module</span>=<span class="hljs-string">&quot;org.keycloak.keycloak-saml-adapter-subsystem&quot;</span>/&gt;</span>
          ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">extensions</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">subsystem</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:domain:keycloak-saml:1.1&quot;</span>/&gt;</span>
         ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
</code></pre>
<p>&#x5F53;&#x60A8;&#x9700;&#x8981;&#x5728;&#x5B89;&#x5168;Web&#x5C42;&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;&#x4F20;&#x64AD;&#x5230;&#x60A8;&#x6B63;&#x5728;&#x8C03;&#x7528;&#x7684;EJB&#xFF08;&#x5176;&#x4ED6;EE&#x7EC4;&#x4EF6;&#xFF09;&#x65F6;&#xFF0C;<code>keycloak</code>&#x5B89;&#x5168;&#x57DF;&#x5E94;&#x8BE5;&#x4E0E;EJB&#x548C;&#x5176;&#x4ED6;&#x7EC4;&#x4EF6;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x3002; &#x5426;&#x5219;&#x6B64;&#x914D;&#x7F6E;&#x662F;&#x53EF;&#x9009;&#x7684;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">server</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:domain:1.4&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">subsystem</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:domain:security:1.2&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">security-domains</span>&gt;</span>
...
      <span class="hljs-tag">&lt;<span class="hljs-name">security-domain</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;keycloak&quot;</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">authentication</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">login-module</span> <span class="hljs-attr">code</span>=<span class="hljs-string">&quot;org.keycloak.adapters.jboss.KeycloakLoginModule&quot;</span>
                         <span class="hljs-attr">flag</span>=<span class="hljs-string">&quot;required&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">authentication</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">security-domain</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-domains</span>&gt;</span>
</code></pre>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x7684;WEB-INF/classes&#x76EE;&#x5F55;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;EJB&#x7684;JAX-RS&#x670D;&#x52A1;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x4F7F;&#x7528;<code>@SecurityDomain</code>&#x6CE8;&#x91CA;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x6CE8;&#x91CA;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">import</span> org.jboss.ejb3.annotation.SecurityDomain;
<span class="hljs-keyword">import</span> org.jboss.resteasy.annotations.cache.NoCache;

<span class="hljs-keyword">import</span> javax.annotation.security.RolesAllowed;
<span class="hljs-keyword">import</span> javax.ejb.EJB;
<span class="hljs-keyword">import</span> javax.ejb.Stateless;
<span class="hljs-keyword">import</span> javax.ws.rs.GET;
<span class="hljs-keyword">import</span> javax.ws.rs.Path;
<span class="hljs-keyword">import</span> javax.ws.rs.Produces;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Path</span>(<span class="hljs-string">&quot;customers&quot;</span>)
<span class="hljs-meta">@Stateless</span>
<span class="hljs-meta">@SecurityDomain</span>(<span class="hljs-string">&quot;keycloak&quot;</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerService</span> </span>{

    <span class="hljs-meta">@EJB</span>
    CustomerDB db;

    <span class="hljs-meta">@GET</span>
    <span class="hljs-meta">@Produces</span>(<span class="hljs-string">&quot;application/json&quot;</span>)
    <span class="hljs-meta">@NoCache</span>
    <span class="hljs-meta">@RolesAllowed</span>(<span class="hljs-string">&quot;db_user&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getCustomers</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> db.getCustomers();
    }
}
</code></pre>
<p>&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5C06;&#x6765;&#x6539;&#x8FDB;&#x6211;&#x4EEC;&#x7684;&#x96C6;&#x6210;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x60A8;&#x5E0C;&#x671B;&#x5C06;keycloak&#x5B89;&#x5168;&#x4E0A;&#x4E0B;&#x6587;&#x4F20;&#x64AD;&#x5230;EJB&#x5C42;&#x65F6;&#x4E0D;&#x5FC5;&#x6307;&#x5B9A;<code>@SecurityDomain</code>&#x6CE8;&#x91CA;&#x3002;</p>
<p><a name="205______JBoss_SSO"></a></p>
<h5 id="jboss-sso"><a name="jboss-sso" class="anchor-navigation-ex-anchor" href="#jboss-sso"><i class="fa fa-link" aria-hidden="true"></i></a>JBoss SSO</h5>
<p>WildFly&#x5185;&#x7F6E;&#x652F;&#x6301;&#x90E8;&#x7F72;&#x5230;&#x540C;&#x4E00;WildFly&#x5B9E;&#x4F8B;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5355;&#x70B9;&#x767B;&#x5F55;&#x3002; &#x4F7F;&#x7528;Keycloak&#x65F6;&#x4E0D;&#x5E94;&#x542F;&#x7528;&#x6B64;&#x529F;&#x80FD;&#x3002;</p>
<p><a name="206_____3_1_3__&#x4ECE;RPM&#x5B89;&#x88C5;JBoss_EAP&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="313-&#x4ECE;rpm&#x5B89;&#x88C5;jboss-eap&#x9002;&#x914D;&#x5668;"><a name="313-&#x4ECE;rpm&#x5B89;&#x88C5;jboss-eap&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#313-&#x4ECE;rpm&#x5B89;&#x88C5;jboss-eap&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.3. &#x4ECE;RPM&#x5B89;&#x88C5;JBoss EAP&#x9002;&#x914D;&#x5668;</h4>
<p>&#x4ECE;RPM&#x5B89;&#x88C5;EAP 7&#x9002;&#x914D;&#x5668;&#xFF1A;</p>
<blockquote>
<p>&#x5728;Red Hat Enterprise Linux 7&#x4E2D;&#xFF0C;&#x672F;&#x8BED;channel&#x88AB;&#x66FF;&#x6362;&#x4E3A;&#x672F;&#x8BED;&#x5E93;&#x3002; &#x5728;&#x8FD9;&#x4E9B;&#x8BF4;&#x660E;&#x4E2D;&#xFF0C;&#x4EC5;&#x4F7F;&#x7528;&#x672F;&#x8BED;&#x5E93;&#x3002;</p>
</blockquote>
<p>&#x60A8;&#x5FC5;&#x987B;&#x5148;&#x8BA2;&#x9605;JBoss EAP 7&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x80FD;&#x4ECE;RPM&#x5B89;&#x88C5;EAP 7&#x9002;&#x914D;&#x5668;&#x3002;</p>
<p>&#x5148;&#x51B3;&#x6761;&#x4EF6;</p>
<ol>
<li>&#x786E;&#x4FDD;&#x60A8;&#x7684;Red Hat Enterprise Linux&#x7CFB;&#x7EDF;&#x5DF2;&#x4F7F;&#x7528;Red Hat Subscription Manager&#x6CE8;&#x518C;&#x5230;&#x60A8;&#x7684;&#x5E10;&#x6237;&#x3002; &#x6709;&#x5173;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://access.redhat.com/documentation/en-us/red_hat_subscription_management/1/html-single/quick_registration_for_rhel/index" target="_blank">Red Hat&#x8BA2;&#x9605;&#x7BA1;&#x7406;&#x6587;&#x6863;</a>&#x3002;</li>
<li>&#x5982;&#x679C;&#x60A8;&#x5DF2;&#x7ECF;&#x8BA2;&#x9605;&#x4E86;&#x53E6;&#x4E00;&#x4E2A;JBoss EAP&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x5148;&#x53D6;&#x6D88;&#x8BA2;&#x9605;&#x8BE5;&#x5B58;&#x50A8;&#x5E93;&#x3002;</li>
</ol>
<p>&#x4F7F;&#x7528;Red Hat Subscription Manager&#xFF0C;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x8BA2;&#x9605;JBoss EAP 7&#x5B58;&#x50A8;&#x5E93;&#x3002; &#x5C06;<rhel_version>&#x66FF;&#x6362;&#x4E3A;6&#x6216;7&#xFF0C;&#x5177;&#x4F53;&#x53D6;&#x51B3;&#x4E8E;&#x60A8;&#x7684;Red Hat Enterprise Linux&#x7248;&#x672C;&#x3002;</rhel_version></p>
<pre><code class="lang-bash">$ sudo subscription-manager repos --enable=jb-eap-7-for-rhel-&lt;RHEL_VERSION&gt;-server-rpms
</code></pre>
<p>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x4E3A;SAML&#x5B89;&#x88C5;EAP 7&#x9002;&#x914D;&#x5668;&#xFF1A;</p>
<pre><code class="lang-bash">$ sudo yum install eap7-keycloak-saml-adapter-sso7_2
</code></pre>
<blockquote>
<p>RPM&#x5B89;&#x88C5;&#x7684;&#x9ED8;&#x8BA4;EAP_HOME&#x8DEF;&#x5F84;&#x662F;<code>/opt/rh/eap7/root/usr/share/wildfly</code>&#x3002; </p>
</blockquote>
<p>&#x8FD0;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x6A21;&#x5757;&#x5B89;&#x88C5;&#x811A;&#x672C;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;SAML&#x6A21;&#x5757;&#xFF0C;&#x8BF7;&#x8F93;&#x5165;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code class="lang-bash">$ <span class="hljs-variable">$EAP_HOME</span>/bin/jboss-cli.sh -c --file=<span class="hljs-variable">$EAP_HOME</span>/bin/adapter-install-saml.cli
</code></pre>
<p>&#x60A8;&#x7684;&#x5B89;&#x88C5;&#x5DF2;&#x5B8C;&#x6210;&#x3002;</p>
<p>&#x4ECE;RPM&#x5B89;&#x88C5;EAP 6&#x9002;&#x914D;&#x5668;&#xFF1A;</p>
<blockquote>
<p>&#x5728;Red Hat Enterprise Linux 7&#x4E2D;&#xFF0C;&#x672F;&#x8BED;channel&#x88AB;&#x66FF;&#x6362;&#x4E3A;&#x672F;&#x8BED;&#x5E93;&#x3002; &#x5728;&#x8FD9;&#x4E9B;&#x8BF4;&#x660E;&#x4E2D;&#xFF0C;&#x4EC5;&#x4F7F;&#x7528;&#x672F;&#x8BED;&#x5E93;&#x3002;</p>
</blockquote>
<p>&#x60A8;&#x5FC5;&#x987B;&#x5148;&#x8BA2;&#x9605;JBoss EAP 6&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x80FD;&#x4ECE;RPM&#x5B89;&#x88C5;EAP 6&#x9002;&#x914D;&#x5668;&#x3002;</p>
<p>&#x5148;&#x51B3;&#x6761;&#x4EF6;</p>
<ol>
<li>&#x786E;&#x4FDD;&#x60A8;&#x7684;Red Hat Enterprise Linux&#x7CFB;&#x7EDF;&#x5DF2;&#x4F7F;&#x7528;Red Hat Subscription Manager&#x6CE8;&#x518C;&#x5230;&#x60A8;&#x7684;&#x5E10;&#x6237;&#x3002; &#x6709;&#x5173;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://access.redhat.com/documentation/en-us/red_hat_subscription_management/1/html-single/quick_registration_for_rhel/index" target="_blank">Red Hat&#x8BA2;&#x9605;&#x7BA1;&#x7406;&#x6587;&#x6863;</a>&#x3002;</li>
<li>&#x5982;&#x679C;&#x60A8;&#x5DF2;&#x7ECF;&#x8BA2;&#x9605;&#x4E86;&#x53E6;&#x4E00;&#x4E2A;JBoss EAP&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x5148;&#x53D6;&#x6D88;&#x8BA2;&#x9605;&#x8BE5;&#x5B58;&#x50A8;&#x5E93;&#x3002;</li>
</ol>
<p>&#x4F7F;&#x7528;Red Hat Subscription Manager&#xFF0C;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x8BA2;&#x9605;JBoss EAP 6&#x5B58;&#x50A8;&#x5E93;&#x3002; &#x5C06;<rhel_version>&#x66FF;&#x6362;&#x4E3A;6&#x6216;7&#xFF0C;&#x5177;&#x4F53;&#x53D6;&#x51B3;&#x4E8E;&#x60A8;&#x7684;Red Hat Enterprise Linux&#x7248;&#x672C;&#x3002;</rhel_version></p>
<pre><code class="lang-bash">$ sudo subscription-manager repos --enable=jb-eap-6-for-rhel-&lt;RHEL_VERSION&gt;-server-rpms
</code></pre>
<p>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x4E3A;SAML&#x5B89;&#x88C5;EAP 6&#x9002;&#x914D;&#x5668;&#xFF1A;</p>
<pre><code class="lang-bash">$ sudo yum install keycloak-saml-adapter-sso7_2-eap6
</code></pre>
<blockquote>
<p>RPM&#x5B89;&#x88C5;&#x7684;&#x9ED8;&#x8BA4;EAP_HOME&#x8DEF;&#x5F84;&#x662F;<code>/opt/rh/eap6/root/usr/share/wildfly</code>&#x3002; 
&#x8FD0;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x6A21;&#x5757;&#x5B89;&#x88C5;&#x811A;&#x672C;&#x3002;</p>
</blockquote>
<p>&#x5BF9;&#x4E8E;SAML&#x6A21;&#x5757;&#xFF0C;&#x8BF7;&#x8F93;&#x5165;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code class="lang-bash">$ <span class="hljs-variable">$EAP_HOME</span>/bin/jboss-cli.sh -c --file=<span class="hljs-variable">$EAP_HOME</span>/bin/adapter-install-saml.cli
</code></pre>
<p>&#x60A8;&#x7684;&#x5B89;&#x88C5;&#x5DF2;&#x5B8C;&#x6210;&#x3002;</p>
<p><a name="207______&#x6BCF;&#x4E2A;WAR&#x914D;&#x7F6E;"></a></p>
<h5 id="&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;"><a name="&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x6BCF;&#x4E2A;war&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6BCF;&#x4E2A;WAR&#x914D;&#x7F6E;</h5>
<p>&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x5728;WAR&#x5305;&#x4E2D;&#x6DFB;&#x52A0;&#x914D;&#x7F6E;&#x548C;&#x7F16;&#x8F91;&#x6587;&#x4EF6;&#x6765;&#x76F4;&#x63A5;&#x4FDD;&#x62A4;WAR&#x3002;</p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x505A;&#x7684;&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x662F;&#x5728;WAR&#x7684;<code>WEB-INF</code>&#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>keycloak-saml.xml</code>&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002; &#x8BE5;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_saml-general-config" target="_blank">General Adapter Config</a>&#x90E8;&#x5206;&#x4E2D;&#x63CF;&#x8FF0;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;<code>web.xml</code>&#x4E2D;&#x5C06;<code>auth-method</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>KEYCLOAK-SAML</code>&#x3002; &#x60A8;&#x8FD8;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x6807;&#x51C6;servlet&#x5B89;&#x5168;&#x6027;&#x6765;&#x6307;&#x5B9A;URL&#x4E0A;&#x7684;&#x89D2;&#x8272;&#x57FA;&#x7840;&#x7EA6;&#x675F;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;<em>web.xml</em>&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
      <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
      <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">module-name</span>&gt;</span>customer-portal<span class="hljs-tag">&lt;/<span class="hljs-name">module-name</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-collection</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-name</span>&gt;</span>Admins<span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/admin/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-collection</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">auth-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">user-data-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transport-guarantee</span>&gt;</span>CONFIDENTIAL<span class="hljs-tag">&lt;/<span class="hljs-name">transport-guarantee</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">user-data-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">security-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-collection</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-name</span>&gt;</span>Customers<span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/customers/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-collection</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">auth-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">user-data-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transport-guarantee</span>&gt;</span>CONFIDENTIAL<span class="hljs-tag">&lt;/<span class="hljs-name">transport-guarantee</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">user-data-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-constraint</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">login-config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-method</span>&gt;</span>KEYCLOAK-SAML<span class="hljs-tag">&lt;/<span class="hljs-name">auth-method</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">realm-name</span>&gt;</span>this is ignored currently<span class="hljs-tag">&lt;/<span class="hljs-name">realm-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">login-config</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
<p>&#x9664;&#x4E86;<code>auth-method</code>&#x8BBE;&#x7F6E;&#x4E4B;&#x5916;&#x7684;&#x6240;&#x6709;&#x6807;&#x51C6;servlet&#x8BBE;&#x7F6E;&#x3002;</p>
<p><a name="208______&#x901A;&#x8FC7;Keycloak_SAML&#x5B50;&#x7CFB;&#x7EDF;&#x4FDD;&#x62A4;WAR"></a></p>
<h5 id="&#x901A;&#x8FC7;keycloak-saml&#x5B50;&#x7CFB;&#x7EDF;&#x4FDD;&#x62A4;war"><a name="&#x901A;&#x8FC7;keycloak-saml&#x5B50;&#x7CFB;&#x7EDF;&#x4FDD;&#x62A4;war" class="anchor-navigation-ex-anchor" href="#&#x901A;&#x8FC7;keycloak-saml&#x5B50;&#x7CFB;&#x7EDF;&#x4FDD;&#x62A4;war"><i class="fa fa-link" aria-hidden="true"></i></a>&#x901A;&#x8FC7;Keycloak SAML&#x5B50;&#x7CFB;&#x7EDF;&#x4FDD;&#x62A4;WAR</h5>
<p>&#x60A8;&#x4E0D;&#x5FC5;&#x7834;&#x89E3;&#x6253;&#x5F00;WAR&#x4EE5;&#x4F7F;&#x7528;Keycloak&#x4FDD;&#x62A4;&#x5B83;&#x3002; &#x6216;&#x8005;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Keycloak SAML&#x9002;&#x914D;&#x5668;&#x5B50;&#x7CFB;&#x7EDF;&#x4ECE;&#x5916;&#x90E8;&#x4FDD;&#x62A4;&#x5B83;&#x3002; &#x867D;&#x7136;&#x60A8;&#x4E0D;&#x5FC5;&#x5C06;KEYCLOAK-SAML&#x6307;&#x5B9A;&#x4E3A;<code>auth-method</code>&#xFF0C;&#x4F46;&#x4ECD;&#x9700;&#x8981;&#x5728;<code>web.xml</code>&#x4E2D;&#x5B9A;&#x4E49;<code>security-constraints</code>&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x60A8;&#x4E0D;&#x5FC5;&#x521B;&#x5EFA;<code>WEB-INF/keycloak-saml.xml</code>&#x6587;&#x4EF6;&#x3002; &#x800C;&#x662F;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7684;<code>domain.xml</code>&#x6216;<code>standalone.xml</code>&#x5B50;&#x7CFB;&#x7EDF;&#x914D;&#x7F6E;&#x90E8;&#x5206;&#x7684;XML&#x4E2D;&#x5B9A;&#x4E49;&#x6B64;&#x5143;&#x6570;&#x636E;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">extensions</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">extension</span> <span class="hljs-attr">module</span>=<span class="hljs-string">&quot;org.keycloak.keycloak-saml-adapter-subsystem&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">extensions</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">subsystem</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:domain:keycloak-saml:1.1&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">secure-deployment</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;WAR MODULE NAME.war&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">SP</span> <span class="hljs-attr">entityID</span>=<span class="hljs-string">&quot;APPLICATION URL&quot;</span>&gt;</span>
        ...
      <span class="hljs-tag">&lt;/<span class="hljs-name">SP</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">secure-deployment</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">subsystem</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
</code></pre>
<p><code>secure-deployment``name</code>&#x5C5E;&#x6027;&#x6807;&#x8BC6;&#x8981;&#x4FDD;&#x62A4;&#x7684;WAR&#x3002; &#x5B83;&#x7684;&#x503C;&#x662F;<code>web.xml</code>&#x4E2D;&#x5B9A;&#x4E49;&#x7684;<code>module-name</code>&#xFF0C;&#x9644;&#x52A0;&#x4E86;<code>.war</code>&#x3002; &#x5176;&#x4F59;&#x914D;&#x7F6E;&#x4F7F;&#x7528;&#x4E0E;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_saml-general-config" target="_blank">General Adapter Config</a>&#x4E2D;&#x5B9A;&#x4E49;&#x7684;<code>keycloak-saml.xml</code>&#x914D;&#x7F6E;&#x76F8;&#x540C;&#x7684;XML&#x8BED;&#x6CD5;&#x3002;</p>
<p>&#x914D;&#x7F6E;&#x793A;&#x4F8B;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">subsystem</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:domain:keycloak-saml:1.1&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">secure-deployment</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;saml-post-encryption.war&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">SP</span> <span class="hljs-attr">entityID</span>=<span class="hljs-string">&quot;http://localhost:8080/sales-post-enc/&quot;</span>
        <span class="hljs-attr">sslPolicy</span>=<span class="hljs-string">&quot;EXTERNAL&quot;</span>
        <span class="hljs-attr">nameIDPolicyFormat</span>=<span class="hljs-string">&quot;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&quot;</span>
        <span class="hljs-attr">logoutPage</span>=<span class="hljs-string">&quot;/logout.jsp&quot;</span>
        <span class="hljs-attr">forceAuthentication</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Keys</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Key</span> <span class="hljs-attr">signing</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">encryption</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">KeyStore</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;/WEB-INF/keystore.jks&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;store123&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">PrivateKey</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;http://localhost:8080/sales-post-enc/&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;test123&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Certificate</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;http://localhost:8080/sales-post-enc/&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">KeyStore</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Key</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Keys</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">PrincipalNameMapping</span> <span class="hljs-attr">policy</span>=<span class="hljs-string">&quot;FROM_NAME_ID&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">RoleIdentifiers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Role&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">RoleIdentifiers</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">IDP</span> <span class="hljs-attr">entityID</span>=<span class="hljs-string">&quot;idp&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">SingleSignOnService</span> <span class="hljs-attr">signRequest</span>=<span class="hljs-string">&quot;true&quot;</span>
            <span class="hljs-attr">validateResponseSignature</span>=<span class="hljs-string">&quot;true&quot;</span>
            <span class="hljs-attr">requestBinding</span>=<span class="hljs-string">&quot;POST&quot;</span>
            <span class="hljs-attr">bindingUrl</span>=<span class="hljs-string">&quot;http://localhost:8080/auth/realms/saml-demo/protocol/saml&quot;</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">SingleLogoutService</span>
            <span class="hljs-attr">validateRequestSignature</span>=<span class="hljs-string">&quot;true&quot;</span>
            <span class="hljs-attr">validateResponseSignature</span>=<span class="hljs-string">&quot;true&quot;</span>
            <span class="hljs-attr">signRequest</span>=<span class="hljs-string">&quot;true&quot;</span>
            <span class="hljs-attr">signResponse</span>=<span class="hljs-string">&quot;true&quot;</span>
            <span class="hljs-attr">requestBinding</span>=<span class="hljs-string">&quot;POST&quot;</span>
            <span class="hljs-attr">responseBinding</span>=<span class="hljs-string">&quot;POST&quot;</span>
            <span class="hljs-attr">postBindingUrl</span>=<span class="hljs-string">&quot;http://localhost:8080/auth/realms/saml-demo/protocol/saml&quot;</span>
            <span class="hljs-attr">redirectBindingUrl</span>=<span class="hljs-string">&quot;http://localhost:8080/auth/realms/saml-demo/protocol/saml&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Keys</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Key</span> <span class="hljs-attr">signing</span>=<span class="hljs-string">&quot;true&quot;</span> &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">KeyStore</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;/WEB-INF/keystore.jks&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;store123&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Certificate</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;saml-demo&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">KeyStore</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Key</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Keys</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">IDP</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">SP</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">secure-deployment</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">subsystem</span>&gt;</span>
</code></pre>
<p><a name="209_____3_1_4__Tomcat_SAML_&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="314-tomcat-saml-&#x9002;&#x914D;&#x5668;"><a name="314-tomcat-saml-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#314-tomcat-saml-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.4. Tomcat SAML &#x9002;&#x914D;&#x5668;</h4>
<p>&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x5728;Tomcat 6,7&#x548C;8&#x4E0A;&#x7684;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5C06;Keycloak Tomcat 6,7&#x6216;8 SAML&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;&#x5230;Tomcat&#x5B89;&#x88C5;&#x4E2D;&#x3002; &#x7136;&#x540E;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;&#x90E8;&#x7F72;&#x5230;Tomcat&#x7684;&#x6BCF;&#x4E2A;WAR&#x4E2D;&#x63D0;&#x4F9B;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x914D;&#x7F6E;&#x3002; &#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x3002;</p>
<p><a name="210______&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"></a></p>
<h5 id="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><a name="&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;</h5>
<p>&#x9002;&#x914D;&#x5668;&#x4E0D;&#x518D;&#x5305;&#x542B;&#x5728;&#x8BBE;&#x5907;&#x6216;war&#x5206;&#x53D1;&#x7248;&#x4E2D;&#x3002;&#x6BCF;&#x4E2A;&#x9002;&#x914D;&#x5668;&#x5728;Keycloak&#x4E0B;&#x8F7D;&#x7AD9;&#x70B9;&#x4E0A;&#x90FD;&#x662F;&#x5355;&#x72EC;&#x7684;&#x4E0B;&#x8F7D;&#x3002;&#x5B83;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;maven&#x6784;&#x4EF6;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x5C06;&#x9002;&#x914D;&#x5668;&#x53D1;&#x884C;&#x7248;&#x89E3;&#x538B;&#x7F29;&#x5230;Tomcat&#x7684;<code>lib/</code>&#x76EE;&#x5F55;&#x4E2D;&#x3002; &#x5728;WEB-INF/lib&#x76EE;&#x5F55;&#x4E2D;&#x5305;&#x542B;&#x9002;&#x914D;&#x5668;&#x7684;jar&#x5C06;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF01; Keycloak SAML&#x9002;&#x914D;&#x5668;&#x5B9E;&#x73B0;&#x4E3A;Valve&#xFF0C;Valve&#x4EE3;&#x7801;&#x5FC5;&#x987B;&#x9A7B;&#x7559;&#x5728;Tomcat&#x7684;&#x4E3B;lib/&#x76EE;&#x5F55;&#x4E2D;&#x3002;</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$TOMCAT_HOME</span>/lib
$ unzip keycloak-saml-tomcat6-adapter-dist.zip
    or
$ unzip keycloak-saml-tomcat7-adapter-dist.zip
    or
$ unzip keycloak-saml-tomcat8-adapter-dist.zip
</code></pre>
<p><a name="211______&#x6BCF;&#x4E2A;_WAR_&#x914D;&#x7F6E;"></a></p>
<h5 id="&#x6BCF;&#x4E2A;-war-&#x914D;&#x7F6E;"><a name="&#x6BCF;&#x4E2A;-war-&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x6BCF;&#x4E2A;-war-&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6BCF;&#x4E2A; WAR &#x914D;&#x7F6E;</h5>
<p>&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x5728;WAR&#x5305;&#x4E2D;&#x6DFB;&#x52A0;&#x914D;&#x7F6E;&#x548C;&#x7F16;&#x8F91;&#x6587;&#x4EF6;&#x6765;&#x76F4;&#x63A5;&#x4FDD;&#x62A4;WAR&#x3002;</p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x505A;&#x7684;&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x662F;&#x5728;WAR&#x5305;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>META-INF/context.xml</code>&#x6587;&#x4EF6;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x4E8E;Tomcat&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;Keycloak&#x7279;&#x5B9A;&#x7684;Valve&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Context</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/your-context-path&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Valve</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;org.keycloak.adapters.saml.tomcat.SamlAuthenticatorValve&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Context</span>&gt;</span>
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;WAR&#x7684;<code>WEB-INF</code>&#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>keycloak-saml.xml</code>&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002; &#x8BE5;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_saml-general-config" target="_blank">General Adapter Config</a> &#x90E8;&#x5206;&#x4E2D;&#x63CF;&#x8FF0;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x540C;&#x65F6;&#x6307;&#x5B9A;<code>login-config</code>&#x5E76;&#x4F7F;&#x7528;&#x6807;&#x51C6;servlet&#x5B89;&#x5168;&#x6027;&#x6765;&#x6307;&#x5B9A;URL&#x4E0A;&#x7684;&#x89D2;&#x8272;&#x57FA;&#x7840;&#x7EA6;&#x675F;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
      <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
      <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">module-name</span>&gt;</span>customer-portal<span class="hljs-tag">&lt;/<span class="hljs-name">module-name</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-collection</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-name</span>&gt;</span>Customers<span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-collection</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">auth-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-constraint</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">login-config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-method</span>&gt;</span>BASIC<span class="hljs-tag">&lt;/<span class="hljs-name">auth-method</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">realm-name</span>&gt;</span>this is ignored currently<span class="hljs-tag">&lt;/<span class="hljs-name">realm-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">login-config</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
<p><a name="212_____3_1_5__Jetty_SAML_&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="315-jetty-saml-&#x9002;&#x914D;&#x5668;"><a name="315-jetty-saml-&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#315-jetty-saml-&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.5. Jetty SAML &#x9002;&#x914D;&#x5668;</h4>
<p>&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x4FDD;&#x62A4;&#x90E8;&#x7F72;&#x5728;Jetty&#x4E0A;&#x7684;WAR&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5C06;Keycloak Jetty 9.x SAML&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;&#x5230;Jetty&#x5B89;&#x88C5;&#x4E2D;&#x3002; &#x7136;&#x540E;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;&#x90E8;&#x7F72;&#x5230;Jetty&#x7684;&#x6BCF;&#x4E2A;WAR&#x4E2D;&#x63D0;&#x4F9B;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x914D;&#x7F6E;&#x3002; &#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x3002;</p>
<p><a name="213______Jetty_9_&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"></a></p>
<h5 id="jetty-9-&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><a name="jetty-9-&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#jetty-9-&#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>Jetty 9 &#x9002;&#x914D;&#x5668;&#x5B89;&#x88C5;</h5>
<p>Keycloak&#x4E3A;Jetty 9.x&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;SAML&#x9002;&#x914D;&#x5668;&#x3002; &#x7136;&#x540E;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;&#x90E8;&#x7F72;&#x5230;Jetty&#x7684;&#x6BCF;&#x4E2A;WAR&#x4E2D;&#x63D0;&#x4F9B;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x914D;&#x7F6E;&#x3002; &#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x3002;</p>
<p>&#x9002;&#x914D;&#x5668;&#x4E0D;&#x518D;&#x5305;&#x542B;&#x5728;&#x8BBE;&#x5907;&#x6216;war&#x5206;&#x53D1;&#x7248;&#x4E2D;&#x3002;&#x6BCF;&#x4E2A;&#x9002;&#x914D;&#x5668;&#x5728;Keycloak&#x4E0B;&#x8F7D;&#x7AD9;&#x70B9;&#x4E0A;&#x90FD;&#x662F;&#x5355;&#x72EC;&#x7684;&#x4E0B;&#x8F7D;&#x3002;&#x5B83;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;maven&#x6784;&#x4EF6;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x5C06;Jetty 9.x&#x53D1;&#x884C;&#x7248;&#x89E3;&#x538B;&#x7F29;&#x5230;Jetty 9.x&#x7684;&#x6839;&#x76EE;&#x5F55;&#x4E2D;&#x3002; &#x5728;WEB-INF/lib&#x76EE;&#x5F55;&#x4E2D;&#x5305;&#x542B;&#x9002;&#x914D;&#x5668;&#x7684;jar&#x5C06;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF01;</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$JETTY_HOME</span>
$ unzip keycloak-saml-jetty92-adapter-dist.zip
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x4E3A;jetty.base&#x542F;&#x7528;keycloak&#x6A21;&#x5757;&#x3002;</p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> your-base
$ java -jar <span class="hljs-variable">$JETTY_HOME</span>/start.jar --add-to-startd=keycloak
</code></pre>
<p><a name="214______Jetty_9_&#x6BCF;&#x4E2A;_WAR_&#x914D;&#x7F6E;"></a></p>
<h5 id="jetty-9-&#x6BCF;&#x4E2A;-war-&#x914D;&#x7F6E;"><a name="jetty-9-&#x6BCF;&#x4E2A;-war-&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#jetty-9-&#x6BCF;&#x4E2A;-war-&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>Jetty 9 &#x6BCF;&#x4E2A; WAR &#x914D;&#x7F6E;</h5>
<p>&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x5728;WAR&#x5305;&#x4E2D;&#x6DFB;&#x52A0;&#x914D;&#x7F6E;&#x548C;&#x7F16;&#x8F91;&#x6587;&#x4EF6;&#x6765;&#x76F4;&#x63A5;&#x4FDD;&#x62A4;WAR&#x3002;</p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x505A;&#x7684;&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x662F;&#x5728;WAR&#x5305;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>WEB-INF/jetty-web.xml</code>&#x6587;&#x4EF6;&#x3002; &#x8FD9;&#x662F;Jetty&#x7279;&#x5B9A;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;&#x5176;&#x4E2D;&#x5B9A;&#x4E49;Keycloak&#x7279;&#x5B9A;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5668;&#x3002;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE Configure PUBLIC &quot;-//Mort Bay Consulting//DTD Configure//EN&quot; &quot;http://www.eclipse.org/jetty/configure_9_0.dtd&quot;&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Configure</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.eclipse.jetty.webapp.WebAppContext&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Get</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;securityHandler&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Set</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authenticator&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">New</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.keycloak.adapters.saml.jetty.KeycloakSamlAuthenticator&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">New</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Set</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Get</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Configure</span>&gt;</span>
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x5728;WAR&#x7684;<code>WEB-INF</code>&#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>keycloak-saml.xml</code>&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002; &#x8BE5;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_saml-general-config" target="_blank">General Adapter Config</a> &#x90E8;&#x5206;&#x4E2D;&#x63CF;&#x8FF0;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x540C;&#x65F6;&#x6307;&#x5B9A;<code>login-config</code>&#x5E76;&#x4F7F;&#x7528;&#x6807;&#x51C6;servlet&#x5B89;&#x5168;&#x6027;&#x6765;&#x6307;&#x5B9A;URL&#x4E0A;&#x7684;&#x89D2;&#x8272;&#x57FA;&#x7840;&#x7EA6;&#x675F;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
      <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
      <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">module-name</span>&gt;</span>customer-portal<span class="hljs-tag">&lt;/<span class="hljs-name">module-name</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-collection</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">web-resource-name</span>&gt;</span>Customers<span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">web-resource-collection</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">auth-constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">user-data-constraint</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transport-guarantee</span>&gt;</span>CONFIDENTIAL<span class="hljs-tag">&lt;/<span class="hljs-name">transport-guarantee</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">user-data-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-constraint</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">login-config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">auth-method</span>&gt;</span>BASIC<span class="hljs-tag">&lt;/<span class="hljs-name">auth-method</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">realm-name</span>&gt;</span>this is ignored currently<span class="hljs-tag">&lt;/<span class="hljs-name">realm-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">login-config</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">security-role</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">role-name</span>&gt;</span>user<span class="hljs-tag">&lt;/<span class="hljs-name">role-name</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">security-role</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
<p><a name="215_____3_1_6__Java_Servlet_&#x8FC7;&#x6EE4;&#x5668;&#x9002;&#x914D;&#x5668;"></a></p>
<h4 id="316-java-servlet-&#x8FC7;&#x6EE4;&#x5668;&#x9002;&#x914D;&#x5668;"><a name="316-java-servlet-&#x8FC7;&#x6EE4;&#x5668;&#x9002;&#x914D;&#x5668;" class="anchor-navigation-ex-anchor" href="#316-java-servlet-&#x8FC7;&#x6EE4;&#x5668;&#x9002;&#x914D;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.6. Java Servlet &#x8FC7;&#x6EE4;&#x5668;&#x9002;&#x914D;&#x5668;</h4>
<p>&#x5982;&#x679C;&#x8981;&#x5C06;SAML&#x4E0E;&#x4E0D;&#x5177;&#x6709;&#x8BE5;servlet&#x5E73;&#x53F0;&#x9002;&#x914D;&#x5668;&#x7684;Java servlet&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x4F7F;&#x7528;Keycloak&#x5177;&#x6709;&#x7684;servlet&#x8FC7;&#x6EE4;&#x5668;&#x9002;&#x914D;&#x5668;&#x3002; &#x6B64;&#x9002;&#x914D;&#x5668;&#x4E0E;&#x5176;&#x4ED6;&#x9002;&#x914D;&#x5668;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x7565;&#x6709;&#x4E0D;&#x540C;&#x3002; &#x60A8;&#x4ECD;&#x7136;&#x5FC5;&#x987B;&#x6307;&#x5B9A;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_saml-general-config" target="_blank">General Adapter Config</a>&#x4E2D;&#x5B9A;&#x4E49;&#x7684;<code>/WEB-INF/keycloak-saml.xml</code>&#x6587;&#x4EF6;&#x90E8;&#x5206;&#xFF0C;&#x4F46;&#x662F;&#x60A8;&#x6CA1;&#x6709;&#x5728;<em>web.xml</em>&#x4E2D;&#x5B9A;&#x4E49;&#x5B89;&#x5168;&#x6027;&#x7EA6;&#x675F;&#x3002; &#x800C;&#x662F;&#x4F7F;&#x7528;Keycloak servlet&#x8FC7;&#x6EE4;&#x5668;&#x9002;&#x914D;&#x5668;&#x5B9A;&#x4E49;&#x8FC7;&#x6EE4;&#x5668;&#x6620;&#x5C04;&#xFF0C;&#x4EE5;&#x4FDD;&#x62A4;&#x8981;&#x4FDD;&#x62A4;&#x7684;URL&#x6A21;&#x5F0F;&#x3002;</p>
<blockquote>
<p>Backchannel&#x6CE8;&#x9500;&#x4E0E;&#x6807;&#x51C6;&#x9002;&#x914D;&#x5668;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x7565;&#x6709;&#x4E0D;&#x540C;&#x3002; &#x800C;&#x4E0D;&#x662F;&#x4F7F;http&#x4F1A;&#x8BDD;&#x65E0;&#x6548;&#xFF0C;&#x800C;&#x662F;&#x5C06;&#x4F1A;&#x8BDD;ID&#x6807;&#x8BB0;&#x4E3A;&#x5DF2;&#x6CE8;&#x9500;&#x3002; &#x6839;&#x636E;&#x4F1A;&#x8BDD;ID&#xFF0C;&#x65E0;&#x6CD5;&#x4EFB;&#x610F;&#x4F7F;http&#x4F1A;&#x8BDD;&#x65E0;&#x6548;&#x3002;</p>
<p>&#x5F53;&#x60A8;&#x62E5;&#x6709;&#x4F7F;&#x7528;SAML&#x7B5B;&#x9009;&#x5668;&#x7684;&#x7FA4;&#x96C6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;Backchannel&#x6CE8;&#x9500;&#x5F53;&#x524D;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#x3002;</p>
</blockquote>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
      <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
      <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.0&quot;</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">module-name</span>&gt;</span>customer-portal<span class="hljs-tag">&lt;/<span class="hljs-name">module-name</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>Keycloak Filter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.keycloak.adapters.saml.servlet.SamlFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>Keycloak Filter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
<p>Keycloak&#x8FC7;&#x6EE4;&#x5668;&#x5177;&#x6709;&#x4E0E;&#x5176;&#x4ED6;&#x9002;&#x914D;&#x5668;&#x76F8;&#x540C;&#x7684;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF0C;&#x9664;&#x975E;&#x60A8;&#x5FC5;&#x987B;&#x5C06;&#x5B83;&#x4EEC;&#x5B9A;&#x4E49;&#x4E3A;&#x8FC7;&#x6EE4;&#x5668;init&#x53C2;&#x6570;&#x800C;&#x4E0D;&#x662F;&#x4E0A;&#x4E0B;&#x6587;&#x53C2;&#x6570;&#x3002;</p>
<p>&#x5982;&#x679C;&#x60A8;&#x6709;&#x5404;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x5B89;&#x5168;&#x548C;&#x4E0D;&#x5B89;&#x5168;&#x7684;URL&#x6A21;&#x5F0F;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x591A;&#x4E2A;&#x8FC7;&#x6EE4;&#x5668;&#x6620;&#x5C04;&#x3002;</p>
<blockquote>
<p>&#x60A8;&#x5FC5;&#x987B;&#x6709;&#x4E00;&#x4E2A;&#x8986;&#x76D6;<code>/saml</code>&#x7684;&#x8FC7;&#x6EE4;&#x5668;&#x6620;&#x5C04;&#x3002; &#x6B64;&#x6620;&#x5C04;&#x6DB5;&#x76D6;&#x6240;&#x6709;&#x670D;&#x52A1;&#x5668;&#x56DE;&#x8C03;&#x3002;</p>
</blockquote>
<p>&#x5F53;&#x5411;IdP&#x6CE8;&#x518C;SPs&#x65F6;&#xFF0C;&#x5FC5;&#x987B;&#x5C06;<code>http[s]://&#x4E3B;&#x673A;&#x540D;/{context-root}/saml</code>&#x6CE8;&#x518C;&#x4E3A;&#x65AD;&#x8A00;&#x6D88;&#x8D39;&#x8005;&#x670D;&#x52A1;URL&#x548C;&#x5355;&#x4E2A;&#x6CE8;&#x9500;&#x670D;&#x52A1;URL&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;&#x6B64;&#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x8BF7;&#x5728;WAR poms&#x4E2D;&#x5305;&#x542B;&#x6B64;maven&#x5DE5;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.keycloak<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>keycloak-saml-servlet-filter-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>&#x4E3A;&#x4E86;&#x4F7F;&#x7528;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_saml_multi_tenancy" target="_blank">Multi Tenancy</a>&#xFF0C;&#x5E94;&#x5C06;<code>keycloak.config.resolver</code>&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x8FC7;&#x6EE4;&#x5668;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x3002;</p>
<pre><code class="lang-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>Keycloak Filter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.keycloak.adapters.saml.servlet.SamlFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>keycloak.config.resolver<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>example.SamlMultiTenantResolver<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>
</code></pre>
<p><a name="216_____3_1_7__&#x6CE8;&#x518C;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;"></a></p>
<h4 id="317-&#x6CE8;&#x518C;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;"><a name="317-&#x6CE8;&#x518C;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;" class="anchor-navigation-ex-anchor" href="#317-&#x6CE8;&#x518C;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.7. &#x6CE8;&#x518C;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;</h4>
<p>&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x57FA;&#x4E8E;servlet&#x7684;&#x9002;&#x914D;&#x5668;&#xFF0C;&#x60A8;&#x6CE8;&#x518C;&#x65AD;&#x8A00;&#x4F7F;&#x7528;&#x8005;&#x670D;&#x52A1;URL&#x548C;&#x5355;&#x4E2A;&#x6CE8;&#x9500;&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x70B9;&#x5FC5;&#x987B;&#x662F;&#x9644;&#x52A0;&#x4E86;<code>/saml</code>&#x7684;servlet&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x57FA;&#x672C;URL&#xFF0C;&#x5373;<code>https://example.com/contextPath/saml</code>&#x3002;</p>
<p><a name="217_____3_1_8__&#x6CE8;&#x9500;"></a></p>
<h4 id="318-&#x6CE8;&#x9500;"><a name="318-&#x6CE8;&#x9500;" class="anchor-navigation-ex-anchor" href="#318-&#x6CE8;&#x9500;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.8. &#x6CE8;&#x9500;</h4>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x591A;&#x79CD;&#x65B9;&#x5F0F;&#x4ECE;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6CE8;&#x9500;&#x3002; &#x5BF9;&#x4E8E;Java EE servlet&#x5BB9;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x8C03;&#x7528;<code>HttpServletRequest.logout()</code>&#x3002; &#x5BF9;&#x4E8E;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x6D4F;&#x89C8;&#x5668;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x6D4F;&#x89C8;&#x5668;&#x6307;&#x5411;&#x5177;&#x6709;&#x5B89;&#x5168;&#x7EA6;&#x675F;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4EFB;&#x4F55;URL&#xFF0C;&#x5E76;&#x4F20;&#x5165;&#x67E5;&#x8BE2;&#x53C2;&#x6570;GLO&#xFF0C;&#x5373;<code>http://myapp?GLO=true</code>&#x3002; &#x5982;&#x679C;&#x60A8;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x6709;SSO&#x4F1A;&#x8BDD;&#xFF0C;&#x8FD9;&#x5C06;&#x9000;&#x51FA;&#x3002;</p>
<p><a name="218______&#x5728;&#x7FA4;&#x96C6;&#x73AF;&#x5883;&#x4E2D;&#x6CE8;&#x9500;"></a></p>
<h5 id="&#x5728;&#x7FA4;&#x96C6;&#x73AF;&#x5883;&#x4E2D;&#x6CE8;&#x9500;"><a name="&#x5728;&#x7FA4;&#x96C6;&#x73AF;&#x5883;&#x4E2D;&#x6CE8;&#x9500;" class="anchor-navigation-ex-anchor" href="#&#x5728;&#x7FA4;&#x96C6;&#x73AF;&#x5883;&#x4E2D;&#x6CE8;&#x9500;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5728;&#x7FA4;&#x96C6;&#x73AF;&#x5883;&#x4E2D;&#x6CE8;&#x9500;</h5>
<p>&#x5728;&#x5185;&#x90E8;&#xFF0C;SAML&#x9002;&#x914D;&#x5668;&#x5B58;&#x50A8;SAML&#x4F1A;&#x8BDD;&#x7D22;&#x5F15;&#xFF0C;&#x4E3B;&#x4F53;&#x540D;&#x79F0;&#xFF08;&#x5DF2;&#x77E5;&#xFF09;&#x548C;HTTP&#x4F1A;&#x8BDD;ID&#x4E4B;&#x95F4;&#x7684;&#x6620;&#x5C04;&#x3002; &#x53EF;&#x4EE5;&#x5728;&#x7FA4;&#x96C6;&#x4E2D;&#x4E3A;&#x53EF;&#x5206;&#x53D1;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;JBoss&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x670D;&#x52A1;&#x5668;&#x7CFB;&#x5217;&#xFF08;WildFly 10/11&#xFF0C;EAP 6/7&#xFF09;&#x4E2D;&#x7EF4;&#x62A4;&#x6B64;&#x6620;&#x5C04;&#x3002; &#x4F5C;&#x4E3A;&#x524D;&#x63D0;&#x6761;&#x4EF6;&#xFF0C;HTTP&#x4F1A;&#x8BDD;&#x9700;&#x8981;&#x8DE8;&#x96C6;&#x7FA4;&#x5206;&#x5E03;&#xFF08;&#x5373;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;<code>web.xml</code>&#x4E2D;&#x6807;&#x6709;<code>&lt;distributable /&gt;</code>&#x6807;&#x7B7E;&#xFF09;&#x3002;</p>
<p>&#x8981;&#x542F;&#x7528;&#x8BE5;&#x529F;&#x80FD;&#xFF0C;&#x8BF7;&#x5C06;&#x4EE5;&#x4E0B;&#x90E8;&#x5206;&#x6DFB;&#x52A0;&#x5230;<code>/WEB_INF/web.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF1A;</p>
<p>&#x5BF9;&#x4E8E; EAP 7, WildFly 10/11:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>keycloak.sessionIdMapperUpdater.classes<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>org.keycloak.adapters.saml.wildfly.infinispan.InfinispanSessionCacheIdMapperUpdater<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span>
</code></pre>
<p>&#x5BF9;&#x4E8E; EAP 6:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>keycloak.sessionIdMapperUpdater.classes<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>org.keycloak.adapters.saml.jbossweb.infinispan.InfinispanSessionCacheIdMapperUpdater<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span>
</code></pre>
<p>&#x5982;&#x679C;&#x90E8;&#x7F72;&#x7684;&#x4F1A;&#x8BDD;&#x7F13;&#x5B58;&#x540D;&#x4E3A;<code>*deployment-cache*</code>&#xFF0C;&#x5219;&#x7528;&#x4E8E;SAML&#x6620;&#x5C04;&#x7684;&#x7F13;&#x5B58;&#x5C06;&#x547D;&#x540D;&#x4E3A;<code>*deployment-cache*.ssoCache</code>&#x3002; &#x7F13;&#x5B58;&#x7684;&#x540D;&#x79F0;&#x53EF;&#x4EE5;&#x88AB;&#x4E0A;&#x4E0B;&#x6587;&#x53C2;&#x6570;<code>keycloak.sessionIdMapperUpdater.infinispan.cacheName</code>&#x8986;&#x76D6;&#x3002; &#x5305;&#x542B;&#x7F13;&#x5B58;&#x7684;&#x7F13;&#x5B58;&#x5BB9;&#x5668;&#x5C06;&#x4E0E;&#x5305;&#x542B;&#x90E8;&#x7F72;&#x4F1A;&#x8BDD;&#x7F13;&#x5B58;&#x7684;&#x7F13;&#x5B58;&#x5BB9;&#x5668;&#x76F8;&#x540C;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x7531;&#x4E0A;&#x4E0B;&#x6587;&#x53C2;&#x6570;<code>keycloak.sessionIdMapperUpdater.infinispan.containerName</code>&#x8986;&#x76D6;&#x3002;</p>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;SAML&#x6620;&#x5C04;&#x7F13;&#x5B58;&#x7684;&#x914D;&#x7F6E;&#x5C06;&#x4ECE;&#x4F1A;&#x8BDD;&#x7F13;&#x5B58;&#x4E2D;&#x6D3E;&#x751F;&#x3002; &#x53EF;&#x4EE5;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7F13;&#x5B58;&#x914D;&#x7F6E;&#x90E8;&#x5206;&#x4E2D;&#x624B;&#x52A8;&#x8986;&#x76D6;&#x914D;&#x7F6E;&#xFF0C;&#x5C31;&#x50CF;&#x5176;&#x4ED6;&#x7F13;&#x5B58;&#x4E00;&#x6837;&#x3002;</p>
<p>&#x76EE;&#x524D;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;&#x53EF;&#x9760;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5EFA;&#x8BAE;&#x4E3A;SAML&#x4F1A;&#x8BDD;&#x7F13;&#x5B58;&#x4F7F;&#x7528;&#x590D;&#x5236;&#x7F13;&#x5B58;&#x3002; &#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;SAML&#x6CE8;&#x9500;&#x8BF7;&#x6C42;&#x843D;&#x5230;&#x67D0;&#x4E2A;&#x8282;&#x70B9;&#x800C;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;SAM&#x4F1A;&#x8BDD;&#x7D22;&#x5F15;&#x5230;HTTP&#x4F1A;&#x8BDD;&#x6620;&#x5C04;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x6CE8;&#x9500;&#x5931;&#x8D25;&#x3002;</p>
<p><a name="219______&#x5728;Cross_DC&#x573A;&#x666F;&#x4E2D;&#x6CE8;&#x9500;"></a></p>
<h5 id="&#x5728;cross-dc&#x573A;&#x666F;&#x4E2D;&#x6CE8;&#x9500;"><a name="&#x5728;cross-dc&#x573A;&#x666F;&#x4E2D;&#x6CE8;&#x9500;" class="anchor-navigation-ex-anchor" href="#&#x5728;cross-dc&#x573A;&#x666F;&#x4E2D;&#x6CE8;&#x9500;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5728;Cross DC&#x573A;&#x666F;&#x4E2D;&#x6CE8;&#x9500;</h5>
<p>&#x4EA4;&#x53C9;DC&#x573A;&#x666F;&#x4EC5;&#x9002;&#x7528;&#x4E8E;WildFly 10&#x53CA;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#xFF0C;&#x4EE5;&#x53CA;EAP 7&#x53CA;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x3002;</p>
<p>&#x5904;&#x7406;&#x8DE8;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x4E2D;&#x5FC3;&#x7684;&#x4F1A;&#x8BDD;&#x9700;&#x8981;&#x7279;&#x6B8A;&#x5904;&#x7406;&#x3002; &#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#x4EE5;&#x4E0B;&#x573A;&#x666F;&#xFF1A;</p>
<ol>
<li>&#x767B;&#x5F55;&#x8BF7;&#x6C42;&#x5728;&#x6570;&#x636E;&#x4E2D;&#x5FC3;1&#x7684;&#x96C6;&#x7FA4;&#x5185;&#x5904;&#x7406;&#x3002;</li>
<li>&#x7BA1;&#x7406;&#x5458;&#x53D1;&#x51FA;&#x7279;&#x5B9A;SAML&#x4F1A;&#x8BDD;&#x7684;&#x6CE8;&#x9500;&#x8BF7;&#x6C42;&#xFF0C;&#x8BF7;&#x6C42;&#x767B;&#x9646;&#x6570;&#x636E;&#x4E2D;&#x5FC3;2&#x3002;</li>
</ol>
<p>&#x6570;&#x636E;&#x4E2D;&#x5FC3;2&#x5FC5;&#x987B;&#x6CE8;&#x9500;&#x6570;&#x636E;&#x4E2D;&#x5FC3;1&#x4E2D;&#x5B58;&#x5728;&#x7684;&#x6240;&#x6709;&#x4F1A;&#x8BDD;&#xFF08;&#x4EE5;&#x53CA;&#x5171;&#x4EAB;HTTP&#x4F1A;&#x8BDD;&#x7684;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x4E2D;&#x5FC3;&#xFF09;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x6DB5;&#x76D6;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_saml_logout_in_cluster" target="_blank">&#x4E0A;&#x9762;</a> &#x63CF;&#x8FF0;&#x7684;SAML&#x4F1A;&#x8BDD;&#x7F13;&#x5B58;,&#x4E0D;&#x4EC5;&#x9700;&#x8981;&#x5728;&#x5355;&#x4E2A;&#x7FA4;&#x96C6;&#x4E2D;&#x590D;&#x5236;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x5728;&#x6240;&#x6709;&#x6570;&#x636E;&#x4E2D;&#x590D;&#x5236; &#x4E2D;&#x5FC3;&#xFF0C;&#x4F8B;&#x5982; <a href="https://access.redhat.com/documentation/en-us/red_hat_data_grid/6.6/html/administration_and_configuration_guide/chap-externalize_sessions#Externalize_HTTP_Session_from_JBoss_EAP_6.x_to_JBoss_Data_Grid" target="_blank">&#x901A;&#x8FC7;&#x72EC;&#x7ACB;&#x7684;Infinispan/JDG&#x670D;&#x52A1;&#x5668;</a>&#xFF1A;</p>
<ol>
<li>&#x5FC5;&#x987B;&#x5C06;&#x7F13;&#x5B58;&#x6DFB;&#x52A0;&#x5230;&#x72EC;&#x7ACB;&#x7684;Infinispan/JDG&#x670D;&#x52A1;&#x5668;&#x3002;</li>
<li>&#x5FC5;&#x987B;&#x5C06;&#x5148;&#x524D;&#x9879;&#x76EE;&#x7684;&#x7F13;&#x5B58;&#x6DFB;&#x52A0;&#x4E3A;&#x76F8;&#x5E94;SAML&#x4F1A;&#x8BDD;&#x7F13;&#x5B58;&#x7684;&#x8FDC;&#x7A0B;&#x5B58;&#x50A8;&#x3002;</li>
</ol>
<p>&#x5728;&#x90E8;&#x7F72;&#x671F;&#x95F4;&#x53D1;&#x73B0;SAML&#x4F1A;&#x8BDD;&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#x5B58;&#x5728;&#x8FDC;&#x7A0B;&#x5B58;&#x50A8;&#x540E;&#xFF0C;&#x5C06;&#x76D1;&#x89C6;&#x5176;&#x66F4;&#x6539;&#x5E76;&#x76F8;&#x5E94;&#x5730;&#x66F4;&#x65B0;&#x672C;&#x5730;SAML&#x4F1A;&#x8BDD;&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#x3002;</p>
<p><a name="220_____3_1_9__&#x83B7;&#x53D6;&#x65AD;&#x8A00;&#x5C5E;&#x6027;"></a></p>
<h4 id="319-&#x83B7;&#x53D6;&#x65AD;&#x8A00;&#x5C5E;&#x6027;"><a name="319-&#x83B7;&#x53D6;&#x65AD;&#x8A00;&#x5C5E;&#x6027;" class="anchor-navigation-ex-anchor" href="#319-&#x83B7;&#x53D6;&#x65AD;&#x8A00;&#x5C5E;&#x6027;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.9. &#x83B7;&#x53D6;&#x65AD;&#x8A00;&#x5C5E;&#x6027;</h4>
<p>&#x6210;&#x529F;&#x8FDB;&#x884C;SAML&#x767B;&#x5F55;&#x540E;&#xFF0C;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x83B7;&#x53D6;&#x901A;&#x8FC7;SAML&#x65AD;&#x8A00;&#x4F20;&#x9012;&#x7684;&#x5C5E;&#x6027;&#x503C;&#x3002; <code>HttpServletRequest.getUserPrincipal()</code>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;<code>Principal</code>&#x5BF9;&#x8C61;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A;&#x540D;&#x4E3A;<code>org.keycloak.adapters.saml.SamlPrincipal</code>&#x7684;Keycloak&#x7279;&#x5B9A;&#x7C7B;&#x3002; &#x6B64;&#x5BF9;&#x8C61;&#x5141;&#x8BB8;&#x60A8;&#x67E5;&#x770B;&#x539F;&#x59CB;&#x65AD;&#x8A00;&#xFF0C;&#x5E76;&#x5177;&#x6709;&#x67E5;&#x627E;&#x5C5E;&#x6027;&#x503C;&#x7684;&#x4FBF;&#x6377;&#x529F;&#x80FD;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> org.keycloak.adapters.saml;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SamlPrincipal</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span>, <span class="hljs-title">Principal</span> </span>{
    <span class="hljs-comment">/**
     * Get full saml assertion
     *
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> AssertionType <span class="hljs-title">getAssertion</span><span class="hljs-params">()</span> </span>{
       ...
    }

    <span class="hljs-comment">/**
     * Get SAML subject sent in assertion
     *
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getSamlSubject</span><span class="hljs-params">()</span> </span>{
        ...
    }

    <span class="hljs-comment">/**
     * Subject nameID format
     *
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getNameIDFormat</span><span class="hljs-params">()</span> </span>{
        ...
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>{
        ...
    }

    <span class="hljs-comment">/**
     * Convenience function that gets Attribute value by attribute name
     *
     * <span class="hljs-doctag">@param</span> name
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getAttributes</span><span class="hljs-params">(String name)</span> </span>{
        ...

    }

    <span class="hljs-comment">/**
     * Convenience function that gets Attribute value by attribute friendly name
     *
     * <span class="hljs-doctag">@param</span> friendlyName
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getFriendlyAttributes</span><span class="hljs-params">(String friendlyName)</span> </span>{
        ...
    }

    <span class="hljs-comment">/**
     * Convenience function that gets first  value of an attribute by attribute name
     *
     * <span class="hljs-doctag">@param</span> name
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getAttribute</span><span class="hljs-params">(String name)</span> </span>{
        ...
    }

    <span class="hljs-comment">/**
     * Convenience function that gets first  value of an attribute by attribute name
     *
     *
     * <span class="hljs-doctag">@param</span> friendlyName
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getFriendlyAttribute</span><span class="hljs-params">(String friendlyName)</span> </span>{
        ...
    }

    <span class="hljs-comment">/**
     * Get set of all assertion attribute names
     *
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Set&lt;String&gt; <span class="hljs-title">getAttributeNames</span><span class="hljs-params">()</span> </span>{
        ...
    }

    <span class="hljs-comment">/**
     * Get set of all assertion friendly attribute names
     *
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Set&lt;String&gt; <span class="hljs-title">getFriendlyNames</span><span class="hljs-params">()</span> </span>{
        ...
    }
}
</code></pre>
<p><a name="221_____3_1_10__&#x9519;&#x8BEF;&#x5904;&#x7406;"></a></p>
<h4 id="3110-&#x9519;&#x8BEF;&#x5904;&#x7406;"><a name="3110-&#x9519;&#x8BEF;&#x5904;&#x7406;" class="anchor-navigation-ex-anchor" href="#3110-&#x9519;&#x8BEF;&#x5904;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.10. &#x9519;&#x8BEF;&#x5904;&#x7406;</h4>
<p>Keycloak&#x4E3A;&#x57FA;&#x4E8E;servlet&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x529F;&#x80FD;&#x3002; &#x5728;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x4E2D;&#x9047;&#x5230;&#x9519;&#x8BEF;&#x65F6;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x5C06;&#x8C03;&#x7528;<code>HttpServletResponse.sendError()</code>&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x5728;<code>web.xml</code>&#x6587;&#x4EF6;&#x4E2D;&#x8BBE;&#x7F6E;<code>error-page</code>&#x6765;&#x5904;&#x7406;&#x60A8;&#x60F3;&#x8981;&#x7684;&#x9519;&#x8BEF;&#x3002; &#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x53EF;&#x80FD;&#x4F1A;&#x629B;&#x51FA;400,401,403&#x548C;500&#x9519;&#x8BEF;&#x3002;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">error-page</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">error-code</span>&gt;</span>403<span class="hljs-tag">&lt;/<span class="hljs-name">error-code</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">location</span>&gt;</span>/ErrorHandler<span class="hljs-tag">&lt;/<span class="hljs-name">location</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">error-page</span>&gt;</span>
</code></pre>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x8FD8;&#x8BBE;&#x7F6E;&#x4E86;&#x53EF;&#x4EE5;&#x68C0;&#x7D22;&#x7684;<code>HttpServletRequest</code>&#x5C5E;&#x6027;&#x3002; &#x5C5E;&#x6027;&#x540D;&#x79F0;&#x662F;<code>org.keycloak.adapters.spi.AuthenticationError</code>&#x3002; Typecast&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#xFF1A;<code>org.keycloak.adapters.saml.SamlAuthenticationError</code>&#x3002; &#x8FD9;&#x4E2A;&#x7C7B;&#x53EF;&#x4EE5;&#x544A;&#x8BC9;&#x4F60;&#x5230;&#x5E95;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;&#x3002; &#x5982;&#x679C;&#x672A;&#x8BBE;&#x7F6E;&#x6B64;&#x5C5E;&#x6027;&#xFF0C;&#x5219;&#x9002;&#x914D;&#x5668;&#x4E0D;&#x5BF9;&#x9519;&#x8BEF;&#x4EE3;&#x7801;&#x8D1F;&#x8D23;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SamlAuthenticationError</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AuthenticationError</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">enum</span> Reason {
        EXTRACTION_FAILURE,
        INVALID_SIGNATURE,
        ERROR_STATUS
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Reason <span class="hljs-title">getReason</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> reason;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> StatusResponseType <span class="hljs-title">getStatus</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> status;
    }
}
</code></pre>
<p><a name="222_____3_1_11__&#x6545;&#x969C;&#x6392;&#x9664;"></a></p>
<h4 id="3111-&#x6545;&#x969C;&#x6392;&#x9664;"><a name="3111-&#x6545;&#x969C;&#x6392;&#x9664;" class="anchor-navigation-ex-anchor" href="#3111-&#x6545;&#x969C;&#x6392;&#x9664;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.11. &#x6545;&#x969C;&#x6392;&#x9664;</h4>
<p>&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x6700;&#x4F73;&#x65B9;&#x6CD5;&#x662F;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x548C;Keycloak Server&#x4E2D;&#x6253;&#x5F00;SAML&#x7684;&#x8C03;&#x8BD5;&#x3002; &#x4F7F;&#x7528;&#x60A8;&#x7684;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x6846;&#x67B6;&#xFF0C;&#x5C06;&#x65E5;&#x5FD7;&#x7EA7;&#x522B;&#x8BBE;&#x7F6E;&#x4E3A;<code>org.keycloak.saml</code>package&#x7684;<code>DEBUG</code>&#x3002; &#x542F;&#x7528;&#x6B64;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#x548C;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x7684;SAML&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x6587;&#x6863;&#x3002;</p>
<p><a name="223_____3_1_12__&#x591A;&#x79DF;&#x6237;"></a></p>
<h4 id="3112-&#x591A;&#x79DF;&#x6237;"><a name="3112-&#x591A;&#x79DF;&#x6237;" class="anchor-navigation-ex-anchor" href="#3112-&#x591A;&#x79DF;&#x6237;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.12. &#x591A;&#x79DF;&#x6237;</h4>
<p>SAML&#x4E3A;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_multi_tenancy" target="_blank">&#x591A;&#x79DF;&#x6237;</a>&#x63D0;&#x4F9B;&#x4E0E;OIDC&#x76F8;&#x540C;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x591A;&#x4E2A;&#x5B89;&#x5168;&#x4FDD;&#x62A4;&#x5355;&#x4E2A;&#x76EE;&#x6807;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF08;WAR&#xFF09; Keycloak&#x9886;&#x57DF;&#x3002; &#x9886;&#x57DF;&#x53EF;&#x4EE5;&#x4F4D;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;Keycloak&#x5B9E;&#x4F8B;&#x4E0A;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F4D;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x5B9E;&#x4F8B;&#x4E0A;&#x3002;</p>
<p>&#x4E3A;&#x6B64;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5FC5;&#x987B;&#x5177;&#x6709;&#x591A;&#x4E2A;<code>keycloak-saml.xml</code>&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x867D;&#x7136;&#x60A8;&#x53EF;&#x4EE5;&#x5C06;WAR&#x7684;&#x591A;&#x4E2A;&#x5B9E;&#x4F8B;&#x4E0E;&#x4E0D;&#x540C;&#x7684;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x90E8;&#x7F72;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x8DEF;&#x5F84;&#xFF0C;&#x4F46;&#x8FD9;&#x53EF;&#x80FD;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x8FD8;&#x5E0C;&#x671B;&#x6839;&#x636E;context-path&#x4E4B;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x5185;&#x5BB9;&#x9009;&#x62E9;&#x57DF;&#x3002;</p>
<p>Keycloak&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x89E3;&#x6790;&#x5668;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x4E3A;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x3002; &#x5728;SAML&#x4E2D;&#xFF0C;&#x914D;&#x7F6E;&#x4EC5;&#x5728;&#x767B;&#x5F55;&#x5904;&#x7406;&#x4E2D;&#x5F88;&#x6709;&#x610F;&#x4E49;; &#x4E00;&#x65E6;&#x7528;&#x6237;&#x767B;&#x5F55;&#xFF0C;&#x4F1A;&#x8BDD;&#x5C31;&#x4F1A;&#x88AB;&#x9A8C;&#x8BC1;&#xFF0C;&#x5E76;&#x4E14;&#x8FD4;&#x56DE;&#x7684;<code>keycloak-saml.xml</code>&#x662F;&#x4E0D;&#x540C;&#x7684;&#x5E76;&#x4E0D;&#x91CD;&#x8981;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x4E3A;&#x540C;&#x4E00;&#x4F1A;&#x8BDD;&#x8FD4;&#x56DE;&#x76F8;&#x540C;&#x7684;&#x914D;&#x7F6E;&#x662F;&#x6B63;&#x786E;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x4E3A;&#x6B64;&#xFF0C;&#x8BF7;&#x521B;&#x5EFA;<code>org.keycloak.adapters.saml.SamlConfigResolver</code>&#x7684;&#x5B9E;&#x73B0;&#x3002; &#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4F7F;&#x7528;<code>Host</code>&#x6807;&#x5934;&#x6765;&#x5B9A;&#x4F4D;&#x6B63;&#x786E;&#x7684;&#x914D;&#x7F6E;&#x5E76;&#x52A0;&#x8F7D;&#x5B83;&#x4EE5;&#x53CA;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;Java&#x7C7B;&#x8DEF;&#x5F84;&#x4E2D;&#x7684;&#x76F8;&#x5173;&#x5143;&#x7D20;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> example;

<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> org.keycloak.adapters.saml.SamlConfigResolver;
<span class="hljs-keyword">import</span> org.keycloak.adapters.saml.SamlDeployment;
<span class="hljs-keyword">import</span> org.keycloak.adapters.saml.config.parsers.DeploymentBuilder;
<span class="hljs-keyword">import</span> org.keycloak.adapters.saml.config.parsers.ResourceLoader;
<span class="hljs-keyword">import</span> org.keycloak.adapters.spi.HttpFacade;
<span class="hljs-keyword">import</span> org.keycloak.saml.common.exceptions.ParsingException;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SamlMultiTenantResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SamlConfigResolver</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> SamlDeployment <span class="hljs-title">resolve</span><span class="hljs-params">(HttpFacade.Request request)</span> </span>{
        String host = request.getHeader(<span class="hljs-string">&quot;Host&quot;</span>);
        String realm = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (host.contains(<span class="hljs-string">&quot;tenant1&quot;</span>)) {
            realm = <span class="hljs-string">&quot;tenant1&quot;</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (host.contains(<span class="hljs-string">&quot;tenant2&quot;</span>)) {
            realm = <span class="hljs-string">&quot;tenant2&quot;</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;Not able to guess the keycloak-saml.xml to load&quot;</span>);
        }

        InputStream is = getClass().getResourceAsStream(<span class="hljs-string">&quot;/&quot;</span> + realm + <span class="hljs-string">&quot;-keycloak-saml.xml&quot;</span>);
        <span class="hljs-keyword">if</span> (is == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;Not able to find the file /&quot;</span> + realm + <span class="hljs-string">&quot;-keycloak-saml.xml&quot;</span>);
        }

        ResourceLoader loader = <span class="hljs-keyword">new</span> ResourceLoader() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> InputStream <span class="hljs-title">getResourceAsStream</span><span class="hljs-params">(String path)</span> </span>{
                <span class="hljs-keyword">return</span> getClass().getResourceAsStream(path);
            }
        };

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DeploymentBuilder().build(is, loader);
        } <span class="hljs-keyword">catch</span> (ParsingException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;Cannot load SAML deployment&quot;</span>, e);
        }
    }
}
</code></pre>
<p>&#x60A8;&#x8FD8;&#x5FC5;&#x987B;&#x5728;<code>web.xml</code>&#x4E2D;&#x914D;&#x7F6E;&#x4E0E;<code>keycloak.config.resolver</code>context-param&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x7684;<code>SamlConfigResolver</code>&#x5B9E;&#x73B0;&#xFF1A;</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span>&gt;</span>
    ...
    <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>keycloak.config.resolver<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>example.SamlMultiTenantResolver<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span>
</code></pre>
<p><a name="224_____3_1_13__&#x4ECE;&#x65E7;&#x7248;&#x672C;&#x8FC1;&#x79FB;"></a></p>
<h4 id="3113-&#x4ECE;&#x65E7;&#x7248;&#x672C;&#x8FC1;&#x79FB;"><a name="3113-&#x4ECE;&#x65E7;&#x7248;&#x672C;&#x8FC1;&#x79FB;" class="anchor-navigation-ex-anchor" href="#3113-&#x4ECE;&#x65E7;&#x7248;&#x672C;&#x8FC1;&#x79FB;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.13. &#x4ECE;&#x65E7;&#x7248;&#x672C;&#x8FC1;&#x79FB;</h4>
<p><a name="225______&#x8FC1;&#x79FB;&#x5230;1_9_0"></a></p>
<h5 id="&#x8FC1;&#x79FB;&#x5230;190"><a name="&#x8FC1;&#x79FB;&#x5230;190" class="anchor-navigation-ex-anchor" href="#&#x8FC1;&#x79FB;&#x5230;190"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FC1;&#x79FB;&#x5230;1.9.0</h5>
<p><a name="226_______SAML_SP_&#x5BA2;&#x6237;&#x7AEF;_&#x9002;&#x914D;&#x5668;&#x66F4;&#x6539;"></a></p>
<h6 id="saml-sp-&#x5BA2;&#x6237;&#x7AEF;-&#x9002;&#x914D;&#x5668;&#x66F4;&#x6539;"><a name="saml-sp-&#x5BA2;&#x6237;&#x7AEF;-&#x9002;&#x914D;&#x5668;&#x66F4;&#x6539;" class="anchor-navigation-ex-anchor" href="#saml-sp-&#x5BA2;&#x6237;&#x7AEF;-&#x9002;&#x914D;&#x5668;&#x66F4;&#x6539;"><i class="fa fa-link" aria-hidden="true"></i></a>SAML SP &#x5BA2;&#x6237;&#x7AEF; &#x9002;&#x914D;&#x5668;&#x66F4;&#x6539;</h6>
<p>Keycloak SAML SP&#x5BA2;&#x6237;&#x7AEF;&#x9002;&#x914D;&#x5668;&#x73B0;&#x5728;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x7AEF;&#x70B9;&#xFF0C;<code>/saml</code>&#x5C06;&#x5728;&#x60A8;&#x7684;IdP&#x4E2D;&#x6CE8;&#x518C;&#x3002; &#x9664;&#x4E86;&#x5B83;&#x5177;&#x6709;&#x7684;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x7ED1;&#x5B9A;&#x4E4B;&#x5916;&#xFF0C;SamlFilter&#x8FD8;&#x5FC5;&#x987B;&#x7ED1;&#x5B9A;&#x5230;/saml&#x3002; &#x5FC5;&#x987B;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x56E0;&#x4E3A;SAML POST&#x7ED1;&#x5B9A;&#x4F1A;&#x5360;&#x7528;&#x8BF7;&#x6C42;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x8FD9;&#x5BF9;&#x4F9D;&#x8D56;&#x5B83;&#x7684;&#x5BA2;&#x6237;&#x6765;&#x8BF4;&#x771F;&#x7684;&#x5F88;&#x7CDF;&#x7CD5;&#x3002;</p>
<p><a name="227____3_2__mod_auth_mellon_Apache_HTTPD_&#x6A21;&#x5757;"></a></p>
<h3 id="32-modauthmellon-apache-httpd-&#x6A21;&#x5757;"><a name="32-modauthmellon-apache-httpd-&#x6A21;&#x5757;" class="anchor-navigation-ex-anchor" href="#32-modauthmellon-apache-httpd-&#x6A21;&#x5757;"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. mod_auth_mellon Apache HTTPD &#x6A21;&#x5757;</h3>
<p><a href="https://github.com/UNINETT/mod_auth_mellon" target="_blank">mod_auth_mellon</a> &#x6A21;&#x5757;&#x662F;SAML&#x7684;Apache HTTPD&#x63D2;&#x4EF6;&#x3002; &#x5982;&#x679C;&#x60A8;&#x7684;&#x8BED;&#x8A00;/&#x73AF;&#x5883;&#x652F;&#x6301;&#x4F7F;&#x7528;Apache HTTPD&#x4F5C;&#x4E3A;&#x4EE3;&#x7406;&#xFF0C;&#x90A3;&#x4E48;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;mod_auth_mellon&#x901A;&#x8FC7;SAML&#x4FDD;&#x62A4;&#x60A8;&#x7684;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002; &#x6709;&#x5173;&#x6B64;&#x6A21;&#x5757;&#x7684;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<em>mod_auth_mellon</em> GitHub &#x4ED3;&#x5E93;&#x3002;</p>
<p>&#x8981;&#x914D;&#x7F6E;mod_auth_mellon&#xFF0C;&#x60A8;&#x9700;&#x8981;&#xFF1A;</p>
<ul>
<li>&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#xFF08;IdP&#xFF09;&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;XML&#x6587;&#x4EF6;&#xFF0C;&#x63CF;&#x8FF0;&#x4E0E;Keycloak&#x6216;&#x5176;&#x4ED6;SAML IdP&#x7684;&#x8FDE;&#x63A5;</li>
<li>SP&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;XML&#x6587;&#x4EF6;&#xFF0C;&#x63CF;&#x8FF0;&#x60A8;&#x6B63;&#x5728;&#x4FDD;&#x62A4;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;SAML&#x8FDE;&#x63A5;&#x548C;&#x914D;&#x7F6E;&#x3002;</li>
<li>&#x79C1;&#x94A5;PEM&#x6587;&#x4EF6;&#xFF0C;&#x5B83;&#x662F;PEM&#x683C;&#x5F0F;&#x7684;&#x6587;&#x672C;&#x6587;&#x4EF6;&#xFF0C;&#x7528;&#x4E8E;&#x5B9A;&#x4E49;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7528;&#x4E8E;&#x7B7E;&#x7F72;&#x6587;&#x6863;&#x7684;&#x79C1;&#x94A5;&#x3002;</li>
<li>&#x8BC1;&#x4E66;PEM&#x6587;&#x4EF6;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#x6587;&#x4EF6;&#xFF0C;&#x7528;&#x4E8E;&#x5B9A;&#x4E49;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x8BC1;&#x4E66;&#x3002;</li>
<li>mod_auth_mellon &#x7279;&#x5B9A;&#x7684;Apache HTTPD&#x6A21;&#x5757;&#x914D;&#x7F6E;&#x3002;</li>
</ul>
<p>&#x5982;&#x679C;&#x60A8;&#x5DF2;&#x7ECF;&#x5728;Keycloak&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x670D;&#x52A1;&#x5668;&#x7684;&#x9886;&#x57DF;&#x5185;&#x5B9A;&#x4E49;&#x5E76;&#x6CE8;&#x518C;&#x4E86;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5219;Keycloak&#x53EF;&#x4EE5;&#x751F;&#x6210;&#x9664;Apache HTTPD&#x6A21;&#x5757;&#x914D;&#x7F6E;&#x4E4B;&#x5916;&#x6240;&#x9700;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x8981;&#x751F;&#x6210;Apache HTTPD&#x6A21;&#x5757;&#x914D;&#x7F6E;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x8F6C;&#x5230;SAML&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x201C;&#x5B89;&#x88C5;&#x201D;&#x9875;&#x9762;&#xFF0C;&#x7136;&#x540E;&#x9009;&#x62E9;&#x201C;Mod Auth Mellon files&#x201D;&#x9009;&#x9879;&#x3002;</p>
<p>mod_auth_mellon &#x914D;&#x7F6E;&#x4E0B;&#x8F7D;</p>
<p><img src="assets/mod-auth-mellon-config-download.png" alt="mod auth mellon config download"></p>
</li>
<li><p>&#x5355;&#x51FB;<strong>Download</strong>&#x4EE5;&#x4E0B;&#x8F7D;&#x5305;&#x542B;&#x6240;&#x9700;XML&#x63CF;&#x8FF0;&#x7B26;&#x548C;PEM&#x6587;&#x4EF6;&#x7684;zip&#x6587;&#x4EF6;&#x3002;</p>
</li>
</ol>
<p><a name="228_____3_2_1__&#x4F7F;&#x7528;Keycloak&#x914D;&#x7F6E;mod_auth_mellon"></a></p>
<h4 id="321-&#x4F7F;&#x7528;keycloak&#x914D;&#x7F6E;modauthmellon"><a name="321-&#x4F7F;&#x7528;keycloak&#x914D;&#x7F6E;modauthmellon" class="anchor-navigation-ex-anchor" href="#321-&#x4F7F;&#x7528;keycloak&#x914D;&#x7F6E;modauthmellon"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.1. &#x4F7F;&#x7528;Keycloak&#x914D;&#x7F6E;mod_auth_mellon</h4>
<p>&#x6D89;&#x53CA;&#x4E24;&#x4E2A;&#x4E3B;&#x673A;&#xFF1A;</p>
<ul>
<li>&#x8FD0;&#x884C;Keycloak&#x7684;&#x4E3B;&#x673A;&#xFF0C;&#x5C06;&#x88AB;&#x79F0;&#x4E3A;$idp_host&#xFF0C;&#x56E0;&#x4E3A;Keycloak&#x662F;SAML&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#xFF08;IdP&#xFF09;&#x3002;</li>
<li>&#x8FD0;&#x884C;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4E3B;&#x673A;&#xFF0C;&#x5C06;&#x79F0;&#x4E3A;$sp_host&#x3002; &#x5728;SAML&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;IdP&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x79F0;&#x4E3A;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#xFF08;SP&#xFF09;&#x3002;</li>
</ul>
<p>&#x9700;&#x8981;&#x5728;&#x5177;&#x6709;root&#x6743;&#x9650;&#x7684;$sp_host&#x4E0A;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x6240;&#x6709;&#x6B65;&#x9AA4;&#x3002;</p>
<p><a name="229______&#x5B89;&#x88C5;&#x5305;"></a></p>
<h5 id="&#x5B89;&#x88C5;&#x5305;"><a name="&#x5B89;&#x88C5;&#x5305;" class="anchor-navigation-ex-anchor" href="#&#x5B89;&#x88C5;&#x5305;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B89;&#x88C5;&#x5305;</h5>
<p>&#x8981;&#x5B89;&#x88C5;&#x5FC5;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#xFF1A;</p>
<ul>
<li>Apache Web&#x670D;&#x52A1;&#x5668; (httpd)</li>
<li>&#x7528;&#x4E8E;Apache&#x7684;Mellon SAML SP&#x9644;&#x52A0;&#x6A21;&#x5757;</li>
<li>&#x7528;&#x4E8E;&#x521B;&#x5EFA;X509&#x8BC1;&#x4E66;&#x7684;&#x5DE5;&#x5177;</li>
</ul>
<p>&#x8981;&#x5B89;&#x88C5;&#x5FC5;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#xFF0C;&#x8BF7;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code class="lang-bash">yum install httpd mod_auth_mellon mod_ssl openssl
</code></pre>
<p><a name="230______&#x4E3A;Apache_SAML&#x521B;&#x5EFA;&#x914D;&#x7F6E;&#x76EE;&#x5F55;"></a></p>
<h5 id="&#x4E3A;apache-saml&#x521B;&#x5EFA;&#x914D;&#x7F6E;&#x76EE;&#x5F55;"><a name="&#x4E3A;apache-saml&#x521B;&#x5EFA;&#x914D;&#x7F6E;&#x76EE;&#x5F55;" class="anchor-navigation-ex-anchor" href="#&#x4E3A;apache-saml&#x521B;&#x5EFA;&#x914D;&#x7F6E;&#x76EE;&#x5F55;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E3A;Apache SAML&#x521B;&#x5EFA;&#x914D;&#x7F6E;&#x76EE;&#x5F55;</h5>
<p>&#x5EFA;&#x8BAE;&#x5728;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;&#x4FDD;&#x7559;&#x4E0E;Apache&#x4F7F;&#x7528;SAML&#x76F8;&#x5173;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x5728;Apache&#x914D;&#x7F6E;root <code>/etc/httpd</code>&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;saml2&#x7684;&#x65B0;&#x76EE;&#x5F55;&#xFF1A;</p>
<pre><code class="lang-bash">mkdir /etc/httpd/saml2
</code></pre>
<p><a name="231______&#x914D;&#x7F6E;Mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;"></a></p>
<h5 id="&#x914D;&#x7F6E;mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;"><a name="&#x914D;&#x7F6E;mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x914D;&#x7F6E;Mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;</h5>
<p>Apache&#x9644;&#x52A0;&#x6A21;&#x5757;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4F4D;&#x4E8E;<code>/etc/httpd/conf.d</code>&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x6587;&#x4EF6;&#x6269;&#x5C55;&#x540D;&#x4E3A;.conf&#x3002; &#x60A8;&#x9700;&#x8981;&#x521B;&#x5EFA;<code>/etc/httpd/conf.d/mellon.conf</code>&#x6587;&#x4EF6;&#x5E76;&#x5C06;Mellon&#x7684;&#x914D;&#x7F6E;&#x6307;&#x4EE4;&#x653E;&#x5165;&#x5176;&#x4E2D;&#x3002;</p>
<p><code>Mellon&#x2019;s</code>&#x914D;&#x7F6E;&#x6307;&#x4EE4;&#x5927;&#x81F4;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4E24;&#x7C7B;&#x4FE1;&#x606F;&#xFF1A;</p>
<ul>
<li>&#x4F7F;&#x7528;SAML&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x4FDD;&#x62A4;&#x54EA;&#x4E9B;URL</li>
<li>&#x5F15;&#x7528;&#x53D7;&#x4FDD;&#x62A4;&#x7684;URL&#x65F6;&#x5C06;&#x4F7F;&#x7528;&#x54EA;&#x4E9B;SAML&#x53C2;&#x6570;&#x3002;</li>
</ul>
<p>Apache&#x914D;&#x7F6E;&#x6307;&#x4EE4;&#x901A;&#x5E38;&#x9075;&#x5FAA;URL&#x7A7A;&#x95F4;&#x4E2D;&#x7684;&#x5206;&#x5C42;&#x6811;&#x7ED3;&#x6784;&#xFF0C;&#x79F0;&#x4E3A;&#x4F4D;&#x7F6E;&#x3002; &#x60A8;&#x9700;&#x8981;&#x4E3A;Mellon&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;URL&#x4F4D;&#x7F6E;&#x4EE5;&#x8FDB;&#x884C;&#x4FDD;&#x62A4;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x7075;&#x6D3B;&#x5730;&#x6DFB;&#x52A0;&#x9002;&#x7528;&#x4E8E;&#x6BCF;&#x4E2A;&#x4F4D;&#x7F6E;&#x7684;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x6240;&#x6709;&#x5FC5;&#x9700;&#x53C2;&#x6570;&#x6DFB;&#x52A0;&#x5230;&#x4F4D;&#x7F6E;&#x5757;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;Mellon&#x53C2;&#x6570;&#x6DFB;&#x52A0;&#x5230;&#x7279;&#x5B9A;&#x53D7;&#x4FDD;&#x62A4;&#x4F4D;&#x7F6E;&#x7EE7;&#x627F;&#x7684;URL&#x4F4D;&#x7F6E;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E2D;&#x7684;&#x516C;&#x5171;&#x4F4D;&#x7F6E;&#xFF08;&#x6216;&#x4E24;&#x8005;&#x7684;&#x67D0;&#x79CD;&#x7EC4;&#x5408;&#xFF09;&#x3002; &#x7531;&#x4E8E;&#x65E0;&#x8BBA;&#x54EA;&#x4E2A;&#x4F4D;&#x7F6E;&#x89E6;&#x53D1;SAML&#x64CD;&#x4F5C;&#xFF0C;SP&#x90FD;&#x4EE5;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x793A;&#x4F8B;&#x914D;&#x7F6E;&#x5C06;&#x5E38;&#x7528;&#x7684;Mellon&#x914D;&#x7F6E;&#x6307;&#x4EE4;&#x653E;&#x5728;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x7684;&#x6839;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Mellon&#x4FDD;&#x62A4;&#x7684;&#x7279;&#x5B9A;&#x4F4D;&#x7F6E;&#x5B9A;&#x4E49; &#x6700;&#x5C0F;&#x6307;&#x4EE4;&#x3002; &#x6B64;&#x7B56;&#x7565;&#x907F;&#x514D;&#x4E3A;&#x6BCF;&#x4E2A;&#x53D7;&#x4FDD;&#x62A4;&#x4F4D;&#x7F6E;&#x590D;&#x5236;&#x76F8;&#x540C;&#x7684;&#x53C2;&#x6570;&#x3002;</p>
<p>&#x6B64;&#x793A;&#x4F8B;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x53D7;&#x4FDD;&#x62A4;&#x7684;&#x4F4D;&#x7F6E;:<a href="https://$sp_host/protected&#x3002;" target="_blank">https://$sp_host/protected&#x3002;</a></p>
<p>&#x8981;&#x914D;&#x7F6E;Mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x521B;&#x5EFA;&#x6587;&#x4EF6;<code>/etc/httpd/conf.d/mellon.conf</code>&#xFF1A;</li>
</ol>
<pre><code class="lang-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">Location</span> / &gt;</span>
    MellonEnable info
    MellonEndpointPath /mellon/
    MellonSPMetadataFile /etc/httpd/saml2/mellon_metadata.xml
    MellonSPPrivateKeyFile /etc/httpd/saml2/mellon.key
    MellonSPCertFile /etc/httpd/saml2/mellon.crt
    MellonIdPMetadataFile /etc/httpd/saml2/idp_metadata.xml
 <span class="hljs-tag">&lt;/<span class="hljs-name">Location</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">Location</span> /<span class="hljs-attr">private</span> &gt;</span>
    AuthType Mellon
    MellonEnable auth
    Require valid-user
 <span class="hljs-tag">&lt;/<span class="hljs-name">Location</span>&gt;</span>
</code></pre>
<blockquote>
<p>&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x4E2D;&#x5F15;&#x7528;&#x7684;&#x67D0;&#x4E9B;&#x6587;&#x4EF6;&#x662F;&#x5728;&#x540E;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x3002;</p>
</blockquote>
<p><a name="232______&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#x5143;&#x6570;&#x636E;"></a></p>
<h5 id="&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#x5143;&#x6570;&#x636E;"><a name="&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#x5143;&#x6570;&#x636E;" class="anchor-navigation-ex-anchor" href="#&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#x5143;&#x6570;&#x636E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x8005;&#x5143;&#x6570;&#x636E;</h5>
<p>&#x5728;SAML&#x4E2D;&#xFF0C;IdP&#x548C;SP&#x4EA4;&#x6362;SAML&#x5143;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x662F;XML&#x683C;&#x5F0F;&#x7684;&#x3002; &#x5143;&#x6570;&#x636E;&#x7684;&#x6A21;&#x5F0F;&#x662F;&#x6807;&#x51C6;&#xFF0C;&#x56E0;&#x6B64;&#x786E;&#x4FDD;&#x53C2;&#x4E0E;&#x7684;SAML&#x5B9E;&#x4F53;&#x53EF;&#x4EE5;&#x6D88;&#x8017;&#x5F7C;&#x6B64;&#x7684;&#x5143;&#x6570;&#x636E;&#x3002; &#x4F60;&#x9700;&#x8981;&#xFF1A;</p>
<ul>
<li>SP&#x4F7F;&#x7528;&#x7684;IdP&#x7684;&#x5143;&#x6570;&#x636E;</li>
<li>&#x63CF;&#x8FF0;&#x63D0;&#x4F9B;&#x7ED9;IdP&#x7684;SP&#x7684;&#x5143;&#x6570;&#x636E;</li>
</ul>
<p>SAML&#x5143;&#x6570;&#x636E;&#x7684;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x662F;X509&#x8BC1;&#x4E66;&#x3002; &#x8FD9;&#x4E9B;&#x8BC1;&#x4E66;&#x7528;&#x4E8E;&#x4E24;&#x4E2A;&#x76EE;&#x7684;&#xFF1A;</p>
<ul>
<li>&#x7B7E;&#x7F72;SAML&#x6D88;&#x606F;&#xFF0C;&#x4EE5;&#x4FBF;&#x63A5;&#x6536;&#x7AEF;&#x53EF;&#x4EE5;&#x8BC1;&#x660E;&#x6D88;&#x606F;&#x6765;&#x81EA;&#x9884;&#x671F;&#x7684;&#x4E00;&#x65B9;&#x3002;</li>
<li>&#x5728;&#x4F20;&#x8F93;&#x8FC7;&#x7A0B;&#x4E2D;&#x52A0;&#x5BC6;&#x6D88;&#x606F;&#xFF08;&#x5F88;&#x5C11;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;SAML&#x6D88;&#x606F;&#x901A;&#x5E38;&#x53D1;&#x751F;&#x5728;&#x53D7;TLS&#x4FDD;&#x62A4;&#x7684;&#x4F20;&#x8F93;&#x4E0A;&#xFF09;</li>
</ul>
<p>&#x5982;&#x679C;&#x60A8;&#x5DF2;&#x62E5;&#x6709;&#x8BC1;&#x4E66;&#x9881;&#x53D1;&#x673A;&#x6784;&#xFF08;CA&#xFF09;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x8BC1;&#x4E66;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x751F;&#x6210;&#x81EA;&#x7B7E;&#x540D;&#x8BC1;&#x4E66;&#x3002; &#x4E3A;&#x7B80;&#x5355;&#x8D77;&#x89C1;&#xFF0C;&#x5728;&#x6B64;&#x793A;&#x4F8B;&#x4E2D;&#x4F7F;&#x7528;&#x81EA;&#x7B7E;&#x540D;&#x8BC1;&#x4E66;&#x3002;</p>
<p>&#x56E0;&#x4E3A;Mellon&#x7684;SP&#x5143;&#x6570;&#x636E;&#x5FC5;&#x987B;&#x53CD;&#x6620;&#x5DF2;&#x5B89;&#x88C5;&#x7684;mod_auth_mellon&#x7248;&#x672C;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x662F;&#x6709;&#x6548;&#x7684;SP&#x5143;&#x6570;&#x636E;XML&#xFF0C;&#x5E76;&#x4E14;&#x5FC5;&#x987B;&#x5305;&#x542B;X509&#x8BC1;&#x4E66;&#xFF08;&#x9664;&#x975E;&#x60A8;&#x719F;&#x6089;X509&#x8BC1;&#x4E66;&#x751F;&#x6210;&#xFF0C;&#x5426;&#x5219;&#x5176;&#x521B;&#x5EFA;&#x53EF;&#x80FD;&#x662F;&#x949D;&#x7684;&#xFF09;&#x662F;&#x751F;&#x6210; SP&#x5143;&#x6570;&#x636E;&#x5C06;&#x4F7F;&#x7528;mod_auth_mellon&#x5305;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x5DE5;&#x5177;&#xFF08;mellon_create_metadata.sh&#xFF09;&#x3002; &#x751F;&#x6210;&#x7684;&#x5143;&#x6570;&#x636E;&#x603B;&#x662F;&#x53EF;&#x4EE5;&#x5728;&#x4EE5;&#x540E;&#x7F16;&#x8F91;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#x6587;&#x4EF6;&#x3002; &#x8BE5;&#x5DE5;&#x5177;&#x8FD8;&#x4F1A;&#x521B;&#x5EFA;&#x60A8;&#x7684;X509&#x5BC6;&#x94A5;&#x548C;&#x8BC1;&#x4E66;&#x3002;</p>
<p>SAML IdP&#x548C;SP&#x4F7F;&#x7528;&#x79F0;&#x4E3A;EntityID&#x7684;&#x552F;&#x4E00;&#x540D;&#x79F0;&#x6765;&#x6807;&#x8BC6;&#x81EA;&#x5DF1;&#x3002; &#x8981;&#x4F7F;&#x7528;Mellon&#x5143;&#x6570;&#x636E;&#x521B;&#x5EFA;&#x5DE5;&#x5177;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#xFF1A;</p>
<ul>
<li>EntityID&#xFF0C;&#x901A;&#x5E38;&#x662F;SP&#x7684;URL&#xFF0C;&#x901A;&#x5E38;&#x662F;&#x53EF;&#x4EE5;&#x68C0;&#x7D22;SP&#x5143;&#x6570;&#x636E;&#x7684;SP&#x7684;URL</li>
<li>&#x5C06;&#x4F7F;&#x7528;SP&#x7684;SAML&#x6D88;&#x606F;&#x7684;URL&#xFF0C;Mellon&#x5C06;&#x5176;&#x79F0;&#x4E3A;MellonEndPointPath&#x3002;</li>
</ul>
<p>&#x8981;&#x521B;&#x5EFA;SP&#x5143;&#x6570;&#x636E;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x521B;&#x5EFA;&#x4E00;&#x4E9B;&#x8F85;&#x52A9;shell&#x53D8;&#x91CF;&#xFF1A;</p>
<pre><code class="lang-properties">fqdn=`hostname`
mellon_endpoint_url=&quot;https://${fqdn}/mellon&quot;
mellon_entity_id=&quot;${mellon_endpoint_url}/metadata&quot;
file_prefix=&quot;$(echo &quot;$mellon_entity_id&quot; | sed &apos;s/[^A-Za-z.]/_/g&apos; | sed &apos;s/__*/_/g&apos;)&quot;
</code></pre>
</li>
<li><p>&#x901A;&#x8FC7;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x8C03;&#x7528;Mellon&#x5143;&#x6570;&#x636E;&#x521B;&#x5EFA;&#x5DE5;&#x5177;&#xFF1A;</p>
<pre><code class="lang-bash">/usr/libexec/mod_auth_mellon/mellon_create_metadata.sh <span class="hljs-variable">$mellon_entity_id</span> <span class="hljs-variable">$mellon_endpoint_url</span>
</code></pre>
</li>
<li><p>&#x5C06;&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x79FB;&#x52A8;&#x5230;&#x76EE;&#x6807;&#x4F4D;&#x7F6E;&#xFF08;&#x5728;&#x4E0A;&#x9762;&#x521B;&#x5EFA;&#x7684;/etc/httpd/conf.d/mellon.conf&#x6587;&#x4EF6;&#x4E2D;&#x5F15;&#x7528;&#xFF09;&#xFF1A;</p>
<pre><code class="lang-bash">mv <span class="hljs-variable">${file_prefix}</span>.cert /etc/httpd/saml2/mellon.crt
mv <span class="hljs-variable">${file_prefix}</span>.key /etc/httpd/saml2/mellon.key
mv <span class="hljs-variable">${file_prefix}</span>.xml /etc/httpd/saml2/mellon_metadata.xml
</code></pre>
</li>
</ol>
<p><a name="233______&#x5C06;Mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#x6DFB;&#x52A0;&#x5230;Keycloak&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;"></a></p>
<h5 id="&#x5C06;mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#x6DFB;&#x52A0;&#x5230;keycloak&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;"><a name="&#x5C06;mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#x6DFB;&#x52A0;&#x5230;keycloak&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;" class="anchor-navigation-ex-anchor" href="#&#x5C06;mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#x6DFB;&#x52A0;&#x5230;keycloak&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5C06;Mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x5546;&#x6DFB;&#x52A0;&#x5230;Keycloak&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;</h5>
<p>&#x5047;&#x8BBE;&#xFF1A;Keycloak IdP&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x5728;$idp_host&#x4E0A;&#x3002;</p>
<p>Keycloak&#x652F;&#x6301;&#x591A;&#x79DF;&#x6237;&#xFF0C;&#x5176;&#x4E2D;&#x6240;&#x6709;&#x7528;&#x6237;&#xFF0C;&#x5BA2;&#x6237;&#x7B49;&#x90FD;&#x88AB;&#x5206;&#x7EC4;&#x5728;&#x6240;&#x8C13;&#x7684;&#x9886;&#x57DF;&#x4E2D;&#x3002; &#x6BCF;&#x4E2A;&#x9886;&#x57DF;&#x90FD;&#x72EC;&#x7ACB;&#x4E8E;&#x5176;&#x4ED6;&#x9886;&#x57DF;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x5728;Keycloak&#x4E2D;&#x4F7F;&#x7528;&#x73B0;&#x6709;&#x9886;&#x57DF;&#xFF0C;&#x4F46;&#x6B64;&#x793A;&#x4F8B;&#x663E;&#x793A;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x540D;&#x4E3A;test_realm&#x7684;&#x65B0;&#x9886;&#x57DF;&#x5E76;&#x4F7F;&#x7528;&#x8BE5;&#x9886;&#x57DF;&#x3002;</p>
<p>&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x4F7F;&#x7528;Keycloak&#x7BA1;&#x7406;Web&#x63A7;&#x5236;&#x53F0;&#x6267;&#x884C;&#x7684;&#x3002; &#x60A8;&#x5FC5;&#x987B;&#x62E5;&#x6709;$idp_host&#x7684;&#x7BA1;&#x7406;&#x5458;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;&#x3002;</p>
<p>&#x8981;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x6253;&#x5F00;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#xFF0C;&#x7136;&#x540E;&#x8F93;&#x5165;&#x7BA1;&#x7406;&#x5458;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;&#x767B;&#x5F55;&#x3002;</p>
<p>&#x767B;&#x5F55;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x540E;&#xFF0C;&#x5C06;&#x5B58;&#x5728;&#x73B0;&#x6709;&#x9886;&#x57DF;&#x3002; &#x9996;&#x6B21;&#x8BBE;&#x7F6E;Keycloak&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6839;&#x57DF;master&#x3002; &#x4EFB;&#x4F55;&#x4EE5;&#x524D;&#x521B;&#x5EFA;&#x7684;&#x57DF;&#x90FD;&#x5728;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x7684;&#x5DE6;&#x4E0A;&#x89D2;&#x5217;&#x5728;&#x4E0B;&#x62C9;&#x5217;&#x8868;&#x4E2D;&#x3002;</p>
</li>
<li><p>&#x4ECE;&#x9886;&#x57DF;&#x4E0B;&#x62C9;&#x5217;&#x8868;&#x4E2D;&#x9009;&#x62E9;<strong>Add realm</strong>&#x3002;</p>
</li>
<li><p>&#x5728;Name&#x5B57;&#x6BB5;&#x4E2D;&#x8F93;&#x5165;<code>test_realm</code>&#x5E76;&#x5355;&#x51FB;<strong>Create</strong>&#x3002;</p>
</li>
</ol>
<p><a name="234_______&#x5C06;Mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x6DFB;&#x52A0;&#x4E3A;&#x9886;&#x57DF;&#x7684;&#x5BA2;&#x6237;&#x7AEF;"></a></p>
<h6 id="&#x5C06;mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x6DFB;&#x52A0;&#x4E3A;&#x9886;&#x57DF;&#x7684;&#x5BA2;&#x6237;&#x7AEF;"><a name="&#x5C06;mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x6DFB;&#x52A0;&#x4E3A;&#x9886;&#x57DF;&#x7684;&#x5BA2;&#x6237;&#x7AEF;" class="anchor-navigation-ex-anchor" href="#&#x5C06;mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x6DFB;&#x52A0;&#x4E3A;&#x9886;&#x57DF;&#x7684;&#x5BA2;&#x6237;&#x7AEF;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5C06;Mellon&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x6DFB;&#x52A0;&#x4E3A;&#x9886;&#x57DF;&#x7684;&#x5BA2;&#x6237;&#x7AEF;</h6>
<p>&#x5728;Keycloak&#x4E2D;&#xFF0C;SAML SP&#x79F0;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x8981;&#x6DFB;&#x52A0;SP&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x4F4D;&#x4E8E;&#x9886;&#x57DF;&#x7684;&#x201C;&#x5BA2;&#x6237;&#x7AEF;&#x201D;&#x90E8;&#x5206;&#x3002;</p>
<ol>
<li>&#x5355;&#x51FB;&#x5DE6;&#x4FA7;&#x7684;&#x201C;&#x5BA2;&#x6237;&#x7AEF;&#x201D;&#x83DC;&#x5355;&#x9879;&#xFF0C;&#x7136;&#x540E;&#x5355;&#x51FB;&#x53F3;&#x4E0A;&#x89D2;&#x7684;&#x201C;<strong>Create</strong>&#x201D;&#x4EE5;&#x521B;&#x5EFA;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</li>
</ol>
<p><a name="235_______&#x6DFB;&#x52A0;Mellon_SP&#x5BA2;&#x6237;&#x7AEF;"></a></p>
<h6 id="&#x6DFB;&#x52A0;mellon-sp&#x5BA2;&#x6237;&#x7AEF;"><a name="&#x6DFB;&#x52A0;mellon-sp&#x5BA2;&#x6237;&#x7AEF;" class="anchor-navigation-ex-anchor" href="#&#x6DFB;&#x52A0;mellon-sp&#x5BA2;&#x6237;&#x7AEF;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6DFB;&#x52A0;Mellon SP&#x5BA2;&#x6237;&#x7AEF;</h6>
<p>&#x8981;&#x6DFB;&#x52A0;Mellon SP&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li>&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x534F;&#x8BAE;&#x8BBE;&#x7F6E;&#x4E3A;SAML&#x3002; &#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x534F;&#x8BAE;&#x4E0B;&#x62C9;&#x5217;&#x8868;&#x4E2D;&#xFF0C;&#x9009;&#x62E9;<strong>saml</strong>&#x3002;</li>
<li>&#x63D0;&#x4F9B;&#x4E0A;&#x9762;&#x521B;&#x5EFA;&#x7684;Mellon SP&#x5143;&#x6570;&#x636E;&#x6587;&#x4EF6;(/etc/httpd/saml2/mellon_metadata.xml)&#x3002; &#x6839;&#x636E;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x8FD0;&#x884C;&#x4F4D;&#x7F6E;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x5FC5;&#x987B;&#x5C06;SP&#x5143;&#x6570;&#x636E;&#x4ECE;$sp_host&#x590D;&#x5236;&#x5230;&#x8FD0;&#x884C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x8BA1;&#x7B97;&#x673A;&#xFF0C;&#x4EE5;&#x4FBF;&#x6D4F;&#x89C8;&#x5668;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x8BE5;&#x6587;&#x4EF6;&#x3002;</li>
<li>&#x70B9;&#x51FB; <strong>Save</strong>.</li>
</ol>
<p><a name="236_______&#x7F16;&#x8F91;Mellon_SP&#x5BA2;&#x6237;&#x7AEF;"></a></p>
<h6 id="&#x7F16;&#x8F91;mellon-sp&#x5BA2;&#x6237;&#x7AEF;"><a name="&#x7F16;&#x8F91;mellon-sp&#x5BA2;&#x6237;&#x7AEF;" class="anchor-navigation-ex-anchor" href="#&#x7F16;&#x8F91;mellon-sp&#x5BA2;&#x6237;&#x7AEF;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7F16;&#x8F91;Mellon SP&#x5BA2;&#x6237;&#x7AEF;</h6>
<p>&#x6211;&#x4EEC;&#x5EFA;&#x8BAE;&#x8BBE;&#x7F6E;&#x51E0;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF1A;</p>
<ul>
<li>&#x786E;&#x4FDD;&quot;Force POST Binding&quot;&#x5904;&#x4E8E;&#x6253;&#x5F00;&#x72B6;&#x6001;&#x3002;</li>
<li>&#x5C06;paosResponse&#x6DFB;&#x52A0;&#x5230;Valid Redirect URIs&#x5217;&#x8868;&#x4E2D;&#xFF1A;<ol>
<li>&#x590D;&#x5236;&quot;Valid Redirect URIs&quot;&#x4E2D;&#x7684;postResponse URL&#x5E76;&#x5C06;&#x5176;&#x7C98;&#x8D34;&#x5230;&quot;+&quot;&#x4E0B;&#x65B9;&#x7684;&#x7A7A;&#x6DFB;&#x52A0;&#x6587;&#x672C;&#x5B57;&#x6BB5;&#x4E2D;&#x3002;</li>
<li>&#x5C06;&#x201C;postResponse&#x201D;&#x66F4;&#x6539;&#x4E3A;&#x201C;paosResponse&#x201D;&#x3002; &#xFF08;SAML ECP&#x9700;&#x8981;paosResponse URL&#x3002;&#xFF09;</li>
<li>&#x70B9;&#x51FB;&#x5E95;&#x90E8;&#x7684;<strong>Save</strong>&#x3002;</li>
</ol>
</li>
</ul>
<p>&#x8BB8;&#x591A;SAML SP&#x6839;&#x636E;&#x7528;&#x6237;&#x5728;&#x7EC4;&#x4E2D;&#x7684;&#x6210;&#x5458;&#x8EAB;&#x4EFD;&#x786E;&#x5B9A;&#x6388;&#x6743;&#x3002; Keycloak IdP&#x53EF;&#x4EE5;&#x7BA1;&#x7406;&#x7528;&#x6237;&#x7EC4;&#x4FE1;&#x606F;&#xFF0C;&#x4F46;&#x5B83;&#x4E0D;&#x63D0;&#x4F9B;&#x7528;&#x6237;&#x7684;&#x7EC4;&#xFF0C;&#x9664;&#x975E;IdP&#x914D;&#x7F6E;&#x4E3A;&#x5C06;&#x5176;&#x4F5C;&#x4E3A;SAML&#x5C5E;&#x6027;&#x63D0;&#x4F9B;&#x3002;</p>
<p>&#x8981;&#x914D;&#x7F6E;IdP&#x4EE5;&#x5C06;&#x7528;&#x6237;&#x7EC4;&#x4F5C;&#x4E3A;SAML&#x5C5E;&#x6027;&#x63D0;&#x4F9B;&#xFF0C;&#x8BF7;&#x5B8C;&#x6210;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li>&#x5355;&#x51FB;&#x5BA2;&#x6237;&#x7AEF;&#x7684;Mappers&#x9009;&#x9879;&#x5361;&#x3002;</li>
<li>&#x5728;Mappers&#x9875;&#x9762;&#x7684;&#x53F3;&#x4E0A;&#x89D2;&#xFF0C;&#x5355;&#x51FB;<strong>Create</strong>&#x3002;</li>
<li>&#x4ECE;Mapper Type&#x4E0B;&#x62C9;&#x5217;&#x8868;&#x4E2D;&#x9009;&#x62E9;<strong>Group list</strong>&#x3002;</li>
<li>&#x5C06;&#x540D;&#x79F0;&#x8BBE;&#x7F6E;&#x4E3A;&#x201C;group list&#x201D;&#x3002;</li>
<li>&#x5C06;SAML&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x8BBE;&#x7F6E;&#x4E3A;&#x201C;groups&#x201D;&#x3002;</li>
<li>&#x70B9;&#x51FB; <strong>Save</strong>.</li>
</ol>
<p>&#x5176;&#x4F59;&#x6B65;&#x9AA4;&#x5728;$sp_host&#x4E0A;&#x6267;&#x884C;&#x3002;</p>
<p><a name="237_______&#x68C0;&#x7D22;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x5143;&#x6570;&#x636E;"></a></p>
<h6 id="&#x68C0;&#x7D22;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x5143;&#x6570;&#x636E;"><a name="&#x68C0;&#x7D22;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x5143;&#x6570;&#x636E;" class="anchor-navigation-ex-anchor" href="#&#x68C0;&#x7D22;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x5143;&#x6570;&#x636E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x68C0;&#x7D22;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x5143;&#x6570;&#x636E;</h6>
<p>&#x73B0;&#x5728;&#x60A8;&#x5DF2;&#x7ECF;&#x5728;IdP&#x4E0A;&#x521B;&#x5EFA;&#x4E86;&#x9886;&#x57DF;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x68C0;&#x7D22;&#x4E0E;&#x5176;&#x5173;&#x8054;&#x7684;IdP&#x5143;&#x6570;&#x636E;&#xFF0C;&#x4EE5;&#x4FBF;Mellon SP&#x8BC6;&#x522B;&#x5B83;&#x3002; &#x5728;&#x5148;&#x524D;&#x521B;&#x5EFA;&#x7684;<code>/etc/httpd/conf.d/mellon.conf</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;MellonIdPMetadataFile&#x6307;&#x5B9A;&#x4E3A;<code>/etc/httpd/saml2/idp_metadata.xml</code>&#xFF0C;&#x4F46;&#x76F4;&#x5230;&#x73B0;&#x5728;&#x8BE5;&#x6587;&#x4EF6;&#x5728;$ sp_host&#x4E0A;&#x4E0D;&#x5B58;&#x5728;&#x3002; &#x8981;&#x83B7;&#x53D6;&#x8BE5;&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4ECE;IdP&#x4E2D;&#x68C0;&#x7D22;&#x5B83;&#x3002;</p>
<ol>
<li><p>&#x901A;&#x8FC7;&#x7528;$idp_host&#x66FF;&#x6362;&#x6B63;&#x786E;&#x7684;&#x503C;&#x6765;&#x4ECE;IdP&#x4E2D;&#x68C0;&#x7D22;&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code class="lang-bash">curl -k -o /etc/httpd/saml2/idp_metadata.xml \
https://<span class="hljs-variable">$idp_host</span>/auth/realms/<span class="hljs-built_in">test</span>_realm/protocol/saml/descriptor
</code></pre>
<p>Mellon &#x73B0;&#x5DF2;&#x5B8C;&#x5168;&#x914D;&#x7F6E;&#x3002;</p>
</li>
<li><p>&#x8981;&#x8FD0;&#x884C;Apache&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x8BED;&#x6CD5;&#x68C0;&#x67E5;&#xFF1A;</p>
<pre><code class="lang-bash">apachectl configtest
</code></pre>
<blockquote>
<p>Configtest&#x7B49;&#x540C;&#x4E8E;apachectl&#x7684;-t&#x53C2;&#x6570;&#x3002; &#x5982;&#x679C;&#x914D;&#x7F6E;&#x6D4B;&#x8BD5;&#x663E;&#x793A;&#x4EFB;&#x4F55;&#x9519;&#x8BEF;&#xFF0C;&#x8BF7;&#x5728;&#x7EE7;&#x7EED;&#x4E4B;&#x524D;&#x66F4;&#x6B63;&#x5B83;&#x4EEC;&#x3002;</p>
</blockquote>
</li>
<li><p>&#x91CD;&#x542F;Apache&#x670D;&#x52A1;&#x5668;&#xFF1A;</p>
<pre><code class="lang-bash">systemctl restart httpd.service
</code></pre>
</li>
</ol>
<p>&#x60A8;&#x73B0;&#x5728;&#x5DF2;&#x5C06;testcalm&#x4E2D;&#x7684;Keycloak&#x8BBE;&#x7F6E;&#x4E3A;SAML IdP&#xFF0C;&#x5C06;mod_auth_mellon&#x8BBE;&#x7F6E;&#x4E3A;SAML SP&#xFF0C;&#x901A;&#x8FC7;&#x5BF9;<code>$idp_host</code>IdP&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;&#x4FDD;&#x62A4;URL $sp_host/protected&#xFF08;&#x53CA;&#x5176;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x5185;&#x5BB9;&#xFF09;&#x3002;</p>
<p><a name="238___4__Docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;"></a></p>
<h2 id="4-docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;"><a name="4-docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#4-docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>4. Docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;</h2>
<blockquote>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x7981;&#x7528;Docker&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x8981;&#x542F;&#x7528;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_installation/#profiles" target="_blank">Profiles</a>&#x3002;</p>
</blockquote>
<p>&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x914D;&#x7F6E;Docker&#x6CE8;&#x518C;&#x8868;&#x4EE5;&#x5C06;Keycloak&#x7528;&#x4F5C;&#x5176;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x670D;&#x52A1;&#x5668;&#x3002;</p>
<p>&#x6709;&#x5173;&#x5982;&#x4F55;&#x8BBE;&#x7F6E;&#x548C;&#x914D;&#x7F6E;Docker&#x6CE8;&#x518C;&#x8868;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://docs.docker.com/registry/configuration/" target="_blank">Docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x6307;&#x5357;</a>&#x3002;</p>
<p><a name="239____4_1__Docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5B89;&#x88C5;"></a></p>
<h3 id="41-docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5B89;&#x88C5;"><a name="41-docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#41-docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. Docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5B89;&#x88C5;</h3>
<p>&#x5BF9;&#x4E8E;&#x5177;&#x6709;&#x66F4;&#x9AD8;&#x7EA7;Docker&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x901A;&#x5E38;&#x5EFA;&#x8BAE;&#x60A8;&#x63D0;&#x4F9B;&#x81EA;&#x5DF1;&#x7684;&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002; Keycloak Docker&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x901A;&#x8FC7;<em>Registry Config File</em> &#x683C;&#x5F0F;&#x5316;&#x9009;&#x9879;&#x652F;&#x6301;&#x6B64;&#x673A;&#x5236;&#x3002; &#x9009;&#x62E9;&#x6B64;&#x9009;&#x9879;&#x5C06;&#x751F;&#x6210;&#x7C7B;&#x4F3C;&#x4E8E;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x7684;&#x8F93;&#x51FA;&#xFF1A;</p>
<pre><code>auth:
  token:
    realm: http://localhost:8080/auth/realms/master/protocol/docker-v2/auth
    service: docker-test
    issuer: http://localhost:8080/auth/realms/master
</code></pre><p>&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x5C06;&#x6B64;&#x8F93;&#x51FA;&#x590D;&#x5236;&#x5230;&#x4EFB;&#x4F55;&#x73B0;&#x6709;&#x7684;&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x3002; &#x6709;&#x5173;&#x5982;&#x4F55;&#x8BBE;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://docs.docker.com/registry/configuration/" target="_blank">&#x6CE8;&#x518C;&#x8868;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x89C4;&#x8303;</a>&#xFF0C;&#x6216;&#x8005;&#x4EE5;<a href="https://github.com/docker/distribution/blob/master/cmd/registry/config-example.yml" target="_blank">&#x57FA;&#x672C;&#x793A;&#x4F8B;</a>&#x5F00;&#x5934;&#x3002;</p>
<blockquote>
<p>&#x4E0D;&#x8981;&#x5FD8;&#x8BB0;&#x4F7F;&#x7528;Keycloak&#x9886;&#x57DF;&#x7684;pulic&#x8BC1;&#x4E66;&#x7684;&#x4F4D;&#x7F6E;&#x914D;&#x7F6E;<code>rootcertbundle</code>&#x5B57;&#x6BB5;&#x3002; &#x6CA1;&#x6709;&#x6B64;&#x53C2;&#x6570;&#xFF0C;auth&#x914D;&#x7F6E;&#x5C06;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#x3002;</p>
</blockquote>
<p><a name="240____4_2__Docker&#x6CE8;&#x518C;&#x8868;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8986;&#x76D6;&#x5B89;&#x88C5;"></a></p>
<h3 id="42-docker&#x6CE8;&#x518C;&#x8868;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8986;&#x76D6;&#x5B89;&#x88C5;"><a name="42-docker&#x6CE8;&#x518C;&#x8868;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8986;&#x76D6;&#x5B89;&#x88C5;" class="anchor-navigation-ex-anchor" href="#42-docker&#x6CE8;&#x518C;&#x8868;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8986;&#x76D6;&#x5B89;&#x88C5;"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. Docker&#x6CE8;&#x518C;&#x8868;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8986;&#x76D6;&#x5B89;&#x88C5;</h3>
<p>&#x901A;&#x5E38;&#xFF0C;&#x5BF9;&#x5F00;&#x53D1;&#x6216;POC Docker&#x6CE8;&#x518C;&#x8868;&#x4F7F;&#x7528;&#x7B80;&#x5355;&#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8986;&#x76D6;&#x662F;&#x5408;&#x9002;&#x7684;&#x3002; &#x867D;&#x7136;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x901A;&#x5E38;&#x4E0D;&#x5EFA;&#x8BAE;&#x7528;&#x4E8E;&#x751F;&#x4EA7;&#x7528;&#x9014;&#xFF0C;&#x4F46;&#x662F;&#x5F53;&#x9700;&#x8981;&#x5FEB;&#x901F;&#x800C;&#x80AE;&#x810F;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5EFA;&#x7ACB;&#x6CE8;&#x518C;&#x8868;&#x65F6;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002; &#x53EA;&#x9700;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5B89;&#x88C5;&#x9009;&#x9879;&#x5361;&#x4E2D;&#x7684;<em>Variable Override</em> &#x683C;&#x5F0F;&#x9009;&#x9879;&#xFF0C;&#x8F93;&#x51FA;&#x5E94;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code>REGISTRY_AUTH_TOKEN_REALM: http://localhost:8080/auth/realms/master/protocol/docker-v2/auth
REGISTRY_AUTH_TOKEN_SERVICE: docker-test
REGISTRY_AUTH_TOKEN_ISSUER: http://localhost:8080/auth/realms/master
</code></pre><blockquote>
<p>&#x4E0D;&#x8981;&#x5FD8;&#x8BB0;&#x4F7F;&#x7528;Keycloak&#x9886;&#x57DF;&#x7684;pulic&#x8BC1;&#x4E66;&#x7684;&#x4F4D;&#x7F6E;&#x914D;&#x7F6E;<code>REGISTRY_AUTH_TOKEN_ROOTCERTBUNDLE</code>&#x8986;&#x76D6;&#x3002; &#x6CA1;&#x6709;&#x6B64;&#x53C2;&#x6570;&#xFF0C;auth&#x914D;&#x7F6E;&#x5C06;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#x3002;</p>
</blockquote>
<p><a name="241____4_3__Docker&#x64B0;&#x5199;YAML&#x6587;&#x4EF6;"></a></p>
<h3 id="43-docker&#x64B0;&#x5199;yaml&#x6587;&#x4EF6;"><a name="43-docker&#x64B0;&#x5199;yaml&#x6587;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#43-docker&#x64B0;&#x5199;yaml&#x6587;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3. Docker&#x64B0;&#x5199;YAML&#x6587;&#x4EF6;</h3>
<blockquote>
<p>&#x6B64;&#x5B89;&#x88C5;&#x65B9;&#x6CD5;&#x65E8;&#x5728;&#x8BA9;docker&#x6CE8;&#x518C;&#x8868;&#x9488;&#x5BF9;Keycloak&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x5B83;&#x4EC5;&#x7528;&#x4E8E;&#x5F00;&#x53D1;&#x76EE;&#x7684;&#xFF0C;&#x4E0D;&#x5E94;&#x5728;&#x751F;&#x4EA7;&#x6216;&#x7C7B;&#x4F3C;&#x751F;&#x4EA7;&#x7684;&#x73AF;&#x5883;&#x4E2D;&#x4F7F;&#x7528;&#x3002;</p>
</blockquote>
<p>zip&#x6587;&#x4EF6;&#x5B89;&#x88C5;&#x673A;&#x5236;&#x4E3A;&#x60F3;&#x8981;&#x4E86;&#x89E3;Keycloak&#x670D;&#x52A1;&#x5668;&#x5982;&#x4F55;&#x4E0E;Docker&#x6CE8;&#x518C;&#x8868;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x63D0;&#x4F9B;&#x4E86;&#x5FEB;&#x901F;&#x5165;&#x95E8;&#x3002; &#x4E3A;&#x4E86;&#x914D;&#x7F6E;&#xFF1A;</p>
<ol>
<li>&#x4ECE;&#x6240;&#x9700;&#x7684;&#x9886;&#x57DF;&#xFF0C;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x3002; &#x6B64;&#x65F6;&#x60A8;&#x5C06;&#x6CA1;&#x6709;Docker&#x6CE8;&#x518C;&#x8868; - &#x5FEB;&#x901F;&#x5165;&#x95E8;&#x5C06;&#x8D1F;&#x8D23;&#x8BE5;&#x90E8;&#x5206;&#x3002;</li>
<li>&#x4ECE;&#x5B89;&#x88C5;&#x9009;&#x9879;&#x5361;&#x4E2D;&#x9009;&#x62E9;&#x201C;Docker Compose YAML&#x201D;&#x9009;&#x9879;&#x5E76;&#x4E0B;&#x8F7D;.zip&#x6587;&#x4EF6;</li>
<li>&#x5C06;&#x5B58;&#x6863;&#x89E3;&#x538B;&#x7F29;&#x5230;&#x6240;&#x9700;&#x4F4D;&#x7F6E;&#xFF0C;&#x7136;&#x540E;&#x6253;&#x5F00;&#x76EE;&#x5F55;&#x3002;</li>
<li>&#x4F7F;&#x7528;<code>docker-compose up</code>&#x542F;&#x52A8;Docker&#x6CE8;&#x518C;&#x8868;</li>
</ol>
<blockquote>
<p>&#x5EFA;&#x8BAE;&#x60A8;&#x5728;<code>master</code>&#x4EE5;&#x5916;&#x7684;&#x57DF;&#x4E2D;&#x914D;&#x7F6E;Docker&#x6CE8;&#x518C;&#x8868;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x56E0;&#x4E3A;HTTP Basic&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6D41;&#x7A0B;&#x4E0D;&#x4F1A;&#x663E;&#x793A;&#x8868;&#x5355;&#x3002;</p>
</blockquote>
<p>&#x5B8C;&#x6210;&#x4E0A;&#x8FF0;&#x914D;&#x7F6E;&#xFF0C;&#x5E76;&#x4E14;keycloak&#x670D;&#x52A1;&#x5668;&#x548C;Docker&#x6CE8;&#x518C;&#x8868;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;docker&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5E94;&#x8BE5;&#x6210;&#x529F;&#xFF1A;</p>
<pre><code class="lang-bash">[user ~]<span class="hljs-comment">#??docker login localhost:5000 -u $username</span>
Password: *******
Login Succeeded
</code></pre>
<p><a name="242___5__&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;"></a></p>
<h2 id="5-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;"><a name="5-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;" class="anchor-navigation-ex-anchor" href="#5-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;"><i class="fa fa-link" aria-hidden="true"></i></a>5. &#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;</h2>
<p>&#x4E3A;&#x4E86;&#x4F7F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6216;&#x670D;&#x52A1;&#x80FD;&#x591F;&#x4F7F;&#x7528;Keycloak&#xFF0C;&#x5B83;&#x5FC5;&#x987B;&#x5728;Keycloak&#x4E2D;&#x6CE8;&#x518C;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x7BA1;&#x7406;&#x5458;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#xFF08;&#x6216;&#x7BA1;&#x7406;&#x5458;REST&#x7AEF;&#x70B9;&#xFF09;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x5BA2;&#x6237;&#x7AEF;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Keycloak&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x81EA;&#x5DF1;&#x3002;</p>
<p>&#x5BA2;&#x6237;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x4E3A;Keycloak&#x5BA2;&#x6237;&#x7AEF;&#x8868;&#x793A;&#xFF0C;OpenID Connect&#x5BA2;&#x6237;&#x7AEF;&#x5143;&#x6570;&#x636E;&#x548C;SAML&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x652F;&#x6301;&#x3002; &#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x7AEF;&#x70B9;&#x662F;<code>/auth/realms/&lt;realm&gt;/clients-registrations/&lt;provider&gt;</code>&#x3002;</p>
<p>&#x5185;&#x7F6E;&#x652F;&#x6301;&#x7684;<code>providers</code>&#x662F;&#xFF1A;</p>
<ul>
<li>default - Keycloak&#x5BA2;&#x6237;&#x7AEF;&#x8868;&#x793A; (JSON)</li>
<li>install - Keycloak&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E; (JSON)</li>
<li>openid-connect - OpenID Connect&#x5BA2;&#x6237;&#x7AEF;&#x5143;&#x6570;&#x636E;&#x63CF;&#x8FF0; (JSON)</li>
<li>saml2-entity-descriptor - SAML&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26; (XML)</li>
</ul>
<p>&#x4EE5;&#x4E0B;&#x90E8;&#x5206;&#x5C06;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x3002;</p>
<p><a name="243____5_1__&#x8BA4;&#x8BC1;"></a></p>
<h3 id="51-&#x8BA4;&#x8BC1;"><a name="51-&#x8BA4;&#x8BC1;" class="anchor-navigation-ex-anchor" href="#51-&#x8BA4;&#x8BC1;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1. &#x8BA4;&#x8BC1;</h3>
<p>&#x8981;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x4EE4;&#x724C;&#x3002; &#x4EE4;&#x724C;&#x53EF;&#x4EE5;&#x662F;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#xFF0C;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x6216;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x6709;&#x4E00;&#x79CD;&#x66FF;&#x4EE3;&#x65B9;&#x6848;&#x53EF;&#x4EE5;&#x5728;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4EE4;&#x724C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x6CE8;&#x518C;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4F46;&#x662F;&#x60A8;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x7B56;&#x7565;&#xFF08;&#x89C1;&#x4E0B;&#x6587;&#xFF09;&#x3002;</p>
<p><a name="244_____5_1_1__&#x627F;&#x8F7D;&#x4EE4;&#x724C;"></a></p>
<h4 id="511-&#x627F;&#x8F7D;&#x4EE4;&#x724C;"><a name="511-&#x627F;&#x8F7D;&#x4EE4;&#x724C;" class="anchor-navigation-ex-anchor" href="#511-&#x627F;&#x8F7D;&#x4EE4;&#x724C;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1.1. &#x627F;&#x8F7D;&#x4EE4;&#x724C;</h4>
<p>&#x53EF;&#x4EE5;&#x4EE3;&#x8868;&#x7528;&#x6237;&#x6216;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x53D1;&#x51FA;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x3002; &#x8C03;&#x7528;&#x7AEF;&#x70B9;&#x9700;&#x8981;&#x4EE5;&#x4E0B;&#x6743;&#x9650;&#xFF08;&#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_admin/" target="_blank">&#x670D;&#x52A1;&#x5668;&#x7BA1;&#x7406;&#x6307;&#x5357;</a> for more details)&#xFF09;&#xFF1A;</p>
<ul>
<li>create-client&#x6216;manage-client  - &#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;</li>
<li>view-client&#x6216;manage-client  - &#x67E5;&#x770B;&#x5BA2;&#x6237;&#x7AEF;</li>
<li>manage-client  - &#x66F4;&#x65B0;&#x6216;&#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;</li>
</ul>
<p>&#x5982;&#x679C;&#x60A8;&#x4F7F;&#x7528;&#x4E0D;&#x8BB0;&#x540D;&#x4EE4;&#x724C;&#x6765;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x4EC5;&#x5177;&#x6709;&#x201C;create-client&#x201D;&#x89D2;&#x8272;&#x7684;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x4E2D;&#x7684;&#x4EE4;&#x724C;&#xFF08;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_admin/" target="_blank">&#x670D;&#x52A1;&#x5668;&#x7BA1;&#x7406;&#x6307;&#x5357;</a>&#x4E86;&#x89E3;&#x66F4;&#x591A;&#x8BE6;&#x60C5;&#xFF09;&#x3002;</p>
<p><a name="245_____5_1_2__&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"></a></p>
<h4 id="512-&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"><a name="512-&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;" class="anchor-navigation-ex-anchor" href="#512-&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1.2. &#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</h4>
<p>&#x6CE8;&#x518C;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x63A8;&#x8350;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x53EA;&#x80FD;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5E76;&#x4E14;&#x5177;&#x6709;&#x53EF;&#x914D;&#x7F6E;&#x7684;&#x5230;&#x671F;&#x65F6;&#x95F4;&#x4EE5;&#x53CA;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x6570;&#x91CF;&#x7684;&#x53EF;&#x914D;&#x7F6E;&#x9650;&#x5236;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x521B;&#x5EFA;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x8981;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x9996;&#x5148;&#x5728;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x9009;&#x62E9;&#x57DF;&#xFF0C;&#x7136;&#x540E;&#x5355;&#x51FB;&#x5DE6;&#x4FA7;&#x83DC;&#x5355;&#x4E2D;&#x7684;<code>Realm Settings</code>&#xFF0C;&#x7136;&#x540E;&#x5355;&#x51FB;&#x9875;&#x9762;&#x4E2D;&#x663E;&#x793A;&#x7684;&#x9009;&#x9879;&#x5361;&#x4E2D;&#x7684;<code>Client Registration</code>&#x3002; &#x7136;&#x540E;&#x6700;&#x540E;&#x70B9;&#x51FB;<code>Initial Access Tokens</code>&#x5B50;&#x6807;&#x7B7E;&#x3002;</p>
<p>&#x60A8;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4EFB;&#x4F55;&#x73B0;&#x6709;&#x7684;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x5982;&#x679C;&#x60A8;&#x6709;&#x6743;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x7684;&#x4EE4;&#x724C;&#x3002; &#x60A8;&#x53EA;&#x80FD;&#x5728;&#x521B;&#x5EFA;&#x4EE4;&#x724C;&#x65F6;&#x68C0;&#x7D22;&#x4EE4;&#x724C;&#x7684;&#x503C;&#x3002; &#x8981;&#x521B;&#x5EFA;&#x65B0;&#x6807;&#x8BB0;&#xFF0C;&#x8BF7;&#x5355;&#x51FB;<code>Create</code>&#x3002; &#x60A8;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x6DFB;&#x52A0;&#x4EE4;&#x724C;&#x6709;&#x6548;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE4;&#x724C;&#x521B;&#x5EFA;&#x591A;&#x5C11;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x5355;&#x51FB;<code>Save</code>&#x540E;&#xFF0C;&#x5C06;&#x663E;&#x793A;&#x6807;&#x8BB0;&#x503C;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x590D;&#x5236;/&#x7C98;&#x8D34;&#x6B64;&#x4EE4;&#x724C;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x56E0;&#x4E3A;&#x4EE5;&#x540E;&#x60A8;&#x5C06;&#x65E0;&#x6CD5;&#x68C0;&#x7D22;&#x5B83;&#x3002; &#x5982;&#x679C;&#x60A8;&#x5FD8;&#x8BB0;&#x590D;&#x5236;/&#x7C98;&#x8D34;&#x5B83;&#xFF0C;&#x5219;&#x5220;&#x9664;&#x4EE4;&#x724C;&#x5E76;&#x521B;&#x5EFA;&#x53E6;&#x4E00;&#x4E2A;&#x4EE4;&#x724C;&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x6DFB;&#x52A0;&#x5230;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;Authorization&#x6807;&#x5934;&#xFF0C;&#x4EE4;&#x724C;&#x503C;&#x5728;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x65F6;&#x7528;&#x4F5C;&#x6807;&#x51C6;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x3002; &#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code>Authorization: bearer eyJhbGciOiJSUz...
</code></pre><p><a name="246_____5_1_3__&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"></a></p>
<h4 id="513-&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"><a name="513-&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;" class="anchor-navigation-ex-anchor" href="#513-&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1.3. &#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</h4>
<p>&#x901A;&#x8FC7;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x65F6;&#xFF0C;&#x54CD;&#x5E94;&#x5C06;&#x5305;&#x62EC;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x63D0;&#x4F9B;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x4EE5;&#x4FBF;&#x7A0D;&#x540E;&#x68C0;&#x7D22;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x66F4;&#x65B0;&#x6216;&#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x4EE5;&#x4E0E;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x6216;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x5305;&#x542B;&#x5728;&#x8BF7;&#x6C42;&#x4E2D;&#x3002; &#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x4EC5;&#x6709;&#x6548;&#x4E00;&#x6B21;&#xFF0C;&#x5F53;&#x4F7F;&#x7528;&#x65F6;&#xFF0C;&#x54CD;&#x5E94;&#x5C06;&#x5305;&#x542B;&#x65B0;&#x4EE4;&#x724C;&#x3002;</p>
<p>&#x5982;&#x679C;&#x5BA2;&#x6237;&#x7AEF;&#x662F;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x4E4B;&#x5916;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x5219;&#x5B83;&#x5C06;&#x6CA1;&#x6709;&#x4E0E;&#x4E4B;&#x5173;&#x8054;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x3002; &#x5982;&#x679C;&#x60A8;&#x4E22;&#x5931;&#x7279;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4EE4;&#x724C;&#xFF0C;&#x8FD9;&#x4E5F;&#x5F88;&#x6709;&#x7528;&#x3002; &#x8981;&#x521B;&#x5EFA;&#x65B0;&#x4EE4;&#x724C;&#xFF0C;&#x8BF7;&#x5728;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x627E;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7136;&#x540E;&#x5355;&#x51FB;<code>Credentials</code>&#x3002; &#x7136;&#x540E;&#x5355;&#x51FB;<code>Generate registration access token</code>&#x3002;</p>
<p><a name="247____5_2__Keycloak&#x8868;&#x793A;"></a></p>
<h3 id="52-keycloak&#x8868;&#x793A;"><a name="52-keycloak&#x8868;&#x793A;" class="anchor-navigation-ex-anchor" href="#52-keycloak&#x8868;&#x793A;"><i class="fa fa-link" aria-hidden="true"></i></a>5.2. Keycloak&#x8868;&#x793A;</h3>
<p><code>default</code>&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x53EF;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#xFF0C;&#x68C0;&#x7D22;&#xFF0C;&#x66F4;&#x65B0;&#x548C;&#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x5B83;&#x4F7F;&#x7528;Keycloak&#x5BA2;&#x6237;&#x7AEF;&#x8868;&#x793A;&#x683C;&#x5F0F;&#xFF0C;&#x8BE5;&#x683C;&#x5F0F;&#x4E3A;&#x901A;&#x8FC7;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x914D;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4F9B;&#x4E86;&#x5B8C;&#x5168;&#x914D;&#x7F6E;&#x652F;&#x6301;&#xFF0C;&#x5305;&#x62EC;&#x914D;&#x7F6E;&#x534F;&#x8BAE;&#x6620;&#x5C04;&#x5668;&#x3002;</p>
<p>&#x8981;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8BF7;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x8868;&#x793A;&#xFF08;JSON&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5BF9;<code>/auth/realms/&lt;realm&gt;/clients-registrations/default</code>&#x6267;&#x884C;HTTP POST&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x5B83;&#x5C06;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x8868;&#x793A;&#xFF0C;&#x5176;&#x4E2D;&#x8FD8;&#x5305;&#x62EC;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x5982;&#x679C;&#x8981;&#x7A0D;&#x540E;&#x68C0;&#x7D22;&#x914D;&#x7F6E;&#xFF0C;&#x66F4;&#x65B0;&#x6216;&#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5219;&#x5E94;&#x5C06;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x4FDD;&#x5B58;&#x5728;&#x67D0;&#x5904;&#x3002;</p>
<p>&#x8981;&#x68C0;&#x7D22;&#x5BA2;&#x6237;&#x7AEF;&#x8868;&#x793A;&#xFF0C;&#x8BF7;&#x5BF9;<code>/auth/realms/&lt;realm&gt;/clients-registrations/default/&lt;client id&gt;</code>&#x6267;&#x884C;HTTP GET&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x5B83;&#x8FD8;&#x5C06;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;</p>
<p>&#x8981;&#x66F4;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x8868;&#x793A;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;&#x66F4;&#x65B0;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8868;&#x793A;&#x6267;&#x884C;HTTP PUT&#x8BF7;&#x6C42;&#xFF1A;<code>/auth/realms/&lt;realm&gt;/clients-registrations/default/&lt;client id&gt;</code>&#x3002;</p>
<p>&#x5B83;&#x8FD8;&#x5C06;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;</p>
<p>&#x8981;&#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;&#x8868;&#x793A;&#xFF0C;&#x8BF7;&#x6267;&#x884C;HTTP DELETE&#x8BF7;&#x6C42;&#xFF1A;<code>/auth/realms/&lt;realm&gt;/clients-registrations/default/&lt;client id&gt;</code></p>
<p><a name="248____5_3__Keycloak&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;"></a></p>
<h3 id="53-keycloak&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;"><a name="53-keycloak&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#53-keycloak&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>5.3. Keycloak&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;</h3>
<p><code>installation</code>&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x53EF;&#x7528;&#x4E8E;&#x68C0;&#x7D22;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x3002; &#x9664;&#x4E86;&#x4EE4;&#x724C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;HTTP&#x57FA;&#x672C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5BF9;&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x636E;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x4E3A;&#x6B64;&#xFF0C;&#x8BF7;&#x5728;&#x8BF7;&#x6C42;&#x4E2D;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x6807;&#x5934;&#xFF1A;</p>
<pre><code>Authorization: basic BASE64(client-id + &apos;:&apos; + client-secret)
</code></pre><p>&#x8981;&#x68C0;&#x7D22;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#xFF0C;&#x7136;&#x540E;&#x5BF9;<code>/auth/realms/&lt;realm&gt;/clients-registrations/install/&lt;client id&gt;</code>&#x6267;&#x884C;HTTP GET&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x516C;&#x5171;&#x5BA2;&#x6237;&#x7AEF;&#x65E0;&#x9700;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x8FD9;&#x610F;&#x5473;&#x7740;&#x5BF9;&#x4E8E;JavaScript&#x9002;&#x914D;&#x5668;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0A;&#x8FF0;URL&#x76F4;&#x63A5;&#x4ECE;Keycloak&#x52A0;&#x8F7D;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x3002;</p>
<p><a name="249____5_4__OpenID&#x8FDE;&#x63A5;&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;"></a></p>
<h3 id="54-openid&#x8FDE;&#x63A5;&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;"><a name="54-openid&#x8FDE;&#x63A5;&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;" class="anchor-navigation-ex-anchor" href="#54-openid&#x8FDE;&#x63A5;&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;"><i class="fa fa-link" aria-hidden="true"></i></a>5.4. OpenID&#x8FDE;&#x63A5;&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;</h3>
<p>Keycloak&#x5B9E;&#x73B0;&#x4E86;<a href="https://openid.net/specs/openid-connect-registration-1_0.html" target="_blank">OpenID Connect&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;</a>&#xFF0C;&#x5B83;&#x6269;&#x5C55;&#x4E86;<a href="https://tools.ietf.org/html/rfc7591" target="_blank">OAuth 2.0&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x534F;&#x8BAE;</a>&#x548C;<a href="https://tools.ietf.org/html/rfc7592" target="_blank">OAuth 2.0&#x52A8;&#x6001;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x7BA1;&#x7406;&#x534F;&#x8BAE;</a>&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x89C4;&#x8303;&#x5728;Keycloak&#x4E2D;&#x6CE8;&#x518C;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x7AEF;&#x70B9;&#x662F;<code>/auth/realms/&lt;realm&gt;/clients-registrations/openid-connect[/&lt;client id&gt;]</code>&#x3002;</p>
<p>&#x6B64;&#x7AEF;&#x70B9;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x57DF;&#x7684;OpenID Connect Discovery&#x7AEF;&#x70B9;&#x4E2D;&#x627E;&#x5230;&#xFF0C;<code>/auth/realms/&lt;realm&gt;/.well-known/openid-configuration</code>&#x3002;</p>
<p><a name="250____5_5__SAML&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;"></a></p>
<h3 id="55-saml&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;"><a name="55-saml&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;" class="anchor-navigation-ex-anchor" href="#55-saml&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;"><i class="fa fa-link" aria-hidden="true"></i></a>5.5. SAML&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;</h3>
<p>SAML&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;&#x7AEF;&#x70B9;&#x4EC5;&#x652F;&#x6301;&#x4F7F;&#x7528;SAML v2&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;&#x6765;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x5B83;&#x4E0D;&#x652F;&#x6301;&#x68C0;&#x7D22;&#xFF0C;&#x66F4;&#x65B0;&#x6216;&#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x5BF9;&#x4E8E;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#xFF0C;&#x5E94;&#x4F7F;&#x7528;Keycloak&#x8868;&#x793A;&#x7AEF;&#x70B9;&#x3002; &#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x65F6;&#xFF0C;&#x5C06;&#x8FD4;&#x56DE;Keycloak Client Representation&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x6709;&#x5173;&#x5DF2;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x62EC;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;</p>
<p>&#x8981;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;SAML&#x5B9E;&#x4F53;&#x63CF;&#x8FF0;&#x7B26;&#x5BF9;<code>/auth/realms/&lt;realm&gt;/clients-registrations/saml2-entity-descriptor</code>&#x6267;&#x884C;HTTP POST&#x8BF7;&#x6C42;&#x3002;</p>
<p><a name="251____5_6__&#x4F7F;&#x7528;CURL&#x7684;&#x793A;&#x4F8B;"></a></p>
<h3 id="56-&#x4F7F;&#x7528;curl&#x7684;&#x793A;&#x4F8B;"><a name="56-&#x4F7F;&#x7528;curl&#x7684;&#x793A;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#56-&#x4F7F;&#x7528;curl&#x7684;&#x793A;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>5.6. &#x4F7F;&#x7528;CURL&#x7684;&#x793A;&#x4F8B;</h3>
<p>&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#x4F7F;&#x7528;CURL&#x4F7F;&#x7528;clientId<code>myclient</code>&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x60A8;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x6B63;&#x786E;&#x7684;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x6216;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x66FF;&#x6362;<code>eyJhbGciOiJSUz ...</code>&#x3002;</p>
<pre><code class="lang-bash">curl -X POST \
    <span class="hljs-_">-d</span> <span class="hljs-string">&apos;{ &quot;clientId&quot;: &quot;myclient&quot; }&apos;</span> \
    -H <span class="hljs-string">&quot;Content-Type:application/json&quot;</span> \
    -H <span class="hljs-string">&quot;Authorization: bearer eyJhbGciOiJSUz...&quot;</span> \
    http://localhost:8080/auth/realms/master/clients-registrations/default
</code></pre>
<p><a name="252____5_7__&#x4F7F;&#x7528;Java&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;API&#x7684;&#x793A;&#x4F8B;"></a></p>
<h3 id="57-&#x4F7F;&#x7528;java&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;api&#x7684;&#x793A;&#x4F8B;"><a name="57-&#x4F7F;&#x7528;java&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;api&#x7684;&#x793A;&#x4F8B;" class="anchor-navigation-ex-anchor" href="#57-&#x4F7F;&#x7528;java&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;api&#x7684;&#x793A;&#x4F8B;"><i class="fa fa-link" aria-hidden="true"></i></a>5.7. &#x4F7F;&#x7528;Java&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;API&#x7684;&#x793A;&#x4F8B;</h3>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;Java API&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Java&#x8F7B;&#x677E;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x3002; &#x8981;&#x4F7F;&#x7528;&#x5305;&#x542B;&#x6765;&#x81EA;Maven&#x7684;&#x4F9D;&#x8D56;&#x9879;<code>org.keycloak:keycloak-client-registration-api:&gt;VERSION&lt;</code>&#x3002;</p>
<p>&#x6709;&#x5173;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x7684;&#x5B8C;&#x6574;&#x8BF4;&#x660E;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;JavaDocs&#x3002; &#x4EE5;&#x4E0B;&#x662F;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x793A;&#x4F8B;&#x3002; &#x60A8;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x6B63;&#x786E;&#x7684;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x6216;&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x66FF;&#x6362;<code>eyJhbGciOiJSUz ...</code>&#x3002;</p>
<pre><code class="lang-java">String token = <span class="hljs-string">&quot;eyJhbGciOiJSUz...&quot;</span>;

ClientRepresentation client = <span class="hljs-keyword">new</span> ClientRepresentation();
client.setClientId(CLIENT_ID);

ClientRegistration reg = ClientRegistration.create()
    .url(<span class="hljs-string">&quot;http://localhost:8080/auth&quot;</span>, <span class="hljs-string">&quot;myrealm&quot;</span>)
    .build();

reg.auth(Auth.token(token));

client = reg.create(client);

String registrationAccessToken = client.getRegistrationAccessToken();
</code></pre>
<p><a name="253____5_8__&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x653F;&#x7B56;"></a></p>
<h3 id="58-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x653F;&#x7B56;"><a name="58-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x653F;&#x7B56;" class="anchor-navigation-ex-anchor" href="#58-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x653F;&#x7B56;"><i class="fa fa-link" aria-hidden="true"></i></a>5.8. &#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x653F;&#x7B56;</h3>
<p>Keycloak&#x76EE;&#x524D;&#x652F;&#x6301;2&#x79CD;&#x65B9;&#x5F0F;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x5BA2;&#x6237;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x65B0;&#x5BA2;&#x6237;&#x3002;</p>
<ul>
<li>&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x8BF7;&#x6C42; - &#x6CE8;&#x518C;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x5FC5;&#x987B;&#x5305;&#x542B;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;<code>Initial Access Token(&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;)</code> &#x6216; <code>Bearer Token(&#x627F;&#x8F7D;&#x4EE4;&#x724C;)</code>&#x3002;</li>
<li>&#x533F;&#x540D;&#x8BF7;&#x6C42; - &#x6CE8;&#x518C;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x6839;&#x672C;&#x4E0D;&#x9700;&#x8981;&#x5305;&#x542B;&#x4EFB;&#x4F55;&#x4EE4;&#x724C;</li>
</ul>
<p>&#x533F;&#x540D;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x8BF7;&#x6C42;&#x662F;&#x975E;&#x5E38;&#x6709;&#x8DA3;&#x548C;&#x5F3A;&#x5927;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F46;&#x662F;&#x60A8;&#x901A;&#x5E38;&#x4E0D;&#x5E0C;&#x671B;&#x4EFB;&#x4F55;&#x4EBA;&#x80FD;&#x591F;&#x65E0;&#x4EFB;&#x4F55;&#x9650;&#x5236;&#x5730;&#x6CE8;&#x518C;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x201C;&#x5BA2;&#x6237;&#x6CE8;&#x518C;&#x7B56;&#x7565;SPI&#x201D;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x9650;&#x5236;&#x8C01;&#x53EF;&#x4EE5;&#x6CE8;&#x518C;&#x65B0;&#x5BA2;&#x6237;&#x4EE5;&#x53CA;&#x5728;&#x4F55;&#x79CD;&#x6761;&#x4EF6;&#x4E0B;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x5728;Keycloak&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5355;&#x51FB;<code>Client Registration(&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;)</code>&#x9009;&#x9879;&#x5361;&#xFF0C;&#x7136;&#x540E;&#x5355;&#x51FB;&#x201C;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x7B56;&#x7565;&#x201D;&#x5B50;&#x9009;&#x9879;&#x5361;&#x3002; &#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x60A8;&#x5C06;&#x770B;&#x5230;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x4E3A;&#x533F;&#x540D;&#x8BF7;&#x6C42;&#x914D;&#x7F6E;&#x4E86;&#x54EA;&#x4E9B;&#x7B56;&#x7565;&#xFF0C;&#x4EE5;&#x53CA;&#x4E3A;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x8BF7;&#x6C42;&#x914D;&#x7F6E;&#x4E86;&#x54EA;&#x4E9B;&#x7B56;&#x7565;&#x3002;</p>
<blockquote>
<p>&#x533F;&#x540D;&#x8BF7;&#x6C42;&#xFF08;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4EE4;&#x724C;&#x7684;&#x8BF7;&#x6C42;&#xFF09;&#x4EC5;&#x5141;&#x8BB8;&#x521B;&#x5EFA;&#xFF08;&#x6CE8;&#x518C;&#xFF09;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x60A8;&#x901A;&#x8FC7;&#x533F;&#x540D;&#x8BF7;&#x6C42;&#x6CE8;&#x518C;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x65F6;&#xFF0C;&#x54CD;&#x5E94;&#x5C06;&#x5305;&#x542B;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x8BE5;&#x4EE4;&#x724C;&#x5FC5;&#x987B;&#x7528;&#x4E8E;&#x7279;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BFB;&#x53D6;&#xFF0C;&#x66F4;&#x65B0;&#x6216;&#x5220;&#x9664;&#x8BF7;&#x6C42;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x4F7F;&#x7528;&#x533F;&#x540D;&#x6CE8;&#x518C;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x4E5F;&#x5C06;&#x53D7;&#x5230;&#x533F;&#x540D;&#x7B56;&#x7565;&#x7684;&#x7EA6;&#x675F;&#xFF01; &#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x5177;&#x6709;<code>Trusted Hosts(&#x53EF;&#x4FE1;&#x4E3B;&#x673A;)</code>&#x7B56;&#x7565;&#xFF0C;&#x5219;&#x66F4;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x4E5F;&#x9700;&#x8981;&#x6765;&#x81EA;&#x53EF;&#x4FE1;&#x4E3B;&#x673A;&#x3002; &#x53E6;&#x5916;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x66F4;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x53CA;&#x5B58;&#x5728;<code>Consent Required(&#x540C;&#x610F;&#x6240;&#x9700;)</code>&#x7B56;&#x7565;&#x65F6;&#xFF0C;&#x5C06;&#x4E0D;&#x5141;&#x8BB8;&#x7981;&#x7528;<code>Consent Required(&#x540C;&#x610F;&#x6240;&#x9700;)</code>&#x7B49;&#x3002;</p>
</blockquote>
<p>&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x6709;&#x8FD9;&#x4E9B;&#x7B56;&#x7565;&#x5B9E;&#x65BD;&#xFF1A;</p>
<ul>
<li>Trusted Hosts Policy(&#x53EF;&#x4FE1;&#x4E3B;&#x673A;&#x7B56;&#x7565;) - &#x60A8;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x53EF;&#x4FE1;&#x4E3B;&#x673A;&#x548C;&#x53EF;&#x4FE1;&#x57DF;&#x7684;&#x5217;&#x8868;&#x3002; &#x53EF;&#x4EE5;&#x4ECE;&#x8FD9;&#x4E9B;&#x4E3B;&#x673A;&#x6216;&#x57DF;&#x53D1;&#x9001;&#x5BF9;&#x5BA2;&#x6237;&#x6CE8;&#x518C;&#x670D;&#x52A1;&#x7684;&#x8BF7;&#x6C42;&#x3002; &#x67D0;&#x4E9B;&#x4E0D;&#x53D7;&#x4FE1;&#x4EFB;&#x7684;IP&#x53D1;&#x9001;&#x7684;&#x8BF7;&#x6C42;&#x5C06;&#x88AB;&#x62D2;&#x7EDD;&#x3002; &#x65B0;&#x6CE8;&#x518C;&#x5BA2;&#x6237;&#x7AEF;&#x7684;URL&#x4E5F;&#x5FC5;&#x987B;&#x4EC5;&#x4F7F;&#x7528;&#x90A3;&#x4E9B;&#x53EF;&#x4FE1;&#x4E3B;&#x673A;&#x6216;&#x57DF;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x4E0D;&#x5141;&#x8BB8;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x201C;&#x91CD;&#x5B9A;&#x5411;URI&#x201D;&#x8BBE;&#x7F6E;&#x4E3A;&#x6307;&#x5411;&#x67D0;&#x4E2A;&#x4E0D;&#x53D7;&#x4FE1;&#x4EFB;&#x7684;&#x4E3B;&#x673A;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5217;&#x5165;&#x767D;&#x540D;&#x5355;&#x7684;&#x4E3B;&#x673A;&#xFF0C;&#x56E0;&#x6B64;&#x4E8B;&#x5B9E;&#x4E0A;&#x7981;&#x7528;&#x533F;&#x540D;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x3002;</li>
<li>Consent Required Policy(&#x9700;&#x8981;&#x540C;&#x610F;&#x7B56;&#x7565;) - &#x65B0;&#x6CE8;&#x518C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x542F;&#x7528;<code>Consent Allowed(&#x5141;&#x8BB8;&#x540C;&#x610F;)</code>&#x5207;&#x6362;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x6210;&#x529F;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x540E;&#xFF0C;&#x7528;&#x6237;&#x5728;&#x9700;&#x8981;&#x6279;&#x51C6;&#x6743;&#x9650;&#xFF08;&#x5BA2;&#x6237;&#x7AEF;&#x8303;&#x56F4;&#xFF09;&#x65F6;&#x5C06;&#x59CB;&#x7EC8;&#x770B;&#x5230;&#x540C;&#x610F;&#x5C4F;&#x5E55;&#x3002; &#x8FD9;&#x610F;&#x5473;&#x7740;&#x9664;&#x975E;&#x7528;&#x6237;&#x6279;&#x51C6;&#xFF0C;&#x5426;&#x5219;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x4EFB;&#x4F55;&#x4E2A;&#x4EBA;&#x4FE1;&#x606F;&#x6216;&#x7528;&#x6237;&#x7684;&#x8BB8;&#x53EF;&#x3002;</li>
<li>Protocol Mappers Policy(&#x534F;&#x8BAE;&#x6620;&#x5C04;&#x5668;&#x7B56;&#x7565;) - &#x5141;&#x8BB8;&#x914D;&#x7F6E;&#x5217;&#x5165;&#x767D;&#x540D;&#x5355;&#x7684;&#x534F;&#x8BAE;&#x6620;&#x5C04;&#x5668;&#x5B9E;&#x73B0;&#x3002; &#x5982;&#x679C;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x975E;&#x767D;&#x540D;&#x5355;&#x7684;&#x534F;&#x8BAE;&#x6620;&#x5C04;&#x5668;&#xFF0C;&#x5219;&#x65E0;&#x6CD5;&#x6CE8;&#x518C;&#x6216;&#x66F4;&#x65B0;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x6B64;&#x7B56;&#x7565;&#x4E5F;&#x7528;&#x4E8E;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x56E0;&#x6B64;&#x5373;&#x4F7F;&#x5BF9;&#x4E8E;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x4E5F;&#x5B58;&#x5728;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x534F;&#x8BAE;&#x6620;&#x5C04;&#x5668;&#x7684;&#x4E00;&#x4E9B;&#x9650;&#x5236;&#x3002;</li>
<li>Client Scope Policy(&#x5BA2;&#x6237;&#x7AEF;&#x8303;&#x56F4;&#x7B56;&#x7565;) - &#x5141;&#x8BB8;&#x5C06;<code>Client Scopes(&#x5BA2;&#x6237;&#x7AEF;&#x8303;&#x56F4;)</code>&#x5217;&#x5165;&#x767D;&#x540D;&#x5355;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0E;&#x65B0;&#x6CE8;&#x518C;&#x6216;&#x66F4;&#x65B0;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6CA1;&#x6709;&#x5217;&#x5165;&#x767D;&#x540D;&#x5355;&#x7684;&#x8303;&#x56F4;; &#x53EA;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x4F5C;&#x7528;&#x57DF;&#xFF08;&#x5B9A;&#x4E49;&#x4E3A;<code>Realm Default Client Scopes</code>&#xFF09;&#x9ED8;&#x8BA4;&#x5217;&#x5165;&#x767D;&#x540D;&#x5355;&#x3002;</li>
<li>Full Scope Policy(&#x5168;&#x8303;&#x56F4;&#x7B56;&#x7565;) - &#x65B0;&#x6CE8;&#x518C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x7981;&#x7528;<code>Full Scope Allowed(&#x5141;&#x8BB8;&#x5168;&#x8303;&#x56F4;)</code>&#x5F00;&#x5173;&#x3002; &#x8FD9;&#x610F;&#x5473;&#x7740;&#x4ED6;&#x4EEC;&#x5C06;&#x4E0D;&#x5177;&#x6709;&#x4EFB;&#x4F55;&#x4F5C;&#x7528;&#x57DF;&#x9886;&#x57DF;&#x89D2;&#x8272;&#x6216;&#x5176;&#x4ED6;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5BA2;&#x6237;&#x89D2;&#x8272;&#x3002;</li>
<li>Max Clients Policy(&#x6700;&#x5927;&#x5BA2;&#x6237;&#x7AEF;&#x7B56;&#x7565;) - &#x5982;&#x679C;&#x57DF;&#x4E2D;&#x7684;&#x5F53;&#x524D;&#x5BA2;&#x6237;&#x7AEF;&#x6570;&#x91CF;&#x5927;&#x4E8E;&#x6307;&#x5B9A;&#x9650;&#x5236;&#xFF0C;&#x5219;&#x62D2;&#x7EDD;&#x6CE8;&#x518C;&#x3002; &#x533F;&#x540D;&#x6CE8;&#x518C;&#x9ED8;&#x8BA4;&#x4E3A;200&#x3002;</li>
<li>Client Disabled Policy(&#x5BA2;&#x6237;&#x7AEF;&#x5DF2;&#x7981;&#x7528;&#x7B56;&#x7565;) - &#x5C06;&#x7981;&#x7528;&#x65B0;&#x6CE8;&#x518C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x8FD9;&#x610F;&#x5473;&#x7740;&#x7BA1;&#x7406;&#x5458;&#x9700;&#x8981;&#x624B;&#x52A8;&#x6279;&#x51C6;&#x5E76;&#x542F;&#x7528;&#x6240;&#x6709;&#x65B0;&#x6CE8;&#x518C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x5373;&#x4F7F;&#x662F;&#x533F;&#x540D;&#x6CE8;&#x518C;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x6B64;&#x7B56;&#x7565;&#x3002;</li>
</ul>
<p><a name="254___6__&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;_CLI"></a></p>
<h2 id="6-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;-cli"><a name="6-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;-cli" class="anchor-navigation-ex-anchor" href="#6-&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;-cli"><i class="fa fa-link" aria-hidden="true"></i></a>6. &#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C; CLI</h2>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x662F;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x884C;&#x754C;&#x9762;&#xFF08;CLI&#xFF09;&#x5DE5;&#x5177;&#xFF0C;&#x4F9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5728;&#x4E0E;Keycloak&#x96C6;&#x6210;&#x65F6;&#x4EE5;&#x81EA;&#x52A9;&#x670D;&#x52A1;&#x65B9;&#x5F0F;&#x914D;&#x7F6E;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x5B83;&#x4E13;&#x95E8;&#x8BBE;&#x8BA1;&#x7528;&#x4E8E;&#x4E0E;Keycloak&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;REST&#x7AEF;&#x70B9;&#x4EA4;&#x4E92;&#x3002;</p>
<p>&#x5FC5;&#x987B;&#x4E3A;&#x4EFB;&#x4F55;&#x80FD;&#x591F;&#x4F7F;&#x7528;Keycloak&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x521B;&#x5EFA;&#x6216;&#x83B7;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x3002; &#x60A8;&#x901A;&#x5E38;&#x4E3A;&#x6258;&#x7BA1;&#x5728;&#x552F;&#x4E00;&#x4E3B;&#x673A;&#x540D;&#x4E0A;&#x7684;&#x6BCF;&#x4E2A;&#x65B0;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x914D;&#x7F6E;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x5F53;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E0E;Keycloak&#x4EA4;&#x4E92;&#x65F6;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;ID&#x8BC6;&#x522B;&#x81EA;&#x8EAB;&#xFF0C;&#x56E0;&#x6B64;Keycloak&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x767B;&#x5F55;&#x9875;&#x9762;&#xFF0C;&#x5355;&#x70B9;&#x767B;&#x5F55;&#xFF08;SSO&#xFF09;&#x4F1A;&#x8BDD;&#x7BA1;&#x7406;&#x548C;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x3002;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#x914D;&#x7F6E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5728;shell&#x811A;&#x672C;&#x4E2D;&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x5141;&#x8BB8;&#x7279;&#x5B9A;&#x7528;&#x6237;&#x4F7F;&#x7528;<code>&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI</code>&#xFF0C;Keycloak&#x7BA1;&#x7406;&#x5458;&#x901A;&#x5E38;&#x4F7F;&#x7528;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x914D;&#x7F6E;&#x5177;&#x6709;&#x9002;&#x5F53;&#x89D2;&#x8272;&#x7684;&#x65B0;&#x7528;&#x6237;&#xFF0C;&#x6216;&#x8005;&#x914D;&#x7F6E;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x4EE5;&#x6388;&#x4E88;&#x5BF9;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;REST API&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x3002;</p>
<p><a name="255____6_1__&#x914D;&#x7F6E;&#x65B0;&#x5E38;&#x89C4;&#x7528;&#x6237;&#x4EE5;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI"></a></p>
<h3 id="61-&#x914D;&#x7F6E;&#x65B0;&#x5E38;&#x89C4;&#x7528;&#x6237;&#x4EE5;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli"><a name="61-&#x914D;&#x7F6E;&#x65B0;&#x5E38;&#x89C4;&#x7528;&#x6237;&#x4EE5;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli" class="anchor-navigation-ex-anchor" href="#61-&#x914D;&#x7F6E;&#x65B0;&#x5E38;&#x89C4;&#x7528;&#x6237;&#x4EE5;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli"><i class="fa fa-link" aria-hidden="true"></i></a>6.1. &#x914D;&#x7F6E;&#x65B0;&#x5E38;&#x89C4;&#x7528;&#x6237;&#x4EE5;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI</h3>
<ol>
<li><p>&#x4EE5;<code>admin</code>&#x8EAB;&#x4EFD;&#x767B;&#x5F55;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#xFF08;&#x4F8B;&#x5982;<a href="http://localhost:8080/auth/admin" target="_blank">http://localhost:8080/auth/admin</a>&#xFF09;&#x3002;</p>
</li>
<li><p>&#x9009;&#x62E9;&#x8981;&#x7BA1;&#x7406;&#x7684;&#x9886;&#x57DF;&#x3002;</p>
</li>
<li><p>&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;&#x73B0;&#x6709;&#x7528;&#x6237;&#xFF0C;&#x8BF7;&#x9009;&#x62E9;&#x8981;&#x7F16;&#x8F91;&#x7684;&#x7528;&#x6237;; &#x5426;&#x5219;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7528;&#x6237;&#x3002;</p>
</li>
<li><p>&#x9009;&#x62E9;<strong>Role Mappings &gt; Client Roles &gt; realm-management</strong>&#x3002; &#x5982;&#x679C;&#x60A8;&#x5728;&#x4E3B;&#x57DF;&#x4E2D;&#xFF0C;&#x8BF7;&#x9009;&#x62E9;<strong>NAME-realm</strong>&#xFF0C;&#x5176;&#x4E2D;<code>NAME</code>&#x662F;&#x76EE;&#x6807;&#x57DF;&#x7684;&#x540D;&#x79F0;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x5411;&#x4E3B;&#x57DF;&#x4E2D;&#x7684;&#x7528;&#x6237;&#x6388;&#x4E88;&#x5BF9;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x57DF;&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x3002;</p>
</li>
<li><p>&#x9009;&#x62E9;<strong>Available Roles&gt;manage-client</strong>&#x4EE5;&#x6388;&#x4E88;&#x4E00;&#x6574;&#x5957;&#x5BA2;&#x6237;&#x7AEF;&#x7BA1;&#x7406;&#x6743;&#x9650;&#x3002; &#x53E6;&#x4E00;&#x4E2A;&#x9009;&#x62E9;&#x662F;&#x9009;&#x62E9;<strong>view-clients</strong>&#x4E3A;&#x53EA;&#x8BFB;&#x6216;<strong>create-client</strong>&#x6765;&#x521B;&#x5EFA;&#x65B0;&#x5BA2;&#x6237;&#x3002;</p>
<blockquote>
<p>&#x8FD9;&#x4E9B;&#x6743;&#x9650;&#x6388;&#x4E88;&#x7528;&#x6237;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x4F7F;&#x7528;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_initial_access_token" target="_blank">&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</a>&#x6216;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_registration_access_token" target="_blank">&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</a>&#x3002;</p>
</blockquote>
</li>
</ol>
<p>&#x53EF;&#x4EE5;&#x4E0D;&#x5411;&#x7528;&#x6237;&#x5206;&#x914D;&#x4EFB;&#x4F55;<code>realm-management</code>&#x89D2;&#x8272;&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7528;&#x6237;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x767B;&#x5F55;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x5219;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x5B83;&#x3002; &#x5C1D;&#x8BD5;&#x5728;&#x6CA1;&#x6709;&#x4EE4;&#x724C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x6267;&#x884C;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;&#x4F1A;&#x5BFC;&#x81F4;<strong>403 Forbidden</strong>&#x9519;&#x8BEF;&#x3002;</p>
<p>&#x7BA1;&#x7406;&#x5458;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>Realm Settings &gt; Client Registration &gt; Initial Access Token</strong>&#x83DC;&#x5355;&#x4ECE;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x53D1;&#x51FA;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;</p>
<p><a name="256____6_2__&#x914D;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x4E00;&#x8D77;&#x4F7F;&#x7528;"></a></p>
<h3 id="62-&#x914D;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli&#x4E00;&#x8D77;&#x4F7F;&#x7528;"><a name="62-&#x914D;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli&#x4E00;&#x8D77;&#x4F7F;&#x7528;" class="anchor-navigation-ex-anchor" href="#62-&#x914D;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli&#x4E00;&#x8D77;&#x4F7F;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>6.2. &#x914D;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x4E00;&#x8D77;&#x4F7F;&#x7528;</h3>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x8BC6;&#x522B;&#x4E3A;<code>admin-cli</code>&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8BE5;&#x5BA2;&#x6237;&#x7AEF;&#x4E3A;&#x6BCF;&#x4E2A;&#x65B0;&#x57DF;&#x81EA;&#x52A8;&#x914D;&#x7F6E;&#x3002; &#x4F7F;&#x7528;&#x7528;&#x6237;&#x540D;&#x767B;&#x5F55;&#x65F6;&#x65E0;&#x9700;&#x5176;&#x4ED6;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x3002;</p>
<ol>
<li>&#x5982;&#x679C;&#x8981;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x4F7F;&#x7528;&#x5355;&#x72EC;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#xFF0C;&#x8BF7;&#x521B;&#x5EFA;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;<code>reg-cli</code>&#xFF09;&#x3002;</li>
<li>&#x5207;&#x6362;<strong>Standard Flow Enabled</strong>&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;<strong>Off</strong>&#x3002;</li>
<li>&#x901A;&#x8FC7;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;<code>Access Type</code>&#x914D;&#x7F6E;&#x4E3A;<code>Confidential</code>&#x5E76;&#x9009;&#x62E9;<strong>Credentials &gt; ClientId and Secret</strong>&#x6765;&#x52A0;&#x5F3A;&#x5B89;&#x5168;&#x6027;&#x3002;</li>
</ol>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x5728;<strong>Credentials</strong>&#x9009;&#x9879;&#x5361;&#x4E0B;&#x914D;&#x7F6E;<code>Client Id and Secret</code>&#x6216;<code>Signed JWT</code>&#x3002;</p>
<ol>
<li>&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x5173;&#x8054;&#x7684;&#x670D;&#x52A1;&#x5E10;&#x6237;&#xFF0C;&#x8BF7;&#x901A;&#x8FC7;&#x5728;<code>Admin Console</code>&#x7684;<strong>Clients</strong>&#x90E8;&#x5206;&#x4E2D;&#x9009;&#x62E9;&#x8981;&#x7F16;&#x8F91;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x542F;&#x7528;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x3002;<ol>
<li>&#x5728;<strong>Settings</strong>&#x4E0B;&#xFF0C;&#x5C06;<strong>Access Type</strong>&#x66F4;&#x6539;&#x4E3A;<strong>Confidential</strong>&#xFF0C;&#x5C06;<strong>Service Accounts Enabled</strong>&#x8BBE;&#x7F6E;&#x5207;&#x6362;&#x4E3A;<strong>On</strong>&#xFF0C;&#x7136;&#x540E;&#x5355;&#x51FB;<strong>Save</strong>&#x3002;</li>
<li>&#x5355;&#x51FB;<strong>Service Account Roles</strong>&#x5E76;&#x9009;&#x62E9;&#x6240;&#x9700;&#x89D2;&#x8272;&#x4EE5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x3002; &#x6709;&#x5173;&#x8981;&#x9009;&#x62E9;&#x7684;&#x89D2;&#x8272;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_configuring_a_user_for_client_registration_cli" target="_blank">&#x914D;&#x7F6E;&#x7528;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x7684;&#x65B0;&#x5E38;&#x89C4;&#x7528;&#x6237;</a>&#x3002;</li>
</ol>
</li>
<li>&#x5207;&#x6362;<strong>Direct Access Grants Enabled</strong>&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;<strong>On</strong>&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x8981;&#x4F7F;&#x7528;&#x5E38;&#x89C4;&#x7528;&#x6237;&#x5E10;&#x6237;&#x800C;&#x4E0D;&#x662F;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x3002;</li>
<li>&#x5982;&#x679C;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x4E3A;<code>Confidential</code>&#xFF0C;&#x5219;&#x5728;&#x4F7F;&#x7528;<code>--secret</code>&#x9009;&#x9879;&#x8FD0;&#x884C;<code>kcreg config credentials</code>&#x65F6;&#x63D0;&#x4F9B;&#x5DF2;&#x914D;&#x7F6E;&#x7684;&#x673A;&#x5BC6;&#x3002;</li>
<li>&#x5728;&#x8FD0;&#x884C;<code>kcreg config credentials</code>&#x65F6;&#x6307;&#x5B9A;&#x8981;&#x4F7F;&#x7528;&#x7684;<code>clientId</code>&#xFF08;&#x4F8B;&#x5982;&#xFF0C;<code>--client reg-cli</code>&#xFF09;&#x3002;</li>
<li>&#x542F;&#x7528;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x540E;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x8FD0;&#x884C;<code>kcreg config credentials</code>&#x65F6;&#x7701;&#x7565;&#x6307;&#x5B9A;&#x7528;&#x6237;&#xFF0C;&#x5E76;&#x4EC5;&#x63D0;&#x4F9B;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x6216;&#x5BC6;&#x94A5;&#x5E93;&#x4FE1;&#x606F;&#x3002;</li>
</ol>
<p><a name="257____6_3__&#x5B89;&#x88C5;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI"></a></p>
<h3 id="63-&#x5B89;&#x88C5;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli"><a name="63-&#x5B89;&#x88C5;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli" class="anchor-navigation-ex-anchor" href="#63-&#x5B89;&#x88C5;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli"><i class="fa fa-link" aria-hidden="true"></i></a>6.3. &#x5B89;&#x88C5;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI</h3>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x6253;&#x5305;&#x5728;Keycloak Server&#x53D1;&#x884C;&#x7248;&#x4E2D;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x5728;<code>bin</code>&#x76EE;&#x5F55;&#x4E2D;&#x627E;&#x5230;&#x6267;&#x884C;&#x811A;&#x672C;&#x3002; Linux&#x811A;&#x672C;&#x79F0;&#x4E3A;<code>kcreg.sh</code>&#xFF0C;Windows&#x811A;&#x672C;&#x79F0;&#x4E3A;<code>kcreg.bat</code>&#x3002;</p>
<p>&#x5728;&#x8BBE;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x4FBF;&#x4ECE;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x4EFB;&#x4F55;&#x4F4D;&#x7F6E;&#x4F7F;&#x7528;&#x65F6;&#xFF0C;&#x5C06;Keycloak&#x670D;&#x52A1;&#x5668;&#x76EE;&#x5F55;&#x6DFB;&#x52A0;&#x5230;<code>PATH</code>&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#xFF1A;</p>
<ul>
<li>Linux:</li>
</ul>
<pre><code class="lang-bash">$ <span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$KEYCLOAK_HOME</span>/bin
$ kcreg.sh
</code></pre>
<ul>
<li>Windows:</li>
</ul>
<pre><code class="lang-bash">c:\&gt; <span class="hljs-built_in">set</span> PATH=%PATH%;%KEYCLOAK_HOME%\bin
c:\&gt; kcreg
</code></pre>
<p><code>KEYCLOAK_HOME</code>&#x6307;&#x7684;&#x662F;&#x89E3;&#x538B;&#x7F29;Keycloak Server&#x5206;&#x53D1;&#x7684;&#x76EE;&#x5F55;&#x3002;</p>
<p><a name="258____6_4__&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI"></a></p>
<h3 id="64-&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli"><a name="64-&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli" class="anchor-navigation-ex-anchor" href="#64-&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;cli"><i class="fa fa-link" aria-hidden="true"></i></a>6.4. &#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI</h3>
<ol>
<li><p>&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x60A8;&#x7684;&#x51ED;&#x636E;&#x767B;&#x5F55;&#x6765;&#x542F;&#x52A8;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x4F1A;&#x8BDD;&#x3002;</p>
</li>
<li><p>&#x5728;<code>Client Registration REST</code>&#x7AEF;&#x70B9;&#x4E0A;&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#xFF1A;</p>
<ul>
<li><p>Linux:</p>
<pre><code class="lang-bash">$ kcreg.sh config credentials --server http://localhost:8080/auth --realm demo --user user --client reg-cli
$ kcreg.sh create <span class="hljs-_">-s</span> clientId=my_client <span class="hljs-_">-s</span> <span class="hljs-string">&apos;redirectUris=[&quot;http://localhost:8980/myapp/*&quot;]&apos;</span>
$ kcreg.sh get my_client
</code></pre>
</li>
<li><p>Windows:</p>
<pre><code class="lang-bash">c:\&gt; kcreg config credentials --server http://localhost:8080/auth --realm demo --user user --client reg-cli
c:\&gt; kcreg create <span class="hljs-_">-s</span> clientId=my_client <span class="hljs-_">-s</span> <span class="hljs-string">&quot;redirectUris=[\&quot;http://localhost:8980/myapp/*\&quot;]&quot;</span>
c:\&gt; kcreg get my_client
</code></pre>
<blockquote>
<p>&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528;<code>https:</code>&#x8BBF;&#x95EE;Keycloak&#xFF0C;&#x4EE5;&#x907F;&#x514D;&#x5C06;&#x4EE4;&#x724C;&#x66B4;&#x9732;&#x7ED9;&#x7F51;&#x7EDC;&#x55C5;&#x63A2;&#x5668;&#x3002;</p>
</blockquote>
</li>
</ul>
</li>
<li><p>&#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8BC1;&#x4E66;&#x4E0D;&#x662F;&#x7531;Java&#x7684;&#x9ED8;&#x8BA4;&#x8BC1;&#x4E66;&#x4FE1;&#x4EFB;&#x5E93;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x53D7;&#x4FE1;&#x4EFB;&#x8BC1;&#x4E66;&#x9881;&#x53D1;&#x673A;&#x6784;&#xFF08;CA&#xFF09;&#x4E4B;&#x4E00;&#x9881;&#x53D1;&#x7684;&#xFF0C;&#x8BF7;&#x51C6;&#x5907;<code>truststore.jks</code>&#x6587;&#x4EF6;&#x5E76;&#x6307;&#x793A;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#xFF1A;</p>
<ul>
<li><p>Linux:</p>
<pre><code class="lang-bash">$ kcreg.sh config truststore --trustpass <span class="hljs-variable">$PASSWORD</span> ~/.keycloak/truststore.jks
</code></pre>
</li>
<li><p>Windows:</p>
<pre><code class="lang-bash">c:\&gt; kcreg config truststore --trustpass %PASSWORD% %HOMEPATH%\.keycloak\truststore.jks
</code></pre>
</li>
</ul>
</li>
</ol>
<p><a name="259_____6_4_1__&#x767B;&#x5F55;"></a></p>
<h4 id="641-&#x767B;&#x5F55;"><a name="641-&#x767B;&#x5F55;" class="anchor-navigation-ex-anchor" href="#641-&#x767B;&#x5F55;"><i class="fa fa-link" aria-hidden="true"></i></a>6.4.1. &#x767B;&#x5F55;</h4>
<ol>
<li>&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x767B;&#x5F55;&#x65F6;&#xFF0C;&#x8BF7;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x70B9;URL&#x548C;&#x57DF;&#x3002;</li>
<li>&#x6307;&#x5B9A;&#x7528;&#x6237;&#x540D;&#x6216;&#x5BA2;&#x6237;&#x7AEF;ID&#xFF0C;&#x8FD9;&#x5C06;&#x5BFC;&#x81F4;&#x4F7F;&#x7528;&#x7279;&#x6B8A;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x3002; &#x4F7F;&#x7528;&#x7528;&#x6237;&#x540D;&#x65F6;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;&#x3002; &#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;ID&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5BC6;&#x94A5;&#x6216;<code>Signed JWT</code>&#x800C;&#x4E0D;&#x662F;&#x5BC6;&#x7801;&#x3002;</li>
</ol>
<p>&#x65E0;&#x8BBA;&#x767B;&#x5F55;&#x65B9;&#x6CD5;&#x5982;&#x4F55;&#xFF0C;&#x767B;&#x5F55;&#x7684;&#x5E10;&#x6237;&#x90FD;&#x9700;&#x8981;&#x9002;&#x5F53;&#x7684;&#x6743;&#x9650;&#x624D;&#x80FD;&#x6267;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;&#x64CD;&#x4F5C;&#x3002; &#x8BF7;&#x8BB0;&#x4F4F;&#xFF0C;&#x975E;&#x4E3B;&#x57DF;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x5E10;&#x6237;&#x53EA;&#x80FD;&#x62E5;&#x6709;&#x7BA1;&#x7406;&#x540C;&#x4E00;&#x57DF;&#x5185;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6743;&#x9650;&#x3002; &#x5982;&#x679C;&#x9700;&#x8981;&#x7BA1;&#x7406;&#x4E0D;&#x540C;&#x7684;&#x57DF;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x57DF;&#x4E2D;&#x914D;&#x7F6E;&#x591A;&#x4E2A;&#x7528;&#x6237;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;<code>master</code>&#x57DF;&#x4E2D;&#x521B;&#x5EFA;&#x5355;&#x4E2A;&#x7528;&#x6237;&#xFF0C;&#x5E76;&#x6DFB;&#x52A0;&#x89D2;&#x8272;&#x4EE5;&#x7BA1;&#x7406;&#x4E0D;&#x540C;&#x9886;&#x57DF;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
<p>&#x60A8;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x914D;&#x7F6E;&#x7528;&#x6237;&#x3002; &#x4F7F;&#x7528;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;Web&#x754C;&#x9762;&#x6216;Admin Client CLI&#x914D;&#x7F6E;&#x7528;&#x6237;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_admin/" target="_blank">&#x670D;&#x52A1;&#x5668;&#x7BA1;&#x7406;&#x6307;&#x5357;</a>&#x3002;</p>
<p>&#x5F53;<code>kcreg</code>&#x6210;&#x529F;&#x767B;&#x5F55;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x63A5;&#x6536;&#x6388;&#x6743;&#x4EE4;&#x724C;&#x5E76;&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x5728;&#x79C1;&#x6709;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x4EE4;&#x724C;&#x53EF;&#x7528;&#x4E8E;&#x540E;&#x7EED;&#x8C03;&#x7528;&#x3002; &#x6709;&#x5173;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_working_with_alternative_configurations" target="_blank">&#x4F7F;&#x7528;&#x5907;&#x7528;&#x914D;&#x7F6E;</a> &#x3002;</p>
<p>&#x6709;&#x5173;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;&#x5185;&#x7F6E;&#x5E2E;&#x52A9;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#xFF1A;</p>
<ul>
<li>Linux:</li>
</ul>
<pre><code class="lang-bash">$ kcreg.sh <span class="hljs-built_in">help</span>
</code></pre>
<ul>
<li>Windows:</li>
</ul>
<pre><code class="lang-bash">c:\&gt; kcreg <span class="hljs-built_in">help</span>
</code></pre>
<p>&#x6709;&#x5173;&#x542F;&#x52A8;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x4F1A;&#x8BDD;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<code>kcreg config credentials --help</code>&#x3002;</p>
<p><a name="260_____6_4_2__&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x914D;&#x7F6E;"></a></p>
<h4 id="642-&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x914D;&#x7F6E;"><a name="642-&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#642-&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>6.4.2. &#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x914D;&#x7F6E;</h4>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7EF4;&#x62A4;&#x5728;&#x7528;&#x6237;&#x4E3B;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x9ED8;&#x8BA4;&#x4F4D;&#x7F6E;<code>./.keycloak/kcreg.config</code>&#x4E2D;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>--config</code>&#x9009;&#x9879;&#x6307;&#x5411;&#x4E0D;&#x540C;&#x7684;&#x6587;&#x4EF6;&#x6216;&#x4F4D;&#x7F6E;&#xFF0C;&#x4EE5;&#x5E76;&#x884C;&#x4FDD;&#x5B58;&#x591A;&#x4E2A;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x4F1A;&#x8BDD;&#x3002; &#x8FD9;&#x662F;&#x4ECE;&#x5355;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7ED1;&#x5B9A;&#x5230;&#x5355;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x64CD;&#x4F5C;&#x7684;&#x6700;&#x5B89;&#x5168;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<blockquote>
<p>&#x4E0D;&#x8981;&#x4F7F;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5BF9;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x5176;&#x4ED6;&#x7528;&#x6237;&#x53EF;&#x89C1;&#x3002; &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5305;&#x542B;&#x5E94;&#x4FDD;&#x5BC6;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x548C;&#x79D8;&#x5BC6;&#x3002;</p>
</blockquote>
<p>&#x60A8;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x901A;&#x8FC7;&#x5728;&#x6240;&#x6709;&#x547D;&#x4EE4;&#x4E2D;&#x4F7F;&#x7528;<code>--no-config</code>&#x9009;&#x9879;&#x6765;&#x907F;&#x514D;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x5B58;&#x50A8;&#x673A;&#x5BC6;&#xFF0C;&#x5373;&#x4F7F;&#x5B83;&#x4E0D;&#x592A;&#x65B9;&#x4FBF;&#x5E76;&#x4E14;&#x9700;&#x8981;&#x66F4;&#x591A;&#x4EE4;&#x724C;&#x8BF7;&#x6C42;&#x3002; &#x4F7F;&#x7528;&#x6BCF;&#x4E2A;<code>kcreg</code>&#x8C03;&#x7528;&#x6307;&#x5B9A;&#x6240;&#x6709;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x4FE1;&#x606F;&#x3002;</p>
<p><a name="261_____6_4_3__&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x548C;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"></a></p>
<h4 id="643-&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x548C;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"><a name="643-&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x548C;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;" class="anchor-navigation-ex-anchor" href="#643-&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x548C;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"><i class="fa fa-link" aria-hidden="true"></i></a>6.4.3. &#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x548C;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</h4>
<p>&#x6CA1;&#x6709;&#x5728;&#x4ED6;&#x4EEC;&#x60F3;&#x8981;&#x4F7F;&#x7528;&#x7684;Keycloak&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x914D;&#x7F6E;&#x5E10;&#x6237;&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x3002; &#x4EC5;&#x5F53;&#x9886;&#x57DF;&#x7BA1;&#x7406;&#x5458;&#x5411;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53D1;&#x51FA;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x65F6;&#xFF0C;&#x624D;&#x53EF;&#x80FD;&#x8FD9;&#x6837;&#x505A;&#x3002; &#x7531;&#x9886;&#x57DF;&#x7BA1;&#x7406;&#x5458;&#x51B3;&#x5B9A;&#x5982;&#x4F55;&#x4EE5;&#x53CA;&#x4F55;&#x65F6;&#x53D1;&#x5E03;&#x548C;&#x5206;&#x53D1;&#x8FD9;&#x4E9B;&#x4EE4;&#x724C;&#x3002; &#x9886;&#x57DF;&#x7BA1;&#x7406;&#x5458;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x7684;&#x6700;&#x957F;&#x671F;&#x9650;&#x4EE5;&#x53CA;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x521B;&#x5EFA;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x603B;&#x6570;&#x3002;</p>
<p>&#x4E00;&#x65E6;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x62E5;&#x6709;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x521B;&#x5EFA;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x4F7F;&#x7528;<code>kcreg config credentials</code>&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002; &#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;<code>kcreg create</code>&#x547D;&#x4EE4;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x6307;&#x5B9A;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#xFF1A;</p>
<ul>
<li>Linux:</li>
</ul>
<pre><code class="lang-bash">$ kcreg.sh config initial-token <span class="hljs-variable">$TOKEN</span>
$ kcreg.sh create <span class="hljs-_">-s</span> clientId=myclient
</code></pre>
<p>&#x6216;&#x8005;</p>
<pre><code class="lang-bash">$ kcreg.sh create <span class="hljs-_">-s</span> clientId=myclient -t <span class="hljs-variable">$TOKEN</span>
</code></pre>
<ul>
<li>Windows:</li>
</ul>
<pre><code class="lang-bash">c:\&gt; kcreg config initial-token %TOKEN%
c:\&gt; kcreg create <span class="hljs-_">-s</span> clientId=myclient
</code></pre>
<p>&#x6216;&#x8005;</p>
<pre><code class="lang-bash">c:\&gt; kcreg create <span class="hljs-_">-s</span> clientId=myclient -t %TOKEN%
</code></pre>
<p>&#x4F7F;&#x7528;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x5305;&#x62EC;&#x65B0;&#x53D1;&#x5E03;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x8BE5;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4EFB;&#x4F55;&#x540E;&#x7EED;&#x64CD;&#x4F5C;&#x90FD;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x8BE5;&#x4EE4;&#x724C;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;&#x6267;&#x884C;&#xFF0C;&#x8BE5;&#x4EE4;&#x724C;&#x4EC5;&#x5BF9;&#x8BE5;&#x5BA2;&#x6237;&#x7AEF;&#x6709;&#x6548;&#x3002;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x81EA;&#x52A8;&#x4F7F;&#x7528;&#x5176;&#x4E13;&#x7528;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6765;&#x4FDD;&#x5B58;&#x6B64;&#x6807;&#x8BB0;&#x5E76;&#x5C06;&#x5176;&#x4E0E;&#x5176;&#x5173;&#x8054;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x3002; &#x53EA;&#x8981;&#x5C06;&#x76F8;&#x540C;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7528;&#x4E8E;&#x6240;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x64CD;&#x4F5C;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5C31;&#x65E0;&#x9700;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5373;&#x53EF;&#x8BFB;&#x53D6;&#xFF0C;&#x66F4;&#x65B0;&#x6216;&#x5220;&#x9664;&#x4EE5;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x521B;&#x5EFA;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
<p>&#x6709;&#x5173;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x548C;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_client_registration" target="_blank">&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;</a>&#x3002;</p>
<p>&#x8FD0;&#x884C;<code>kcreg config initial-token --help</code>&#x548C;<code>kcreg config registration-token --help</code>&#x547D;&#x4EE4;&#xFF0C;&#x4EE5;&#x83B7;&#x53D6;&#x6709;&#x5173;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x914D;&#x7F6E;&#x4EE4;&#x724C;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x3002;</p>
<p><a name="262_____6_4_4__&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"></a></p>
<h4 id="644-&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"><a name="644-&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#644-&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>6.4.4. &#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;</h4>
<p>&#x4F7F;&#x7528;&#x51ED;&#x636E;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6216;&#x914D;&#x7F6E;&#x521D;&#x59CB;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x540E;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x901A;&#x5E38;&#x662F;&#x521B;&#x5EFA;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x901A;&#x5E38;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x4F7F;&#x7528;&#x51C6;&#x5907;&#x597D;&#x7684;JSON&#x6587;&#x4EF6;&#x4F5C;&#x4E3A;&#x6A21;&#x677F;&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;&#x6216;&#x8986;&#x76D6;&#x67D0;&#x4E9B;&#x5C5E;&#x6027;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#x663E;&#x793A;&#x5982;&#x4F55;&#x8BFB;&#x53D6;JSON&#x6587;&#x4EF6;&#xFF0C;&#x8986;&#x76D6;&#x5B83;&#x53EF;&#x80FD;&#x5305;&#x542B;&#x7684;&#x4EFB;&#x4F55;&#x5BA2;&#x6237;&#x7AEF;ID&#xFF0C;&#x8BBE;&#x7F6E;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x6210;&#x529F;&#x521B;&#x5EFA;&#x540E;&#x5C06;&#x914D;&#x7F6E;&#x6253;&#x5370;&#x5230;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x3002;</p>
<ul>
<li>Linux:</li>
</ul>
<pre><code class="lang-bash">$ kcreg.sh create <span class="hljs-_">-f</span> client-template.json <span class="hljs-_">-s</span> clientId=myclient <span class="hljs-_">-s</span> baseUrl=/myclient <span class="hljs-_">-s</span> <span class="hljs-string">&apos;redirectUris=[&quot;/myclient/*&quot;]&apos;</span> -o
</code></pre>
<ul>
<li>Windows:</li>
</ul>
<pre><code class="lang-bash">C:\&gt; kcreg create <span class="hljs-_">-f</span> client-template.json <span class="hljs-_">-s</span> clientId=myclient <span class="hljs-_">-s</span> baseUrl=/myclient <span class="hljs-_">-s</span> <span class="hljs-string">&quot;redirectUris=[\&quot;/myclient/*\&quot;]&quot;</span> -o
</code></pre>
<p>&#x6709;&#x5173;<code>kcreg create</code>&#x547D;&#x4EE4;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x8FD0;&#x884C;<code>kcreg create --help</code>&#x3002;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>kcreg attrs</code>&#x5217;&#x51FA;&#x53EF;&#x7528;&#x5C5E;&#x6027;&#x3002; &#x8BF7;&#x8BB0;&#x4F4F;&#xFF0C;&#x672A;&#x68C0;&#x67E5;&#x8BB8;&#x591A;&#x914D;&#x7F6E;&#x5C5E;&#x6027;&#x7684;&#x6709;&#x6548;&#x6027;&#x6216;&#x4E00;&#x81F4;&#x6027;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x6B63;&#x786E;&#x7684;&#x503C;&#x3002; &#x8BF7;&#x8BB0;&#x4F4F;&#xFF0C;&#x6A21;&#x677F;&#x4E2D;&#x4E0D;&#x5E94;&#x5305;&#x542B;&#x4EFB;&#x4F55;id&#x5B57;&#x6BB5;&#xFF0C;&#x4E5F;&#x4E0D;&#x5E94;&#x5C06;&#x5B83;&#x4EEC;&#x6307;&#x5B9A;&#x4E3A;<code>kcreg create</code>&#x547D;&#x4EE4;&#x7684;&#x53C2;&#x6570;&#x3002;</p>
<p><a name="263_____6_4_5__&#x68C0;&#x7D22;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"></a></p>
<h4 id="645-&#x68C0;&#x7D22;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"><a name="645-&#x68C0;&#x7D22;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#645-&#x68C0;&#x7D22;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>6.4.5. &#x68C0;&#x7D22;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;</h4>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>kcreg get</code>&#x547D;&#x4EE4;&#x68C0;&#x7D22;&#x73B0;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#xFF1A;</p>
<ul>
<li>Linux:</li>
</ul>
<pre><code class="lang-bash">$ kcreg.sh get myclient
</code></pre>
<ul>
<li>Windows:</li>
</ul>
<pre><code class="lang-bash">C:\&gt; kcreg get myclient
</code></pre>
<p>&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x68C0;&#x7D22;&#x4E3A;&#x9002;&#x914D;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x4E0E;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6253;&#x5305;&#x5728;&#x4E00;&#x8D77;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#xFF1A;</p>
<ul>
<li>Linux:</li>
</ul>
<pre><code class="lang-bash">$ kcreg.sh get myclient <span class="hljs-_">-e</span> install &gt; keycloak.json
</code></pre>
<ul>
<li>Windows:</li>
</ul>
<pre><code class="lang-bash">C:\&gt; kcreg get myclient <span class="hljs-_">-e</span> install &gt; keycloak.json
</code></pre>
<p>&#x6709;&#x5173;<code>kcreg get</code>&#x547D;&#x4EE4;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x8FD0;&#x884C;<code>kcreg get --help</code>&#x547D;&#x4EE4;&#x3002;</p>
<p><a name="264_____6_4_6__&#x4FEE;&#x6539;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"></a></p>
<h4 id="646-&#x4FEE;&#x6539;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"><a name="646-&#x4FEE;&#x6539;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#646-&#x4FEE;&#x6539;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>6.4.6. &#x4FEE;&#x6539;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;</h4>
<p>&#x6709;&#x4E24;&#x79CD;&#x66F4;&#x65B0;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x5728;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x914D;&#x7F6E;&#xFF0C;&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x5230;&#x6587;&#x4EF6;&#xFF0C;&#x7F16;&#x8F91;&#x5B83;&#x5E76;&#x5C06;&#x5176;&#x53D1;&#x56DE;&#x670D;&#x52A1;&#x5668;&#x540E;&#xFF0C;&#x5411;&#x670D;&#x52A1;&#x5668;&#x63D0;&#x4EA4;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x65B0;&#x72B6;&#x6001;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#xFF1A;</p>
<ul>
<li>Linux:</li>
</ul>
<pre><code class="lang-bash">$ kcreg.sh get myclient &gt; myclient.json
$ vi myclient.json
$ kcreg.sh update myclient <span class="hljs-_">-f</span> myclient.json
</code></pre>
<ul>
<li>Windows:</li>
</ul>
<pre><code class="lang-bash">C:\&gt; kcreg get myclient &gt; myclient.json
C:\&gt; notepad myclient.json
C:\&gt; kcreg update myclient <span class="hljs-_">-f</span> myclient.json
</code></pre>
<p>&#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8BBE;&#x7F6E;&#x6216;&#x5220;&#x9664;&#x5176;&#x4E0A;&#x7684;&#x5B57;&#x6BB5;&#xFF0C;&#x5E76;&#x5728;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;&#x4E2D;&#x5C06;&#x5176;&#x53D1;&#x56DE;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#xFF1A;</p>
<ul>
<li>Linux:</li>
</ul>
<pre><code class="lang-bash">$ kcreg.sh update myclient <span class="hljs-_">-s</span> enabled=<span class="hljs-literal">false</span> <span class="hljs-_">-d</span> redirectUris
</code></pre>
<ul>
<li>Windows:</li>
</ul>
<pre><code class="lang-bash">C:\&gt; kcreg update myclient <span class="hljs-_">-s</span> enabled=<span class="hljs-literal">false</span> <span class="hljs-_">-d</span> redirectUris
</code></pre>
<p>&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EC5;&#x5305;&#x542B;&#x8981;&#x5E94;&#x7528;&#x7684;&#x66F4;&#x6539;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x60A8;&#x5C31;&#x4E0D;&#x5FC5;&#x5C06;&#x592A;&#x591A;&#x503C;&#x6307;&#x5B9A;&#x4E3A;&#x53C2;&#x6570;&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6307;&#x5B9A;<code>--merge</code>&#x544A;&#x8BC9;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5C06;JSON&#x6587;&#x4EF6;&#x89C6;&#x4E3A;&#x5B8C;&#x6574;&#x7684;&#x65B0;&#x914D;&#x7F6E;&#xFF0C;&#x5B83;&#x5E94;&#x5C06;&#x5176;&#x89C6;&#x4E3A;&#x8981;&#x5728;&#x73B0;&#x6709;&#x914D;&#x7F6E;&#x4E0A;&#x5E94;&#x7528;&#x7684;&#x4E00;&#x7EC4;&#x5C5E;&#x6027;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#xFF1A;</p>
<ul>
<li>Linux:</li>
</ul>
<pre><code class="lang-bash">$ kcreg.sh update myclient --merge <span class="hljs-_">-d</span> redirectUris <span class="hljs-_">-f</span> mychanges.json
</code></pre>
<ul>
<li>Windows:</li>
</ul>
<pre><code class="lang-bash">C:\&gt; kcreg update myclient --merge <span class="hljs-_">-d</span> redirectUris <span class="hljs-_">-f</span> mychanges.json
</code></pre>
<p>&#x6709;&#x5173;<code>kcreg update</code>&#x547D;&#x4EE4;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x8FD0;&#x884C;<code>kcreg update --help</code>&#x547D;&#x4EE4;&#x3002;</p>
<p><a name="265_____6_4_7__&#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"></a></p>
<h4 id="647-&#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"><a name="647-&#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#647-&#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>6.4.7. &#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;</h4>
<p>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#x5220;&#x9664;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
<ul>
<li>Linux:</li>
</ul>
<pre><code class="lang-bash">$ kcreg.sh delete myclient
</code></pre>
<ul>
<li>Windows:</li>
</ul>
<pre><code class="lang-bash">C:\&gt; kcreg delete myclient
</code></pre>
<p>&#x6709;&#x5173;<code>kcreg delete</code>&#x547D;&#x4EE4;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x8FD0;&#x884C;<code>kcreg delete --help</code>&#x547D;&#x4EE4;&#x3002;</p>
<p><a name="266_____6_4_8__&#x5237;&#x65B0;&#x65E0;&#x6548;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"></a></p>
<h4 id="648-&#x5237;&#x65B0;&#x65E0;&#x6548;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"><a name="648-&#x5237;&#x65B0;&#x65E0;&#x6548;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;" class="anchor-navigation-ex-anchor" href="#648-&#x5237;&#x65B0;&#x65E0;&#x6548;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;"><i class="fa fa-link" aria-hidden="true"></i></a>6.4.8. &#x5237;&#x65B0;&#x65E0;&#x6548;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;</h4>
<p>&#x4F7F;&#x7528;<code>--no-config</code>&#x6A21;&#x5F0F;&#x6267;&#x884C;&#x521B;&#x5EFA;&#xFF0C;&#x8BFB;&#x53D6;&#xFF0C;&#x66F4;&#x65B0;&#x548C;&#x5220;&#x9664;&#xFF08;CRUD&#xFF09;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x65E0;&#x6CD5;&#x4E3A;&#x60A8;&#x5904;&#x7406;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x4E22;&#x5931;&#x5BF9;&#x5BA2;&#x6237;&#x7AEF;&#x6700;&#x8FD1;&#x53D1;&#x5E03;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x7684;&#x8DDF;&#x8E2A;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97;&#x65E0;&#x6CD5;&#x5728;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5177;&#x6709;<strong>manage-clients</strong>&#x6743;&#x9650;&#x7684;&#x5E10;&#x6237;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5728;&#x8BE5;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x6267;&#x884C;&#x4EFB;&#x4F55;&#x8FDB;&#x4E00;&#x6B65;&#x7684;CRUD&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x5982;&#x679C;&#x60A8;&#x5177;&#x6709;&#x6743;&#x9650;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x51FA;&#x65B0;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x6253;&#x5370;&#x5230;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x6216;&#x4FDD;&#x5B58;&#x5230;&#x60A8;&#x9009;&#x62E9;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x3002; &#x5426;&#x5219;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x8981;&#x6C42;&#x9886;&#x57DF;&#x7BA1;&#x7406;&#x5458;&#x4E3A;&#x60A8;&#x7684;&#x5BA2;&#x6237;&#x53D1;&#x51FA;&#x65B0;&#x7684;&#x6CE8;&#x518C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x5E76;&#x5C06;&#x5176;&#x53D1;&#x9001;&#x7ED9;&#x60A8;&#x3002; &#x7136;&#x540E;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>--token</code>&#x9009;&#x9879;&#x5C06;&#x5176;&#x4F20;&#x9012;&#x7ED9;&#x4EFB;&#x4F55;CRUD&#x547D;&#x4EE4;&#x3002; &#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>kcreg config registration-token</code>&#x547D;&#x4EE4;&#x5C06;&#x65B0;&#x4EE4;&#x724C;&#x4FDD;&#x5B58;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x5E76;&#x8BA9;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x518C;CLI&#x4ECE;&#x90A3;&#x65F6;&#x8D77;&#x81EA;&#x52A8;&#x4E3A;&#x60A8;&#x5904;&#x7406;&#x3002;</p>
<p>&#x6709;&#x5173;<code>kcreg update-token</code>&#x547D;&#x4EE4;&#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x8FD0;&#x884C;<code>kcreg update-token --help</code>&#x547D;&#x4EE4;&#x3002;</p>
<p><a name="267____6_5__&#x6545;&#x969C;&#x6392;&#x9664;"></a></p>
<h3 id="65-&#x6545;&#x969C;&#x6392;&#x9664;"><a name="65-&#x6545;&#x969C;&#x6392;&#x9664;" class="anchor-navigation-ex-anchor" href="#65-&#x6545;&#x969C;&#x6392;&#x9664;"><i class="fa fa-link" aria-hidden="true"></i></a>6.5. &#x6545;&#x969C;&#x6392;&#x9664;</h3>
<ul>
<li><p>Q: &#x767B;&#x5F55;&#x65F6;&#xFF0C;&#x51FA;&#x73B0;&#x9519;&#x8BEF;&#xFF1A; *Parameter client_assertion_type is missing [invalid_client].</p>
<p>A: &#x6B64;&#x9519;&#x8BEF;&#x610F;&#x5473;&#x7740;&#x60A8;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x4E86;<code>Signed JWT(&#x7B7E;&#x540D;JWT)</code>&#x4EE4;&#x724C;&#x51ED;&#x636E;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x60A8;&#x5FC5;&#x987B;&#x5728;&#x767B;&#x5F55;&#x65F6;&#x4F7F;&#x7528;<code>--keystore</code>&#x53C2;&#x6570;&#x3002;</p>
</li>
</ul>
<p><a name="268___7__&#x4EE4;&#x724C;&#x4EA4;&#x6362;"></a></p>
<h2 id="7-&#x4EE4;&#x724C;&#x4EA4;&#x6362;"><a name="7-&#x4EE4;&#x724C;&#x4EA4;&#x6362;" class="anchor-navigation-ex-anchor" href="#7-&#x4EE4;&#x724C;&#x4EA4;&#x6362;"><i class="fa fa-link" aria-hidden="true"></i></a>7. &#x4EE4;&#x724C;&#x4EA4;&#x6362;</h2>
<blockquote>
<p>&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x662F;<strong>&#x6280;&#x672F;&#x9884;&#x89C8;</strong>&#xFF0C;&#x5E76;&#x4E0D;&#x5B8C;&#x5168;&#x652F;&#x6301;&#x3002; &#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x7981;&#x7528;&#x6B64;&#x529F;&#x80FD;&#x3002;&#x8981;&#x542F;&#x7528;<code>-Dkeycloak.profile=preview</code> &#x6216; <code>-Dkeycloak.profile.feature.token_exchange=enabled</code>&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;&#x3002; &#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_installation/#profiles" target="_blank">Profiles</a>&#x3002;</p>
</blockquote>
<p>&#x5728;Keycloak&#x4E2D;&#xFF0C;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x662F;&#x4F7F;&#x7528;&#x4E00;&#x7EC4;&#x51ED;&#x636E;&#x6216;&#x4EE4;&#x724C;&#x6765;&#x83B7;&#x53D6;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#x7684;&#x4EE4;&#x724C;&#x7684;&#x8FC7;&#x7A0B;&#x3002; &#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x5728;&#x4E0D;&#x592A;&#x53D7;&#x4FE1;&#x4EFB;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E0A;&#x8C03;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x964D;&#x7EA7;&#x5B83;&#x5177;&#x6709;&#x7684;&#x5F53;&#x524D;&#x4EE4;&#x724C;&#x3002; &#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x80FD;&#x60F3;&#x8981;&#x4E3A;&#x5B58;&#x50A8;&#x7528;&#x4E8E;&#x94FE;&#x63A5;&#x7684;&#x793E;&#x4EA4;&#x63D0;&#x4F9B;&#x8005;&#x5E10;&#x6237;&#x7684;&#x4EE4;&#x724C;&#x4EA4;&#x6362;Keycloak&#x4EE4;&#x724C;&#x3002; &#x60A8;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x4FE1;&#x4EFB;&#x7531;&#x5176;&#x4ED6;Keycloak&#x9886;&#x57DF;&#x6216;&#x5916;&#x56FD;&#x56FD;&#x5185;&#x6D41;&#x79BB;&#x5931;&#x6240;&#x8005;&#x94F8;&#x9020;&#x7684;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x3002; &#x5BA2;&#x6237;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5192;&#x5145;&#x7528;&#x6237;&#x3002; &#x4EE5;&#x4E0B;&#x662F;Keycloak&#x56F4;&#x7ED5;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x5F53;&#x524D;&#x529F;&#x80FD;&#x7684;&#x7B80;&#x77ED;&#x6458;&#x8981;&#x3002;</p>
<ul>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x4EA4;&#x6362;&#x4E3A;&#x7279;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x521B;&#x5EFA;&#x7684;&#x73B0;&#x6709;Keycloak&#x4EE4;&#x724C;&#xFF0C;&#x4EE5;&#x83B7;&#x53D6;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x65B0;&#x4EE4;&#x724C;</li>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x5C06;&#x73B0;&#x6709;&#x7684;Keycloak&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x4E3A;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#xFF0C;&#x5373;&#x94FE;&#x63A5;&#x7684;Facebook&#x5E10;&#x6237;</li>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x4E3A;Keycloak&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x3002;</li>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x5192;&#x5145;&#x7528;&#x6237;</li>
</ul>
<p>Keycloak&#x4E2D;&#x7684;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x662F;IETF&#x4E2D;<a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-16" target="_blank">OAuth&#x4EE4;&#x724C;&#x4EA4;&#x6362;</a>&#x89C4;&#x8303;&#x7684;&#x975E;&#x5E38;&#x677E;&#x6563;&#x7684;&#x5B9E;&#x73B0;&#x3002; &#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6269;&#x5C55;&#x4E86;&#x4E00;&#x70B9;&#xFF0C;&#x5FFD;&#x7565;&#x4E86;&#x4E00;&#x4E9B;&#xFF0C;&#x5E76;&#x677E;&#x6563;&#x5730;&#x89E3;&#x91CA;&#x4E86;&#x89C4;&#x8303;&#x7684;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x3002; &#x5B83;&#x662F;&#x9886;&#x57DF;&#x7684;OpenID Connect&#x4EE4;&#x724C;&#x7AEF;&#x70B9;&#x4E0A;&#x7684;&#x7B80;&#x5355;&#x6388;&#x6743;&#x7C7B;&#x578B;&#x8C03;&#x7528;&#x3002;</p>
<pre><code class="lang-bash">/auth/realms/{realm}/protocol/openid-connect/token
</code></pre>
<p>&#x5B83;&#x63A5;&#x53D7;&#x8868;&#x5355;&#x53C2;&#x6570;&#xFF08;<code>application / x-www-form-urlencoded</code>&#xFF09;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#xFF0C;&#x8F93;&#x51FA;&#x53D6;&#x51B3;&#x4E8E;&#x60A8;&#x8BF7;&#x6C42;&#x4EA4;&#x6362;&#x7684;&#x4EE4;&#x724C;&#x7C7B;&#x578B;&#x3002; &#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x7AEF;&#x70B9;&#xFF0C;&#x56E0;&#x6B64;&#x8BF7;&#x6C42;&#x5FC5;&#x987B;&#x4E3A;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4F9B;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x4FE1;&#x606F;&#x3002; &#x516C;&#x5171;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x5176;&#x5BA2;&#x6237;&#x7AEF;&#x6807;&#x8BC6;&#x7B26;&#x6307;&#x5B9A;&#x4E3A;&#x8868;&#x5355;&#x53C2;&#x6570;&#x3002; &#x673A;&#x5BC6;&#x5BA2;&#x6237;&#x7AEF;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8868;&#x5355;&#x53C2;&#x6570;&#x6765;&#x4F20;&#x9012;&#x5176;&#x5BA2;&#x6237;&#x7AEF;ID&#x548C;&#x5BC6;&#x7801;&#xFF0C;Basic Auth&#xFF0C;&#x6216;&#x8005;&#x60A8;&#x7684;&#x7BA1;&#x7406;&#x5458;&#x5DF2;&#x5728;&#x60A8;&#x7684;&#x9886;&#x57DF;&#x4E2D;&#x914D;&#x7F6E;&#x4E86;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6D41;&#x3002; &#x8FD9;&#x662F;&#x8868;&#x5355;&#x53C2;&#x6570;&#x5217;&#x8868;</p>
<ul>
<li><p>client_id</p>
<p><em>REQUIRED MAYBE.</em> &#x4F7F;&#x7528;&#x8868;&#x5355;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x6B64;&#x53C2;&#x6570;&#x3002; &#x5982;&#x679C;&#x60A8;&#x4F7F;&#x7528;&#x7684;&#x662F;Basic Auth&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;JWT&#x4EE4;&#x724C;&#x6216;&#x5BA2;&#x6237;&#x7AEF;&#x8BC1;&#x4E66;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5219;&#x4E0D;&#x8981;&#x6307;&#x5B9A;&#x6B64;&#x53C2;&#x6570;&#x3002;</p>
</li>
<li><p>client_secret</p>
<p><em>REQUIRED MAYBE</em>. &#x5BF9;&#x4E8E;&#x4F7F;&#x7528;&#x8868;&#x5355;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5E76;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x673A;&#x5BC6;&#x4F5C;&#x4E3A;&#x51ED;&#x636E;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x6B64;&#x53C2;&#x6570;&#x662F;&#x5FC5;&#x9700;&#x7684;&#x3002; &#x5982;&#x679C;&#x60A8;&#x7684;&#x9886;&#x57DF;&#x4E2D;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8C03;&#x7528;&#x901A;&#x8FC7;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x8BF7;&#x4E0D;&#x8981;&#x6307;&#x5B9A;&#x6B64;&#x53C2;&#x6570;&#x3002;</p>
</li>
<li><p>grant_type</p>
<p><em>REQUIRED.</em> &#x53C2;&#x6570;&#x7684;&#x503C;&#x5FC5;&#x987B;&#x662F;<code>urn:ietf:params:oauth:grant-type:token-exchange</code>&#x3002;</p>
</li>
<li><p>subject_token</p>
<p><em>OPTIONAL.</em> &#x4EE3;&#x8868;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#x7684;&#x4E00;&#x65B9;&#x7684;&#x8EAB;&#x4EFD;&#x7684;&#x5B89;&#x5168;&#x4EE4;&#x724C;&#x3002; &#x5982;&#x679C;&#x60A8;&#x8981;&#x4E3A;&#x65B0;&#x7684;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x73B0;&#x6709;&#x4EE4;&#x724C;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x5B83;&#x3002;</p>
</li>
<li><p>subject_issuer</p>
<p><em>OPTIONAL.</em> &#x6807;&#x8BC6;<code>subject_token</code>&#x7684;&#x53D1;&#x884C;&#x8005;&#x3002; &#x5982;&#x679C;&#x4EE4;&#x724C;&#x6765;&#x81EA;&#x5F53;&#x524D;&#x9886;&#x57DF;&#xFF0C;&#x6216;&#x8005;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x4ECE;<code>subject_token_type</code>&#x786E;&#x5B9A;&#x53D1;&#x884C;&#x8005;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x7559;&#x7A7A;&#x3002; &#x5426;&#x5219;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x3002; &#x6709;&#x6548;&#x503C;&#x662F;&#x4E3A;&#x60A8;&#x7684;&#x9886;&#x57DF;&#x914D;&#x7F6E;&#x7684;&#x201C;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#x201D;&#x7684;&#x522B;&#x540D;&#x3002; &#x6216;&#x8005;&#x7531;&#x7279;&#x5B9A;<code>Identity Provider</code>&#x914D;&#x7F6E;&#x7684;&#x53D1;&#x884C;&#x8005;&#x58F0;&#x660E;&#x6807;&#x8BC6;&#x7B26;&#x3002;</p>
</li>
<li><p>subject_token_type</p>
<p><em>OPTIONAL.</em> &#x6B64;&#x53C2;&#x6570;&#x662F;&#x4F7F;&#x7528;<code>subject_token</code>&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7684;&#x6807;&#x8BB0;&#x7684;&#x7C7B;&#x578B;&#x3002; &#x5982;&#x679C;<code>subject_token</code>&#x6765;&#x81EA;&#x9886;&#x57DF;&#x5E76;&#x4E14;&#x662F;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x5219;&#x9ED8;&#x8BA4;&#x4E3A;<code>urn:ietf:params:oauth:token-type:access_token</code>&#x3002; &#x5982;&#x679C;&#x5B83;&#x662F;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x6839;&#x636E;<code>subject_issuer</code>&#x7684;&#x8981;&#x6C42;&#x6307;&#x5B9A;&#x6216;&#x4E0D;&#x6307;&#x5B9A;&#x6B64;&#x53C2;&#x6570;&#x3002;</p>
</li>
<li><p>requested_token_type</p>
<p><em>OPTIONAL.</em> &#x6B64;&#x53C2;&#x6570;&#x8868;&#x793A;&#x5BA2;&#x6237;&#x7AEF;&#x8981;&#x4EA4;&#x6362;&#x7684;&#x4EE4;&#x724C;&#x7C7B;&#x578B;&#x3002; &#x76EE;&#x524D;&#x4EC5;&#x652F;&#x6301;oauth&#x548C;OpenID Connect&#x4EE4;&#x724C;&#x7C7B;&#x578B;&#x3002; &#x8FD9;&#x4E2A;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x53D6;&#x51B3;&#x4E8E;&#x662F;<code>urn:ietf:params:oauth:token-type:refresh_token</code>&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x60A8;&#x5C06;&#x5728;&#x54CD;&#x5E94;&#x4E2D;&#x8FD4;&#x56DE;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x548C;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x3002; &#x5176;&#x4ED6;&#x5408;&#x9002;&#x7684;&#x503C;&#x662F;<code>urn:ietf:params:oauth:token-type:access_token</code> &#x548C; <code>urn:ietf:params:oauth:token-type:id_token</code></p>
</li>
<li><p>audience</p>
<p><em>OPTIONAL.</em> &#x6B64;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x8981;&#x4E3A;&#x5176;&#x751F;&#x6210;&#x65B0;&#x4EE4;&#x724C;&#x7684;&#x76EE;&#x6807;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
</li>
<li><p>requested_issuer</p>
<p><em>OPTIONAL.</em> &#x6B64;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x7531;&#x5916;&#x90E8;&#x63D0;&#x4F9B;&#x8005;&#x751F;&#x6210;&#x7684;&#x4EE4;&#x724C;&#x3002;&#x5B83;&#x5FC5;&#x987B;&#x662F;&#x5728;&#x57DF;&#x4E2D;&#x914D;&#x7F6E;&#x7684;<code>Identity Provider</code>&#x7684;&#x522B;&#x540D;&#x3002;</p>
</li>
<li><p>requested_subject</p>
<p><em>OPTIONAL.</em> &#x5982;&#x679C;&#x60A8;&#x7684;&#x5BA2;&#x6237;&#x60F3;&#x8981;&#x6A21;&#x4EFF;&#x5176;&#x4ED6;&#x7528;&#x6237;&#xFF0C;&#x5219;&#x6307;&#x5B9A;&#x7528;&#x6237;&#x540D;&#x6216;&#x7528;&#x6237;ID&#x3002;</p>
</li>
<li><p>scope</p>
<p><em>NOT IMPLEMENTED.</em> &#x6B64;&#x53C2;&#x6570;&#x8868;&#x793A;&#x5BA2;&#x6237;&#x673A;&#x8BF7;&#x6C42;&#x7684;OAuth&#x548C;OpenID&#x8FDE;&#x63A5;&#x8303;&#x56F4;&#x7684;&#x76EE;&#x6807;&#x96C6;&#x3002;&#x76EE;&#x524D;&#x8FD8;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x65E6;Keycloak&#x5BF9;&#x8303;&#x56F4;&#x6709;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x5B83;&#x5C31;&#x4F1A;&#x5B9E;&#x73B0;&#x3002;</p>
</li>
</ul>
<blockquote>
<p>&#x6211;&#x4EEC;&#x76EE;&#x524D;&#x4EC5;&#x652F;&#x6301;OpenID Connect&#x548C;OAuth&#x4EA4;&#x6362;&#x3002; &#x6839;&#x636E;&#x7528;&#x6237;&#x9700;&#x6C42;&#xFF0C;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x6DFB;&#x52A0;&#x5BF9;&#x57FA;&#x4E8E;SAML&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x7684;&#x652F;&#x6301;&#x3002;</p>
</blockquote>
<p>&#x6765;&#x81EA;&#x4EA4;&#x6362;&#x8C03;&#x7528;&#x7684;&#x6210;&#x529F;&#x54CD;&#x5E94;&#x5C06;&#x8FD4;&#x56DE;HTTP 200&#x54CD;&#x5E94;&#x4EE3;&#x7801;&#xFF0C;&#x5176;&#x5185;&#x5BB9;&#x7C7B;&#x578B;&#x53D6;&#x51B3;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x8981;&#x6C42;&#x7684;<code>requested-token-type</code>&#x548C;<code>requested_issuer</code>&#x3002; OAuth&#x8BF7;&#x6C42;&#x7684;&#x4EE4;&#x724C;&#x7C7B;&#x578B;&#x5C06;&#x8FD4;&#x56DE;[OAuth&#x4EE4;&#x724C;&#x4EA4;&#x6362;]&#xFF08;(<a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-16" target="_blank">https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-16</a>) &#x89C4;&#x8303;&#x4E2D;&#x6240;&#x8FF0;&#x7684;JSON&#x6587;&#x6863;&#x3002;</p>
<pre><code class="lang-json">{
   <span class="hljs-string">&quot;access_token&quot;</span> : <span class="hljs-string">&quot;.....&quot;</span>,
   <span class="hljs-string">&quot;refresh_token&quot;</span> : <span class="hljs-string">&quot;.....&quot;</span>,
   <span class="hljs-string">&quot;expires_in&quot;</span> : <span class="hljs-string">&quot;....&quot;</span>
 }
</code></pre>
<p>&#x8BF7;&#x6C42;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x5728;&#x54CD;&#x5E94;&#x4E2D;&#x8FD4;&#x56DE;&#x8BBF;&#x95EE;&#x548C;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x3002; &#x4EC5;&#x8BF7;&#x6C42;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x7C7B;&#x578B;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x4EC5;&#x5728;&#x54CD;&#x5E94;&#x4E2D;&#x83B7;&#x53D6;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x5BF9;&#x4E8E;&#x901A;&#x8FC7;<code>requested_issuer</code>&#x53C2;&#x6570;&#x8BF7;&#x6C42;&#x5916;&#x90E8;&#x53D1;&#x884C;&#x8005;&#x7684;&#x5BA2;&#x6237;&#xFF0C;&#x53EF;&#x4EE5;&#x5305;&#x62EC;&#x6216;&#x4E0D;&#x5305;&#x62EC;&#x5230;&#x671F;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x9519;&#x8BEF;&#x54CD;&#x5E94;&#x901A;&#x5E38;&#x5C5E;&#x4E8E;400 HTTP&#x54CD;&#x5E94;&#x4EE3;&#x7801;&#x7C7B;&#x522B;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x4F1A;&#x8FD4;&#x56DE;&#x5176;&#x4ED6;&#x9519;&#x8BEF;&#x72B6;&#x6001;&#x4EE3;&#x7801;&#xFF0C;&#x5177;&#x4F53;&#x53D6;&#x51B3;&#x4E8E;&#x9519;&#x8BEF;&#x7684;&#x4E25;&#x91CD;&#x6027;&#x3002; &#x9519;&#x8BEF;&#x54CD;&#x5E94;&#x53EF;&#x80FD;&#x5305;&#x62EC;&#x53D6;&#x51B3;&#x4E8E;<code>requested_issuer</code>&#x7684;&#x5185;&#x5BB9;&#x3002; &#x57FA;&#x4E8E;OAuth&#x7684;&#x4EA4;&#x6362;&#x53EF;&#x80FD;&#x4F1A;&#x8FD4;&#x56DE;JSON&#x6587;&#x6863;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-json">{
   <span class="hljs-string">&quot;error&quot;</span> : <span class="hljs-string">&quot;....&quot;</span>
   <span class="hljs-string">&quot;error_description&quot;</span> : <span class="hljs-string">&quot;....&quot;</span>
}
</code></pre>
<p>&#x53EF;&#x80FD;&#x4F1A;&#x8FD4;&#x56DE;&#x5176;&#x4ED6;&#x9519;&#x8BEF;&#x58F0;&#x660E;&#xFF0C;&#x5177;&#x4F53;&#x53D6;&#x51B3;&#x4E8E;&#x4EA4;&#x6362;&#x7C7B;&#x578B;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x6237;&#x6CA1;&#x6709;&#x6307;&#x5411;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#x7684;&#x94FE;&#x63A5;&#xFF0C;OAuth&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#x53EF;&#x80FD;&#x4F1A;&#x5305;&#x542B;&#x989D;&#x5916;&#x7684;<code>account-link-url</code>&#x58F0;&#x660E;&#x3002; &#x6B64;&#x94FE;&#x63A5;&#x53EF;&#x7528;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77;&#x7684;&#x94FE;&#x63A5;&#x8BF7;&#x6C42;&#x3002;</p>
<blockquote>
<p>&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x8BBE;&#x7F6E;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x7EC6;&#x7C92;&#x5EA6;&#x7BA1;&#x7406;&#x5458;&#x6743;&#x9650;&#xFF08;&#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_admin/" target="_blank">&#x670D;&#x52A1;&#x5668;&#x7BA1;&#x7406;&#x6307;&#x5357;</a>&#xFF09;&#x3002; &#x60A8;&#x9700;&#x8981;&#x6388;&#x4E88;&#x5BA2;&#x6237;&#x4EA4;&#x6362;&#x7684;&#x6743;&#x9650;&#x3002; &#x8FD9;&#x5C06;&#x5728;&#x672C;&#x7AE0;&#x540E;&#x9762;&#x8BA8;&#x8BBA;&#x3002;</p>
</blockquote>
<p>&#x672C;&#x7AE0;&#x7684;&#x5176;&#x4F59;&#x90E8;&#x5206;&#x8BA8;&#x8BBA;&#x4E86;&#x8BBE;&#x7F6E;&#x8981;&#x6C42;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;&#x4E0D;&#x540C;&#x4EA4;&#x6362;&#x65B9;&#x6848;&#x7684;&#x793A;&#x4F8B;&#x3002; &#x4E3A;&#x7B80;&#x5355;&#x8D77;&#x89C1;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x5C06;&#x5F53;&#x524D;&#x9886;&#x57DF;&#x94F8;&#x9020;&#x7684;&#x4EE4;&#x724C;&#x79F0;&#x4E3A;<em>internal</em>&#x4EE4;&#x724C;&#xFF0C;&#x5E76;&#x5C06;&#x5916;&#x90E8;&#x57DF;&#x6216;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#x94F8;&#x9020;&#x7684;&#x4EE4;&#x724C;&#x79F0;&#x4E3A;<em>external</em>&#x4EE4;&#x724C;&#x3002;</p>
<p><a name="269____7_1__&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;"></a></p>
<h3 id="71-&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;"><a name="71-&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;" class="anchor-navigation-ex-anchor" href="#71-&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;"><i class="fa fa-link" aria-hidden="true"></i></a>7.1. &#x5185;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;</h3>
<p>&#x901A;&#x8FC7;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x73B0;&#x6709;&#x4EE4;&#x724C;&#x6DFB;&#x52A0;&#x5230;&#x7279;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5E76;&#x4E14;&#x60A8;&#x5E0C;&#x671B;&#x5C06;&#x6B64;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x4E3A;&#x4E3A;&#x4E0D;&#x540C;&#x76EE;&#x6807;&#x5BA2;&#x6237;&#x7AEF;&#x521B;&#x5EFA;&#x7684;&#x65B0;&#x4EE4;&#x724C;&#x3002; &#x4F60;&#x4E3A;&#x4EC0;&#x4E48;&#x60F3;&#x505A;&#x8FD9;&#x4E2A;&#xFF1F; &#x8FD9;&#x901A;&#x5E38;&#x53D1;&#x751F;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x4E3A;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4EE4;&#x724C;&#x65F6;&#xFF0C;&#x5E76;&#x4E14;&#x9700;&#x8981;&#x5411;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x4E2D;&#x9700;&#x8981;&#x4E0D;&#x540C;&#x58F0;&#x660E;&#x548C;&#x6743;&#x9650;&#x7684;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53D1;&#x51FA;&#x5176;&#x4ED6;&#x8BF7;&#x6C42;&#x3002; &#x53EF;&#x80FD;&#x9700;&#x8981;&#x6B64;&#x7C7B;&#x4EA4;&#x6362;&#x7684;&#x5176;&#x4ED6;&#x539F;&#x56E0;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x6267;&#x884C;&#x201C;permission downgrade(&#x6743;&#x9650;&#x964D;&#x7EA7;)&#x201D;&#xFF0C;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x9700;&#x8981;&#x5728;&#x4E0D;&#x592A;&#x53D7;&#x4FE1;&#x4EFB;&#x7684;&#x5E94;&#x7528;&#x4E0A;&#x8C03;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x60A8;&#x4E0D;&#x5E0C;&#x671B;&#x4F20;&#x64AD;&#x5F53;&#x524D;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002;</p>
<p><a name="270_____7_1_1__&#x6388;&#x4E88;Exchange&#x6743;&#x9650;"></a></p>
<h4 id="711-&#x6388;&#x4E88;exchange&#x6743;&#x9650;"><a name="711-&#x6388;&#x4E88;exchange&#x6743;&#x9650;" class="anchor-navigation-ex-anchor" href="#711-&#x6388;&#x4E88;exchange&#x6743;&#x9650;"><i class="fa fa-link" aria-hidden="true"></i></a>7.1.1. &#x6388;&#x4E88;Exchange&#x6743;&#x9650;</h4>
<p>&#x60F3;&#x8981;&#x4E3A;&#x4E0D;&#x540C;&#x5BA2;&#x6237;&#x7AEF;&#x4EA4;&#x6362;&#x4EE4;&#x724C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x5728;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x8FDB;&#x884C;&#x6388;&#x6743;&#x624D;&#x80FD;&#x8FD9;&#x6837;&#x505A;&#x3002; &#x60A8;&#x9700;&#x8981;&#x5728;&#x8981;&#x83B7;&#x5F97;&#x6743;&#x9650;&#x4EA4;&#x6362;&#x7684;&#x76EE;&#x6807;&#x5BA2;&#x6237;&#x7AEF;&#x4E2D;&#x5B9A;&#x4E49;<code>token-exchange</code>&#x7EC6;&#x7C92;&#x5EA6;&#x6743;&#x9650;&#x3002;</p>
<p>&#x76EE;&#x6807;&#x5BA2;&#x6237;&#x7AEF;&#x6743;&#x9650;</p>
<p><img src="assets/exchange-target-client-permission-unset.png" alt="exchange target client permission unset"></p>
<p>&#x5C06;<code>Permissions Enabled</code>&#x5F00;&#x5173;&#x5207;&#x6362;&#x4E3A;ON&#x3002;</p>
<p>&#x76EE;&#x6807;&#x5BA2;&#x6237;&#x7AEF;&#x6743;&#x9650;</p>
<p><img src="assets/exchange-target-client-permission-set.png" alt="exchange target client permission set"></p>
<p>&#x60A8;&#x5E94;&#x8BE5;&#x5728;&#x9875;&#x9762;&#x4E0A;&#x770B;&#x5230;<code>token-exchange</code>&#x94FE;&#x63A5;&#x3002; &#x5355;&#x51FB;&#x8BE5;&#x5F00;&#x59CB;&#x5B9A;&#x4E49;&#x6743;&#x9650;&#x3002; &#x5B83;&#x4F1A;&#x5E26;&#x4F60;&#x5230;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#x3002;</p>
<p>&#x76EE;&#x6807;&#x5BA2;&#x6237;&#x7AEF;Exchange&#x6743;&#x9650;&#x8BBE;&#x7F6E;</p>
<p><img src="assets/exchange-target-client-permission-setup.png" alt="exchange target client permission setup"></p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x4E3A;&#x6B64;&#x6743;&#x9650;&#x5B9A;&#x4E49;&#x7B56;&#x7565;&#x3002; &#x5355;&#x51FB;<code>Authorization</code>&#x94FE;&#x63A5;&#xFF0C;&#x8F6C;&#x5230;<code>Policies</code>&#x9009;&#x9879;&#x5361;&#x5E76;&#x521B;&#x5EFA;<code>Client</code>&#x7B56;&#x7565;&#x3002;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x7B56;&#x7565;&#x521B;&#x5EFA;</p>
<p><img src="assets/exchange-target-client-policy.png" alt="exchange target client policy"></p>
<p>&#x5728;&#x6B64;&#x5904;&#x8F93;&#x5165;&#x8D77;&#x59CB;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5373;&#x8BF7;&#x6C42;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x521B;&#x5EFA;&#x6B64;&#x7B56;&#x7565;&#x540E;&#xFF0C;&#x8FD4;&#x56DE;&#x76EE;&#x6807;&#x5BA2;&#x6237;&#x7AEF;&#x7684;<code>token-exchange</code>&#x6743;&#x9650;&#x5E76;&#x6DFB;&#x52A0;&#x521A;&#x521A;&#x5B9A;&#x4E49;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x7B56;&#x7565;&#x3002;</p>
<p>&#x5E94;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x7B56;&#x7565;</p>
<p><img src="assets/exchange-target-client-exchange-apply-policy.png" alt="exchange target client exchange apply policy"></p>
<p>&#x60A8;&#x7684;&#x5BA2;&#x6237;&#x73B0;&#x5728;&#x6709;&#x6743;&#x8C03;&#x7528;&#x3002; &#x5982;&#x679C;&#x60A8;&#x6CA1;&#x6709;&#x6B63;&#x786E;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x5C1D;&#x8BD5;&#x8FDB;&#x884C;&#x4EA4;&#x6362;&#xFF0C;&#x5219;&#x4F1A;&#x6536;&#x5230;403 Forbidden&#x54CD;&#x5E94;&#x3002;</p>
<p><a name="271_____7_1_2__&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"></a></p>
<h4 id="712-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"><a name="712-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;" class="anchor-navigation-ex-anchor" href="#712-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"><i class="fa fa-link" aria-hidden="true"></i></a>7.1.2. &#x63D0;&#x51FA;&#x8BF7;&#x6C42;</h4>
<p>&#x5F53;&#x60A8;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4E3A;&#x6307;&#x5411;&#x53E6;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x73B0;&#x6709;&#x4EE4;&#x724C;&#x65F6;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x4F7F;&#x7528;<code>audience</code>&#x53C2;&#x6570;&#x3002; &#x6B64;&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F;&#x60A8;&#x5728;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x914D;&#x7F6E;&#x7684;&#x76EE;&#x6807;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x6807;&#x8BC6;&#x7B26;&#x3002;</p>
<pre><code class="lang-bash">curl -X POST \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_id=starting-client&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_secret=geheim&quot;</span> \
    --data-urlencode <span class="hljs-string">&quot;grant_type=urn:ietf:params:oauth:grant-type:token-exchange&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;subject_token=....&quot;</span> \
    --data-urlencode <span class="hljs-string">&quot;requested_token_type=urn:ietf:params:oauth:token-type:refresh_token&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;audience=target-client&quot;</span> \
    http://localhost:8080/auth/realms/myrealm/protocol/openid-connect/token
</code></pre>
<p><code>subject_token</code>&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F;&#x76EE;&#x6807;&#x9886;&#x57DF;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; &#x5982;&#x679C;&#x60A8;&#x7684;<code>requested_token_type</code>&#x53C2;&#x6570;&#x662F;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x7C7B;&#x578B;&#xFF0C;&#x5219;&#x54CD;&#x5E94;&#x5C06;&#x5305;&#x542B;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x548C;&#x5230;&#x671F;&#x3002; &#x8FD9;&#x662F;&#x60A8;&#x4ECE;&#x6B64;&#x8C03;&#x7528;&#x4E2D;&#x83B7;&#x5F97;&#x7684;&#x793A;&#x4F8B;JSON&#x54CD;&#x5E94;&#x3002;</p>
<pre><code class="lang-bash">{
   <span class="hljs-string">&quot;access_token&quot;</span> : <span class="hljs-string">&quot;....&quot;</span>,
   <span class="hljs-string">&quot;refresh_token&quot;</span> : <span class="hljs-string">&quot;....&quot;</span>,
   <span class="hljs-string">&quot;expires_in&quot;</span> : 3600
}
</code></pre>
<p><a name="272____7_2__&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x5185;&#x90E8;&#x4EE4;&#x724C;"></a></p>
<h3 id="72-&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x5185;&#x90E8;&#x4EE4;&#x724C;"><a name="72-&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x5185;&#x90E8;&#x4EE4;&#x724C;" class="anchor-navigation-ex-anchor" href="#72-&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x5185;&#x90E8;&#x4EE4;&#x724C;"><i class="fa fa-link" aria-hidden="true"></i></a>7.2. &#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x5185;&#x90E8;&#x4EE4;&#x724C;</h3>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x4E3A;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#x521B;&#x5EFA;&#x7684;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x9886;&#x57DF;&#x4EE4;&#x724C;&#x3002; &#x5FC5;&#x987B;&#x5728;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x7684;&#x201C;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x201D;&#x90E8;&#x5206;&#x4E2D;&#x914D;&#x7F6E;&#x6B64;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x3002; &#x76EE;&#x524D;&#x4EC5;&#x652F;&#x6301;&#x57FA;&#x4E8E;OAuth/OpenID Connect&#x7684;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#xFF0C;&#x8FD9;&#x5305;&#x62EC;&#x6240;&#x6709;&#x793E;&#x4EA4;&#x63D0;&#x4F9B;&#x5546;&#x3002; Keycloak&#x4E0D;&#x4F1A;&#x5411;&#x5916;&#x90E8;&#x63D0;&#x4F9B;&#x5546;&#x6267;&#x884C;&#x53CD;&#x5411;&#x4FE1;&#x9053;&#x4EA4;&#x6362;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x5E10;&#x6237;&#x672A;&#x94FE;&#x63A5;&#xFF0C;&#x60A8;&#x5C06;&#x65E0;&#x6CD5;&#x83B7;&#x5F97;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x3002; &#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x83B7;&#x5F97;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#xFF0C;&#x5FC5;&#x987B;&#x6EE1;&#x8DB3;&#x4EE5;&#x4E0B;&#x6761;&#x4EF6;&#x4E4B;&#x4E00;&#xFF1A;</p>
<ul>
<li>&#x7528;&#x6237;&#x5FC5;&#x987B;&#x81F3;&#x5C11;&#x4F7F;&#x7528;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x767B;&#x5F55;&#x4E00;&#x6B21;</li>
<li>&#x7528;&#x6237;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x7528;&#x6237;&#x5E10;&#x6237;&#x670D;&#x52A1;&#x4E0E;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x94FE;&#x63A5;</li>
<li>&#x7528;&#x6237;&#x5E10;&#x6237;&#x4F7F;&#x7528;<a href="https://www.keycloak.org/docs/6.0/server_development/" target="_blank">&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x52A8;&#x7684;&#x5E10;&#x6237;&#x94FE;&#x63A5;</a>API&#x901A;&#x8FC7;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x8FDB;&#x884C;&#x94FE;&#x63A5;&#x3002;</li>
</ul>
<p>&#x6700;&#x540E;&#xFF0C;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x5FC5;&#x987B;&#x5DF2;&#x914D;&#x7F6E;&#x4E3A;&#x5B58;&#x50A8;&#x4EE4;&#x724C;&#xFF0C;&#x6216;&#x8005;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x4E0E;&#x8981;&#x4EA4;&#x6362;&#x7684;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x76F8;&#x540C;&#x7684;&#x7528;&#x6237;&#x4F1A;&#x8BDD;&#x6267;&#x884C;&#x4E0A;&#x8FF0;&#x64CD;&#x4F5C;&#x4E4B;&#x4E00;&#x3002;</p>
<p>&#x5982;&#x679C;&#x5E10;&#x6237;&#x672A;&#x94FE;&#x63A5;&#xFF0C;&#x5219;&#x4EA4;&#x6362;&#x54CD;&#x5E94;&#x5C06;&#x5305;&#x542B;&#x53EF;&#x7528;&#x4E8E;&#x5EFA;&#x7ACB;&#x5E10;&#x6237;&#x7684;&#x94FE;&#x63A5;&#x3002; &#x8FD9;&#x5C06;&#x5728;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_internal_external_making_request" target="_blank">&#x53D1;&#x51FA;&#x8BF7;&#x6C42;</a>&#x90E8;&#x5206;&#x4E2D;&#x8FDB;&#x884C;&#x66F4;&#x591A;&#x8BA8;&#x8BBA;&#x3002;</p>
<p><a name="273_____7_2_1__&#x6388;&#x4E88;Exchange&#x6743;&#x9650;"></a></p>
<h4 id="721-&#x6388;&#x4E88;exchange&#x6743;&#x9650;"><a name="721-&#x6388;&#x4E88;exchange&#x6743;&#x9650;" class="anchor-navigation-ex-anchor" href="#721-&#x6388;&#x4E88;exchange&#x6743;&#x9650;"><i class="fa fa-link" aria-hidden="true"></i></a>7.2.1. &#x6388;&#x4E88;Exchange&#x6743;&#x9650;</h4>
<p>&#x5728;&#x60A8;&#x6388;&#x4E88;&#x547C;&#x53EB;&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x4EA4;&#x6362;&#x4EE4;&#x724C;&#x7684;&#x6743;&#x9650;&#x4E4B;&#x524D;&#xFF0C;&#x5C06;&#x62D2;&#x7EDD;&#x5185;&#x90E8;&#x5230;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x8BF7;&#x6C42;&#x7684;403&#x7981;&#x6B62;&#x54CD;&#x5E94;&#x3002; &#x8981;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x6388;&#x4E88;&#x6743;&#x9650;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x8F6C;&#x5230;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x7684;&#x914D;&#x7F6E;&#x9875;&#x9762;&#x4E2D;&#x7684;<code>Permissions</code>&#x9009;&#x9879;&#x5361;&#x3002;</p>
<p>&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x8BB8;&#x53EF;</p>
<p><img src="assets/exchange-idp-permission-unset.png" alt="exchange idp permission unset"></p>
<p>&#x5C06;<code>Permissions Enabled</code>&#x5207;&#x6362;&#x4E3A;true&#x3002;</p>
<p>&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x8BB8;&#x53EF;</p>
<p><img src="assets/exchange-idp-permission-set.png" alt="exchange idp permission set"></p>
<p>&#x60A8;&#x5E94;&#x8BE5;&#x5728;&#x9875;&#x9762;&#x4E0A;&#x770B;&#x5230;<code>token-exchange</code>&#x94FE;&#x63A5;&#x3002; &#x5355;&#x51FB;&#x8BE5;&#x5F00;&#x59CB;&#x5B9A;&#x4E49;&#x6743;&#x9650;&#x3002; &#x5B83;&#x4F1A;&#x5E26;&#x4F60;&#x5230;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#x3002;</p>
<p>&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;Exchange&#x6743;&#x9650;&#x8BBE;&#x7F6E;</p>
<p><img src="assets/exchange-idp-permission-setup.png" alt="exchange idp permission setup"></p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x4E3A;&#x6B64;&#x6743;&#x9650;&#x5B9A;&#x4E49;&#x7B56;&#x7565;&#x3002; &#x5355;&#x51FB;<code>Authorization</code>&#x94FE;&#x63A5;&#xFF0C;&#x8F6C;&#x5230;<code>Policies</code>&#x9009;&#x9879;&#x5361;&#x5E76;&#x521B;&#x5EFA;<code>Client</code>&#x7B56;&#x7565;&#x3002;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x7B56;&#x7565;&#x521B;&#x5EFA;</p>
<p><img src="assets/exchange-idp-client-policy.png" alt="exchange idp client policy"></p>
<p>&#x5728;&#x6B64;&#x5904;&#x8F93;&#x5165;&#x8D77;&#x59CB;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5373;&#x8BF7;&#x6C42;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x521B;&#x5EFA;&#x6B64;&#x7B56;&#x7565;&#x540E;&#xFF0C;&#x8FD4;&#x56DE;&#x5230;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#x7684;<code>token-exchange</code>&#x6743;&#x9650;&#x5E76;&#x6DFB;&#x52A0;&#x60A8;&#x521A;&#x5B9A;&#x4E49;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x7B56;&#x7565;&#x3002;</p>
<p>&#x5E94;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x7B56;&#x7565;</p>
<p><img src="assets/exchange-idp-apply-policy.png" alt="exchange idp apply policy"></p>
<p>&#x60A8;&#x7684;&#x5BA2;&#x6237;&#x73B0;&#x5728;&#x6709;&#x6743;&#x8C03;&#x7528;&#x3002; &#x5982;&#x679C;&#x60A8;&#x6CA1;&#x6709;&#x6B63;&#x786E;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x5C1D;&#x8BD5;&#x8FDB;&#x884C;&#x4EA4;&#x6362;&#xFF0C;&#x5219;&#x4F1A;&#x6536;&#x5230;403 Forbidden&#x54CD;&#x5E94;&#x3002;</p>
<p><a name="274_____7_2_2__&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"></a></p>
<h4 id="722-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"><a name="722-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;" class="anchor-navigation-ex-anchor" href="#722-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"><i class="fa fa-link" aria-hidden="true"></i></a>7.2.2. &#x63D0;&#x51FA;&#x8BF7;&#x6C42;</h4>
<p>&#x5F53;&#x60A8;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x73B0;&#x6709;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x5230;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x65F6;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;<code>requested_issuer</code>&#x53C2;&#x6570;&#x3002; &#x8BE5;&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F;&#x5DF2;&#x914D;&#x7F6E;&#x7684;&#x6807;&#x8BC6;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x7684;&#x522B;&#x540D;&#x3002;</p>
<pre><code class="lang-bash">curl -X POST \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_id=starting-client&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_secret=geheim&quot;</span> \
    --data-urlencode <span class="hljs-string">&quot;grant_type=urn:ietf:params:oauth:grant-type:token-exchange&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;subject_token=....&quot;</span> \
    --data-urlencode <span class="hljs-string">&quot;requested_token_type=urn:ietf:params:oauth:token-type:access_token&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;requested_issuer=google&quot;</span> \
    http://localhost:8080/auth/realms/myrealm/protocol/openid-connect/token
</code></pre>
<p><code>subject_token</code>&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F;&#x76EE;&#x6807;&#x9886;&#x57DF;&#x7684;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x3002; <code>requested_token_type</code>&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F;<code>urn:ietf:params:oauth:token-type:access_token</code>&#x6216;&#x7559;&#x7A7A;&#x3002; &#x76EE;&#x524D;&#x4E0D;&#x652F;&#x6301;&#x5176;&#x4ED6;&#x8BF7;&#x6C42;&#x7684;&#x4EE4;&#x724C;&#x7C7B;&#x578B;&#x3002; &#x4EE5;&#x4E0B;&#x662F;&#x60A8;&#x4ECE;&#x6B64;&#x8C03;&#x7528;&#x4E2D;&#x83B7;&#x5F97;&#x7684;&#x6210;&#x529F;JSON&#x54CD;&#x5E94;&#x793A;&#x4F8B;&#x3002;</p>
<pre><code class="lang-json">{
   <span class="hljs-string">&quot;access_token&quot;</span> : <span class="hljs-string">&quot;....&quot;</span>,
   <span class="hljs-string">&quot;expires_in&quot;</span> : <span class="hljs-number">3600</span>
   <span class="hljs-string">&quot;account-link-url&quot;</span> : <span class="hljs-string">&quot;https://....&quot;</span>
}
</code></pre>
<p>&#x5982;&#x679C;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x7531;&#x4E8E;&#x67D0;&#x79CD;&#x539F;&#x56E0;&#x672A;&#x94FE;&#x63A5;&#xFF0C;&#x60A8;&#x5C06;&#x83B7;&#x5F97;&#x5E26;&#x6709;&#x6B64;JSON&#x6587;&#x6863;&#x7684;HTTP 400&#x54CD;&#x5E94;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre><code class="lang-json">{
   <span class="hljs-string">&quot;error&quot;</span> : <span class="hljs-string">&quot;....&quot;</span>,
   <span class="hljs-string">&quot;error_description&quot;</span> : <span class="hljs-string">&quot;...&quot;</span>
   <span class="hljs-string">&quot;account-link-url&quot;</span> : <span class="hljs-string">&quot;https://....&quot;</span>
}
</code></pre>
<p><code>error</code>&#x58F0;&#x660E;&#x5C06;&#x662F;<code>token_expired</code>&#x6216;<code>not_linked</code>&#x3002; &#x63D0;&#x4F9B;&#x4E86;<code>account-link-url</code>&#x58F0;&#x660E;&#xFF0C;&#x4EE5;&#x4FBF;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x6267;&#x884C;<a href="https://www.keycloak.org/docs/6.0/server_development/" target="_blank">&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77;&#x7684;&#x5E10;&#x6237;&#x94FE;&#x63A5;</a>&#x3002; &#x5927;&#x591A;&#x6570;&#xFF08;&#x6240;&#x6709;&#xFF1F;&#xFF09;&#x63D0;&#x4F9B;&#x5546;&#x90FD;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;OAuth&#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x94FE;&#x63A5;&#x3002; &#x4F7F;&#x7528;<code>account-link-url</code>&#x53EA;&#x9700;&#x5411;&#x5176;&#x6DFB;&#x52A0;<code>redirect_uri</code>&#x67E5;&#x8BE2;&#x53C2;&#x6570;&#xFF0C;&#x60A8;&#x5C31;&#x53EF;&#x4EE5;&#x8F6C;&#x53D1;&#x6D4F;&#x89C8;&#x5668;&#x6765;&#x6267;&#x884C;&#x94FE;&#x63A5;&#x3002;</p>
<p><a name="275____7_3__&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;"></a></p>
<h3 id="73-&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;"><a name="73-&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;" class="anchor-navigation-ex-anchor" href="#73-&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;"><i class="fa fa-link" aria-hidden="true"></i></a>7.3. &#x5916;&#x90E8;&#x4EE4;&#x724C;&#x5230;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;</h3>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x4FE1;&#x4EFB;&#x5E76;&#x4EA4;&#x6362;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x4E3A;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x521B;&#x5EFA;&#x7684;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x3002; &#x8FD9;&#x53EF;&#x7528;&#x4E8E;&#x5728;&#x9886;&#x57DF;&#x4E4B;&#x95F4;&#x67B6;&#x8D77;&#x6865;&#x6881;&#xFF0C;&#x6216;&#x4EC5;&#x7528;&#x4E8E;&#x4FE1;&#x4EFB;&#x6765;&#x81EA;&#x793E;&#x4EA4;&#x63D0;&#x4F9B;&#x5546;&#x7684;&#x4EE4;&#x724C;&#x3002; &#x5B83;&#x4E0E;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x6D4F;&#x89C8;&#x5668;&#x767B;&#x5F55;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x7C7B;&#x4F3C;&#xFF0C;&#x5982;&#x679C;&#x65B0;&#x7528;&#x6237;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x4F1A;&#x5C06;&#x65B0;&#x7528;&#x6237;&#x5BFC;&#x5165;&#x60A8;&#x7684;&#x9886;&#x57DF;&#x3002;</p>
<blockquote>
<p>&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x5F53;&#x524D;&#x9650;&#x5236;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x6620;&#x5C04;&#x5230;&#x73B0;&#x6709;&#x7528;&#x6237;&#xFF0C;&#x5219;&#x4E0D;&#x5141;&#x8BB8;&#x4EA4;&#x6362;&#xFF0C;&#x9664;&#x975E;&#x73B0;&#x6709;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x5177;&#x6709;&#x5230;&#x5916;&#x90E8;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#x7684;&#x5E10;&#x6237;&#x94FE;&#x63A5;&#x3002;</p>
</blockquote>
<p>&#x4EA4;&#x6362;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x5C06;&#x5728;&#x9886;&#x57DF;&#x5185;&#x521B;&#x5EFA;&#x7528;&#x6237;&#x4F1A;&#x8BDD;&#xFF0C;&#x60A8;&#x5C06;&#x6839;&#x636E;<code>requested_token_type</code>&#x53C2;&#x6570;&#x503C;&#x63A5;&#x6536;&#x8BBF;&#x95EE;&#x548C;/&#x6216;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x3002; &#x60A8;&#x5E94;&#x8BE5;&#x6CE8;&#x610F;&#xFF0C;&#x6B64;&#x65B0;&#x7528;&#x6237;&#x4F1A;&#x8BDD;&#x5C06;&#x4FDD;&#x6301;&#x6D3B;&#x52A8;&#x72B6;&#x6001;&#xFF0C;&#x76F4;&#x5230;&#x5B83;&#x8D85;&#x65F6;&#x6216;&#x76F4;&#x5230;&#x60A8;&#x8C03;&#x7528;&#x57DF;&#x7684;&#x6CE8;&#x9500;&#x7AEF;&#x70B9;&#x4F20;&#x9012;&#x6B64;&#x65B0;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x4E3A;&#x6B62;&#x3002;</p>
<p>&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x7684;&#x66F4;&#x6539;&#x9700;&#x8981;&#x5728;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x914D;&#x7F6E;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x3002;</p>
<blockquote>
<p>&#x76EE;&#x524D;&#x4E0D;&#x652F;&#x6301;SAML&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x3002; Twitter&#x4EE4;&#x724C;&#x4E5F;&#x65E0;&#x6CD5;&#x4EA4;&#x6362;&#x3002;</p>
</blockquote>
<p><a name="276_____7_3_1__&#x6388;&#x4E88;Exchange&#x6743;&#x9650;"></a></p>
<h4 id="731-&#x6388;&#x4E88;exchange&#x6743;&#x9650;"><a name="731-&#x6388;&#x4E88;exchange&#x6743;&#x9650;" class="anchor-navigation-ex-anchor" href="#731-&#x6388;&#x4E88;exchange&#x6743;&#x9650;"><i class="fa fa-link" aria-hidden="true"></i></a>7.3.1. &#x6388;&#x4E88;Exchange&#x6743;&#x9650;</h4>
<p>&#x5728;&#x8FDB;&#x884C;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x4E4B;&#x524D;&#xFF0C;&#x60A8;&#x5FC5;&#x987B;&#x4E3A;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6388;&#x4E88;&#x8FDB;&#x884C;&#x4EA4;&#x6362;&#x7684;&#x6743;&#x9650;&#x3002; &#x6B64;&#x6743;&#x9650;&#x7684;&#x6388;&#x4E88;&#x65B9;&#x5F0F;&#x4E0E;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_grant_permission_external_exchange" target="_blank">&#x6388;&#x4E88;&#x5916;&#x90E8;&#x6743;&#x9650;&#x7684;&#x5185;&#x90E8;</a>&#x76F8;&#x540C;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;<code>audience</code>&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x6307;&#x5411;&#x4E0D;&#x540C;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5219;&#x8FD8;&#x5FC5;&#x987B;&#x6388;&#x4E88;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;<code>audience</code>&#x53C2;&#x6570;&#x4E2D;&#x7279;&#x5B9A;&#x76EE;&#x6807;&#x5BA2;&#x6237;&#x7AEF;&#x4EA4;&#x6362;&#x7684;&#x6743;&#x9650;&#x3002; &#x5982;&#x4F55;&#x505A;&#x5230;&#x8FD9;&#x4E00;&#x70B9;<a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_client_to_client_permission" target="_blank">&#x5728;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BA8;&#x8BBA;&#x8FC7;</a>&#x3002;</p>
<p><a name="277_____7_3_2__&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"></a></p>
<h4 id="732-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"><a name="732-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;" class="anchor-navigation-ex-anchor" href="#732-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"><i class="fa fa-link" aria-hidden="true"></i></a>7.3.2. &#x63D0;&#x51FA;&#x8BF7;&#x6C42;</h4>
<p><code>subject_token_type</code>&#x5FC5;&#x987B;&#x662F;<code>urn:ietf:params:oauth:token-type:access_token</code> &#x6216; <code>urn:ietf:params:oauth:token-type:jwt</code>&#x3002; &#x5982;&#x679C;&#x7C7B;&#x578B;&#x662F;<code>urn:ietf:params:oauth:token-type:access_token</code>&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x6307;&#x5B9A;<code>subject_issuer</code>&#x53C2;&#x6570;&#xFF0C;&#x5B83;&#x5FC5;&#x987B;&#x662F;&#x5DF2;&#x914D;&#x7F6E;&#x7684;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x8005;&#x7684;&#x522B;&#x540D;&#x3002; &#x5982;&#x679C;&#x7C7B;&#x578B;&#x662F; <code>urn:ietf:params:oauth:token-type:jwt</code>&#xFF0C;&#x5219;&#x63D0;&#x4F9B;&#x8005;&#x5C06;&#x901A;&#x8FC7;JWT&#x4E2D;&#x7684;<code>issuer</code>&#x58F0;&#x660E;&#x8FDB;&#x884C;&#x5339;&#x914D;&#xFF0C;&#x8BE5;&#x58F0;&#x660E;&#x5FC5;&#x987B;&#x662F;&#x63D0;&#x4F9B;&#x8005;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x6216;&#x8005;&#x63D0;&#x4F9B;&#x8005;&#x914D;&#x7F6E;&#x4E2D;&#x7684;&#x6CE8;&#x518C;&#x53D1;&#x5E03;&#x65B9;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x9A8C;&#x8BC1;&#xFF0C;&#x5982;&#x679C;&#x4EE4;&#x724C;&#x662F;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x5219;&#x5C06;&#x8C03;&#x7528;&#x63D0;&#x4F9B;&#x8005;&#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x670D;&#x52A1;&#x4EE5;&#x9A8C;&#x8BC1;&#x4EE4;&#x724C;&#x3002; &#x6210;&#x529F;&#x901A;&#x8BDD;&#x610F;&#x5473;&#x7740;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x6709;&#x6548;&#x3002; &#x5982;&#x679C;&#x4E3B;&#x9898;&#x4EE4;&#x724C;&#x662F;JWT&#x5E76;&#x4E14;&#x5982;&#x679C;&#x63D0;&#x4F9B;&#x8005;&#x542F;&#x7528;&#x4E86;&#x7B7E;&#x540D;&#x9A8C;&#x8BC1;&#xFF0C;&#x5219;&#x5C06;&#x5C1D;&#x8BD5;&#x8FDB;&#x884C;&#xFF0C;&#x5426;&#x5219;&#xFF0C;&#x5B83;&#x5C06;&#x9ED8;&#x8BA4;&#x4E5F;&#x8C03;&#x7528;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x670D;&#x52A1;&#x6765;&#x9A8C;&#x8BC1;&#x4EE4;&#x724C;&#x3002;</p>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x94F8;&#x9020;&#x5C06;&#x4F7F;&#x7528;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x4E3A;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5B9A;&#x4E49;&#x7684;&#x534F;&#x8BAE;&#x6620;&#x5C04;&#x5668;&#x6765;&#x786E;&#x5B9A;&#x4EE4;&#x724C;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x3002; &#x6216;&#x8005;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>audience</code>&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x5176;&#x4ED6;&#x76EE;&#x6807;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
<pre><code class="lang-bash">curl -X POST \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_id=starting-client&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_secret=geheim&quot;</span> \
    --data-urlencode <span class="hljs-string">&quot;grant_type=urn:ietf:params:oauth:grant-type:token-exchange&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;subject_token=....&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;subject_issuer=myOidcProvider&quot;</span> \
    --data-urlencode <span class="hljs-string">&quot;subject_token_type=urn:ietf:params:oauth:token-type:access_token&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;audience=target-client&quot;</span> \
    http://localhost:8080/auth/realms/myrealm/protocol/openid-connect/token
</code></pre>
<p>&#x5982;&#x679C;&#x60A8;&#x7684;<code>requested_token_type</code>&#x53C2;&#x6570;&#x662F;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x7C7B;&#x578B;&#xFF0C;&#x5219;&#x54CD;&#x5E94;&#x5C06;&#x5305;&#x542B;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#xFF0C;&#x5237;&#x65B0;&#x4EE4;&#x724C;&#x548C;&#x5230;&#x671F;&#x3002; &#x8FD9;&#x662F;&#x60A8;&#x4ECE;&#x6B64;&#x8C03;&#x7528;&#x4E2D;&#x83B7;&#x5F97;&#x7684;&#x793A;&#x4F8B;JSON&#x54CD;&#x5E94;&#x3002;</p>
<pre><code class="lang-json">{
   <span class="hljs-string">&quot;access_token&quot;</span> : <span class="hljs-string">&quot;....&quot;</span>,
   <span class="hljs-string">&quot;refresh_token&quot;</span> : <span class="hljs-string">&quot;....&quot;</span>,
   <span class="hljs-string">&quot;expires_in&quot;</span> : <span class="hljs-number">3600</span>
}
</code></pre>
<p><a name="278____7_4__&#x6A21;&#x62DF;"></a></p>
<h3 id="74-&#x6A21;&#x62DF;"><a name="74-&#x6A21;&#x62DF;" class="anchor-navigation-ex-anchor" href="#74-&#x6A21;&#x62DF;"><i class="fa fa-link" aria-hidden="true"></i></a>7.4. &#x6A21;&#x62DF;</h3>
<p>&#x5BF9;&#x4E8E;&#x5185;&#x90E8;&#x548C;&#x5916;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x4EE3;&#x8868;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x5192;&#x5145;&#x4E0D;&#x540C;&#x7684;&#x7528;&#x6237;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x6A21;&#x62DF;&#x7528;&#x6237;&#x7684;&#x7BA1;&#x7406;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x4EE5;&#x4FBF;&#x652F;&#x6301;&#x5DE5;&#x7A0B;&#x5E08;&#x53EF;&#x4EE5;&#x8C03;&#x8BD5;&#x95EE;&#x9898;&#x3002;</p>
<p><a name="279_____7_4_1__&#x6388;&#x4E88;Exchange&#x6743;&#x9650;"></a></p>
<h4 id="741-&#x6388;&#x4E88;exchange&#x6743;&#x9650;"><a name="741-&#x6388;&#x4E88;exchange&#x6743;&#x9650;" class="anchor-navigation-ex-anchor" href="#741-&#x6388;&#x4E88;exchange&#x6743;&#x9650;"><i class="fa fa-link" aria-hidden="true"></i></a>7.4.1. &#x6388;&#x4E88;Exchange&#x6743;&#x9650;</h4>
<p>&#x4E3B;&#x9898;&#x4EE4;&#x724C;&#x6240;&#x4EE3;&#x8868;&#x7684;&#x7528;&#x6237;&#x5FC5;&#x987B;&#x5177;&#x6709;&#x6A21;&#x4EFF;&#x5176;&#x4ED6;&#x7528;&#x6237;&#x7684;&#x6743;&#x9650;&#x3002; &#x6709;&#x5173;&#x5982;&#x4F55;&#x542F;&#x7528;&#x6B64;&#x6743;&#x9650;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;<a href="https://www.keycloak.org/docs/6.0/server_admin/" target="_blank">&#x670D;&#x52A1;&#x5668;&#x7BA1;&#x7406;&#x6307;&#x5357;</a>&#x3002; &#x5B83;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x89D2;&#x8272;&#x6216;&#x7EC6;&#x7C92;&#x5EA6;&#x7BA1;&#x7406;&#x5458;&#x6743;&#x9650;&#x6765;&#x5B8C;&#x6210;&#x3002;</p>
<p><a name="280_____7_4_2__&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"></a></p>
<h4 id="742-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"><a name="742-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;" class="anchor-navigation-ex-anchor" href="#742-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"><i class="fa fa-link" aria-hidden="true"></i></a>7.4.2. &#x63D0;&#x51FA;&#x8BF7;&#x6C42;</h4>
<p>&#x9664;&#x4E86;&#x53E6;&#x5916;&#x6307;&#x5B9A;<code>request_subject</code>&#x53C2;&#x6570;&#x4E4B;&#x5916;&#xFF0C;&#x6309;&#x7167;&#x5176;&#x4ED6;&#x7AE0;&#x8282;&#x4E2D;&#x7684;&#x63CF;&#x8FF0;&#x53D1;&#x51FA;&#x8BF7;&#x6C42;&#x3002; &#x6B64;&#x53C2;&#x6570;&#x7684;&#x503C;&#x5FC5;&#x987B;&#x662F;&#x7528;&#x6237;&#x540D;&#x6216;&#x7528;&#x6237;ID&#x3002;</p>
<pre><code class="lang-bash">curl -X POST \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_id=starting-client&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_secret=geheim&quot;</span> \
    --data-urlencode <span class="hljs-string">&quot;grant_type=urn:ietf:params:oauth:grant-type:token-exchange&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;subject_token=....&quot;</span> \
    --data-urlencode <span class="hljs-string">&quot;requested_token_type=urn:ietf:params:oauth:token-type:access_token&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;audience=target-client&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;requested_subject=wburke&quot;</span> \
    http://localhost:8080/auth/realms/myrealm/protocol/openid-connect/token
</code></pre>
<p><a name="281____7_5__&#x76F4;&#x63A5;&#x8D64;&#x88F8;&#x88F8;&#x7684;&#x6A21;&#x62DF;"></a></p>
<h3 id="75-&#x76F4;&#x63A5;&#x8D64;&#x88F8;&#x88F8;&#x7684;&#x6A21;&#x62DF;"><a name="75-&#x76F4;&#x63A5;&#x8D64;&#x88F8;&#x88F8;&#x7684;&#x6A21;&#x62DF;" class="anchor-navigation-ex-anchor" href="#75-&#x76F4;&#x63A5;&#x8D64;&#x88F8;&#x88F8;&#x7684;&#x6A21;&#x62DF;"><i class="fa fa-link" aria-hidden="true"></i></a>7.5. &#x76F4;&#x63A5;&#x8D64;&#x88F8;&#x88F8;&#x7684;&#x6A21;&#x62DF;</h3>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x63D0;&#x4F9B;<code>subject_token</code>&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x53D1;&#x51FA;&#x5185;&#x90E8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x79F0;&#x4E3A;&#x76F4;&#x63A5;&#x88F8;&#x6A21;&#x62DF;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x975E;&#x5E38;&#x4FE1;&#x4EFB;&#x5BA2;&#x6237;&#x673A;&#xFF0C;&#x56E0;&#x4E3A;&#x5BA2;&#x6237;&#x673A;&#x53EF;&#x4EE5;&#x6A21;&#x62DF;&#x57DF;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x3002;&#x5728;&#x65E0;&#x6CD5;&#x83B7;&#x5F97;&#x8981;&#x4EA4;&#x6362;&#x7684;&#x4E3B;&#x9898;&#x4EE4;&#x724C;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x6B64;&#x6865;&#x63A5;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x6B63;&#x5728;&#x96C6;&#x6210;&#x4E00;&#x4E2A;&#x76F4;&#x63A5;&#x4F7F;&#x7528;LDAP&#x6267;&#x884C;&#x767B;&#x5F55;&#x7684;&#x9057;&#x7559;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x9057;&#x7559;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x80FD;&#x591F;&#x5BF9;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x4F46;&#x65E0;&#x6CD5;&#x83B7;&#x5F97;&#x4EE4;&#x724C;&#x3002;</p>
<blockquote>
<p>&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x7528;&#x76F4;&#x63A5;&#x88F8;&#x6A21;&#x62DF;&#x662F;&#x975E;&#x5E38;&#x5371;&#x9669;&#x7684;&#x3002;&#x5982;&#x679C;&#x5BA2;&#x6237;&#x673A;&#x7684;&#x51ED;&#x636E;&#x88AB;&#x76D7;&#xFF0C;&#x5219;&#x8BE5;&#x5BA2;&#x6237;&#x673A;&#x53EF;&#x4EE5;&#x6A21;&#x62DF;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x3002;</p>
</blockquote>
<p><a name="282_____7_5_1__&#x6388;&#x4E88;Exchange&#x6743;&#x9650;"></a></p>
<h4 id="751-&#x6388;&#x4E88;exchange&#x6743;&#x9650;"><a name="751-&#x6388;&#x4E88;exchange&#x6743;&#x9650;" class="anchor-navigation-ex-anchor" href="#751-&#x6388;&#x4E88;exchange&#x6743;&#x9650;"><i class="fa fa-link" aria-hidden="true"></i></a>7.5.1. &#x6388;&#x4E88;Exchange&#x6743;&#x9650;</h4>
<p>&#x5982;&#x679C;&#x63D0;&#x4F9B;&#x4E86;<code>audience</code>&#x53C2;&#x6570;&#xFF0C;&#x5219;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x5FC5;&#x987B;&#x5177;&#x6709;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x4EA4;&#x6362;&#x7684;&#x6743;&#x9650;&#x3002; &#x672C;&#x7AE0;&#x524D;&#x9762;&#x5C06;&#x8BA8;&#x8BBA;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x6B64;&#x8BBE;&#x7F6E;&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x5FC5;&#x987B;&#x6388;&#x4E88;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x6A21;&#x62DF;&#x7528;&#x6237;&#x7684;&#x6743;&#x9650;&#x3002; &#x5728;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#xFF0C;&#x8F6C;&#x5230;<code>Users</code>&#x5C4F;&#x5E55;&#xFF0C;&#x7136;&#x540E;&#x5355;&#x51FB;<code>Permissions</code>&#x9009;&#x9879;&#x5361;&#x3002;</p>
<p>&#x7528;&#x6237;&#x6743;&#x9650;</p>
<p><img src="assets/exchange-users-permission-unset.png" alt="exchange users permission unset"></p>
<p>&#x5C06;<code>Permissions Enabled</code>&#x5207;&#x6362;&#x4E3A;true&#x3002;</p>
<p>&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x5546;&#x8BB8;&#x53EF;</p>
<p><img src="assets/exchange-users-permission-set.png" alt="exchange users permission set"></p>
<p>&#x60A8;&#x5E94;&#x8BE5;&#x5728;&#x9875;&#x9762;&#x4E0A;&#x770B;&#x5230;<code>impersonation</code>&#x94FE;&#x63A5;&#x3002; &#x5355;&#x51FB;&#x8BE5;&#x5F00;&#x59CB;&#x5B9A;&#x4E49;&#x6743;&#x9650;&#x3002; &#x5B83;&#x4F1A;&#x5E26;&#x4F60;&#x5230;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#x3002;</p>
<p>&#x7528;&#x6237;&#x6A21;&#x62DF;&#x6743;&#x9650;&#x8BBE;&#x7F6E;</p>
<p><img src="assets/exchange-users-permission-setup.png" alt="exchange users permission setup"></p>
<p>&#x60A8;&#x5FC5;&#x987B;&#x4E3A;&#x6B64;&#x6743;&#x9650;&#x5B9A;&#x4E49;&#x7B56;&#x7565;&#x3002; &#x5355;&#x51FB;<code>Authorization</code>&#x94FE;&#x63A5;&#xFF0C;&#x8F6C;&#x5230;<code>Policies</code>&#x9009;&#x9879;&#x5361;&#x5E76;&#x521B;&#x5EFA;<code>Client</code>&#x7B56;&#x7565;&#x3002;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x7B56;&#x7565;&#x521B;&#x5EFA;</p>
<p><img src="assets/exchange-users-client-policy.png" alt="exchange users client policy"></p>
<p>&#x5728;&#x6B64;&#x5904;&#x8F93;&#x5165;&#x8D77;&#x59CB;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5373;&#x8BF7;&#x6C42;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x7684;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x521B;&#x5EFA;&#x6B64;&#x7B56;&#x7565;&#x540E;&#xFF0C;&#x8BF7;&#x8FD4;&#x56DE;&#x7528;&#x6237;&#x7684;<code>impersonation</code>&#x6743;&#x9650;&#x5E76;&#x6DFB;&#x52A0;&#x521A;&#x521A;&#x5B9A;&#x4E49;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x7B56;&#x7565;&#x3002;</p>
<p>&#x5E94;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x7B56;&#x7565;</p>
<p><img src="assets/exchange-users-apply-policy.png" alt="exchange users apply policy"></p>
<p>&#x60A8;&#x7684;&#x5BA2;&#x6237;&#x673A;&#x73B0;&#x5728;&#x5177;&#x6709;&#x6A21;&#x4EFF;&#x7528;&#x6237;&#x7684;&#x6743;&#x9650;&#x3002;&#x5982;&#x679C;&#x60A8;&#x6CA1;&#x6709;&#x6B63;&#x786E;&#x5730;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x5C1D;&#x8BD5;&#x8FDB;&#x884C;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x4EA4;&#x6362;&#xFF0C;&#x60A8;&#x5C06;&#x5F97;&#x5230;403&#x7981;&#x6B62;&#x54CD;&#x5E94;&#x3002;</p>
<blockquote>
<p>&#x516C;&#x5171;&#x5BA2;&#x6237;&#x7AEF;&#x4E0D;&#x5141;&#x8BB8;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x88F8;&#x6A21;&#x62DF;&#x3002;</p>
</blockquote>
<p><a name="283_____7_5_2__&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"></a></p>
<h4 id="752-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"><a name="752-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;" class="anchor-navigation-ex-anchor" href="#752-&#x63D0;&#x51FA;&#x8BF7;&#x6C42;"><i class="fa fa-link" aria-hidden="true"></i></a>7.5.2. &#x63D0;&#x51FA;&#x8BF7;&#x6C42;</h4>
<p>&#x8981;&#x53D1;&#x51FA;&#x8BF7;&#x6C42;&#xFF0C;&#x53EA;&#x9700;&#x6307;&#x5B9A;<code>requested_subject</code>&#x53C2;&#x6570;&#x5373;&#x53EF;&#x3002; &#x8FD9;&#x5FC5;&#x987B;&#x662F;&#x6709;&#x6548;&#x7528;&#x6237;&#x7684;&#x7528;&#x6237;&#x540D;&#x6216;&#x7528;&#x6237;ID&#x3002; &#x5982;&#x679C;&#x60A8;&#x613F;&#x610F;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;<code>audience</code>&#x53C2;&#x6570;&#x3002;</p>
<pre><code class="lang-bash">curl -X POST \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_id=starting-client&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;client_secret=geheim&quot;</span> \
    --data-urlencode <span class="hljs-string">&quot;grant_type=urn:ietf:params:oauth:grant-type:token-exchange&quot;</span> \
    <span class="hljs-_">-d</span> <span class="hljs-string">&quot;requested_subject=wburke&quot;</span> \
    http://localhost:8080/auth/realms/myrealm/protocol/openid-connect/token
</code></pre>
<p><a name="284____7_6__&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x5C55;&#x5F00;&#x6743;&#x9650;&#x6A21;&#x578B;"></a></p>
<h3 id="76-&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x5C55;&#x5F00;&#x6743;&#x9650;&#x6A21;&#x578B;"><a name="76-&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x5C55;&#x5F00;&#x6743;&#x9650;&#x6A21;&#x578B;" class="anchor-navigation-ex-anchor" href="#76-&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x5C55;&#x5F00;&#x6743;&#x9650;&#x6A21;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>7.6. &#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x5C55;&#x5F00;&#x6743;&#x9650;&#x6A21;&#x578B;</h3>
<p>&#x6388;&#x4E88;&#x5BA2;&#x6237;&#x7AEF;&#x4EA4;&#x6362;&#x6743;&#x9650;&#x65F6;&#xFF0C;&#x60A8;&#x4E0D;&#x5FC5;&#x4E3A;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x624B;&#x52A8;&#x542F;&#x7528;&#x8FD9;&#x4E9B;&#x6743;&#x9650;&#x3002; &#x5982;&#x679C;&#x5BA2;&#x6237;&#x7AEF;&#x5177;&#x6709;&#x4E0E;&#x4E4B;&#x5173;&#x8054;&#x7684;&#x670D;&#x52A1;&#x5E10;&#x6237;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x89D2;&#x8272;&#x5C06;&#x6743;&#x9650;&#x7EC4;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x5C06;&#x89D2;&#x8272;&#x5206;&#x914D;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x6765;&#x5206;&#x914D;&#x4EA4;&#x6362;&#x6743;&#x9650;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;<code>naked-exchange</code>&#x89D2;&#x8272;&#xFF0C;&#x4EFB;&#x4F55;&#x5177;&#x6709;&#x8BE5;&#x89D2;&#x8272;&#x7684;&#x670D;&#x52A1;&#x5E10;&#x6237;&#x90FD;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x88F8;&#x4EA4;&#x6362;&#x3002;</p>
<p><a name="285____7_7__&#x4EA4;&#x6362;&#x6F0F;&#x6D1E;"></a></p>
<h3 id="77-&#x4EA4;&#x6362;&#x6F0F;&#x6D1E;"><a name="77-&#x4EA4;&#x6362;&#x6F0F;&#x6D1E;" class="anchor-navigation-ex-anchor" href="#77-&#x4EA4;&#x6362;&#x6F0F;&#x6D1E;"><i class="fa fa-link" aria-hidden="true"></i></a>7.7. &#x4EA4;&#x6362;&#x6F0F;&#x6D1E;</h3>
<p>&#x5F53;&#x4F60;&#x5F00;&#x59CB;&#x5141;&#x8BB8;&#x4EE4;&#x724C;&#x4EA4;&#x6362;&#x65F6;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x548C;&#x6CE8;&#x610F;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x4E8B;&#x60C5;&#x3002;</p>
<p>&#x9996;&#x5148;&#x662F;&#x516C;&#x5171;&#x5BA2;&#x6237;&#x3002; &#x516C;&#x5171;&#x5BA2;&#x6237;&#x7AEF;&#x6CA1;&#x6709;&#x6216;&#x9700;&#x8981;&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x8BC1;&#x624D;&#x80FD;&#x6267;&#x884C;&#x4EA4;&#x6362;&#x3002; &#x4EFB;&#x4F55;&#x62E5;&#x6709;&#x6709;&#x6548;&#x4EE4;&#x724C;&#x7684;&#x4EBA;&#x90FD;&#x53EF;&#x4EE5;<em>impersonate</em>&#x516C;&#x5171;&#x5BA2;&#x6237;&#x7AEF;&#x5E76;&#x6267;&#x884C;&#x5141;&#x8BB8;&#x516C;&#x5171;&#x5BA2;&#x6237;&#x7AEF;&#x6267;&#x884C;&#x7684;&#x4EA4;&#x6362;&#x3002; &#x5982;&#x679C;&#x6709;&#x4EFB;&#x4F55;&#x7531;&#x60A8;&#x7684;&#x57DF;&#x7BA1;&#x7406;&#x7684;&#x4E0D;&#x503C;&#x5F97;&#x4FE1;&#x4EFB;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x516C;&#x5171;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x60A8;&#x7684;&#x6743;&#x9650;&#x6A21;&#x578B;&#x4E2D;&#x6253;&#x5F00;&#x6F0F;&#x6D1E;&#x3002; &#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x76F4;&#x63A5;&#x88F8;&#x4EA4;&#x6362;&#x4E0D;&#x5141;&#x8BB8;&#x516C;&#x5171;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5E76;&#x4E14;&#x5982;&#x679C;&#x4E3B;&#x53EB;&#x5BA2;&#x6237;&#x7AEF;&#x662F;&#x516C;&#x5171;&#x7684;&#xFF0C;&#x5C06;&#x4E2D;&#x6B62;&#x9519;&#x8BEF;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x4EA4;&#x6362;&#x7531;Facebook&#xFF0C;Google&#x7B49;&#x63D0;&#x4F9B;&#x7684;&#x793E;&#x4EA4;&#x4EE4;&#x724C;&#x4F5C;&#x4E3A;&#x9886;&#x57DF;&#x4EE4;&#x724C;&#x3002; &#x8BF7;&#x5C0F;&#x5FC3;&#x5E76;&#x8B66;&#x60D5;&#x4EA4;&#x6362;&#x4EE4;&#x724C;&#x53EF;&#x4EE5;&#x505A;&#x4EC0;&#x4E48;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x8FD9;&#x4E9B;&#x793E;&#x4EA4;&#x7F51;&#x7AD9;&#x4E0A;&#x521B;&#x5EFA;&#x865A;&#x5047;&#x8D26;&#x6237;&#x5E76;&#x4E0D;&#x56F0;&#x96BE;&#x3002; &#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x89D2;&#x8272;&#xFF0C;&#x7EC4;&#x548C;&#x8EAB;&#x4EFD;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x6620;&#x5C04;&#x5668;&#x6765;&#x63A7;&#x5236;&#x4E3A;&#x5916;&#x90E8;&#x793E;&#x4EA4;&#x7528;&#x6237;&#x5206;&#x914D;&#x7684;&#x5C5E;&#x6027;&#x548C;&#x89D2;&#x8272;&#x3002;</p>
<p>&#x76F4;&#x63A5;&#x7684;&#x88F8;&#x4EA4;&#x6362;&#x975E;&#x5E38;&#x5371;&#x9669;&#x3002; &#x60A8;&#x5BF9;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x975E;&#x5E38;&#x4FE1;&#x4EFB;&#x5B83;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x6CC4;&#x9732;&#x5176;&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x636E;&#x3002; &#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x51ED;&#x636E;&#x88AB;&#x6CC4;&#x9732;&#xFF0C;&#x90A3;&#x4E48;&#x5C0F;&#x5077;&#x53EF;&#x4EE5;&#x5192;&#x5145;&#x4F60;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x4EBA;&#x3002; &#x8FD9;&#x4E0E;&#x5177;&#x6709;&#x73B0;&#x6709;&#x4EE4;&#x724C;&#x7684;&#x673A;&#x5BC6;&#x5BA2;&#x6237;&#x5F62;&#x6210;&#x9C9C;&#x660E;&#x5BF9;&#x6BD4;&#x3002; &#x60A8;&#x6709;&#x4E24;&#x4E2A;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x56E0;&#x7D20;&#xFF0C;&#x8BBF;&#x95EE;&#x4EE4;&#x724C;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x51ED;&#x636E;&#xFF0C;&#x800C;&#x60A8;&#x53EA;&#x5904;&#x7406;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x3002; &#x56E0;&#x6B64;&#xFF0C;&#x8BF7;&#x8C28;&#x614E;&#x4F7F;&#x7528;&#x76F4;&#x63A5;&#x88F8;&#x4EA4;&#x6362;&#x3002;</p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; WS 2019 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2021-01-04 20:08:11
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="02_Server Installation and Configuration Guide.html#110____10_4__Keycloak标识头" class="navigation navigation-prev " aria-label="Previous page: 10.4. Keycloak标识头">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="03_Securing Applications and Services Guide.html#1___1__概述" class="navigation navigation-next " aria-label="Next page: 1. 概述">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"保护应用程序和服务指南","level":"4.1","depth":1,"next":{"title":"1. 概述","level":"4.1.1","depth":2,"anchor":"#1___1__概述","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#1___1__概述","articles":[{"title":"1.1. 什么是客户端适配器?","level":"4.1.1.1","depth":3,"anchor":"#2____1_1__什么是客户端适配器_","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#2____1_1__什么是客户端适配器_","articles":[]},{"title":"1.2. 支持的平台","level":"4.1.1.2","depth":3,"anchor":"#3____1_2__支持的平台","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#3____1_2__支持的平台","articles":[{"title":"1.2.1. OpenID Connect","level":"4.1.1.2.1","depth":4,"anchor":"#4_____1_2_1__OpenID_Connect","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#4_____1_2_1__OpenID_Connect","articles":[{"title":"Java","level":"4.1.1.2.1.1","depth":5,"anchor":"#5______Java","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#5______Java","articles":[]},{"title":"JavaScript (client-side)","level":"4.1.1.2.1.2","depth":5,"anchor":"#6______JavaScript__client_side_","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#6______JavaScript__client_side_","articles":[]},{"title":"Node.js (server-side)","level":"4.1.1.2.1.3","depth":5,"anchor":"#7______Node_js__server_side_","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#7______Node_js__server_side_","articles":[]},{"title":"1.2.2. C","level":"4.1.1.2.1.4","depth":5,"anchor":"#8_____1_2_2__C_","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#8_____1_2_2__C_","articles":[]}]},{"title":"1.2.3. Python","level":"4.1.1.2.2","depth":4,"anchor":"#9_____1_2_3__Python","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#9_____1_2_3__Python","articles":[]},{"title":"1.2.4. Android","level":"4.1.1.2.3","depth":4,"anchor":"#10_____1_2_4__Android","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#10_____1_2_4__Android","articles":[]},{"title":"1.2.5. iOS","level":"4.1.1.2.4","depth":4,"anchor":"#11_____1_2_5__iOS","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#11_____1_2_5__iOS","articles":[{"title":"Apache HTTP Server","level":"4.1.1.2.4.1","depth":5,"anchor":"#12______Apache_HTTP_Server","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#12______Apache_HTTP_Server","articles":[]}]},{"title":"1.2.6. SAML","level":"4.1.1.2.5","depth":4,"anchor":"#13_____1_2_6__SAML","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#13_____1_2_6__SAML","articles":[{"title":"Java","level":"4.1.1.2.5.1","depth":5,"anchor":"#14______Java","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#14______Java","articles":[]},{"title":"Apache HTTP Server","level":"4.1.1.2.5.2","depth":5,"anchor":"#15______Apache_HTTP_Server","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#15______Apache_HTTP_Server","articles":[]}]}]},{"title":"1.3. 支持的协议","level":"4.1.1.3","depth":3,"anchor":"#16____1_3__支持的协议","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#16____1_3__支持的协议","articles":[{"title":"1.3.1. OpenID Connect","level":"4.1.1.3.1","depth":4,"anchor":"#17_____1_3_1__OpenID_Connect","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#17_____1_3_1__OpenID_Connect","articles":[]},{"title":"1.3.2. SAML 2.0","level":"4.1.1.3.2","depth":4,"anchor":"#18_____1_3_2__SAML_2_0","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#18_____1_3_2__SAML_2_0","articles":[]},{"title":"1.3.3. OpenID Connect 与 SAML","level":"4.1.1.3.3","depth":4,"anchor":"#19_____1_3_3__OpenID_Connect_与_SAML","path":"03_Securing Applications and Services Guide.md","ref":"03_Securing Applications and Services Guide.md#19_____1_3_3__OpenID_Connect_与_SAML","articles":[]}]}]},"previous":{"title":"10.4. Keycloak标识头","level":"3.1.10.4","depth":3,"anchor":"#110____10_4__Keycloak标识头","path":"02_Server Installation and Configuration Guide.md","ref":"02_Server Installation and Configuration Guide.md#110____10_4__Keycloak标识头","articles":[]},"dir":"ltr"},"config":{"plugins":["github@^2.0.0","edit-link@^2.0.2","anchors@^0.7.1","include-codeblock@^3.0.2","splitter@^0.0.8","tbfed-pagefooter@^0.0.1","expandable-chapters-small@^0.1.7","anchor-navigation-ex@0.1.8","book-summary-scroll-position-saver","ace","emphasize","-lunr","-search","search-plus"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright © WS 2019","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"emphasize":{},"ace":{},"github":{"url":"https://github.com/wjw465150/KeycloakGuid"},"book-summary-scroll-position-saver":{},"splitter":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"anchor-navigation-ex":{"isRewritePageTitle":false,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right"},"expandable-chapters-small":{},"include-codeblock":{"check":false,"edit":true,"fixlang":false,"lang":"","template":"ace","theme":"chrome","unindent":true},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"编辑此页面","base":"https://github.com/wjw465150/KeycloakGuid/edit/master"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{},"search-plus":{}},"theme":"default","author":"WS","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"KeycloakGuid中文版","language":"zh-hans","gitbook":"*","description":"KeycloakGuid中文版"},"file":{"path":"03_Securing Applications and Services Guide.md","mtime":"2021-01-04T12:08:11.294Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-01-04T12:13:33.799Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-book-summary-scroll-position-saver/book-summary-scroll-position-saver.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ace/ace/ace.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ace/ace.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

